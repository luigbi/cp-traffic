VERSION 5.00
Object = "{0ECD9B60-23AA-11D0-B351-00A0C9055D8E}#6.0#0"; "MSHFLXGD.OCX"
Begin VB.Form Copy 
   Appearance      =   0  'Flat
   BorderStyle     =   3  'Fixed Dialog
   ClientHeight    =   6240
   ClientLeft      =   5010
   ClientTop       =   3795
   ClientWidth     =   9645
   ControlBox      =   0   'False
   BeginProperty Font 
      Name            =   "Arial"
      Size            =   8.25
      Charset         =   0
      Weight          =   700
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   ForeColor       =   &H80000008&
   LinkMode        =   1  'Source
   LinkTopic       =   "DoneMsg"
   MaxButton       =   0   'False
   MDIChild        =   -1  'True
   MinButton       =   0   'False
   PaletteMode     =   1  'UseZOrder
   ScaleHeight     =   6240
   ScaleWidth      =   9645
   Begin VB.PictureBox picISCI_Filter 
      Appearance      =   0  'Flat
      BackColor       =   &H00BFFFFF&
      ForeColor       =   &H80000008&
      Height          =   750
      Left            =   8385
      ScaleHeight     =   720
      ScaleWidth      =   3810
      TabIndex        =   160
      Top             =   8475
      Width           =   3840
      Begin VB.Frame fraFilter 
         BackColor       =   &H00BFFFFF&
         BorderStyle     =   0  'None
         Caption         =   "Frame1"
         Height          =   1620
         Left            =   90
         TabIndex        =   161
         Top             =   75
         Width           =   2775
         Begin VB.TextBox txtISCI_Filter 
            Appearance      =   0  'Flat
            Height          =   315
            Left            =   915
            MaxLength       =   20
            TabIndex        =   163
            TabStop         =   0   'False
            ToolTipText     =   "Type here to filter records by ISCI code"
            Top             =   0
            Width           =   1380
         End
         Begin VB.CheckBox chkKeepRecordsWithValues 
            BackColor       =   &H00BFFFFF&
            Caption         =   "Keep Records With Values"
            BeginProperty Font 
               Name            =   "Arial Narrow"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   0
            TabIndex        =   162
            TabStop         =   0   'False
            ToolTipText     =   "When filtering, results will always include records with %Ratio values"
            Top             =   315
            Value           =   1  'Checked
            Width           =   2505
         End
         Begin VB.Label lblISCI_Filter 
            BackColor       =   &H80000018&
            BackStyle       =   0  'Transparent
            Caption         =   "ISCI Filter:"
            Height          =   225
            Left            =   15
            TabIndex        =   164
            Top             =   45
            Width           =   975
         End
         Begin VB.Image imgFilter_ISCI 
            Height          =   300
            Left            =   -45
            Picture         =   "Copy.frx":0000
            Top             =   15
            Visible         =   0   'False
            Width           =   300
         End
      End
   End
   Begin VB.CommandButton cmcPool 
      Appearance      =   0  'Flat
      Caption         =   "P&ool"
      Height          =   285
      HelpContextID   =   1
      Left            =   8625
      TabIndex        =   68
      Top             =   5820
      Width           =   735
   End
   Begin VB.TextBox edcGridTotal 
      Appearance      =   0  'Flat
      BackColor       =   &H00C0FFFF&
      Height          =   600
      Left            =   5205
      Locked          =   -1  'True
      MultiLine       =   -1  'True
      TabIndex        =   159
      TabStop         =   0   'False
      Top             =   5055
      Visible         =   0   'False
      Width           =   1080
   End
   Begin VB.PictureBox plcCalendar 
      Appearance      =   0  'Flat
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   1770
      Left            =   5280
      ScaleHeight     =   1740
      ScaleWidth      =   1965
      TabIndex        =   53
      TabStop         =   0   'False
      Top             =   1440
      Visible         =   0   'False
      Width           =   1995
      Begin VB.CommandButton cmcCalUp 
         Appearance      =   0  'Flat
         Caption         =   "t"
         BeginProperty Font 
            Name            =   "Monotype Sorts"
            Size            =   8.25
            Charset         =   2
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   225
         Left            =   1635
         TabIndex        =   56
         TabStop         =   0   'False
         Top             =   45
         Width           =   285
      End
      Begin VB.CommandButton cmcCalDn 
         Appearance      =   0  'Flat
         Caption         =   "s"
         BeginProperty Font 
            Name            =   "Monotype Sorts"
            Size            =   8.25
            Charset         =   2
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   225
         Left            =   45
         TabIndex        =   54
         TabStop         =   0   'False
         Top             =   60
         Width           =   285
      End
      Begin VB.PictureBox pbcCalendar 
         Appearance      =   0  'Flat
         BackColor       =   &H80000005&
         ClipControls    =   0   'False
         ForeColor       =   &H00FF0000&
         Height          =   1440
         Left            =   45
         Picture         =   "Copy.frx":038A
         ScaleHeight     =   1410
         ScaleWidth      =   1845
         TabIndex        =   57
         TabStop         =   0   'False
         Top             =   270
         Width           =   1875
         Begin VB.Label lacDate 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00FF0000&
            BorderStyle     =   1  'Fixed Single
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00FFFFFF&
            Height          =   240
            Left            =   510
            TabIndex        =   58
            Top             =   390
            Visible         =   0   'False
            Width           =   300
         End
      End
      Begin VB.Label lacCalName 
         Alignment       =   2  'Center
         Appearance      =   0  'Flat
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   210
         Left            =   330
         TabIndex        =   55
         Top             =   60
         Width           =   1305
      End
   End
   Begin VB.PictureBox plcTme 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      ForeColor       =   &H80000008&
      Height          =   1410
      Left            =   3810
      ScaleHeight     =   1380
      ScaleWidth      =   1095
      TabIndex        =   59
      TabStop         =   0   'False
      Top             =   3420
      Visible         =   0   'False
      Width           =   1125
      Begin VB.PictureBox pbcTme 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         ForeColor       =   &H00FF0000&
         Height          =   1305
         Left            =   30
         Picture         =   "Copy.frx":31A4
         ScaleHeight     =   1305
         ScaleWidth      =   1020
         TabIndex        =   60
         TabStop         =   0   'False
         Top             =   30
         Width           =   1020
         Begin VB.Image imcTmeOutline 
            Appearance      =   0  'Flat
            BorderStyle     =   1  'Fixed Single
            Enabled         =   0   'False
            Height          =   285
            Left            =   330
            Top             =   270
            Visible         =   0   'False
            Width           =   360
         End
         Begin VB.Image imcTmeInv 
            Appearance      =   0  'Flat
            Enabled         =   0   'False
            Height          =   480
            Left            =   360
            Picture         =   "Copy.frx":3E62
            Top             =   765
            Visible         =   0   'False
            Width           =   480
         End
      End
   End
   Begin VB.CommandButton cmcGrid 
      Appearance      =   0  'Flat
      Caption         =   "&Grids"
      Height          =   285
      HelpContextID   =   6
      Left            =   9360
      TabIndex        =   158
      Top             =   105
      Visible         =   0   'False
      Width           =   735
   End
   Begin VB.TextBox edcRGComment 
      Appearance      =   0  'Flat
      BackColor       =   &H00FFFF00&
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   1005
      HelpContextID   =   8
      Left            =   5760
      MultiLine       =   -1  'True
      ScrollBars      =   2  'Vertical
      TabIndex        =   147
      Top             =   3360
      Visible         =   0   'False
      Width           =   5025
   End
   Begin VB.TextBox edcGridHelp 
      Appearance      =   0  'Flat
      BackColor       =   &H00C0FFFF&
      Height          =   600
      Left            =   165
      Locked          =   -1  'True
      MultiLine       =   -1  'True
      TabIndex        =   157
      TabStop         =   0   'False
      Top             =   5055
      Visible         =   0   'False
      Width           =   5040
   End
   Begin VB.ListBox lbcRGVehicle 
      Appearance      =   0  'Flat
      Height          =   240
      ItemData        =   "Copy.frx":416C
      Left            =   5070
      List            =   "Copy.frx":416E
      MultiSelect     =   2  'Extended
      TabIndex        =   145
      TabStop         =   0   'False
      Top             =   4695
      Visible         =   0   'False
      Width           =   2280
   End
   Begin VB.TextBox edcToolTip 
      Appearance      =   0  'Flat
      BackColor       =   &H00C0FFFF&
      Height          =   540
      HideSelection   =   0   'False
      Left            =   165
      Locked          =   -1  'True
      MultiLine       =   -1  'True
      TabIndex        =   155
      Top             =   4965
      Visible         =   0   'False
      Width           =   2280
   End
   Begin VB.PictureBox pbcSetFocus 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   45
      Left            =   15
      ScaleHeight     =   45
      ScaleWidth      =   45
      TabIndex        =   154
      TabStop         =   0   'False
      Top             =   6135
      Width           =   45
   End
   Begin VB.ListBox lbcVehicle 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   7860
      MultiSelect     =   2  'Extended
      TabIndex        =   52
      TabStop         =   0   'False
      Top             =   2400
      Visible         =   0   'False
      Width           =   2940
   End
   Begin VB.ListBox lbcRGSelection 
      Appearance      =   0  'Flat
      Height          =   240
      Index           =   5
      ItemData        =   "Copy.frx":4170
      Left            =   6435
      List            =   "Copy.frx":4172
      MultiSelect     =   2  'Extended
      Sorted          =   -1  'True
      TabIndex        =   144
      TabStop         =   0   'False
      Top             =   5190
      Visible         =   0   'False
      Width           =   2280
   End
   Begin VB.ListBox lbcRGSelection 
      Appearance      =   0  'Flat
      Height          =   240
      Index           =   4
      ItemData        =   "Copy.frx":4174
      Left            =   6255
      List            =   "Copy.frx":4176
      MultiSelect     =   2  'Extended
      Sorted          =   -1  'True
      TabIndex        =   143
      TabStop         =   0   'False
      Top             =   5325
      Visible         =   0   'False
      Width           =   2280
   End
   Begin VB.ListBox lbcRGSelection 
      Appearance      =   0  'Flat
      Height          =   240
      Index           =   3
      ItemData        =   "Copy.frx":4178
      Left            =   6090
      List            =   "Copy.frx":417A
      MultiSelect     =   2  'Extended
      Sorted          =   -1  'True
      TabIndex        =   142
      TabStop         =   0   'False
      Top             =   5475
      Visible         =   0   'False
      Width           =   2280
   End
   Begin VB.ListBox lbcRGSelection 
      Appearance      =   0  'Flat
      Height          =   240
      Index           =   2
      ItemData        =   "Copy.frx":417C
      Left            =   5985
      List            =   "Copy.frx":417E
      MultiSelect     =   2  'Extended
      Sorted          =   -1  'True
      TabIndex        =   141
      TabStop         =   0   'False
      Top             =   5550
      Visible         =   0   'False
      Width           =   2280
   End
   Begin VB.ListBox lbcRGSelection 
      Appearance      =   0  'Flat
      Height          =   240
      Index           =   1
      ItemData        =   "Copy.frx":4180
      Left            =   5880
      List            =   "Copy.frx":4182
      MultiSelect     =   2  'Extended
      Sorted          =   -1  'True
      TabIndex        =   140
      TabStop         =   0   'False
      Top             =   5700
      Visible         =   0   'False
      Width           =   2280
   End
   Begin VB.TextBox edcRGMultiSelect 
      Appearance      =   0  'Flat
      BackColor       =   &H00FFFF00&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   210
      Left            =   2775
      Locked          =   -1  'True
      TabIndex        =   153
      Text            =   "Multi-Select"
      Top             =   5160
      Visible         =   0   'False
      Width           =   1020
   End
   Begin VB.CommandButton cmcRGDropdown 
      Appearance      =   0  'Flat
      Caption         =   "t"
      BeginProperty Font 
         Name            =   "Monotype Sorts"
         Size            =   5.25
         Charset         =   2
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   210
      Left            =   3285
      Picture         =   "Copy.frx":4184
      TabIndex        =   136
      TabStop         =   0   'False
      Top             =   4890
      Visible         =   0   'False
      Width           =   195
   End
   Begin VB.ListBox lbcRGAdvt 
      Appearance      =   0  'Flat
      Height          =   240
      ItemData        =   "Copy.frx":427E
      Left            =   4500
      List            =   "Copy.frx":4280
      Sorted          =   -1  'True
      TabIndex        =   146
      TabStop         =   0   'False
      Top             =   4875
      Visible         =   0   'False
      Width           =   2280
   End
   Begin VB.ListBox lbcRGSelection 
      Appearance      =   0  'Flat
      Height          =   240
      Index           =   0
      ItemData        =   "Copy.frx":4282
      Left            =   4455
      List            =   "Copy.frx":4284
      MultiSelect     =   2  'Extended
      Sorted          =   -1  'True
      TabIndex        =   139
      TabStop         =   0   'False
      Top             =   5280
      Visible         =   0   'False
      Width           =   2280
   End
   Begin VB.ListBox lbcRGCategory 
      Appearance      =   0  'Flat
      Height          =   240
      ItemData        =   "Copy.frx":4286
      Left            =   3060
      List            =   "Copy.frx":4288
      TabIndex        =   138
      TabStop         =   0   'False
      Top             =   5220
      Visible         =   0   'False
      Width           =   2280
   End
   Begin VB.ListBox lbcRGRegion 
      Appearance      =   0  'Flat
      Height          =   240
      ItemData        =   "Copy.frx":428A
      Left            =   2880
      List            =   "Copy.frx":428C
      Sorted          =   -1  'True
      TabIndex        =   137
      TabStop         =   0   'False
      Top             =   5385
      Visible         =   0   'False
      Width           =   2280
   End
   Begin VB.PictureBox pbcRGInclExcl 
      Appearance      =   0  'Flat
      BackColor       =   &H00FF0000&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00FFFFFF&
      Height          =   210
      Left            =   3735
      ScaleHeight     =   210
      ScaleWidth      =   690
      TabIndex        =   134
      TabStop         =   0   'False
      Top             =   5115
      Visible         =   0   'False
      Width           =   690
   End
   Begin VB.TextBox edcCGDropdown 
      Appearance      =   0  'Flat
      BackColor       =   &H00FFFF00&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   210
      Left            =   7140
      MaxLength       =   20
      TabIndex        =   151
      Top             =   4995
      Visible         =   0   'False
      Width           =   795
   End
   Begin VB.TextBox edcRGDropdown 
      Appearance      =   0  'Flat
      BackColor       =   &H00FFFF00&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   210
      Left            =   3495
      MaxLength       =   20
      TabIndex        =   135
      Top             =   4890
      Visible         =   0   'False
      Width           =   1020
   End
   Begin VB.PictureBox pbcArrow 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   180
      Left            =   15
      Picture         =   "Copy.frx":428E
      ScaleHeight     =   180
      ScaleWidth      =   105
      TabIndex        =   131
      TabStop         =   0   'False
      Top             =   5295
      Visible         =   0   'False
      Width           =   105
   End
   Begin VB.PictureBox pbcCGTab 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   105
      Left            =   510
      ScaleHeight     =   105
      ScaleWidth      =   60
      TabIndex        =   152
      Top             =   6120
      Width           =   60
   End
   Begin VB.PictureBox pbcKey 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   4890
      Left            =   1365
      Picture         =   "Copy.frx":4598
      ScaleHeight     =   4860
      ScaleWidth      =   5970
      TabIndex        =   123
      TabStop         =   0   'False
      Top             =   6105
      Visible         =   0   'False
      Width           =   6000
   End
   Begin MSHierarchicalFlexGridLib.MSHFlexGrid grdCopy 
      Height          =   960
      Left            =   2835
      TabIndex        =   150
      TabStop         =   0   'False
      Top             =   4920
      Visible         =   0   'False
      Width           =   5700
      _ExtentX        =   10054
      _ExtentY        =   1693
      _Version        =   393216
      Cols            =   10
      FixedCols       =   0
      BackColorBkg    =   12648447
      BackColorUnpopulated=   12648447
      GridColor       =   -2147483635
      GridColorFixed  =   -2147483635
      AllowBigSelection=   0   'False
      FocusRect       =   0
      HighLight       =   0
      GridLinesFixed  =   1
      ScrollBars      =   2
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Arial"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      _NumberOfBands  =   1
      _Band(0).Cols   =   10
   End
   Begin VB.PictureBox pbcCGSTab 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   105
      Left            =   270
      ScaleHeight     =   105
      ScaleWidth      =   60
      TabIndex        =   149
      Top             =   6135
      Width           =   60
   End
   Begin VB.PictureBox pbcRGSTab 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   105
      Left            =   30
      ScaleHeight     =   105
      ScaleWidth      =   60
      TabIndex        =   132
      Top             =   5700
      Width           =   60
   End
   Begin VB.PictureBox pbcRGTab 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   105
      Left            =   45
      ScaleHeight     =   105
      ScaleWidth      =   60
      TabIndex        =   148
      Top             =   5835
      Width           =   60
   End
   Begin VB.PictureBox plcRotInfo 
      Appearance      =   0  'Flat
      BackColor       =   &H00FFFF80&
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   3780
      Left            =   8685
      ScaleHeight     =   3750
      ScaleWidth      =   5190
      TabIndex        =   92
      TabStop         =   0   'False
      Top             =   1980
      Visible         =   0   'False
      Width           =   5220
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Last Assignment Done: Date xx/xx/xx   Time xx:xx:xxam"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   15
         Left            =   120
         TabIndex        =   112
         Top             =   3240
         Width           =   7725
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Bulk Feed: Send on xx/xx/xx"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   16
         Left            =   135
         TabIndex        =   111
         Top             =   3450
         Width           =   7725
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Rotation: #  by user name"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   10
         Left            =   105
         TabIndex        =   110
         Top             =   2190
         Width           =   5040
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Entered Date xx/xx/xx    Version Date xx/xx/xx   Modified xx Times"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   11
         Left            =   105
         TabIndex        =   109
         Top             =   2400
         Width           =   7800
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Date Range Assigned To:  Earliest xx/xx/xx   Latest xx/xx/xx"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   12
         Left            =   120
         TabIndex        =   108
         Top             =   2610
         Width           =   6330
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Last Assignment Done: Date xx/xx/xx   Time xx:xx:xxam"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   13
         Left            =   105
         TabIndex        =   107
         Top             =   2820
         Width           =   7725
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Bulk Feed: Send on xx/xx/xx"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   14
         Left            =   90
         TabIndex        =   106
         Top             =   3030
         Width           =   7725
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Rotation: #  by user name"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   5
         Left            =   105
         TabIndex        =   105
         Top             =   1140
         Width           =   5040
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Entered Date xx/xx/xx    Version Date xx/xx/xx   Modified xx Times"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   6
         Left            =   105
         TabIndex        =   104
         Top             =   1350
         Width           =   7800
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Date Range Assigned To:  Earliest xx/xx/xx   Latest xx/xx/xx"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   7
         Left            =   105
         TabIndex        =   103
         Top             =   1560
         Width           =   6330
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Last Assignment Done: Date xx/xx/xx   Time xx:xx:xxam"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   8
         Left            =   105
         TabIndex        =   102
         Top             =   1755
         Width           =   7725
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Bulk Feed: Send on xx/xx/xx"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   9
         Left            =   120
         TabIndex        =   101
         Top             =   1980
         Width           =   7725
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Bulk Feed: Send on xx/xx/xx"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   4
         Left            =   105
         TabIndex        =   97
         Top             =   930
         Width           =   7725
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Last Assignment Done: Date xx/xx/xx   Time xx:xx:xxam"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   3
         Left            =   105
         TabIndex        =   96
         Top             =   720
         Width           =   7725
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Date Range Assigned To:  Earliest xx/xx/xx   Latest xx/xx/xx"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   2
         Left            =   105
         TabIndex        =   95
         Top             =   510
         Width           =   6330
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Entered Date xx/xx/xx    Version Date xx/xx/xx   Modified xx Times"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   1
         Left            =   105
         TabIndex        =   94
         Top             =   300
         Width           =   7800
      End
      Begin VB.Label lacRotInfo 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF80&
         Caption         =   "Rotation: #  by user name"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000008&
         Height          =   225
         Index           =   0
         Left            =   105
         TabIndex        =   93
         Top             =   75
         Width           =   5040
      End
   End
   Begin VB.ListBox lbcRot 
      Appearance      =   0  'Flat
      Height          =   1920
      ItemData        =   "Copy.frx":62F8A
      Left            =   9120
      List            =   "Copy.frx":62F8C
      TabIndex        =   5
      TabStop         =   0   'False
      Top             =   5820
      Visible         =   0   'False
      Width           =   9255
   End
   Begin VB.ListBox lbcAvail 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   4050
      TabIndex        =   48
      TabStop         =   0   'False
      Top             =   1110
      Visible         =   0   'False
      Width           =   2280
   End
   Begin VB.ListBox lbcLen 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   8745
      TabIndex        =   46
      TabStop         =   0   'False
      Top             =   1335
      Visible         =   0   'False
      Width           =   960
   End
   Begin VB.ListBox lbcHistory 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   3645
      MultiSelect     =   2  'Extended
      TabIndex        =   100
      TabStop         =   0   'False
      Top             =   1170
      Visible         =   0   'False
      Width           =   1065
   End
   Begin VB.ListBox lbcCntr 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   1875
      TabIndex        =   50
      TabStop         =   0   'False
      Top             =   1395
      Visible         =   0   'False
      Width           =   5535
   End
   Begin VB.ListBox lbcExpandActive 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   4860
      MultiSelect     =   2  'Extended
      TabIndex        =   117
      TabStop         =   0   'False
      Top             =   1230
      Visible         =   0   'False
      Width           =   1650
   End
   Begin VB.ListBox lbcExpandHistory 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   2955
      MultiSelect     =   2  'Extended
      TabIndex        =   119
      TabStop         =   0   'False
      Top             =   1425
      Visible         =   0   'False
      Width           =   1650
   End
   Begin VB.ListBox lbcMGCopyAssign 
      Appearance      =   0  'Flat
      Height          =   240
      ItemData        =   "Copy.frx":62F8E
      Left            =   3000
      List            =   "Copy.frx":62F90
      TabIndex        =   51
      TabStop         =   0   'False
      Top             =   1620
      Visible         =   0   'False
      Width           =   5700
   End
   Begin VB.ListBox lbcZones 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   1980
      TabIndex        =   45
      TabStop         =   0   'False
      Top             =   1815
      Visible         =   0   'False
      Width           =   6030
   End
   Begin VB.ListBox lbcType 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   3000
      TabIndex        =   47
      TabStop         =   0   'False
      Top             =   2190
      Visible         =   0   'False
      Width           =   1380
   End
   Begin VB.ListBox lbcShtTitle 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   3060
      TabIndex        =   49
      TabStop         =   0   'False
      Top             =   3015
      Visible         =   0   'False
      Width           =   2685
   End
   Begin VB.CommandButton cmcMoveComment 
      Appearance      =   0  'Flat
      Caption         =   "&Copy Contract Comment to Rotation Comment"
      Height          =   240
      HelpContextID   =   1
      Left            =   4305
      TabIndex        =   12
      TabStop         =   0   'False
      Top             =   4110
      Visible         =   0   'False
      Width           =   5025
   End
   Begin VB.PictureBox pbcAirGame 
      Appearance      =   0  'Flat
      BackColor       =   &H0080FF80&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   3360
      Left            =   8415
      ScaleHeight     =   3360
      ScaleWidth      =   5160
      TabIndex        =   13
      Top             =   1695
      Visible         =   0   'False
      Width           =   5160
      Begin VB.PictureBox pbcAGTab 
         Appearance      =   0  'Flat
         BackColor       =   &H0080FF80&
         BorderStyle     =   0  'None
         ForeColor       =   &H80000008&
         Height          =   105
         Left            =   15
         ScaleHeight     =   105
         ScaleWidth      =   75
         TabIndex        =   39
         Top             =   3195
         Width           =   75
      End
      Begin VB.PictureBox pbcAGSTab 
         Appearance      =   0  'Flat
         BackColor       =   &H0080FF80&
         BorderStyle     =   0  'None
         ForeColor       =   &H80000008&
         Height          =   90
         Left            =   0
         ScaleHeight     =   90
         ScaleWidth      =   60
         TabIndex        =   14
         Top             =   0
         Width           =   60
      End
      Begin VB.OptionButton rbcAirTimeCopyBy 
         BackColor       =   &H0080FF80&
         Caption         =   "Time/Day"
         Height          =   210
         Index           =   0
         Left            =   2085
         TabIndex        =   16
         Top             =   165
         Width           =   1125
      End
      Begin VB.OptionButton rbcAirTimeCopyBy 
         BackColor       =   &H0080FF80&
         Caption         =   "Event #"
         Height          =   210
         Index           =   1
         Left            =   3210
         TabIndex        =   17
         Top             =   165
         Width           =   1035
      End
      Begin VB.OptionButton rbcAirTimeCopyBy 
         BackColor       =   &H0080FF80&
         Caption         =   "Team"
         Height          =   210
         Index           =   2
         Left            =   4215
         TabIndex        =   18
         Top             =   165
         Width           =   825
      End
      Begin VB.Frame frcTeam 
         BackColor       =   &H0080FF80&
         Caption         =   "Team"
         Height          =   1950
         Left            =   900
         TabIndex        =   37
         Top             =   1860
         Visible         =   0   'False
         Width           =   3870
         Begin VB.ListBox lbcTeam 
            Appearance      =   0  'Flat
            Height          =   1500
            ItemData        =   "Copy.frx":62F92
            Left            =   270
            List            =   "Copy.frx":62F94
            MultiSelect     =   2  'Extended
            Sorted          =   -1  'True
            TabIndex        =   38
            TabStop         =   0   'False
            Top             =   285
            Width           =   3315
         End
      End
      Begin VB.Frame frcGameNo 
         BackColor       =   &H0080FF80&
         Caption         =   "Event #"
         Height          =   2670
         Left            =   375
         TabIndex        =   32
         Top             =   1035
         Visible         =   0   'False
         Width           =   4710
         Begin VB.ListBox lbcGameNo 
            Appearance      =   0  'Flat
            Height          =   1920
            ItemData        =   "Copy.frx":62F96
            Left            =   90
            List            =   "Copy.frx":62F98
            MultiSelect     =   2  'Extended
            TabIndex        =   36
            TabStop         =   0   'False
            Top             =   630
            Width           =   4500
         End
         Begin VB.OptionButton rbcSortGameBy 
            BackColor       =   &H0080FF80&
            Caption         =   "Date"
            Height          =   240
            Index           =   0
            Left            =   1485
            TabIndex        =   34
            Top             =   345
            Value           =   -1  'True
            Width           =   795
         End
         Begin VB.OptionButton rbcSortGameBy 
            BackColor       =   &H0080FF80&
            Caption         =   "Number"
            Height          =   240
            Index           =   1
            Left            =   2310
            TabIndex        =   35
            Top             =   345
            Width           =   1095
         End
         Begin VB.Label lacGameNo 
            BackColor       =   &H0080FF80&
            Caption         =   "Sort Events By"
            Height          =   210
            Left            =   120
            TabIndex        =   33
            Top             =   345
            Width           =   1365
         End
      End
      Begin VB.Frame frcTimeDay 
         BackColor       =   &H0080FF80&
         Caption         =   "Time/Day"
         Height          =   1260
         Left            =   165
         TabIndex        =   19
         Top             =   495
         Visible         =   0   'False
         Width           =   4665
         Begin VB.TextBox edcTimeDay 
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFF00&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   210
            Index           =   0
            Left            =   1215
            MaxLength       =   20
            TabIndex        =   21
            Top             =   330
            Width           =   1020
         End
         Begin VB.TextBox edcTimeDay 
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFF00&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   210
            Index           =   1
            Left            =   3045
            MaxLength       =   20
            TabIndex        =   23
            Top             =   330
            Width           =   1020
         End
         Begin VB.CommandButton cmcTimeDay 
            Appearance      =   0  'Flat
            Caption         =   "t"
            BeginProperty Font 
               Name            =   "Monotype Sorts"
               Size            =   5.25
               Charset         =   2
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   210
            Index           =   0
            Left            =   2250
            Picture         =   "Copy.frx":62F9A
            TabIndex        =   22
            TabStop         =   0   'False
            Top             =   330
            Width           =   195
         End
         Begin VB.CommandButton cmcTimeDay 
            Appearance      =   0  'Flat
            Caption         =   "t"
            BeginProperty Font 
               Name            =   "Monotype Sorts"
               Size            =   5.25
               Charset         =   2
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   210
            Index           =   1
            Left            =   4065
            Picture         =   "Copy.frx":63094
            TabIndex        =   24
            TabStop         =   0   'False
            Top             =   330
            Width           =   195
         End
         Begin VB.CheckBox ckcTimeDay 
            BackColor       =   &H0080FF80&
            Caption         =   "Mo"
            Height          =   270
            Index           =   0
            Left            =   210
            TabIndex        =   25
            Top             =   705
            Width           =   630
         End
         Begin VB.CheckBox ckcTimeDay 
            BackColor       =   &H0080FF80&
            Caption         =   "Tu"
            Height          =   270
            Index           =   1
            Left            =   840
            TabIndex        =   26
            Top             =   705
            Width           =   585
         End
         Begin VB.CheckBox ckcTimeDay 
            BackColor       =   &H0080FF80&
            Caption         =   "We"
            Height          =   270
            Index           =   2
            Left            =   1470
            TabIndex        =   27
            Top             =   705
            Width           =   630
         End
         Begin VB.CheckBox ckcTimeDay 
            BackColor       =   &H0080FF80&
            Caption         =   "Th"
            Height          =   270
            Index           =   3
            Left            =   2100
            TabIndex        =   28
            Top             =   705
            Width           =   630
         End
         Begin VB.CheckBox ckcTimeDay 
            BackColor       =   &H0080FF80&
            Caption         =   "Fr"
            Height          =   270
            Index           =   4
            Left            =   2730
            TabIndex        =   29
            Top             =   690
            Width           =   630
         End
         Begin VB.CheckBox ckcTimeDay 
            BackColor       =   &H0080FF80&
            Caption         =   "Sa"
            Height          =   270
            Index           =   5
            Left            =   3360
            TabIndex        =   30
            Top             =   705
            Width           =   630
         End
         Begin VB.CheckBox ckcTimeDay 
            BackColor       =   &H0080FF80&
            Caption         =   "Su"
            Height          =   270
            Index           =   6
            Left            =   3990
            TabIndex        =   31
            Top             =   705
            Width           =   630
         End
         Begin VB.Label lacTimeDay 
            BackColor       =   &H0080FF80&
            Caption         =   "Time: Start                                  End"
            Height          =   285
            Left            =   210
            TabIndex        =   20
            Top             =   315
            Width           =   4110
         End
      End
      Begin VB.Label lacAirGameBy 
         BackColor       =   &H0080FF80&
         Caption         =   "Event Vehicle Copy By"
         Height          =   255
         Left            =   120
         TabIndex        =   15
         Top             =   165
         Width           =   1920
      End
   End
   Begin MSHierarchicalFlexGridLib.MSHFlexGrid grdRot 
      Height          =   3090
      Left            =   4980
      TabIndex        =   133
      TabStop         =   0   'False
      Top             =   1110
      Visible         =   0   'False
      Width           =   8910
      _ExtentX        =   15716
      _ExtentY        =   5450
      _Version        =   393216
      BackColor       =   16777215
      Cols            =   14
      FixedCols       =   0
      GridColor       =   -2147483635
      GridColorFixed  =   -2147483635
      AllowBigSelection=   0   'False
      FocusRect       =   0
      HighLight       =   0
      GridLinesFixed  =   1
      ScrollBars      =   2
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Arial"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      _NumberOfBands  =   1
      _Band(0).Cols   =   14
   End
   Begin VB.CheckBox ckcCurrentRot 
      Caption         =   "Current Rotations"
      Height          =   210
      Left            =   45
      TabIndex        =   125
      Top             =   270
      Value           =   1  'Checked
      Width           =   1800
   End
   Begin VB.CheckBox ckcIncludeMG 
      Caption         =   "Unique MG Vehicles"
      Height          =   210
      Left            =   2070
      TabIndex        =   124
      Top             =   270
      Width           =   2070
   End
   Begin VB.PictureBox pbcYN 
      Appearance      =   0  'Flat
      BackColor       =   &H00FF0000&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00FFFFFF&
      Height          =   210
      Left            =   1755
      ScaleHeight     =   210
      ScaleWidth      =   210
      TabIndex        =   42
      TabStop         =   0   'False
      Top             =   825
      Visible         =   0   'False
      Width           =   210
   End
   Begin VB.Timer tmcTerminate 
      Enabled         =   0   'False
      Interval        =   1000
      Left            =   75
      Top             =   5145
   End
   Begin VB.PictureBox pbcLbcRot 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      Enabled         =   0   'False
      ForeColor       =   &H80000008&
      Height          =   1875
      Left            =   8985
      ScaleHeight     =   1875
      ScaleWidth      =   8985
      TabIndex        =   120
      TabStop         =   0   'False
      Top             =   5565
      Visible         =   0   'False
      Width           =   8985
   End
   Begin VB.ListBox lbcExpandPurge 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   3060
      MultiSelect     =   2  'Extended
      TabIndex        =   118
      TabStop         =   0   'False
      Top             =   1485
      Visible         =   0   'False
      Width           =   1650
   End
   Begin VB.CommandButton cmcRegion 
      Appearance      =   0  'Flat
      Caption         =   "&Region"
      Enabled         =   0   'False
      Height          =   285
      HelpContextID   =   6
      Left            =   7890
      TabIndex        =   67
      Top             =   5820
      Width           =   735
   End
   Begin VB.PictureBox pbcForFontSize 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   150
      Left            =   -885
      ScaleHeight     =   120
      ScaleWidth      =   1290
      TabIndex        =   116
      Top             =   4155
      Visible         =   0   'False
      Width           =   1320
   End
   Begin VB.TextBox edcLinkSrceDoneMsg 
      Appearance      =   0  'Flat
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   285
      Left            =   8910
      TabIndex        =   115
      TabStop         =   0   'False
      Top             =   4920
      Visible         =   0   'False
      Width           =   525
   End
   Begin VB.TextBox edcLinkDestHelpMsg 
      Appearance      =   0  'Flat
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   285
      Left            =   8760
      TabIndex        =   114
      TabStop         =   0   'False
      Top             =   4695
      Visible         =   0   'False
      Width           =   525
   End
   Begin VB.TextBox edcLinkSrceHelpMsg 
      Appearance      =   0  'Flat
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   285
      Left            =   8790
      TabIndex        =   113
      Top             =   4845
      Visible         =   0   'False
      Width           =   255
   End
   Begin VB.ListBox lbcActive 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   3285
      MultiSelect     =   2  'Extended
      TabIndex        =   99
      TabStop         =   0   'False
      Top             =   585
      Visible         =   0   'False
      Width           =   1065
   End
   Begin VB.CommandButton cmcInvNo 
      Appearance      =   0  'Flat
      Caption         =   "&Inventory?"
      Height          =   285
      HelpContextID   =   6
      Left            =   6735
      TabIndex        =   66
      Top             =   5820
      Width           =   1125
   End
   Begin VB.CommandButton cmcNewInv 
      Appearance      =   0  'Flat
      Caption         =   "&New Inv"
      Enabled         =   0   'False
      Height          =   285
      HelpContextID   =   6
      Left            =   5895
      TabIndex        =   84
      Top             =   5835
      Width           =   810
   End
   Begin VB.ListBox lbcPurge 
      Appearance      =   0  'Flat
      Height          =   240
      Left            =   -510
      MultiSelect     =   2  'Extended
      TabIndex        =   88
      TabStop         =   0   'False
      Top             =   3750
      Visible         =   0   'False
      Width           =   1065
   End
   Begin VB.CommandButton cmcAsgn 
      Appearance      =   0  'Flat
      Caption         =   "Assig&n"
      Height          =   285
      HelpContextID   =   6
      Left            =   4395
      TabIndex        =   82
      Top             =   5820
      Width           =   735
   End
   Begin VB.CommandButton cmcDone 
      Appearance      =   0  'Flat
      Caption         =   "&Done"
      Height          =   285
      HelpContextID   =   1
      Left            =   600
      TabIndex        =   77
      Top             =   5820
      Width           =   735
   End
   Begin VB.TextBox edcComment 
      Appearance      =   0  'Flat
      BackColor       =   &H00FFFF00&
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   1005
      HelpContextID   =   8
      Left            =   8625
      MultiLine       =   -1  'True
      ScrollBars      =   2  'Vertical
      TabIndex        =   11
      Top             =   2160
      Visible         =   0   'False
      Width           =   5025
   End
   Begin VB.TextBox edcDropDown 
      Appearance      =   0  'Flat
      BackColor       =   &H00FFFF00&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   210
      Left            =   270
      MaxLength       =   20
      TabIndex        =   9
      Top             =   1560
      Visible         =   0   'False
      Width           =   1020
   End
   Begin VB.CommandButton cmcDropDown 
      Appearance      =   0  'Flat
      Caption         =   "t"
      BeginProperty Font 
         Name            =   "Monotype Sorts"
         Size            =   5.25
         Charset         =   2
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   210
      Left            =   3975
      Picture         =   "Copy.frx":6318E
      TabIndex        =   10
      TabStop         =   0   'False
      Top             =   915
      Visible         =   0   'False
      Width           =   195
   End
   Begin VB.PictureBox pbcDay 
      Appearance      =   0  'Flat
      BackColor       =   &H00FF0000&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00FFFFFF&
      Height          =   210
      Left            =   5685
      ScaleHeight     =   210
      ScaleWidth      =   210
      TabIndex        =   43
      TabStop         =   0   'False
      Top             =   885
      Visible         =   0   'False
      Width           =   210
   End
   Begin VB.PictureBox pbcDGWkly 
      Appearance      =   0  'Flat
      BackColor       =   &H00FFFF00&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   210
      Left            =   6975
      ScaleHeight     =   210
      ScaleWidth      =   240
      TabIndex        =   40
      TabStop         =   0   'False
      Top             =   915
      Visible         =   0   'False
      Width           =   240
      Begin VB.CheckBox ckcDGDay 
         Appearance      =   0  'Flat
         BackColor       =   &H80000005&
         BeginProperty Font 
            Name            =   "Arial"
            Size            =   7.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   180
         Left            =   30
         TabIndex        =   41
         Tag             =   "A check indicates that Monday is an airing day for a weekly buy"
         Top             =   15
         Width           =   180
      End
   End
   Begin VB.PictureBox pbcAvType 
      Appearance      =   0  'Flat
      BackColor       =   &H00FF0000&
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00FFFFFF&
      Height          =   210
      Left            =   7350
      ScaleHeight     =   210
      ScaleWidth      =   870
      TabIndex        =   44
      TabStop         =   0   'False
      Top             =   1590
      Visible         =   0   'False
      Width           =   870
   End
   Begin VB.Timer tmcScroll 
      Enabled         =   0   'False
      Interval        =   1000
      Left            =   8100
      Top             =   4455
   End
   Begin VB.CommandButton cmcRot 
      Appearance      =   0  'Flat
      Caption         =   "t"
      BeginProperty Font 
         Name            =   "Monotype Sorts"
         Size            =   5.25
         Charset         =   2
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   210
      Left            =   9030
      Picture         =   "Copy.frx":63288
      TabIndex        =   4
      TabStop         =   0   'False
      Top             =   690
      Width           =   195
   End
   Begin VB.Timer tmcDrag 
      Enabled         =   0   'False
      Interval        =   1000
      Left            =   8100
      Top             =   5040
   End
   Begin VB.Timer tmcClick 
      Interval        =   2000
      Left            =   8085
      Top             =   4695
   End
   Begin VB.TextBox edcLinkDestDoneMsg 
      Appearance      =   0  'Flat
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   285
      Left            =   8775
      TabIndex        =   86
      TabStop         =   0   'False
      Top             =   4395
      Visible         =   0   'False
      Width           =   435
   End
   Begin VB.PictureBox pbcSTab 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   105
      Left            =   15
      ScaleHeight     =   105
      ScaleWidth      =   75
      TabIndex        =   6
      Top             =   405
      Width           =   75
   End
   Begin VB.CommandButton cmcPurge 
      Appearance      =   0  'Flat
      Caption         =   "&Purge"
      Height          =   285
      Left            =   3630
      TabIndex        =   81
      Top             =   5820
      Width           =   735
   End
   Begin VB.PictureBox pbcClickFocus 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   165
      Left            =   30
      ScaleHeight     =   165
      ScaleWidth      =   105
      TabIndex        =   85
      TabStop         =   0   'False
      Top             =   5520
      Width           =   105
   End
   Begin VB.PictureBox plcScreen 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &H00000000&
      Height          =   240
      Left            =   30
      ScaleHeight     =   240
      ScaleWidth      =   1350
      TabIndex        =   0
      TabStop         =   0   'False
      Top             =   30
      Width           =   1350
   End
   Begin VB.CommandButton cmcUndo 
      Appearance      =   0  'Flat
      Caption         =   "&Undo"
      Height          =   285
      HelpContextID   =   6
      Left            =   5160
      TabIndex        =   83
      Top             =   5820
      Width           =   735
   End
   Begin VB.CommandButton cmcErase 
      Appearance      =   0  'Flat
      Caption         =   "&Erase"
      Height          =   285
      HelpContextID   =   4
      Left            =   2865
      TabIndex        =   80
      Top             =   5820
      Width           =   735
   End
   Begin VB.CommandButton cmcUpdate 
      Appearance      =   0  'Flat
      Caption         =   "&Save"
      Height          =   285
      HelpContextID   =   3
      Left            =   2100
      TabIndex        =   79
      Top             =   5820
      Width           =   735
   End
   Begin VB.CommandButton cmcCancel 
      Appearance      =   0  'Flat
      Caption         =   "&Cancel"
      Height          =   285
      HelpContextID   =   2
      Left            =   1335
      TabIndex        =   78
      Top             =   5820
      Width           =   735
   End
   Begin VB.PictureBox plcInst 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   3135
      Left            =   5250
      ScaleHeight     =   3075
      ScaleWidth      =   3780
      TabIndex        =   71
      TabStop         =   0   'False
      Top             =   2340
      Width           =   3840
      Begin VB.CommandButton cmcClear 
         Appearance      =   0  'Flat
         Caption         =   "C&lear"
         Height          =   285
         HelpContextID   =   3
         Left            =   1860
         TabIndex        =   73
         Top             =   30
         Width           =   945
      End
      Begin VB.CommandButton cmcRatio 
         Appearance      =   0  'Flat
         Caption         =   "R&atios"
         Height          =   285
         HelpContextID   =   4
         Left            =   2805
         TabIndex        =   74
         Top             =   30
         Width           =   945
      End
      Begin VB.PictureBox pbcLbcInst 
         Appearance      =   0  'Flat
         BackColor       =   &H80000005&
         BorderStyle     =   0  'None
         Enabled         =   0   'False
         ForeColor       =   &H80000008&
         Height          =   2730
         Left            =   45
         ScaleHeight     =   2730
         ScaleWidth      =   3435
         TabIndex        =   122
         Top             =   330
         Width           =   3435
      End
      Begin VB.ListBox lbcInst 
         Appearance      =   0  'Flat
         Height          =   2760
         ItemData        =   "Copy.frx":63382
         Left            =   30
         List            =   "Copy.frx":63384
         MultiSelect     =   2  'Extended
         TabIndex        =   72
         Top             =   315
         Width           =   3720
      End
   End
   Begin VB.PictureBox plcInv 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   3555
      Left            =   315
      ScaleHeight     =   3495
      ScaleWidth      =   3600
      TabIndex        =   69
      TabStop         =   0   'False
      Top             =   2565
      Width           =   3660
      Begin VB.Frame fraFilter_Main 
         BorderStyle     =   0  'None
         Caption         =   "Frame1"
         Height          =   255
         Left            =   3285
         TabIndex        =   165
         Top             =   15
         Width           =   2715
         Begin VB.TextBox txtISCI_Filter_Main 
            Appearance      =   0  'Flat
            BorderStyle     =   0  'None
            Height          =   240
            Left            =   1245
            MaxLength       =   20
            TabIndex        =   166
            TabStop         =   0   'False
            ToolTipText     =   "Type here to filter records by ISCI code"
            Top             =   30
            Width           =   1380
         End
         Begin VB.Label lblISCI_Filter_Main 
            Caption         =   "ISCI Filter:"
            Height          =   225
            Left            =   330
            TabIndex        =   167
            Top             =   30
            Width           =   975
         End
         Begin VB.Image imgFilter_ISCI_Main 
            Height          =   300
            Left            =   -15
            Picture         =   "Copy.frx":63386
            Top             =   -15
            Visible         =   0   'False
            Width           =   300
         End
      End
      Begin VB.CommandButton cmcInv 
         Appearance      =   0  'Flat
         Caption         =   "New"
         Enabled         =   0   'False
         Height          =   285
         HelpContextID   =   3
         Left            =   1170
         TabIndex        =   126
         Top             =   30
         Width           =   945
      End
      Begin VB.PictureBox pbcLbcInv 
         Appearance      =   0  'Flat
         BackColor       =   &H80000005&
         BorderStyle     =   0  'None
         Enabled         =   0   'False
         ForeColor       =   &H80000008&
         Height          =   2730
         Left            =   45
         ScaleHeight     =   2730
         ScaleWidth      =   2820
         TabIndex        =   121
         Top             =   330
         Width           =   2820
      End
      Begin VB.PictureBox pbcInvStatus 
         Appearance      =   0  'Flat
         BackColor       =   &H00FF0000&
         ForeColor       =   &H00FFFFFF&
         Height          =   210
         Left            =   2145
         ScaleHeight     =   180
         ScaleWidth      =   1020
         TabIndex        =   98
         TabStop         =   0   'False
         Top             =   60
         Width           =   1050
      End
      Begin VB.ListBox lbcInv 
         Appearance      =   0  'Flat
         Height          =   2760
         ItemData        =   "Copy.frx":63710
         Left            =   30
         List            =   "Copy.frx":63712
         MultiSelect     =   2  'Extended
         TabIndex        =   70
         Top             =   315
         Width           =   3135
      End
   End
   Begin VB.PictureBox plcCopy 
      ForeColor       =   &H00000000&
      Height          =   420
      Left            =   4440
      ScaleHeight     =   360
      ScaleWidth      =   4800
      TabIndex        =   1
      TabStop         =   0   'False
      Top             =   45
      Width           =   4860
      Begin VB.ComboBox cbcAdvt 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF00&
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   315
         Left            =   1785
         TabIndex        =   3
         Top             =   15
         Width           =   3030
      End
      Begin VB.ComboBox cbcType 
         Appearance      =   0  'Flat
         BackColor       =   &H00FFFF00&
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   315
         Left            =   30
         TabIndex        =   2
         Top             =   30
         Width           =   1395
      End
   End
   Begin VB.PictureBox plcShow 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &H00000000&
      Height          =   225
      Left            =   360
      ScaleHeight     =   225
      ScaleWidth      =   3165
      TabIndex        =   63
      TabStop         =   0   'False
      Top             =   2355
      Width           =   3165
      Begin VB.OptionButton rbcShow 
         Caption         =   "ISCI Code"
         ForeColor       =   &H80000008&
         Height          =   195
         Index           =   1
         Left            =   1860
         TabIndex        =   65
         TabStop         =   0   'False
         Top             =   15
         Width           =   1110
      End
      Begin VB.OptionButton rbcShow 
         Caption         =   "Inventory"
         ForeColor       =   &H80000008&
         Height          =   195
         Index           =   0
         Left            =   675
         TabIndex        =   64
         Top             =   15
         Value           =   -1  'True
         Width           =   1080
      End
   End
   Begin VB.PictureBox pbcRot 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   495
      Left            =   75
      Picture         =   "Copy.frx":63714
      ScaleHeight     =   495
      ScaleWidth      =   9150
      TabIndex        =   8
      TabStop         =   0   'False
      Top             =   570
      Width           =   9150
   End
   Begin VB.PictureBox plcRot 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00000000&
      Height          =   585
      Left            =   30
      ScaleHeight     =   525
      ScaleWidth      =   9195
      TabIndex        =   7
      TabStop         =   0   'False
      Top             =   525
      Width           =   9255
   End
   Begin VB.PictureBox pbcTab 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   105
      Left            =   0
      ScaleHeight     =   105
      ScaleWidth      =   60
      TabIndex        =   61
      Top             =   1890
      Width           =   60
   End
   Begin VB.CommandButton cmcFLUp 
      Appearance      =   0  'Flat
      Caption         =   "s"
      BeginProperty Font 
         Name            =   "Monotype Sorts"
         Size            =   8.25
         Charset         =   2
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   225
      Left            =   4485
      TabIndex        =   90
      TabStop         =   0   'False
      Top             =   2475
      Width           =   285
   End
   Begin VB.PictureBox pbcFL 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   135
      Left            =   4590
      Picture         =   "Copy.frx":72402
      ScaleHeight     =   135
      ScaleWidth      =   465
      TabIndex        =   89
      TabStop         =   0   'False
      Top             =   2400
      Width           =   465
   End
   Begin VB.PictureBox plcFL 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00000000&
      Height          =   2670
      Left            =   4575
      ScaleHeight     =   2610
      ScaleWidth      =   45
      TabIndex        =   87
      TabStop         =   0   'False
      Top             =   2700
      Width           =   105
   End
   Begin VB.CommandButton cmcFLDn 
      Appearance      =   0  'Flat
      Caption         =   "t"
      BeginProperty Font 
         Name            =   "Monotype Sorts"
         Size            =   8.25
         Charset         =   2
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   225
      Left            =   4485
      TabIndex        =   91
      TabStop         =   0   'False
      Top             =   5355
      Width           =   285
   End
   Begin VB.TextBox edcHdLnComment 
      Appearance      =   0  'Flat
      BackColor       =   &H00FFFFFF&
      Height          =   735
      Left            =   30
      MultiLine       =   -1  'True
      ScrollBars      =   2  'Vertical
      TabIndex        =   62
      TabStop         =   0   'False
      Top             =   1170
      Width           =   9255
   End
   Begin VB.PictureBox pbcDnMove 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   180
      Left            =   4245
      Picture         =   "Copy.frx":725B4
      ScaleHeight     =   180
      ScaleWidth      =   180
      TabIndex        =   127
      TabStop         =   0   'False
      Top             =   3225
      Width           =   180
   End
   Begin VB.CommandButton cmcMoveTo 
      Appearance      =   0  'Flat
      Caption         =   "M&ove   "
      Height          =   300
      Left            =   3645
      TabIndex        =   129
      Top             =   3165
      Width           =   810
   End
   Begin VB.PictureBox pbcUpMove 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   180
      Left            =   3690
      Picture         =   "Copy.frx":7268E
      ScaleHeight     =   180
      ScaleWidth      =   180
      TabIndex        =   128
      TabStop         =   0   'False
      Top             =   4260
      Width           =   180
   End
   Begin VB.CommandButton cmcMoveFrom 
      Appearance      =   0  'Flat
      Caption         =   "    Mo&ve"
      Height          =   300
      Left            =   3645
      TabIndex        =   130
      Top             =   4200
      Width           =   810
   End
   Begin VB.ComboBox cbcBlackout 
      Appearance      =   0  'Flat
      BackColor       =   &H00FFFF00&
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   315
      Left            =   945
      Sorted          =   -1  'True
      TabIndex        =   76
      Top             =   2010
      Width           =   2625
   End
   Begin VB.Label lacToolTip 
      Appearance      =   0  'Flat
      AutoSize        =   -1  'True
      BackColor       =   &H00C0FFFF&
      BorderStyle     =   1  'Fixed Single
      ForeColor       =   &H80000008&
      Height          =   225
      Left            =   3540
      TabIndex        =   156
      Top             =   4050
      Visible         =   0   'False
      Width           =   2910
      WordWrap        =   -1  'True
   End
   Begin VB.Label lacBlackout 
      Caption         =   "Blackout Instructions"
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   6.75
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   315
      Left            =   60
      TabIndex        =   75
      Top             =   1980
      Width           =   780
   End
   Begin VB.Image imcKey 
      Appearance      =   0  'Flat
      Height          =   480
      Left            =   1575
      Picture         =   "Copy.frx":72768
      Top             =   -15
      Width           =   480
   End
   Begin VB.Image imcInst 
      Appearance      =   0  'Flat
      Height          =   225
      Index           =   1
      Left            =   5205
      Top             =   5535
      Width           =   3885
   End
   Begin VB.Image imcInst 
      Appearance      =   0  'Flat
      Height          =   225
      Index           =   0
      Left            =   5220
      Top             =   2130
      Width           =   3870
   End
   Begin VB.Image imcTrash 
      Appearance      =   0  'Flat
      Height          =   480
      Left            =   8835
      Picture         =   "Copy.frx":72A72
      Top             =   5625
      Width           =   480
   End
End
Attribute VB_Name = "Copy"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
'******************************************************************************************
'***** VB Compress Pro 6.11.32 generated this copy of Copy.frm on Wed 6/17/09 @ 12:56 PM **
'***** Mode: AutoSelect Standard Mode (Internal References Only)***************************
'******************************************************************************************
'* Note: VBC id'd the following unreferenced items and handled them as described:         *
'*                                                                                        *
'* Private Procedures (Removed)                                                           *
'*  mSetInvRotDate                                                                        *
'******************************************************************************************

' Copyright 1993 Counterpoint Software, Inc. All rights reserved.
' Proprietary Software, Do not copy
'
' File Name: Copy.Frm
'
' Release: 1.0
'
' Description:
'   This file contains the Copy input screen code
Option Explicit
Option Compare Text

    Dim tmCtrls(0 To 22) As FIELDAREA
    Dim imLBCtrls As Integer
    Dim imFirstActivate As Integer
    Dim imBoxNo As Integer          'Current Rate Card Box
    Dim imTimeDayBoxNo As Integer
    Dim smSave(0 To 7) As String    '1=Contract #; 2= Vehicle Name; 3= Start Date; 4=End Date; 5=Start Time; 6=End Time; 7=Avail name
    Dim imSave(0 To 13) As Integer  '1=Time Zone index; 2=Mon(0=No;1=Yes); 3=Tue; 4=Wed; 5=Th; 6=Fr; 7=Sa; 8=Su;
                                    '9=Length index; 10=Avail Type(0=All;1=Include;2=Exclude); 11=Type index;
                                    '12=Live Copy (0=Live Cmml; 1=Rec Cmml; 2=Live Promo; 3=Rec Promo); 13=MG by(0=Original; 1=Scheduled; 2=Both)
    Dim imSvSave(0 To 13) As Integer
    Dim imSvLive As Integer
    Dim smSvRotStartDate As String
    Dim smSvRotEndDate As String
    Dim imVehPopReq As Integer
    Dim tmAvailCode() As SORTCODE
    Dim smAvailCodeTag As String
    Dim smActiveCodeTag As String
    Dim tmPurgeCode() As SORTCODE
    Dim smPurgeCodeTag As String
    Dim tmHistoryCode() As SORTCODE
    Dim smHistoryCodeTag As String
    Dim tmShtTitleCode() As SORTCODE
    Dim smShtTitleCodeTag As String
    Dim tmCopyNameCode() As SORTCODE
    Dim smRegionCodeTag As String
    Dim tmRegionCode() As SORTCODE
    Dim tmCopyRotCode() As SORTCODE
    Dim tmCopyCntrCode() As SORTCODE
    Dim smCopyCntrCodeTag As String
    Dim lmCifChecked() As Long
    Dim lmCifDateSet() As Long
    Dim tmSetInvRotDate() As SETINVROTDATE
    Dim lmCifCode() As Long
    Dim tmTeam() As MNF
    Dim smTeamTag As String
    Dim tmGsfInfo() As GSFINFO
    Dim imGameVefCode As Integer
    
    Dim imInvStatus As Integer      '0=Active; 1=Purged; 2=History
    Dim imInAllSaveRec As Integer   'Ignore vehicle pop call
    Dim imCheckInv As Integer       'Only check inventory on the first save of a rotation
    Dim imUpdateAllowed As Integer
    Dim imLastUsedRotNo As Integer
    Dim smOrigCntr As String
    Dim smOrigVehicle As String
    Dim smOrigZone As String
    Dim smOrigSDate As String
    Dim imAllowErase As Integer
    Dim smOrigEDate As String
    Dim smOrigSTime As String
    Dim smOrigETime As String
    Dim smOrigType As String
    Dim smOrigAvail As String
    Dim smSeveral As String
    Dim smShtTitle As String        'Short Title, saved to determine if changed
    Dim smInitShtTitle As String    'Short Title, saved to determine if changed
    Dim smComment As String
    Dim smOrigComment As String
    Dim imTerminate As Integer      'True = terminating task, False= OK
    Dim imChgMode As Integer        'Change mode status (so change not entered when in change)
    Dim imBSMode As Integer         'Backspace flag
    Dim imComboBoxIndex As Integer
    Dim imComboBoxIndexAdvt As Integer
    Dim imComboBoxIndexType As Integer
    Dim lmListField(0 To 4) As Long
    Dim lmListFieldRot(0 To 19) As Long
    Dim imAdvtIndex As Integer
    Dim imBlackoutIndex As Integer
    Dim imBlackoutAdfCode As Integer
    Dim imTypeIndex As Integer      '0=Standard; 1=Open BB; 2=Close BB
    Dim imRotIndex As Integer
    Dim imFirstFocusType As Integer
    Dim imFirstFocus As Integer
    Dim imRotChg As Integer
    Dim imLbcMouseDown As Integer   'True=List box mouse down
    Dim imDoubleClickName As Integer 'Name from a list was selected by double clicking
    Dim imLbcArrowSetting As Integer
    Dim imTabDirection As Integer   '0=left to right (Tab); -1=right to left (Shift tab)
    Dim imBypassFocus As Integer    'Bypass gotfocus
    Dim imSelectDelay As Integer    'True=cbcSelect change mode
    Dim imStartMode As Integer
    Dim imRotHeaderChgOnly As Integer    '
    Dim imDoubleClick As Integer
    Dim smMonDefStartDate As String 'First monday after Now or First Monday after Last Log Date
    Dim smDefStartDate As String    'Now+1 or Last Log Date + 1
    Dim smDefaultEndDate As String
    Dim lmNowDate As Long
    Dim imNoRowLbc As Integer       'Number of row in lbcInst
    Dim imButton As Integer         'Value 1= Left button; 2=Right button; 4=Middle button
    Dim imButtonIndex As Integer
    Dim imIgnoreRightMove As Integer
    Dim imAllVehAdj As Integer      '0=[All] Not added to vehicle list, 1=[All] added to vehicle list
    Dim imAskQuestions As Integer   'Only ask question once during save
    Dim imRetailHourGlass As Integer 'Retain HOURGLASS During Save
    Dim imFLValue As Integer        'Final Log Instruction Number (1 Thru x)
    Dim imInitNextFinal As Integer
    Dim lmPrevSupersedeRotStartDate As Long
    Dim lmPrevSupersedeRotEndDate As Long
    Dim imPrevSupersedeAns As Integer
    Dim imEraseStopped As Integer
    Dim bmIDCMsgShown As Boolean
    
'Drag
    Dim imDragIndexSrce As Integer  '
    Dim imDragIndexDest As Integer  '
    Dim fmDragX As Single           'Start x location of drag
    Dim fmDragY As Single           'Start y location
    Dim imDragButton As Integer     'Value 1= Left button; 2=Right button; 4=Middle button
    Dim imDragType As Integer       '0=Start Drag; 1=scroll up; 2= scroll down
    Dim imDragShift As Integer      'Shift state when mouse down event occurrs
    Dim imDragSrce As Integer       'Values defined below
    Dim imDragDest As Integer       'Values defined below
    Dim imDragScroll As Integer     'Object to be scrolled (same values as below)
    Dim imScrollDir As Integer      '0=Page up; 1=Page down
    Const DRAGINV = 1
    Const DRAGINST = 2
    Dim imVpfIndex As Integer       'Vehicle option index
    Dim imVefCode As Integer
    Dim imGameVehicle As Integer
    Dim imAGDirection As Integer    '-1: not set; 0=Top to Bottom; 1=Bottom to Top
    Dim imDateChanged As Integer
    
'Rotation
    Dim tmCrf As CRF                'CRF record image
    Dim tmCrfSrchKey As LONGKEY0    'CRF key record image
    Dim tmCrfSrchKey1 As CRFKEY1    'CRF key record image
    Dim tmCrfSrchKey2 As CRFKEY2    'CRF key record image
    Dim tmCrfSrchKey3 As CRFKEY3    'CRF key record image
    Dim tmCrfSrchKey4 As CRFKEY4    'CRF key record image
    Dim hmCrf As Integer            'CRF Handle
    Dim imCrfRecLen As Integer      'CRF record length
    Dim lmCrfOverlap() As Long      'Record position of records totally overlapped
    Dim hmMcf As Integer            'Media Codes file handle
    
'Instruction
    Dim tmCnf As CNF                'CNF record image
    Dim tmCnfSrchKey As CNFKEY0     'CNF key record image
    Dim hmCnf As Integer            'CNF Handle
    Dim imCnfRecLen As Integer      'CNF record length
    
'Inventory
    Dim tmCif As CIF                'CIF record image
    Dim tmCifSrchKey As LONGKEY0    'CIF key record image
    Dim tmCifSrchKey1 As CIFKEY1    'CIF key record image
    Dim tmCifSrchKey4 As CIFKEY4    'CIF key record image - used for vCreative
    Dim hmCif As Integer            'CIF Handle
    Dim imCifRecLen As Integer      'CIF record length
    Dim bmInvStatusChange As Boolean 'Inv Status Change
    
'Product
    Dim tmCpf As CPF                'CPF record image
    Dim tmCpfSrchKey As LONGKEY0    'CPF key record image
    Dim hmCpf As Integer            'CPF Handle
    Dim imCpfRecLen As Integer      'CPF record length
    
'Comment
    Dim tmCsf As CSF                'CSF record image
    Dim tmCsfSrchKey As LONGKEY0    'CSF key record image
    Dim hmCsf As Integer            'CSF Handle
    Dim imCsfRecLen As Integer      'CSF record length
    
'Copy Feed Date
    Dim tmCyf As CYF                'CYF record image
    Dim tmCyfSrchKey As CYFKEY0     'CYF key record image
    Dim hmCyf As Integer            'CYF Handle
    Dim imCyfRecLen As Integer      'CYF record length
    
    '5882 no longer needed
'IDC Enforced
    'Dim tmIef As IEF               'IEF record image
    'Dim tmIefSrchKey As LONGKEY0   'IEF key record image
    'Dim tmIefSrchKey1 As LONGKEY0  'IEF key record image (GenericCifCode)
    'Dim tmIefSrchKey2 As LONGKEY0  'IEF key record image (SplitRafCode)
    'Dim hmIef As Integer           'IEF Handle
    'Dim imIefRecLen As Integer     'IEF record length
    
'Copy Usage
    Dim tmCuf As CUF                'CUF record image
    Dim tmCufSrchKey As CUFKEY0     'CUF key record image
    Dim tmCufSrchKey1 As CUFKEY1    'CUF key record image
    Dim hmCuf As Integer            'CUF Handle
    Dim imCufRecLen As Integer      'CUF record length
    
'copy vehicle
    Dim tmCvf As CVF                'CVF record image
    Dim tmCvfSrchKey As LONGKEY0    'CVF key record image
    Dim tmCvfSrchKey1 As LONGKEY0   'CVF key record image
    Dim tmCvfSrchKey2 As LONGKEY0   'CVF key record image
    Dim hmCvf As Integer            'CVF Handle
    Dim imCvfRecLen As Integer      'CVF record length
    
'Grid Name
    Dim tmGnf As GNF                'Gpf record image
    Dim tmGnfSrchKey As LONGKEY0    'Gpf key record image
    Dim tmGnfSrchKey1 As GNFKEY1    'Gpf key record image
    Dim tmGnfSrchKey2 As GNFKEY2    'Gpf key record image
    Dim hmGnf As Integer            'Gpf Handle
    Dim imGnfRecLen As Integer      'Gpf record length
    
    Dim lmGnfCode As Long
    
'Grid Position
    Dim tmGpf As GPF                'Gpf record image
    Dim tmGpfSrchKey As LONGKEY0    'Gpf key record image
    Dim tmGpfSrchKey1 As GPFKEY1    'Gpf key record image
    Dim hmGpf As Integer            'Gpf Handle
    Dim imGpfRecLen As Integer      'Gpf record length
    
'Grid Copy
    Dim tmGcf As GCF                'GCF record image
    Dim tmGcfSrchKey As LONGKEY0    'GCF key record image
    Dim tmGcfSrchKey1 As GCFKEY1    'GCF key record image
    Dim hmGcf As Integer            'GCF Handle
    Dim imGcfRecLen As Integer      'GCF record length
    
'Grid Region Name
    Dim tmGtf As GTF                'Gtf record image
    Dim tmGtfSrchKey As LONGKEY0    'Gtf key record image
    Dim tmGtfSrchKey1 As GTFKEY1    'Gtf key record image
    Dim hmGtf As Integer            'Gtf Handle
    Dim imGtfRecLen As Integer      'GCF record length
    
'Vehicle
    Dim tmVef As VEF                'VEF record image
    Dim tmVefSrchKey As INTKEY0     'VEF key record image
    Dim hmVef As Integer            'VEF Handle
    Dim imVefRecLen As Integer      'VEF record length
    
'Contract
    Dim tmChf As CHF                'CHF record image
    Dim tmChfSrchKey As LONGKEY0    'CHF key record image
    Dim hmCHF As Integer            'CHF Handle
    Dim imCHFRecLen As Integer      'CHF record length
    
'Contract Line
    Dim tmClf As CLF                'CLF record image
    Dim tmClfSrchKey As CLFKEY0     'CLF key record image
    Dim hmClf As Integer            'CLF Handle
    Dim imClfRecLen As Integer      'CLF record length
    Dim imAllowedLens() As Integer
    Dim lmCntrForLen As Long
    
'Comments
    Dim hmCxf As Integer            'Comments file handle
    Dim tmCxf As CXF                'CXF record image
    Dim tmCxfSrchKey As LONGKEY0    'CXF key record image
    Dim imCxfRecLen As Integer      'CXF record length
    
'Vehicle combo
    Dim tmVsf As VSF                'VSF record image
    Dim tmVsfSrchKey As LONGKEY0    'VSF key record image
    Dim hmVsf As Integer            'VSF Handle
    Dim imVsfRecLen As Integer      'VSF record length
    
'Regional Schd
    Dim tmRsf As RSF                'RSF record image
    Dim tmRsfSrchKey As LONGKEY0    'RSF key record image
    Dim tmRsfSrchKey1 As LONGKEY0   'RSF key record image
    Dim tmRsfSrchKey3 As RSFKEY3
    Dim hmRsf As Integer            'RSF Handle
    Dim imRsfRecLen As Integer      'RSF record length
    Dim lmRsfCode() As Long
    
'Region Area
    Dim tmRaf As RAF                'RAF record image
    Dim tmRafSrchKey As LONGKEY0    'RAF key record image
    Dim hmRaf As Integer            'RAF Handle
    Dim imRafRecLen As Integer      'RAF record length
    
'Split Entity
    Dim tmSef() As SEF              'SEF record image
    Dim tmSefSrchKey As LONGKEY0    'SEF key record image
    Dim tmSefSrchKey1 As SEFKEY1    'SEF key record image
    Dim hmSef As Integer            'SEF Handle
    Dim imSefRecLen As Integer      'SEF record length
    
'Short Title
    Dim tmSif As SIF                'SIDF record image
    Dim tmSifSrchKey0 As LONGKEY0
    Dim hmSif As Integer            'SIF Handle
    Dim imSifRecLen As Integer      'SIF record length
    
'Spot detail
    Dim tmSdf As SDF                'SDF record image
    Dim tmSdfSrchKey0 As SDFKEY0
    Dim tmSdfSrchKey3 As LONGKEY0
    Dim hmSdf As Integer            'SDF Handle
    Dim imSdfRecLen As Integer      'SDF record length
    
'MG Spec
    Dim tmSmf As SMF                'SDF record image
    Dim tmSmfSrchKey As SMFKEY0
    Dim hmSmf As Integer            'SMF Handle
    Dim imSmfRecLen As Integer      'SMF record length
    
'Time zone Copy inventory record information
    Dim hmTzf As Integer            'Time zone Copy inventory file handle
    Dim tmTzfSrchKey As LONGKEY0    'TZF key record image
    Dim imTzfRecLen As Integer      'TZF record length
    Dim tmTzf As TZF                'TZF record image
    
'User
    Dim tmUrf As URF                'URF record image
    Dim tmUrfSrchKey As INTKEY0     'URF key record image
    Dim hmUrf As Integer            'URF Handle
    Dim imUrfRecLen As Integer      'URF record length
    
'Multi-Name
    Dim hmMnf As Integer
    Dim tmMnf As MNF
    Dim imMnfRecLen As Integer
    Dim tmMnfSrchKey As INTKEY0
    Dim smMMnfStamp As String
    Dim tmMMnf() As MNF
    
'Spot summary
    Dim hmSsf As Integer            'SSF Handle
    Dim tmSsf As SSF                'SSF record image
    Dim tmSsfSrchKey As SSFKEY0     'SSF key record image
    Dim tmSsfSrchKey2 As SSFKEY2    'SSF key record image
    Dim imSsfRecLen As Integer
    Dim tmAvail As AVAILSS
    Dim tmSpot As CSPOTSS
    
'Copy Air Game
    Dim tmCaf As CAF                'CAF record image
    Dim tmCafSrchKey As LONGKEY0    'CAF key record image
    Dim tmCafSrchKey1 As CAFKEY1    'CAF key record image
    Dim hmCaf As Integer            'CAF Handle
    Dim imCafRecLen As Integer      'CAF record length
    
    Dim hmMtf As Integer
    Dim hmLcf As Integer
    Dim hmGhf As Integer
    Dim hmGsf As Integer
    
    'Dim tmRec As LPOPREC
    Dim lmMatchCode() As Long
    
'Calendar info
    Dim tmCDCtrls(0 To 7) As FIELDAREA
    Dim imLBCDCtrls As Integer
    Dim imCalYear As Integer        'Month of displayed calendar
    Dim imCalMonth As Integer       'Year of displayed calendar
    Dim lmCalStartDate As Long      'Start date of displayed calendar
    Dim lmCalEndDate As Long        'End date of displayed calendar
    Dim imCalType As Integer
    
    Dim fmAdjFactorW As Single      'Width adjustment factor
    Dim fmAdjFactorH As Single      'Height adjustment factor
    '5882 no longer needed
    ' IDC
    'Dim bmIsIDC As Boolean
    
    Private tmCifInfo() As CIFINFO
    Private tmCrfDates() As CRFDATES
    Private smCode() As String
    Private lmGenerateCode() As Long  'Codes to be generated
    Private lmWorkArea() As Long
    
    Private smRGSource As String
    Private smRGComment() As String * 5000
    
    Private smGridName As String
    '5/4/15
    Private smRefGridName As String
    Private bmRetainGridCopy As Boolean
    Private bmInCmcGrid As Boolean
    Private bmBypassGridSave As Boolean
    
    Private tmRegionDefinition() As REGIONDEFINITION
    Private tmSplitCategoryInfo() As SPLITCATEGORYINFO
    
    Private bmAllowedAudioTypes(0 To 5) As Boolean  '0Live Cmml(LC:L); 1=Rec Cmml(RC:R); 2=Live Promo(LP:M); 3=Rec Promo(RP:S); 4=Pre-Rec Cmml(PC:P); 5=Pre-Rec Promo(PP:Q)
    Private rst_clf As ADODB.Recordset
    Private rst_adf As ADODB.Recordset
    
    Const LBONE = 1
    
    Const CNTRINDEX = 1         'Contract control/field
    Const LENINDEX = 2          'Length control/field
    Const LIVECOPYINDEX = 3     'Length control/field
    Const VEHICLEINDEX = 4      'Vehicle control/field
    Const MGASSIGNINDEX = 5
    Const ZONEINDEX = 6         'Zone control/field
    Const SDATEINDEX = 7        'Start Date control/field
    Const EDATEINDEX = 8        'End Date control/field
    Const STIMEINDEX = 9        'Start time control/field
    Const ETIMEINDEX = 10       'End time control/field
    Const MONINDEX = 11         'Monday control/field
    Const SUNINDEX = 17         'Sunday control/field
    Const AVAILINDEX = 18       'Avail control/field
    Const TYPEINDEX = 20        'Type control/field
    Const SHTTITLEINDEX = 21    'Short Title
    Const COMMENTINDEX = 22     'Comment control/field
    
    Private lmRGEnableRow As Long
    Private lmRGEnableCol As Long
    Private imRGCtrlVisible As Integer
    Private smRGInclExcl As String
    Private imIgnoreScroll As Integer
    Private lmTopRow As Long
    Private imFromArrow As Integer
    Private imRGSelection As Integer
    Private imEdcChgMode As Integer
    Private bmRGKeyPressed As Boolean
    Private imEnteredOrderNo As Integer
    Private imCurrentBlackoutAdfCode As Integer
    Private imCurrentAdvtIndex As Integer
    
    Private lmCGEnableRow As Long
    Private lmCGEnableCol As Long
    Private imCGCtrlVisible As Integer
    Private imCGIgnoreScroll As Integer
    Private lmCGTopRow As Long
    Private imLastSort As Integer
    Private imLastColSorted As Integer
    
    Const RGVEHICLEINDEX = 0
    Const REGIONNAMEINDEX = 1
    Const CATEGORYINDEX = 2
    Const SELECTIONINDEX = 3
    Const INCLEXCLINDEX = 4
    Const FORMATINDEX = 5
    Const ADVTINDEX = 6
    Const COPYINDEX = 7
    Const RGCOMMENTINDEX = 8
    Const RAFCODEINDEX = 9
    Const GPFCODEINDEX = 10
    Const COPYTIPINDEX = 11
    Const CSFCODEINDEX = 12
    Const STATUSINDEX = 13      'N= New; C=Changed; M=Model
    
    Private bmExitCG As Boolean
    Private imCGRows As Integer
    
    Const PRODUCTINDEX = 0
    Const CREATIVETITLEINDEX = 1
    Const CREATEDDATEINDEX = 2
    Const ROTATIONDATEINDEX = 3
    Const CARTINDEX = 4
    Const ISCIINDEX = 5
    Const REPEATINDEX = 6
    Const PRODMATCHINDEX = 7
    Const CIFCODEINDEX = 8
    Const SORTINDEX = 9
    Private Type REGIONCATEGORY
        lRafCode As Long
        iMaxCategory As Integer
    End Type
    Dim tmRegionCategory() As REGIONCATEGORY
    
    '8/29/16: Allow copy sync across vehicles
    Private Type CRFVEFCODE
        iVefCode As Integer
        iNextFinal As Integer
        iNextPrelim As Integer
    End Type
        
    Dim tmCrfVefCode() As CRFVEFCODE   'Array of vehicles associated with the rotation
    Dim smInvFColor(9999) As String    'Array for Contract site option


Private Sub chkKeepRecordsWithValues_Click()    'TTP 10728 JJB 2023-06-07
    mChangeFilter
End Sub

Private Sub txtISCI_Filter_Change()             'TTP 10728 JJB 2023-06-07
    mChangeFilter
End Sub

Private Sub txtISCI_Filter_Main_Change()        'TTP 10728 JJB 2023-06-07
    mChangeFilter_Main
End Sub

Sub mChangeFilter()                             'TTP 10728 JJB 2023-06-07

    Dim iRow As Integer
    Dim iCol As Integer
    Dim sISCI As String
    Dim sRatio As String
    Dim sFilter As String
    Dim sFilter1 As String
    Dim sFilter2 As String
    Dim iFilterBreakPosition As Integer
    Dim iFilterRowCount As Integer
    Dim bFilterMatch As Boolean
    
' This section is gathering/parsing any ISCI filters the user may be using.  User can use two filters (seperated by a space) and
' each/both filter works as a "contains" operator.
    
    sFilter = Trim(txtISCI_Filter.Text)
    iFilterBreakPosition = InStr(1, sFilter, " ") ' Determine if there is more than one filter
    
    If iFilterBreakPosition > 0 Then
        sFilter1 = Mid(sFilter, 1, iFilterBreakPosition - 1)
        sFilter2 = Replace(Replace(sFilter, sFilter1, ""), " ", "")
    Else
        sFilter1 = sFilter
        sFilter2 = ""
    End If
''''''''''''''''''''
    
    iFilterRowCount = 0
    
    For iRow = 1 To grdCopy.rows - 1
        bFilterMatch = True ' default
        sISCI = grdCopy.TextMatrix(iRow, 5)
        
        If sFilter2 = "" Then
            If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then bFilterMatch = False
        Else
            If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then bFilterMatch = False
            If sFilter2 <> "" And InStr(1, sISCI, sFilter2, vbTextCompare) = 0 Then bFilterMatch = False
        End If
        
        ' Option to display records that have inputted values but do not meet filter criteria
        If chkKeepRecordsWithValues.Value = vbChecked And grdCopy.TextMatrix(iRow, 6) <> "" Then
            bFilterMatch = True
        End If
        
        If bFilterMatch Then iFilterRowCount = iFilterRowCount + 1
         
    Next iRow
    
    If iFilterRowCount > 0 Then
        iFilterRowCount = 0
        
        For iRow = 1 To grdCopy.rows - 1
            bFilterMatch = True ' default
            sISCI = grdCopy.TextMatrix(iRow, 5)
            
            If sFilter2 = "" Then
                If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then bFilterMatch = False
            Else
                If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then bFilterMatch = False
                If sFilter2 <> "" And InStr(1, sISCI, sFilter2, vbTextCompare) = 0 Then bFilterMatch = False
            End If
            
            ' Option to display records that have inputted values but do not meet filter criteria
            If chkKeepRecordsWithValues.Value = vbChecked And grdCopy.TextMatrix(iRow, 6) <> "" Then
                bFilterMatch = True
            End If
            
            If bFilterMatch Then
                iFilterRowCount = iFilterRowCount + 1
                grdCopy.rowHeight(iRow) = fgFlexGridRowH
            Else
                grdCopy.rowHeight(iRow) = 0
            End If
             
        Next iRow
    
        ' If no filter matches then beep and select text
        On Error Resume Next
        If sFilter <> "" And iFilterRowCount = 0 Then
            Beep
            
            txtISCI_Filter.SelStart = Len(txtISCI_Filter.Text) - 1
            txtISCI_Filter.SelLength = 1
        End If
    Else
        On Error Resume Next
        Beep
        txtISCI_Filter.SelStart = Len(txtISCI_Filter.Text) - 1
        txtISCI_Filter.SelLength = 1
    End If
    
    grdCopy.Row = 1
    mCGSetShow
            
            
End Sub

Sub mChangeFilter_Main() 'TTP 10728 JJB 2023-06-09
    Dim ilLoop As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim ilRet As Integer
    Dim sISCI As String
    
    Dim sFilter As String
    Dim sFilter1 As String
    Dim sFilter2 As String
    Dim iFilterBreakPosition As Integer
    Dim iFilterRowCount As Integer
    Dim sRecord As String
    Dim iBaseRecords As Integer

    If bmInvStatusChange Then GoTo ex
      
' This section is gathering/parsing any ISCI filters the user may be using.  User can use two filters (seperated by a space) and
' each/both filter works as a "contains" operator.

    sFilter = Trim(txtISCI_Filter_Main.Text)
    'If sFilter = "" Then GoTo ex
    iFilterBreakPosition = InStr(1, sFilter, " ") ' Determine if there is more than one filter
    If iFilterBreakPosition > 0 Then
        sFilter1 = Mid(sFilter, 1, iFilterBreakPosition - 1)
        sFilter2 = Replace(Replace(sFilter, sFilter1, ""), " ", "")
    Else
        sFilter1 = sFilter
        sFilter2 = ""
    End If
''''''''''''''''''''''
    
    lbcInv.Clear
    
    iFilterRowCount = 0
    iBaseRecords = 0
    
'TTP 10932 JJB 2024-06-27 - Changed the below to a select case to more easily understand the workflow and correct some filter anomalies.  Fogive the GOTO statements because I hate
'                           to have more than 1 exit to any routine.

    Select Case imInvStatus
        Case 0: 'Active
            For ilLoop = 0 To UBound(tgActiveCode) + 1 Step 1
                sRecord = lbcActive.List(ilLoop)
            
                If Left(sRecord, 4) <> "[New" Then
                
                    'Inventory option, ISCI Code Option
                    If tgSpf.sUseCartNo = "B" Or tgSpf.sUseCartNo = "Y" Then 'TTP 10798 JJB 2023-08-15
                        ilRet = gParseItem(sRecord, IIF(rbcShow(0).Value = True, 3, 2), "~", sISCI)
                    Else
                        ilRet = gParseItem(sRecord, 1, "~", sISCI)
                    End If
                    
                    If sFilter2 = "" Then
                        If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then GoTo NextActiveRecord
                    Else
                        If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then GoTo NextActiveRecord
                        If sFilter2 <> "" And InStr(1, sISCI, sFilter2, vbTextCompare) = 0 Then GoTo NextActiveRecord
                    End If
                Else
                    iBaseRecords = iBaseRecords + 1
                End If
            
                On Error GoTo ExitLoop
                
                lbcInv.AddItem sRecord
                iFilterRowCount = iFilterRowCount + 1
NextActiveRecord:
            Next ilLoop
        Case 1: 'Purge
            For ilLoop = 0 To UBound(tmPurgeCode) - 1 Step 1
                sRecord = lbcPurge.List(ilLoop)
            
                'Inventory option, ISCI Code Option
                If tgSpf.sUseCartNo = "B" Or tgSpf.sUseCartNo = "Y" Then 'TTP 10798 JJB 2023-08-15
                    ilRet = gParseItem(sRecord, IIF(rbcShow(0).Value = True, 3, 2), "~", sISCI)
                Else
                    ilRet = gParseItem(sRecord, 1, "~", sISCI)
                End If
                        
                If sFilter2 = "" Then
                    If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then GoTo NextPurgeRecord
                Else
                    If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then GoTo NextPurgeRecord
                    If sFilter2 <> "" And InStr(1, sISCI, sFilter2, vbTextCompare) = 0 Then GoTo NextPurgeRecord
                End If
            
                On Error GoTo ExitLoop
                
                lbcInv.AddItem sRecord
                iFilterRowCount = iFilterRowCount + 1
NextPurgeRecord:
            Next ilLoop
        Case 2: 'History
            For ilLoop = 0 To UBound(tmHistoryCode) - 1 Step 1
                sRecord = lbcHistory.List(ilLoop)
            
                'Inventory option, ISCI Code Option
                If tgSpf.sUseCartNo = "B" Or tgSpf.sUseCartNo = "Y" Then 'TTP 10798 JJB 2023-08-15
                    ilRet = gParseItem(sRecord, IIF(rbcShow(0).Value = True, 3, 2), "~", sISCI)
                Else
                    ilRet = gParseItem(sRecord, 1, "~", sISCI)
                End If
                        
                If sFilter2 = "" Then
                    If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then GoTo NextHistoryRecord
                Else
                    If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then GoTo NextHistoryRecord
                    If sFilter2 <> "" And InStr(1, sISCI, sFilter2, vbTextCompare) = 0 Then GoTo NextHistoryRecord
                End If
            
                On Error GoTo ExitLoop
                
                lbcInv.AddItem sRecord
                iFilterRowCount = iFilterRowCount + 1
NextHistoryRecord:
            Next ilLoop
    End Select
    
'    If imInvStatus = 1 Or imInvStatus = 2 Then
'        For ilLoop = 0 To UBound(tgActiveCode) - 1 Step 1
'            Select Case imInvStatus
'                Case 1: sRecord = lbcPurge.List(ilLoop)
'                Case 2: sRecord = lbcHistory.List(ilLoop)
'            End Select
'
'            'Inventory option, ISCI Code Option
'            If tgSpf.sUseCartNo = "B" Or tgSpf.sUseCartNo = "Y" Then 'TTP 10798 JJB 2023-08-15
'                ilRet = gParseItem(sRecord, IIF(rbcShow(0).Value = True, 3, 2), "~", sISCI)
'            Else
'                ilRet = gParseItem(sRecord, 1, "~", sISCI)
'            End If
'
'            If sFilter2 = "" Then
'                If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then Next ilLoop
'            Else
'                If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then Next ilLoop
'                If sFilter2 <> "" And InStr(1, sISCI, sFilter2, vbTextCompare) = 0 Then Next ilLoop
'            End If
'
'            On Error GoTo ExitLoop
'
'            lbcInv.AddItem sRecord
'            iFilterRowCount = iFilterRowCount + 1
'        Next ilLoop
'    End If
'
'    If imInvStatus = 0 Then
'        For ilLoop = 0 To UBound(tgActiveCode) + 1 Step 1
'            sRecord = lbcActive.List(ilLoop)
'
'            If Left(sRecord, 4) <> "[New" Then
'
'                'Inventory option, ISCI Code Option
'                If tgSpf.sUseCartNo = "B" Or tgSpf.sUseCartNo = "Y" Then 'TTP 10798 JJB 2023-08-15
'                    ilRet = gParseItem(sRecord, IIF(rbcShow(0).Value = True, 3, 2), "~", sISCI)
'                Else
'                    ilRet = gParseItem(sRecord, 1, "~", sISCI)
'                End If
'
'                If sFilter2 = "" Then
'                    If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then GoTo NextLoop2
'                Else
'                    If sFilter1 <> "" And InStr(1, sISCI, sFilter1, vbTextCompare) = 0 Then GoTo NextLoop2
'                    If sFilter2 <> "" And InStr(1, sISCI, sFilter2, vbTextCompare) = 0 Then GoTo NextLoop2
'                End If
'            Else
'                iBaseRecords = iBaseRecords + 1
'            End If
'
'        On Error GoTo ExitLoop
'
'        lbcInv.AddItem sRecord
'        iFilterRowCount = iFilterRowCount + 1
'NextLoop2:
'        Next ilLoop
'    End If

    

ExitLoop:
' If no filter matches then beep and select text
    
    On Error Resume Next
    If (sFilter <> "" And iFilterRowCount = iBaseRecords And imInvStatus = 0) Or (sFilter <> "" And lbcInv.ListCount = 0 And imInvStatus <> 0) Then
        Beep
        txtISCI_Filter_Main.SelStart = Len(txtISCI_Filter_Main.Text) - 1
        txtISCI_Filter_Main.SelLength = 1
    Else
        PaintInv 'pbcLbcInv_Paint
    End If
ex:

End Sub

Private Sub PaintInv()

    Dim ilLoop As Integer
    Dim slStr As String
    Dim ilInvEnd As Integer
    Dim ilField As Integer
    Dim llWidth As Long
    Dim slFields(0 To 2) As String
    Dim llFgColor As Long
    Dim ilFieldIndex As Integer
    Dim i As Integer
    
    ilInvEnd = lbcInv.TopIndex + lbcInv.height \ fgListHtArial825
    If ilInvEnd > lbcInv.ListCount Then
        ilInvEnd = lbcInv.ListCount
    End If
    
    If lbcInv.ListCount <= lbcInv.height \ fgListHtArial825 Then
        llWidth = lbcInv.Width - 30
    Else
        llWidth = lbcInv.Width - igScrollBarWidth - 30
    End If
    pbcLbcInv.Width = llWidth
    
    pbcLbcInv.Cls
    llFgColor = pbcLbcInv.ForeColor
    
    For ilLoop = lbcInv.TopIndex To ilInvEnd - 1 Step 1
        pbcLbcInv.ForeColor = llFgColor
        If lbcInv.MultiSelect = 0 Then
            If lbcInv.ListIndex = ilLoop Then
                gPaintArea pbcLbcInv, CSng(0), CSng((ilLoop - lbcInv.TopIndex) * fgListHtArial825), CSng(pbcLbcInv.Width), CSng(fgListHtArial825) - 15, vbHighlight 'WHITE
                pbcLbcInv.ForeColor = vbWhite
            End If
        Else
            If lbcInv.Selected(ilLoop) Then
                gPaintArea pbcLbcInv, CSng(0), CSng((ilLoop - lbcInv.TopIndex) * fgListHtArial825), CSng(pbcLbcInv.Width), CSng(fgListHtArial825) - 15, vbHighlight 'WHITE
                pbcLbcInv.ForeColor = vbWhite
            End If
        End If
        
        ' TTP 10816 JJB 2023-08-21
        For i = 0 To 9999
            If smInvFColor(i) = lbcInv.List(ilLoop) Then
        'If lbcInv.ItemData(ilLoop) = 1 Then
                pbcLbcInv.ForeColor = vbRed
                Exit For
            End If
        Next i
        ' TTP 10816 JJB 2023-08-21 END
        
        slStr = lbcInv.List(ilLoop)
        gParseItemFields slStr, "~", slFields()
        ilFieldIndex = 0
        For ilField = LBONE To UBound(lmListField) - 1 Step 1
            pbcLbcInv.CurrentX = lmListField(ilField)
            pbcLbcInv.CurrentY = (ilLoop - lbcInv.TopIndex) * fgListHtArial825 + 15
            slStr = slFields(ilFieldIndex)
            If (StrComp(slStr, "[New]", vbTextCompare) <> 0) And (StrComp(slStr, "[New-Cart]", vbTextCompare) <> 0) And (StrComp(slStr, "[New-ISCI]", vbTextCompare) <> 0) Then
'                gAdjShowLen pbcLbcInv, slStr, lmListField(ilField + 1) - lmListField(ilField)
                If ilField = LBONE + 1 Then
                    If slFields(ilFieldIndex) <> "" Then
                        gAdjShowLen pbcLbcInv, slStr, lmListField(ilField + 1) - lmListField(ilField)
                    End If
                Else
                    gAdjShowLen pbcLbcInv, slStr, lmListField(ilField + 1) - lmListField(ilField)
                End If
            End If
            pbcLbcInv.Print slStr
            ilFieldIndex = ilFieldIndex + 1
        Next ilField
        pbcLbcInv.ForeColor = llFgColor
    Next ilLoop
    mPopCG
End Sub

Private Sub cbcAdvt_Change()
    If imStartMode Then
        imStartMode = False
        mCbcAdvtChange
        Exit Sub
    End If
    If imChgMode = False Then 'If currently in change mode- bypass any other changes (avoid infinite loop)
        If cbcAdvt.Text <> "" Then
            gManLookAhead cbcAdvt, imBSMode, imComboBoxIndexAdvt
            tmcClick.Enabled = False
            imSelectDelay = 0
            tmcClick.Interval = 2000    '2 seconds
            tmcClick.Enabled = True
        End If
        cbcBlackout.ListIndex = -1
        mSetCommands
    End If
    Exit Sub
End Sub
Private Sub cbcAdvt_Click()
    cbcAdvt_Change
End Sub
Private Sub cbcAdvt_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
    imSelectDelay = -1
End Sub
Private Sub cbcAdvt_DropDown()
    tmcClick.Enabled = False
    imSelectDelay = -1
End Sub
Private Sub cbcAdvt_GotFocus()
    mSetCommands
    If imFirstFocus Then 'Test if coming from sales source- if so, branch to first control
        imFirstFocus = False
    End If
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
    imComboBoxIndexAdvt = imAdvtIndex
End Sub
Private Sub cbcAdvt_KeyDown(KeyCode As Integer, Shift As Integer)
    'Delete key causes the charact to the right of the cursor to be deleted
    imBSMode = False
End Sub
Private Sub cbcAdvt_KeyPress(KeyAscii As Integer)
    tmcClick.Enabled = False
    imSelectDelay = -1
    'Backspace character cause selected test to be deleted or
    'the first character to the left of the cursor if no text selected
    If KeyAscii = 8 Then    'Process backspace key (delete key handled as a KeyDown Event)
        If cbcAdvt.SelLength <> 0 Then    'avoid deleting two characters
            imBSMode = True 'Force deletion of character prior to selected text
        End If
    End If
End Sub
Private Sub cbcAdvt_LostFocus()
    If imSelectDelay = 0 Then
        tmcClick.Enabled = False
        imSelectDelay = -1
        mCbcAdvtChange
    End If
End Sub

Private Sub cbcBlackout_Change()
    If imChgMode = False Then 'If currently in change mode- bypass any other changes (avoid infinite loop)
        If cbcBlackout.Text <> "" Then
            gManLookAhead cbcBlackout, imBSMode, imComboBoxIndexAdvt
            tmcClick.Enabled = False
            imSelectDelay = 1
            tmcClick.Interval = 2000    '2 seconds
            tmcClick.Enabled = True
        End If
    End If
    Exit Sub
End Sub

Private Sub cbcBlackout_Click()
    cbcBlackout_Change
End Sub

Private Sub cbcBlackout_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
    imSelectDelay = -1
End Sub

Private Sub cbcBlackout_GotFocus()
    mSetShow imBoxNo
    imBoxNo = -1
    imComboBoxIndexAdvt = imBlackoutIndex
    If cbcBlackout.ListCount <= 0 Then
        mAdvtBlackoutPop
    End If
End Sub

Private Sub cbcBlackout_KeyDown(KeyCode As Integer, Shift As Integer)
    'Delete key causes the charact to the right of the cursor to be deleted
    imBSMode = False
End Sub

Private Sub cbcBlackout_KeyPress(KeyAscii As Integer)
    tmcClick.Enabled = False
    imSelectDelay = -1
    'Backspace character cause selected test to be deleted or
    'the first character to the left of the cursor if no text selected
    If KeyAscii = 8 Then    'Process backspace key (delete key handled as a KeyDown Event)
        If cbcBlackout.SelLength <> 0 Then    'avoid deleting two characters
            imBSMode = True 'Force deletion of character prior to selected text
        End If
    End If
End Sub

Private Sub cbcBlackout_LostFocus()
    If imSelectDelay = 1 Then
        tmcClick.Enabled = False
        imSelectDelay = -1
        mCbcBlackoutChange
    End If
End Sub

Private Sub cbcType_Change()

    If imChgMode = False Then
        imChgMode = True
        If cbcType.Text <> "" Then
            gManLookAhead cbcType, imBSMode, imComboBoxIndexType
        End If
        imTypeIndex = cbcType.ListIndex
        gSetMousePointer grdRot, grdRot, vbHourglass
        'TTP:1473
        lmCntrForLen = -1
        imRotIndex = -1
        pbcRot.Cls
        mPaintRot
        lbcInst.Clear
        lbcInst.AddItem " "
        lbcInv.Clear
        lbcActive.Clear
        lbcPurge.Clear
        lbcHistory.Clear
        pbcLbcInv.Cls
        pbcLbcInst.Cls
        mClearCtrlFields
        If (cbcType.ListIndex = 0) Or ((cbcType.ListIndex <= 2) And (tgSpf.sUsingBBs = "Y")) Then
            cbcAdvt.Clear
            mAdvtPop
        Else
            'Populate event names in advertiser list box for selected event type
        End If
        lbcType.Clear
        If imTypeIndex = 0 Then
            lbcType.AddItem "Contract Spot"
        ElseIf imTypeIndex = 1 Then
            lbcType.AddItem "Open BB"
        ElseIf imTypeIndex = 2 Then
            lbcType.AddItem "Close BB"
        End If
        gSetMousePointer grdRot, grdRot, vbDefault
        mSetCommands
        imChgMode = False
    End If
End Sub
Private Sub cbcType_Click()
    cbcType_Change
End Sub
Private Sub cbcType_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub cbcType_GotFocus()
    If imFirstFocus Then 'Test if coming from sales source- if so, branch to first control
        imFirstFocus = False
    End If
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
    If imFirstFocusType Then
        imFirstFocusType = False
        If cbcType.ListCount > 0 Then
            cbcType.ListIndex = 0   'Spots
            If cbcType.ListCount = 1 Then
                cbcAdvt.SetFocus
            End If
        End If
    End If
    imComboBoxIndexType = imTypeIndex
End Sub
Private Sub cbcType_KeyDown(KeyCode As Integer, Shift As Integer)
    'Delete key causes the charact to the right of the cursor to be deleted
    imBSMode = False
End Sub
Private Sub cbcType_KeyPress(KeyAscii As Integer)
    'Backspace character cause selected test to be deleted or
    'the first character to the left of the cursor if no text selected
    If KeyAscii = 8 Then    'Process backspace key (delete key handled as a KeyDown Event)
        If cbcType.SelLength <> 0 Then    'avoid deleting two characters
            imBSMode = True 'Force deletion of character prior to selected text
        End If
    End If
End Sub


Private Sub ckcCurrentRot_Click()
    gSetMousePointer grdRot, grdRot, vbHourglass
    pbcRot.Cls
    mPaintRot
    mRotPop False
    'lbcCntrCode.Tag = ""
    'lbcCntrCode.Clear
    smCopyCntrCodeTag = ""
    ReDim tmCopyCntrCode(0 To 0) As SORTCODE
    mCntrPop
    gSetMousePointer grdRot, grdRot, vbDefault
    mSetCommands
End Sub

Private Sub ckcCurrentRot_GotFocus()
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub

Private Sub ckcIncludeMG_Click()
    gSetMousePointer grdRot, grdRot, vbHourglass
    imVehPopReq = True
    smSave(2) = ""
    pbcRot.Cls
    mPaintRot
    mRotPop False
    smCopyCntrCodeTag = ""
    ReDim tmCopyCntrCode(0 To 0) As SORTCODE
    mCntrPop
    gSetMousePointer grdRot, grdRot, vbDefault
    mSetCommands
End Sub

Private Sub ckcIncludeMG_GotFocus()
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub

Private Sub ckcTimeDay_Click(Index As Integer)
    mSetChg MONINDEX + Index
End Sub

Private Sub ckcTimeDay_GotFocus(Index As Integer)
    Dim ilLoop As Integer
    Dim llDate As Long
    ReDim ilValidDay(0 To 6) As Integer
    
    plcTme.Visible = False
    If imSave(2 + Index) < 0 Then
        If (smSave(3) <> "") And (smSave(4) <> "") Then
            If gValidDate(smSave(3)) And gValidDate(smSave(4)) Then
                If gDateValue(smSave(3)) + 6 <= gDateValue(smSave(4)) Then
                    imSave(2 + Index) = 1    'Yes
                    ckcTimeDay(Index).Value = vbChecked
                Else
                    For ilLoop = 0 To 6 Step 1
                        ilValidDay(ilLoop) = False
                    Next ilLoop
                    For llDate = gDateValue(smSave(3)) To gDateValue(smSave(4)) Step 1
                        ilValidDay(gWeekDayLong(llDate)) = True
                    Next llDate
                    If ilValidDay(Index) Then
                        imSave(2 + Index) = 1    'Yes
                        ckcTimeDay(Index).Value = vbChecked
                    Else
                        imSave(2 + Index) = 0    'No
                        ckcTimeDay(Index).Value = vbUnchecked
                    End If
                End If
            Else
                imSave(2 + Index) = 1    'Yes
                ckcTimeDay(Index).Value = vbChecked
            End If
        Else
            imSave(2 + Index) = 1    'Yes
            ckcTimeDay(Index).Value = vbChecked
        End If
        tmCtrls(MONINDEX + Index).iChg = True
        mSetCommands
    End If
End Sub

Private Sub cmcAsgn_Click()
    Dim ilRet As Integer
    Dim slStr As String
    'Unload IconTraf
    'If Not gWinRoom(igNoExeWinRes(COPYASGNEXE)) Then
    '    Exit Sub
    'End If
    igCopyAsgnCallSource = COPYJOB
    ''Screen.MousePointer = vbHourGlass  'Wait
    'igChildDone = False 'edcLinkDestDoneMsg.Text = ""
    'edcLinkSrceDoneMsg.Text = ""
    'If (Not igStdAloneMode) And (imShowHelpMsg) Then
    '    If igTestSystem Then
    '        slStr = "Copy^Test\" & sgUserName & "\" & Trim$(Str$(igCopyAsgnCallSource))
    '    Else
    '        slStr = "Copy^Prod\" & sgUserName & "\" & Trim$(Str$(igCopyAsgnCallSource))
    '    End If
    'Else
    '    If igTestSystem Then
    '        slStr = "Copy^Test^NOHELP\" & sgUserName & "\" & Trim$(Str$(igCopyAsgnCallSource))
    '    Else
    '        slStr = "Copy^Prod^NOHELP\" & sgUserName & "\" & Trim$(Str$(igCopyAsgnCallSource))
    '    End If
    'End If
    'lgShellRet = Shell(sgExePath & "CopyAsgn.Exe " & slStr, 1)
    'Copy.Enabled = False
    'Screen.MousePointer = vbDefault  'Wait
    'Do While Not igChildDone
    '    DoEvents
    'Loop
    'sgCommandStr = slStr
    CopyAsgn.Show vbModal
    slStr = sgDoneMsg
    'Copy.Enabled = True
    'edcLinkSrceDoneMsg.Text = "Ok"
    'For ilLoop = 0 To 10
    '    DoEvents
    'Next ilLoop
    'Reread VPF since Copy assign could have changed its values
    ilRet = gVpfRead()
End Sub
Private Sub cmcAsgn_GotFocus()
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub
Private Sub cmcCalDn_Click()
    imCalMonth = imCalMonth - 1
    If imCalMonth <= 0 Then
        imCalMonth = 12
        imCalYear = imCalYear - 1
    End If
    pbcCalendar_Paint
    edcDropDown.SelStart = 0
    edcDropDown.SelLength = Len(edcDropDown.Text)
    edcDropDown.SetFocus
End Sub
Private Sub cmcCalUp_Click()
    imCalMonth = imCalMonth + 1
    If imCalMonth > 12 Then
        imCalMonth = 1
        imCalYear = imCalYear + 1
    End If
    pbcCalendar_Paint
    edcDropDown.SelStart = 0
    edcDropDown.SelLength = Len(edcDropDown.Text)
    edcDropDown.SetFocus
End Sub
Private Sub cmcCancel_Click()
    Dim ilRet As Integer
    
    ilRet = mGridSavedRemoved("Current Working")
    mTerminate
End Sub
Private Sub cmcCancel_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub cmcCancel_GotFocus()
    If imFirstFocus Then 'Test if coming from sales source- if so, branch to first control
        imFirstFocus = False
    End If
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub
Private Sub cmcCancel_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If tmcDrag.Enabled Then
        imDragType = -1
        tmcDrag.Enabled = False
    End If
End Sub
Private Sub cmcClear_Click()
    lbcInst.Clear
    lbcInst.AddItem " "
    pbcLbcInst.Cls
    imFLValue = 1
    mSetFLPointer
    mSetCommands
End Sub
Private Sub cmcClear_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub cmcClear_GotFocus()
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mSetShow imBoxNo
    imBoxNo = -1
End Sub
Private Sub cmcDone_Click()
    Dim ilRet As Integer
    
    If Not imUpdateAllowed Then
        cmcCancel_Click
        Exit Sub
    End If
    If cmcUpdate.Enabled = True Then
        If imRotIndex <= 0 Then    'New mode
            If mSaveRecChg(True) = False Then
                If Not imTerminate Then
                    If imBoxNo > 0 Then
                        mEnableBox imBoxNo
                    Else
                        cmcCancel.SetFocus
                    End If
                    Exit Sub
                Else
                    cmcCancel_Click
                    Exit Sub
                End If
            End If
        Else
            If mSaveRecChg(False) = False Then
                If Not imTerminate Then
                    If imBoxNo > 0 Then
                        mEnableBox imBoxNo
                    Else
                        cmcCancel.SetFocus
                    End If
                    Exit Sub
                Else
                    cmcCancel_Click
                    Exit Sub
                End If
            End If
        End If
    End If
    ilRet = mGridSavedRemoved("Current Working")
    mTerminate True
End Sub
Private Sub cmcDone_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub cmcDone_GotFocus()
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub
Private Sub cmcDropDown_Click()
    Select Case imBoxNo
        Case CNTRINDEX
            lbcCntr.Visible = Not lbcCntr.Visible
        Case VEHICLEINDEX
            lbcVehicle.Visible = Not lbcVehicle.Visible
        Case MGASSIGNINDEX
            lbcMGCopyAssign.Visible = Not lbcMGCopyAssign.Visible
        Case ZONEINDEX
            lbcZones.Visible = Not lbcZones.Visible
        Case SDATEINDEX
            plcCalendar.Visible = Not plcCalendar.Visible
        Case EDATEINDEX
            plcCalendar.Visible = Not plcCalendar.Visible
        Case STIMEINDEX
            plcTme.Visible = Not plcTme.Visible
        Case ETIMEINDEX
            plcTme.Visible = Not plcTme.Visible
        Case LENINDEX
            lbcLen.Visible = Not lbcLen.Visible
        Case AVAILINDEX + 1
            lbcAvail.Visible = Not lbcAvail.Visible
        Case TYPEINDEX
            lbcType.Visible = Not lbcType.Visible
        Case SHTTITLEINDEX
            lbcShtTitle.Visible = Not lbcShtTitle.Visible
    End Select
    edcDropDown.SelStart = 0
    edcDropDown.SelLength = Len(edcDropDown.Text)
    edcDropDown.SetFocus
End Sub
Private Sub cmcDropDown_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub
Private Sub cmcErase_Click()
    Dim ilRet As Integer
    Dim ilRes As Integer
    Dim llCrfRecPos As Long
    Dim slNameCode As String
    Dim slCode As String
    Dim llRecPos As Long
    
'    If Not imUpdateAllowed Then
'        Exit Sub
'    End If
'    If imRotIndex <= 0 Then
'        Exit Sub
'    End If
'    ilRes = MsgBox("This will Remove the Rotation and All Copy Assignment to Spots for this Rotation", vbOKCancel + vbExclamation, "Erase Rotation")
'    If ilRes = vbCancel Then
'        Exit Sub
'    End If
'    Screen.MousePointer = vbHourglass  'Wait
'    ilRet = mReadRec(imRotIndex, True, SETFORWRITE)
'    If Not ilRet Then
'        Screen.MousePointer = vbDefault
'        ilRet = MsgBox("Erase Not Completed, Try Later", vbOKOnly + vbExclamation, "Erase")
'        Exit Sub
'    End If
'    ilRet = btrBeginTrans(hmCrf, 1000)
'    If ilRet <> BTRV_ERR_NONE Then
'        Screen.MousePointer = vbDefault
'        ilRet = MsgBox("Erase Not Completed, Try Later", vbOKOnly + vbExclamation, "Erase")
'        Exit Sub
'    End If
'    ilRet = btrGetPosition(hmCrf, llCrfRecPos)
'    If ilRet <> BTRV_ERR_NONE Then
'        Screen.MousePointer = vbDefault
'        ilRet = btrAbortTrans(hmCrf)
'        ilRet = MsgBox("Erase Not Completed, Try Later", vbOKOnly + vbExclamation, "Erase")
'        Exit Sub
'    End If
'    ilRet = mEraseRot(tmCrf, llCrfRecPos, ilRes)
'    If Not ilRet Then
'        Screen.MousePointer = vbDefault
'        If Not imEraseStopped Then
'            If ilRes = 30002 Then
'                ilRet = csiHandleValue(0, 7)
'            Else
'                ilRet = ilRes
'            End If
'            ilRes = btrAbortTrans(hmCrf)
'            ilRes = MsgBox("Erase Not Completed, Try Later" & str$(ilRet), vbOKOnly + vbExclamation, "Erase")
'        Else
'            ilRes = btrAbortTrans(hmCrf)
'        End If
'        Exit Sub
'    End If
'    ilRet = btrEndTrans(hmCrf)

    '5/12/19: Replaced erase of each individual rotation with grid and allowing multi-rotation to be removed
    If Not imUpdateAllowed Then
        Exit Sub
    End If
    If imAdvtIndex < 0 Then
        Exit Sub
    End If
    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 1, "\", sgAdvtName)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    igCopyRotEraseAdfCode = Val(slCode)   '
    If imRotIndex > 0 Then
        slNameCode = tmCopyRotCode(imRotIndex - 1).sKey    'lbcRotCode.List(ilSelectIndex - 1)
        ilRet = gParseItem(slNameCode, 2, "\", slCode)
        slCode = Trim$(slCode)
        slCode = Trim$(slCode)
        llRecPos = CLng(slCode)
        ilRet = btrGetDirect(hmCrf, tmCrf, imCrfRecLen, llRecPos, INDEXKEY0, BTRV_LOCK_NONE)
        If ilRet = BTRV_ERR_NONE Then
            lgCopyRotEraseCrfCode = tmCrf.lCode
        Else
            lgCopyRotEraseCrfCode = -1
        End If
    Else
        lgCopyRotEraseCrfCode = -1
    End If
    CopyRotErase.Show vbModal
            
    gSetMousePointer grdRot, grdRot, vbHourglass
    pbcRot.Cls
    mPaintRot
    lbcInst.Clear
    lbcInst.AddItem " "
    smActiveCodeTag = ""
    lbcActive.Clear
    smPurgeCodeTag = ""
    lbcPurge.Clear
    smHistoryCodeTag = ""
    lbcHistory.Clear
    pbcLbcInst.Cls
    imRotIndex = -1
    gSetMousePointer grdRot, grdRot, vbHourglass
    mClearCtrlFields
    mRotPop False
    gSetMousePointer grdRot, grdRot, vbHourglass
    smCopyCntrCodeTag = ""
    ReDim tmCopyCntrCode(0 To 0) As SORTCODE
    mCntrPop
    gSetMousePointer grdRot, grdRot, vbHourglass
    mInvPop
    gSetMousePointer grdRot, grdRot, vbDefault
    mSetCommands
End Sub
Private Sub cmcErase_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub cmcErase_GotFocus()
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub
Private Sub cmcFLDn_Click()
    If (tgSaf(0).sSyncCopyInRot = "Y") And (tmCrf.lCvfCode > 0) And (tmCrf.lCode > 0) Then
        If (cmcUpdate.Enabled = False) Then
            lgSetNextCvfCode = tmCrf.lCvfCode
            igFLValue = imFLValue
            CopyNextSet.Show vbModal
            imFLValue = igFLValue
            imInitNextFinal = imFLValue
            mSetFLPointer
        End If
        Exit Sub
    End If
    If imFLValue < lbcInst.ListCount - 1 Then
        imFLValue = imFLValue + 1
        If lbcInst.TopIndex + imNoRowLbc < imFLValue Then
            lbcInst.TopIndex = lbcInst.TopIndex + 1
            Exit Sub
        End If
    End If
    mSetFLPointer
End Sub
Private Sub cmcFLUp_Click()
    If (tgSaf(0).sSyncCopyInRot = "Y") And (tmCrf.lCvfCode > 0) And (tmCrf.lCode > 0) Then
        If (cmcUpdate.Enabled = False) Then
            lgSetNextCvfCode = tmCrf.lCvfCode
            igFLValue = imFLValue
            CopyNextSet.Show vbModal
            imFLValue = igFLValue
            imInitNextFinal = imFLValue
            mSetFLPointer
        End If
        Exit Sub
    End If
    If imFLValue > 1 Then
        imFLValue = imFLValue - 1
        If lbcInst.TopIndex = imFLValue Then
            lbcInst.TopIndex = lbcInst.TopIndex - 1
            Exit Sub
        End If
    End If
    mSetFLPointer
End Sub

Private Sub cmcGrid_Click()
    Dim slNameCode As String
    Dim slCode As String
    Dim llRow As Long
    Dim ilRet As Integer
    
    If (imAdvtIndex < 0) Then
        Exit Sub
    End If
    If Not grdRot.Visible Then
        Exit Sub
    End If
    smRefGridName = ""
    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    igGetCopyGridAdfCode = Val(slCode)   '
    GetCopyGrid.Show vbModal
    If igGetCopyGridReturn Then
        grdRot.Redraw = False
        If smGridName = "Current Working" Then
            ilRet = mGridSavedRemoved(smGridName)
        End If
        'Load grid
        bmRetainGridCopy = bgGetCopyGridIncludeCopy
        lmGnfCode = igGetCopyGridGnfCode
        tmGnfSrchKey.lCode = lmGnfCode
        ilRet = btrGetEqual(hmGnf, tmGnf, imGnfRecLen, tmGnfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        If ilRet = BTRV_ERR_NONE Then
            gSetMousePointer grdRot, grdRot, vbHourglass
            '5/4/15
            smRefGridName = Trim$(tmGnf.sGridName)
            bmInCmcGrid = True
            mGridRestore
            bmInCmcGrid = False
            'Save as Current working
            smGridName = "Current Working"
            lmGnfCode = 0
            For llRow = grdRot.FixedRows To grdRot.rows - 1 Step 1
                If grdRot.TextMatrix(llRow, GPFCODEINDEX) <> "" Then
                    grdRot.TextMatrix(llRow, GPFCODEINDEX) = ""
                    ilRet = mGridSaved(llRow, True)
                End If
            Next llRow
        Else
            lmGnfCode = 0
        End If
        bmRetainGridCopy = False
        grdRot.Redraw = True
    End If
    gSetMousePointer grdRot, grdRot, vbDefault
End Sub

Private Sub cmcGrid_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub

Private Sub cmcGrid_GotFocus()
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub

Private Sub cmcInv_Click()
    If lbcInv.ListIndex = 0 Then
        imDoubleClick = True
        lbcInv_MouseUp 0, 0, 0, 0
    ElseIf lbcInv.ListIndex > 0 Then
        imDoubleClick = True
        lbcInv_MouseUp 0, 0, 0, 0
    End If
End Sub

Private Sub cmcInvNo_Click()
    'Unload IconTraf
    'If Not gWinRoom(igNoExeWinRes(CREVNOEXE)) Then
    '    Exit Sub
    'End If
    'Screen.MousePointer = vbHourGlass  'Wait
    'igChildDone = False 'edcLinkDestDoneMsg.Text = ""
    'edcLinkSrceDoneMsg.Text = ""
    'If (Not igStdAloneMode) And (imShowHelpMsg) Then
    '    If igTestSystem Then
    '        slStr = "Copy^Test\" & sgUserName
    '    Else
    '        slStr = "Copy^Prod\" & sgUserName
    '    End If
    'Else
    '    If igTestSystem Then
    '        slStr = "Copy^Test^NOHELP\" & sgUserName
    '    Else
    '        slStr = "Copy^Prod^NOHELP\" & sgUserName
    '    End If
    'End If
    'lgShellRet = Shell(sgExePath & "FdCartNo.Exe " & slStr, 1)
    'Copy.Enabled = False
    ''Screen.MousePointer = vbDefault  'Wait
    'Do While Not igChildDone
    '    DoEvents
    'Loop
    'slStr = sgDoneMsg
    'Copy.Enabled = True
    'edcLinkSrceDoneMsg.Text = "Ok"
    'For ilLoop = 0 To 10
    '    DoEvents
    'Next ilLoop
    FdCartNo.Show vbModal
End Sub

Private Sub cmcInvNo_GotFocus()
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub

Private Sub cmcMoveComment_Click()
    Dim slStr As String
    Dim slHdLnComment As String
    Dim slComment As String
    Dim il1StartChar As Integer
    Dim il2StartChar As Integer
    Dim ilNoChars As Integer

    If edcHdLnComment.SelLength > 0 Then
        slStr = edcHdLnComment.Text
        il1StartChar = edcHdLnComment.SelStart
        ilNoChars = edcHdLnComment.SelLength
        slHdLnComment = Mid$(slStr, il1StartChar, ilNoChars)
    Else
        slHdLnComment = Trim$(edcHdLnComment.Text)
    End If
    If edcComment.SelLength > 0 Then
        slStr = edcComment.Text
        'Replace Selected text
        il1StartChar = edcComment.SelStart
        il2StartChar = edcComment.SelStart + edcComment.SelLength + 1
        slComment = Mid$(slStr, 1, il1StartChar) & slHdLnComment & Mid$(slStr, il2StartChar)
    ElseIf edcComment.SelStart > 0 Then
        slStr = edcComment.Text
        il1StartChar = edcComment.SelStart
        slComment = Mid$(slStr, 1, il1StartChar) & slHdLnComment & Mid$(slStr, il1StartChar + 1)
    Else
        slComment = edcComment.Text & slHdLnComment
    End If
    edcComment.Text = slComment
End Sub

Private Sub cmcMoveFrom_Click()
    
 ' ---- TTP 10413 BEGIN JJB
    Dim i As Integer
    
    If imUpdateAllowed And (imInvStatus = 0) Then
        If (lbcInst.ListIndex <= lbcInv.ListCount - 2) Then
            For i = lbcInst.ListCount - 1 To 0 Step -1
                If lbcInst.Selected(i) = True Then
                    imDragSrce = DRAGINST
                    imDragIndexSrce = i
                    imcTrash_DragDrop lbcInv, 0, 0
                    mSetFLPointer
                End If
            Next i
        End If
    End If
    '----- TTP 10413 END
    
    'TTP: 1466
'    If imUpdateAllowed And (imInvStatus = 0) Then
'        If (lbcInst.ListIndex <= lbcInst.ListCount - 2) Then
'            imDragSrce = DRAGINST
'            imDragIndexSrce = lbcInst.ListIndex
'            imcTrash_DragDrop lbcInst, 0, 0
'            mSetFLPointer
'        End If
'    End If
End Sub

Private Sub cmcMoveFrom_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub

Private Sub cmcMoveTo_Click()

    ' ---- TTP 10413 BEGIN JJB
    Dim i As Integer
    
    If imUpdateAllowed And (imInvStatus = 0) Then
        If (lbcInv.ListIndex >= 0) And (lbcInv.ListIndex <= lbcInv.ListCount - 1) Then
            For i = lbcInv.ListCount - 1 To 0 Step -1
                If lbcInv.Selected(i) = True Then
                    imDragSrce = DRAGINV
                    imDragIndexSrce = i
                    imDragIndexDest = lbcInst.ListCount - 1
                    lbcInst_DragDrop lbcInv, 0, 0
                End If
            Next i
        End If
    End If
    '----- TTP 10413 END
    
    'TTP: 1466
'    If imUpdateAllowed And (imInvStatus = 0) Then
'        If (lbcInv.ListIndex >= 0) And (lbcInv.ListIndex <= lbcInv.ListCount - 1) Then
'            imDragSrce = DRAGINV
'            imDragIndexSrce = lbcInv.ListIndex
'            imDragIndexDest = lbcInst.ListCount - 1
'            lbcInst_DragDrop lbcInv, 0, 0
'        End If
'    End If
End Sub

Private Sub cmcMoveTo_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub

Private Sub cmcNewInv_Click()
    Dim slUseCartNo As String
    Dim slNameCode As String
    Dim slCode As String
    Dim slStr As String
    Dim ilRet As Integer
    Dim slSvUseCartNo As String
    
    If (imAdvtIndex < 0) Then
        Exit Sub
    End If
    If tgSpf.sUseCartNo = "B" Then
        If (grdRot.Visible) Or ((lbcInv.ListIndex < 0) Or (lbcInv.ListIndex > 1)) Then
            sgGenMsg = "Select which Inventory is to be Created"
            sgCMCTitle(0) = "New-CART"
            sgCMCTitle(1) = "New-ISCI"
            sgCMCTitle(2) = "Cancel"
            sgCMCTitle(3) = ""
            igDefCMC = 0
            igEditBox = 0
            GenMsg.Show vbModal
            DoEvents
            If igAnsCMC = 0 Then
                slUseCartNo = "Y"
            ElseIf igAnsCMC = 1 Then
                slUseCartNo = "N"
            ElseIf igAnsCMC = 2 Then
                Exit Sub
            Else
                Exit Sub
            End If
        Else
            If lbcInv.ListIndex = 1 Then
                slUseCartNo = "N"
            Else
                slUseCartNo = "Y"
            End If
        End If
    Else
        slUseCartNo = tgSpf.sUseCartNo
    End If
    lgCopyInvCifCode = 0    'New mode
    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    igCopyInvAdfCode = Val(slCode)   '
    igCopyInvEtfCode = 0
    igCopyInvEnfCode = 0
    If grdRot.Visible Then
        imBlackoutAdfCode = 0
        If lmRGEnableRow >= grdRot.FixedRows Then
            slStr = grdRot.TextMatrix(grdRot.Row, ADVTINDEX)
            If slStr <> "" Then
                gFindMatch slStr, 0, lbcRGAdvt
                If gLastFound(lbcRGAdvt) >= 0 Then
                    imBlackoutAdfCode = lbcRGAdvt.ItemData(gLastFound(lbcRGAdvt))
                End If
            End If
        End If
    End If
    If (imBlackoutAdfCode > 0) Then
        igCopyInvAdfCode = imBlackoutAdfCode
    End If
    sgUseCartNo = slUseCartNo
    If imTypeIndex <= 0 Then
        sgCopyForBBs = "N"
    Else
        sgCopyForBBs = "Y"
    End If
    If imSave(9) < 0 Then
        igCopyInvRotLen = -1
    Else
        igCopyInvRotLen = lbcLen.List(imSave(9))
    End If
    If igTestSystem Then
        slStr = "Copy^Test^NOHELP\" & sgUserName & "\" & Trim$(str$(igCopyInvCallSource)) & "\" & Trim$(str$(lgCopyInvCifCode)) & "\" & Trim$(str$(igCopyInvAdfCode)) & "\" & Trim$(str$(igCopyInvEtfCode)) & "\" & Trim$(str$(igCopyInvEnfCode)) & "\" & Trim$(str$(imInvStatus))
    Else
        slStr = "Copy^Prod^NOHELP\" & sgUserName & "\" & Trim$(str$(igCopyInvCallSource)) & "\" & Trim$(str$(lgCopyInvCifCode)) & "\" & Trim$(str$(igCopyInvAdfCode)) & "\" & Trim$(str$(igCopyInvEtfCode)) & "\" & Trim$(str$(igCopyInvEnfCode)) & "\" & Trim$(str$(imInvStatus))
    End If
    sgCommandStr = slStr
    slSvUseCartNo = tgSpf.sUseCartNo
    tgSpf.sUseCartNo = sgUseCartNo
    CopyInv.Show vbModal
    tgSpf.sUseCartNo = slSvUseCartNo
    slStr = sgDoneMsg
    lbcActive.Clear
    smActiveCodeTag = ""
    lbcPurge.Clear
    smPurgeCodeTag = ""
    lbcHistory.Clear
    smHistoryCodeTag = ""
    mInvPop
    lbcInst.ListIndex = -1
    pbcLbcInst_Paint
End Sub

Private Sub cmcNewInv_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub

Private Sub cmcPool_Click()
    If Not imUpdateAllowed Then
        Exit Sub
    End If
    BkoutPool.Show vbModal
    If igTerminateReturn > 0 Then
        mAdvtBlackoutPop
    End If
End Sub

Private Sub cmcPool_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub

Private Sub cmcPurge_Click()

    If Not imUpdateAllowed Then
        Exit Sub
    End If
    'Unload IconTraf
    'If Not gWinRoom(igNoExeWinRes(PURGEEXE)) Then
    '    Exit Sub
    'End If
    'Screen.MousePointer = vbHourGlass  'Wait
    'igChildDone = False 'edcLinkDestDoneMsg.Text = ""
    'edcLinkSrceDoneMsg.Text = ""
    'If (Not igStdAloneMode) And (imShowHelpMsg) Then
    '    If igTestSystem Then
    '        slStr = "Copy^Test\" & sgUserName
    '    Else
    '        slStr = "Copy^Prod\" & sgUserName
    '    End If
    'Else
    '    If igTestSystem Then
    '        slStr = "Copy^Test^NOHELP\" & sgUserName
    '    Else
    '        slStr = "Copy^Prod^NOHELP\" & sgUserName
    '    End If
    'End If
    'lgShellRet = Shell(sgExePath & "Purge.Exe " & slStr, 1)
    'Copy.Enabled = False
    ''Screen.MousePointer = vbDefault  'Wait
    'Do While Not igChildDone
    '    DoEvents
    'Loop
    'slStr = sgDoneMsg
    'Copy.Enabled = True
    'edcLinkSrceDoneMsg.Text = "Ok"
    'For ilLoop = 0 To 10
    '    DoEvents
    'Next ilLoop
    Purge.Show vbModal
End Sub
Private Sub cmcPurge_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub cmcPurge_GotFocus()
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub
Private Sub cmcRatio_Click()
    Dim ilRet As Integer
    Dim slStr As String
    Dim ilLoop As Integer
    Dim ilCount As Integer
    Dim slName As String
    Dim slNameCode As String
    Dim slCode As String
    Dim ilFound As Integer
    Dim ilIndex As Integer
    Dim ilParse As Integer
    Dim slReturnMsg As String
    Dim ilSpot4Wks As Integer
    Dim ilPos As Integer
    'If Not gWinRoom(igNoExeWinRes(COPYRATOEXE)) Then
    '    Exit Sub
    'End If
    ilSpot4Wks = mNoSpot4Wks()
    igCopyInvCallSource = COPYJOB
    'Screen.MousePointer = vbHourGlass  'Wait
    'igChildDone = False 'edcLinkDestDoneMsg.Text = ""
    'Traffic!edcLinkSrceHelpMsg.Text = ""
    ilCount = lbcInst.ListCount - 1 '-1 for blank line
    If ilSpot4Wks = -1 Then
        slStr = " " & "|" & Trim$(str$(ilCount))
    Else
        slStr = Trim$(str$(ilSpot4Wks)) & "|" & Trim$(str$(ilCount))
    End If
    For ilLoop = 0 To ilCount - 1 Step 1
        slName = lbcInst.List(ilLoop)
        gFindMatch slName, 0, lbcExpandActive
        If ((gLastFound(lbcExpandActive) > 0) And (tgSpf.sUseCartNo <> "B")) Or ((gLastFound(lbcExpandActive) > 1) And (tgSpf.sUseCartNo = "B")) Then
            If tgSpf.sUseCartNo <> "B" Then
                slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 1).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
            Else
                slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 2).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
            End If
        Else
            slName = lbcInst.List(ilLoop)
            gFindMatch slName, 0, lbcExpandPurge
            If gLastFound(lbcExpandPurge) > 0 Then
                slNameCode = tmPurgeCode(gLastFound(lbcExpandPurge)).sKey    'lbcPurgeCode.List(gLastFound(lbcPurge))
            Else
                slName = lbcInst.List(ilLoop)
                gFindMatch slName, 0, lbcExpandHistory
                If gLastFound(lbcExpandHistory) > 0 Then
                    slNameCode = tmHistoryCode(gLastFound(lbcExpandHistory)).sKey  'lbcHistoryCode.List(gLastFound(lbcHistory))
                End If
            End If
        End If
        'Replace delimiter ~ with blank
        ilPos = InStr(slNameCode, "~")
        Do While ilPos > 0
            Mid$(slNameCode, ilPos, 1) = " "
            ilPos = InStr(slNameCode, "~")
        Loop
        slStr = slStr & "|" & slNameCode
    Next ilLoop
    sgDoneMsg = slStr
    CopyRato.Show vbModal
    'lgShellRet = Shell(sgExePath & "CopyRato.Exe " & slStr, 1)
    'Traffic.Enabled = False
    'Screen.MousePointer = vbDefault  'Wait
    'Do While Not igChildDone
    '    DoEvents
    'Loop
    slReturnMsg = sgDoneMsg   'MatchCode values only (lCifCode)
    'Traffic.Enabled = True
    'Traffic!edcLinkSrceHelpMsg.Text = "Ok"
    'For ilLoop = 0 To 10
    '    DoEvents
    'Next ilLoop
    'Remake ilMatchCode
    If igCopyInvCallSource <> CALLDONE Then
        Exit Sub
    End If
    ilParse = gParseItem(slReturnMsg, 1, "\", slStr)
    ilCount = Val(slStr)
    If ilCount <= 0 Then
        Exit Sub
    End If
    'Copied from cmcRatio
    ReDim lmMatchCode(0 To ilCount - 1) As Long
    For ilLoop = 0 To ilCount - 1 Step 1
        ilRet = gParseItem(slReturnMsg, ilLoop + 2, "\", slCode)
        lmMatchCode(ilLoop) = Val(slCode)
    Next ilLoop
    lbcInst.Clear
    For ilLoop = 0 To ilCount - 1 Step 1
        ilFound = False
        For ilIndex = 0 To UBound(tgActiveCode) Step 1   'lbcActiveCode.ListCount Step 1
            slNameCode = tgActiveCode(ilIndex).sKey 'lbcActiveCode.List(ilIndex)
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            If Val(slCode) = lmMatchCode(ilLoop) Then
                'lbcInst.AddItem gAlignStringByPixel(lbcActive.List(ilIndex + 1), "~", lmListField(), lmListFieldChar())
                If tgSpf.sUseCartNo <> "B" Then
                    lbcInst.AddItem lbcActive.List(ilIndex + 1)
                Else
                    lbcInst.AddItem lbcActive.List(ilIndex + 2)
                End If
                ilFound = True
                Exit For
            End If
        Next ilIndex
        If Not ilFound Then
            For ilIndex = 0 To UBound(tmPurgeCode) Step 1 'lbcPurgeCode.ListCount Step 1
                slNameCode = tmPurgeCode(ilIndex).sKey   'lbcPurgeCode.List(ilIndex)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                If Val(slCode) = lmMatchCode(ilLoop) Then
                    'lbcInst.AddItem gAlignStringByPixel(lbcPurge.List(ilIndex), "~", lmListField(), lmListFieldChar())
                    lbcInst.AddItem lbcPurge.List(ilIndex)
                    ilFound = True
                    Exit For
                End If
            Next ilIndex
        End If
        If Not ilFound Then
            For ilIndex = 0 To UBound(tmHistoryCode) Step 1 'lbcHistoryCode.ListCount Step 1
                slNameCode = tmHistoryCode(ilIndex).sKey   'lbcHistoryCode.List(ilIndex)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                If Val(slCode) = lmMatchCode(ilLoop) Then
                    'lbcInst.AddItem gAlignStringByPixel(lbcHistory.List(ilIndex), "~", lmListField(), lmListFieldChar())
                    lbcInst.AddItem lbcHistory.List(ilIndex)
                    ilFound = True
                    Exit For
                End If
            Next ilIndex
        End If
    Next ilLoop
    lbcInst.AddItem " "
    pbcLbcInst_Paint
    Exit Sub
End Sub
Private Sub cmcRatio_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub cmcRatio_GotFocus()
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mSetShow imBoxNo
    imBoxNo = -1
End Sub
Private Sub cmcRegion_Click()
    Dim slNameCode As String
    Dim ilRet As Integer
    Dim slCode As String
    Dim ilValue As Integer

    If imAdvtIndex < 0 Then
        Exit Sub
    End If
    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 1, "\", sgAdvtName)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    igAdfCode = Val(slCode)   '
    ilValue = Asc(tgSpf.sUsingFeatures2)  'Option Fields in Orders/Proposals
    If (ilValue And REGIONALCOPY) = REGIONALCOPY Then
        CopyRegn.Show vbModal
        smRegionCodeTag = ""   'force read
        ilRet = gObtainRegion(igAdfCode, "R", True, tmRegionCode(), smRegionCodeTag)
    Else
        igSplitType = 0
        CopySplit.Show vbModal
        smRegionCodeTag = ""   'force read
        ilRet = gObtainRegion(igAdfCode, "C", True, tmRegionCode(), smRegionCodeTag)
    End If
    DoEvents
    Copy.Refresh
    mVehOptIndex
End Sub
Private Sub cmcRegion_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub cmcRegion_GotFocus()
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub

Private Sub cmcRGDropdown_Click()
    Select Case lmRGEnableCol
        Case REGIONNAMEINDEX
            lbcRGRegion.Visible = Not lbcRGRegion.Visible
        Case CATEGORYINDEX
            lbcRGCategory.Visible = Not lbcRGCategory.Visible
        Case SELECTIONINDEX
            lbcRGSelection(imRGSelection).Visible = Not lbcRGSelection(imRGSelection).Visible
        Case INCLEXCLINDEX
        Case FORMATINDEX
            lbcRGSelection(imRGSelection).Visible = Not lbcRGSelection(imRGSelection).Visible
        Case ADVTINDEX
            lbcRGAdvt.Visible = Not lbcRGAdvt.Visible
        Case COPYINDEX
    End Select
    If edcRGDropdown.Visible Then
        edcRGDropdown.SelStart = 0
        edcRGDropdown.SelLength = Len(edcRGDropdown.Text)
        edcRGDropdown.SetFocus
    End If
End Sub

Private Sub cmcRGDropdown_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub

Private Sub cmcRot_Click()
    'Screen.MousePointer = vbHourglass  'Wait
    gSetMousePointer grdRot, grdRot, vbHourglass
    If lbcRot.ListCount <= 0 Then
        mRotPop False
    End If
    If lbcRot.Top <> plcRot.Top + 30 Then
        'imLbcArrowSetting = True
        lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
        lbcRot.Top = plcRot.Top + 30
        lbcRot.Visible = True 'Not lbcRot.Visible
        pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
        pbcLbcRot.Visible = True
        pbcLbcRot.ZOrder vbSendToBack
        lbcRot.ZOrder vbSendToBack
        'imLbcArrowSetting = False
    Else
        'imLbcArrowSetting = True
        lbcRot.Top = plcRot.Top + plcRot.height - 60
        lbcRot.height = gListBoxHeight(lbcRot.ListCount, 10)
        lbcRot.Visible = True 'Not lbcRot.Visible
        lbcRot.ZOrder vbBringToFront
        pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
        pbcLbcRot.Visible = True
        pbcLbcRot.ZOrder vbBringToFront
        'imLbcArrowSetting = False
    End If
    lbcRot.SetFocus
    pbcLbcRot_Paint
    gSetMousePointer grdRot, grdRot, vbDefault
End Sub
Private Sub cmcRot_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub cmcRot_GotFocus()
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
    'lbcRot.Height = gListBoxHeight(lbcRot.ListCount, 10)
End Sub
Private Sub cmcRot_KeyUp(KeyCode As Integer, Shift As Integer)
    If (KeyCode = KEYUP) Or (KeyCode = KeyDown) Then
        gProcessArrowKey Shift, KeyCode, lbcRot, imLbcArrowSetting
    End If
End Sub

Private Sub cmcTimeDay_Click(Index As Integer)
    plcTme.Visible = Not plcTme.Visible
End Sub

Private Sub cmcTimeDay_GotFocus(Index As Integer)
    imTimeDayBoxNo = Index
    plcTme.Move pbcAirGame.Left + frcTimeDay.Left + edcTimeDay(Index).Left, pbcAirGame.Top + frcTimeDay.Top + edcTimeDay(Index).Top + edcTimeDay(Index).height
End Sub

Private Sub cmcUndo_Click()
    Dim llRow As Long
    Dim ilFound As Integer
    
    If grdRot.Visible Then
        ilFound = False
        For llRow = grdRot.FixedRows To grdRot.rows - 1 Step 1
            If grdRot.TextMatrix(llRow, COPYINDEX) <> "" Then
                ilFound = True
                Exit For
            End If
        Next llRow
        If ilFound Then
            mClearRG
            Exit Sub
        End If
    End If
    'Ignore all changes and set focus to cbcAdvt
    cbcType.Enabled = True
    cbcAdvt.Enabled = True
    cmcRot.Enabled = True
    mCbcAdvtChange
    cbcAdvt.SetFocus
    mSetCommands
End Sub
Private Sub cmcUndo_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub cmcUndo_GotFocus()
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub
Private Sub cmcUpdate_Click()
    Dim ilRet As Integer
    Dim ilLoop As Integer
    
    If Not imUpdateAllowed Then
        Exit Sub
    End If
    If mSaveRecChg(False) = False Then
        If Not imTerminate Then
            If imBoxNo = -1 Then
                'If cmcCancel.Enabled Then
                '    cmcCancel.SetFocus
                'End If
            Else
                mEnableBox imBoxNo
            End If
            Exit Sub
        Else
            cmcCancel_Click
            Exit Sub
        End If
    End If
    If grdRot.Visible Then
        'ilRet = mGridSavedRemoved(True)
        '8/14/12: SSpeed-up setting of copy inventory rotation dates
        'Moved to mAllSaveRec
        'mAdjustCufAndCif "U", tmCrf, lmCifCode()
        imRotIndex = 0
        mRotPop False
        For ilLoop = imLBCtrls To UBound(tmCtrls) Step 1
            tmCtrls(ilLoop).iChg = False
        Next ilLoop
        imRotHeaderChgOnly = True
        mSetCommands
        imInAllSaveRec = False
        If lbcRot.ListIndex = -1 Then
            lbcRot_Click
        Else
            lbcRot.ListIndex = -1
        End If
    End If
End Sub
Private Sub cmcUpdate_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub cmcUpdate_GotFocus()
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub

Private Sub edcCGDropdown_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub

Private Sub edcComment_Change()
    mSetChg imBoxNo
End Sub

Private Sub edcComment_KeyPress(KeyAscii As Integer)
    Dim ilKey As Integer
    ilKey = KeyAscii
    If Not gCheckKeyAscii(ilKey) Then
        KeyAscii = 0
        Exit Sub
    End If
End Sub

Private Sub edcComment_LostFocus()
    smComment = Trim$(edcComment.Text)
End Sub

Private Sub edcDropDown_Change()
    Dim slStr As String
    Dim ilRet As Integer
    Dim ilLoop As Integer
    Dim ilCount As Integer

    Select Case imBoxNo
        Case CNTRINDEX
            imLbcArrowSetting = True
            gMatchLookAhead edcDropDown, lbcCntr, imBSMode, imComboBoxIndex
            txtISCI_Filter_Main.Text = ""
            mChangeFilter_Main
            'Moved this test to mSetShow because focus was jumping to comment field (10/5/02)
            ''Test if instruction and contract product match- if no ask if OK
            'If lbcCntr.ListIndex >= 0 Then
            '    If smSave(1) <> lbcCntr.List(lbcCntr.ListIndex) Then
            '        slNameCode = tmCopyCntrCode(lbcCntr.ListIndex).sKey    'lbcCntrCode.List(lbcCntr.ListIndex)
            '        ilRet = gParseItem(slNameCode, 2, "\", slCode)
            '        If tmChf.lCode <> Val(slCode) Then
            '            tmChfSrchKey.lCode = Val(slCode)
            '            ilRet = btrGetEqual(hmChf, tmChf, imChfRecLen, tmChfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            '        End If
            '        If tmChf.sInvGp = "A" Then  'All Spots
            '            For ilLoop = 0 To lbcInst.ListCount - 2 Step 1
            '                slName = lbcInst.List(ilLoop)
            '                gFindMatch slName, 0, lbcExpandActive
            '                If gLastFound(lbcExpandActive) > 0 Then
            '                    slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 1).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
            '                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
            '                    tmCifSrchKey.lCode = Val(slCode)
            '                    ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            '                    If (ilRet = BTRV_ERR_NONE) And (tmCif.lCpfCode > 0) Then
            '                        tmCpfSrchKey.lCode = tmCif.lCpfCode
            '                        ilRet = btrGetEqual(hmCpf, tmCpf, imCpfRecLen, tmCpfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            '                        If (ilRet = BTRV_ERR_NONE) And (Trim$(tmCpf.sName) <> "") Then
            '                            If tgSpf.sUseProdSptScr = "P" Then  'Short Title
            '                                slShtTitle = ""
            '                                If (tmChf.lSifCode > 0) Then
            '                                    tmSifSrchKey0.lCode = tmChf.lSifCode
            '                                    ilRet = btrGetEqual(hmSif, tmSif, imSifRecLen, tmSifSrchKey0, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            '                                    If ilRet = BTRV_ERR_NONE Then
            '                                        slShtTitle = Trim$(tmSif.sName)
            '                                    End If
            '                                End If
            '                                If StrComp(Trim$(slShtTitle), Trim$(tmCpf.sName), 1) <> 0 Then
            '                                    ilRes = MsgBox("Short Title Names Don't Match. Copy: " & Trim$(tmCpf.sName) & " Contract: " & tmChf.sProduct, vbOkCancel + vbExclamation, "Product Conflict")
            '                                    If ilRes = vbCancel Then
            '                                        mClearDrag
            '                                        Exit Sub
            '                                    End If
            '                                End If
            '                            Else
            '                                If StrComp(Trim$(tmChf.sProduct), Trim$(tmCpf.sName), 1) <> 0 Then
            '                                    ilRes = MsgBox("Product Names Don't Match. Copy: " & Trim$(tmCpf.sName) & " Contract: " & tmChf.sProduct & ", Clear Instruction", vbYesNo + vbQuestion, "Product Conflict")
            '                                    If ilRes = vbYes Then
            '                                        cmcClear_Click
            '                                    End If
            '                                    Exit For
            '                                End If
            '                            End If
            '                        End If
            '                    End If
            '                End If
            '            Next ilLoop
            '        End If
            '    End If
            'End If
        Case VEHICLEINDEX
            imLbcArrowSetting = True
            If edcDropDown.Text <> smSeveral Then
                gMatchLookAhead edcDropDown, lbcVehicle, imBSMode, imComboBoxIndex
            End If
            If edcDropDown.Text = "[All]" Then
                For ilLoop = 0 To lbcVehicle.ListCount - 1 Step 1
                    lbcVehicle.Selected(ilLoop) = False
                Next ilLoop
                ilCount = 0
                For ilLoop = 1 To lbcVehicle.ListCount - 1 Step 1  'lbcVehicleCode.ListCount - 1 Step 1
                    slStr = lbcVehicle.List(ilLoop)
                    If (InStr(1, slStr, "A:", vbTextCompare) <= 0) And (InStr(1, slStr, "H:", vbTextCompare) <= 0) Then
                        lbcVehicle.Selected(ilLoop) = True
                        ilCount = ilCount + 1
                    End If
                Next ilLoop
                If ilCount > 1 Then
                    edcDropDown.Text = smSeveral
                ElseIf ilCount = 1 Then
                    edcDropDown.Text = lbcVehicle.List(lbcVehicle.ListIndex)
                End If
            End If

        Case MGASSIGNINDEX
            imLbcArrowSetting = True
            gMatchLookAhead edcDropDown, lbcMGCopyAssign, imBSMode, imComboBoxIndex
        Case ZONEINDEX
            imLbcArrowSetting = True
            gMatchLookAhead edcDropDown, lbcZones, imBSMode, imComboBoxIndex
        Case SDATEINDEX
            slStr = edcDropDown.Text
            If Not gValidDate(slStr) Then
                Exit Sub
            End If
            gObtainMonthYear imCalType, slStr, imCalMonth, imCalYear
            pbcCalendar_Paint   'mBoxCalDate called within paint
            'Make end date follow start date
            slStr = edcDropDown.Text
            If (smSave(3) <> "") And (smSave(4) <> "") Then
                If gValidDate(smSave(3)) And gValidDate(smSave(4)) Then
                    smSave(4) = Format$(gDateValue(smSave(4)) + gDateValue(slStr) - gDateValue(smSave(3)), "m/d/yy")
                    gSetShow pbcRot, smSave(4), tmCtrls(EDATEINDEX)
                End If
            End If
            smSave(3) = edcDropDown.Text
        Case EDATEINDEX
            slStr = edcDropDown.Text
            If Not gValidDate(slStr) Then
                Exit Sub
            End If
            gObtainMonthYear imCalType, slStr, imCalMonth, imCalYear
            pbcCalendar_Paint   'mBoxCalDate called within paint
            smSave(4) = edcDropDown.Text
        Case STIMEINDEX
            smSave(5) = edcDropDown.Text
        Case ETIMEINDEX
            smSave(6) = edcDropDown.Text
        Case LENINDEX
            imLbcArrowSetting = True
            gMatchLookAhead edcDropDown, lbcLen, imBSMode, imComboBoxIndex
        Case AVAILINDEX + 1
            imLbcArrowSetting = True
            ilRet = gOptionalLookAhead(edcDropDown, lbcAvail, imBSMode, slStr)
            If ilRet = 1 Then
                lbcAvail.ListIndex = 0
            End If
        Case TYPEINDEX
            imLbcArrowSetting = True
            gMatchLookAhead edcDropDown, lbcType, imBSMode, imComboBoxIndex
        Case SHTTITLEINDEX
            imLbcArrowSetting = True
            ilRet = gOptionalLookAhead(edcDropDown, lbcShtTitle, imBSMode, slStr)
            If ilRet = 1 Then   'input was ""
                lbcShtTitle.ListIndex = 0
            End If
            smShtTitle = edcDropDown.Text
    End Select
    imLbcArrowSetting = False
    mSetChg imBoxNo
End Sub
Private Sub edcDropDown_DblClick()
    If (imBoxNo = AVAILINDEX + 1) Or (imBoxNo = SHTTITLEINDEX) Then
        imDoubleClickName = True    'Double click event foolowed by mouse up
    End If
End Sub
Private Sub edcDropDown_GotFocus()
    Select Case imBoxNo
        Case CNTRINDEX
            'If lbcCntr.ListCount = 1 Then
            '    lbcCntr.ListIndex = 0
            '    If imTabDirection = -1 Then  'Right To Left
            '        pbcSTab.SetFocus
            '    Else
            '        pbcTab.SetFocus
            '    End If
            '    Exit Sub
            'End If
        Case VEHICLEINDEX
            'If lbcVehicle.ListCount = 1 Then
            '    lbcVehicle.ListIndex = 0
            '    If imTabDirection = -1 Then  'Right To Left
            '        pbcSTab.SetFocus
            '    Else
            '        pbcTab.SetFocus
            '    End If
            '    Exit Sub
            'End If
        Case MGASSIGNINDEX
        Case ZONEINDEX
            'If lbcZones.ListCount = 1 Then
            '    lbcZones.ListIndex = 0
            '    If imTabDirection = -1 Then 'Right to left
            '        pbcSTab.SetFocus
            '    Else
            '        pbcTab.SetFocus
            '    End If
            '    Exit Sub
            'End If
        Case AVAILINDEX + 1
            'If lbcAvail.ListCount = 1 Then
            '    lbcAvail.ListIndex = 0
            '    If imTabDirection = -1 Then 'Right to left
            '        pbcSTab.SetFocus
            '    Else
            '        pbcTab.SetFocus
            '    End If
            '    Exit Sub
            'End If
        Case TYPEINDEX
            'If lbcType.ListCount = 1 Then
            '    lbcType.ListIndex = 0
            '    If imTabDirection = -1 Then 'Right to left
            '        pbcSTab.SetFocus
            '    Else
            '        pbcTab.SetFocus
            '    End If
            '    Exit Sub
            'End If
        Case SHTTITLEINDEX
    End Select
    If Not imBypassFocus Then
        gCtrlGotFocus ActiveControl
    End If
    imBypassFocus = False
End Sub
Private Sub edcDropDown_KeyDown(KeyCode As Integer, Shift As Integer)
    'Delete key causes the charact to the right of the cursor to be deleted
    imBSMode = False
End Sub
Private Sub edcDropDown_KeyPress(KeyAscii As Integer)
    Dim ilFound As Integer
    Dim ilLoop As Integer
    Dim ilKey As Integer
    If KeyAscii = 8 Then    'Process backspace key (delete key handled as a KeyDown Event)
        If edcDropDown.SelLength <> 0 Then    'avoid deleting two characters
            imBSMode = True 'Force deletion of character prior to selected text
        End If
    End If
    Select Case imBoxNo
        Case SDATEINDEX, EDATEINDEX
            'Filter characters (allow only BackSpace, numbers 0 thru 9
            If (KeyAscii <> KEYBACKSPACE) And ((KeyAscii < KEY0) Or (KeyAscii > KEY9)) And (KeyAscii <> KEYSLASH) Then
                Beep
                KeyAscii = 0
                Exit Sub
            End If
        Case STIMEINDEX, ETIMEINDEX
            If (KeyAscii <> KEYBACKSPACE) And ((KeyAscii < KEY0) Or (KeyAscii > KEY9)) Then
                ilFound = False
                For ilLoop = LBound(igLegalTime) To UBound(igLegalTime) Step 1
                    If KeyAscii = igLegalTime(ilLoop) Then
                        ilFound = True
                        Exit For
                    End If
                Next ilLoop
                If Not ilFound Then
                    Beep
                    KeyAscii = 0
                    Exit Sub
                End If
            End If
        Case SHTTITLEINDEX
            ilKey = KeyAscii
            If Not gCheckKeyAscii(ilKey) Then
                KeyAscii = 0
                Exit Sub
            End If
    End Select
End Sub
Private Sub edcDropDown_KeyUp(KeyCode As Integer, Shift As Integer)
    Dim slDate As String
    If (KeyCode = KEYUP) Or (KeyCode = KeyDown) Then
        Select Case imBoxNo
            Case CNTRINDEX
                gProcessArrowKey Shift, KeyCode, lbcCntr, imLbcArrowSetting
            Case VEHICLEINDEX
                gProcessArrowKey Shift, KeyCode, lbcVehicle, imLbcArrowSetting
            Case MGASSIGNINDEX
                gProcessArrowKey Shift, KeyCode, lbcMGCopyAssign, imLbcArrowSetting
            Case ZONEINDEX
                gProcessArrowKey Shift, KeyCode, lbcZones, imLbcArrowSetting
            Case SDATEINDEX
                If (Shift And vbAltMask) > 0 Then
                    plcCalendar.Visible = Not plcCalendar.Visible
                Else
                    slDate = edcDropDown.Text
                    If gValidDate(slDate) Then
                        If KeyCode = KEYUP Then 'Up arrow
                            slDate = Format$(gDateValue(slDate) - 7, "m/d/yy")
                        Else
                            slDate = Format$(gDateValue(slDate) + 7, "m/d/yy")
                        End If
                        gObtainMonthYear imCalType, slDate, imCalMonth, imCalYear
                        edcDropDown.Text = slDate
                    End If
                End If
            Case EDATEINDEX
                If (Shift And vbAltMask) > 0 Then
                    plcCalendar.Visible = Not plcCalendar.Visible
                Else
                    slDate = edcDropDown.Text
                    If gValidDate(slDate) Then
                        If KeyCode = KEYUP Then 'Up arrow
                            slDate = Format$(gDateValue(slDate) - 7, "m/d/yy")
                        Else
                            slDate = Format$(gDateValue(slDate) + 7, "m/d/yy")
                        End If
                        gObtainMonthYear imCalType, slDate, imCalMonth, imCalYear
                        edcDropDown.Text = slDate
                    End If
                End If
            Case STIMEINDEX
                If (Shift And vbAltMask) > 0 Then
                    plcTme.Visible = Not plcTme.Visible
                End If
            Case ETIMEINDEX
                If (Shift And vbAltMask) > 0 Then
                    plcTme.Visible = Not plcTme.Visible
                End If
            Case LENINDEX
                gProcessArrowKey Shift, KeyCode, lbcLen, imLbcArrowSetting
            Case AVAILINDEX + 1
                gProcessArrowKey Shift, KeyCode, lbcAvail, imLbcArrowSetting
            Case TYPEINDEX
                gProcessArrowKey Shift, KeyCode, lbcType, imLbcArrowSetting
            Case SHTTITLEINDEX
                gProcessArrowKey Shift, KeyCode, lbcShtTitle, imLbcArrowSetting
        End Select
        edcDropDown.SelStart = 0
        edcDropDown.SelLength = Len(edcDropDown.Text)
    End If
    If (KeyCode = KEYLEFT) Or (KeyCode = KEYRIGHT) Then
        Select Case imBoxNo
            Case SDATEINDEX
                If (Shift And vbAltMask) > 0 Then
                Else
                    slDate = edcDropDown.Text
                    If gValidDate(slDate) Then
                        If KeyCode = KEYLEFT Then 'Left arrow
                            slDate = Format$(gDateValue(slDate) - 1, "m/d/yy")
                        Else
                            slDate = Format$(gDateValue(slDate) + 1, "m/d/yy")
                        End If
                        gObtainMonthYear imCalType, slDate, imCalMonth, imCalYear
                        edcDropDown.Text = slDate
                    End If
                End If
            Case EDATEINDEX
                If (Shift And vbAltMask) > 0 Then
                Else
                    slDate = edcDropDown.Text
                    If gValidDate(slDate) Then
                        If KeyCode = KEYLEFT Then 'Left arrow
                            slDate = Format$(gDateValue(slDate) - 1, "m/d/yy")
                        Else
                            slDate = Format$(gDateValue(slDate) + 1, "m/d/yy")
                        End If
                        gObtainMonthYear imCalType, slDate, imCalMonth, imCalYear
                        edcDropDown.Text = slDate
                    End If
                End If
        End Select
        edcDropDown.SelStart = 0
        edcDropDown.SelLength = Len(edcDropDown.Text)
    End If
End Sub
Private Sub edcDropDown_LostFocus()
    Select Case imBoxNo
        Case CNTRINDEX
        Case VEHICLEINDEX 'Vehicle
        Case MGASSIGNINDEX
        Case ZONEINDEX
        Case SDATEINDEX
            smSave(3) = edcDropDown.Text
        Case EDATEINDEX
            smSave(4) = edcDropDown.Text
        Case STIMEINDEX
            smSave(5) = edcDropDown.Text
        Case ETIMEINDEX
            smSave(6) = edcDropDown.Text
        Case LENINDEX
        Case AVAILINDEX + 1
        Case TYPEINDEX
        Case SHTTITLEINDEX
            smShtTitle = edcDropDown.Text
    End Select
End Sub
Private Sub edcDropDown_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If imDoubleClickName Then
        Select Case imBoxNo
            Case AVAILINDEX + 1
                If imTabDirection = -1 Then  'Right To Left
                    pbcSTab.SetFocus
                Else
                    pbcTab.SetFocus
                End If
                Exit Sub
            Case SHTTITLEINDEX
                If imTabDirection = -1 Then  'Right To Left
                    pbcSTab.SetFocus
                Else
                    pbcTab.SetFocus
                End If
                Exit Sub
        End Select
        imDoubleClickName = False
    End If
End Sub

Private Sub edcHdLnComment_GotFocus()
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub

Private Sub edcHdLnComment_KeyDown(KeyCode As Integer, Shift As Integer)
'    Replaced with a call to gSetCtrlReadOnly edcHdLnComment
'    If ((KeyCode = 67) Or (KeyCode = 99) Or (KeyCode = vbKeyInsert)) And ((Shift And vbCtrlMask) > 0) Then   ' Display key combinations
'    Else
'        KeyCode = 0
'    End If
End Sub

Private Sub edcLinkDestHelpMsg_Change()
    igParentRestarted = True
End Sub

Private Sub edcRGComment_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub

Private Sub edcRGComment_KeyPress(KeyAscii As Integer)
    Dim ilKey As Integer
    ilKey = KeyAscii
    If Not gCheckKeyAscii(ilKey) Then
        KeyAscii = 0
        Exit Sub
    End If
End Sub

Private Sub edcRGDropdown_Change()
    Dim slStr As String
    Dim ilRet As Integer
    Dim ilLoop As Integer
    
    Select Case lmRGEnableCol
        Case RGVEHICLEINDEX
            If (lbcRGVehicle.SelCount <= 1) Or (bmRGKeyPressed) Then
                imEdcChgMode = True
                For ilLoop = 0 To lbcRGVehicle.ListCount - 1 Step 1
                    lbcRGVehicle.Selected(ilLoop) = False
                Next ilLoop
                imLbcArrowSetting = True
                bmRGKeyPressed = False
                imEdcChgMode = False
                gMatchLookAhead edcRGDropdown, lbcRGVehicle, imBSMode, imComboBoxIndex
                If lbcRGVehicle.ListIndex >= 0 Then
                    lbcRGVehicle.Selected(lbcRGVehicle.ListIndex) = True
                End If
            Else
                edcRGDropdown.Text = "Multi-Select"
            End If
        Case REGIONNAMEINDEX
            If Not imEdcChgMode Then
                imEdcChgMode = True
                imLbcArrowSetting = True
                ilRet = gOptionalLookAhead(edcRGDropdown, lbcRGRegion, imBSMode, slStr)
                If ilRet >= 1 Then
                    imChgMode = True
                    lbcRGRegion.ListIndex = -1
                    imChgMode = False
                End If
            End If
            imEdcChgMode = False
        Case CATEGORYINDEX
            imLbcArrowSetting = True
            gMatchLookAhead edcRGDropdown, lbcRGCategory, imBSMode, imComboBoxIndex
        Case SELECTIONINDEX, FORMATINDEX
            If (lbcRGSelection(imRGSelection).SelCount <= 1) Or (bmRGKeyPressed) Then
                imEdcChgMode = True
                For ilLoop = 0 To lbcRGSelection(imRGSelection).ListCount - 1 Step 1
                    lbcRGSelection(imRGSelection).Selected(ilLoop) = False
                Next ilLoop
                imLbcArrowSetting = True
                bmRGKeyPressed = False
                imEdcChgMode = False
                gMatchLookAhead edcRGDropdown, lbcRGSelection(imRGSelection), imBSMode, imComboBoxIndex
                If lbcRGSelection(imRGSelection).ListIndex >= 0 Then
                    lbcRGSelection(imRGSelection).Selected(lbcRGSelection(imRGSelection).ListIndex) = True
                End If
            Else
                edcRGDropdown.Text = "Multi-Select"
            End If
        Case INCLEXCLINDEX
        'Case FORMATINDEX
            'If lbcRGSelection(imRGSelection).SelCount <= 1 Then
            '    imLbcArrowSetting = True
            '    gMatchLookAhead edcRGDropdown, lbcRGSelection(imRGSelection), imBSMode, imComboBoxIndex
            'Else
            '    edcRGDropdown.Text = "Multi-Select"
            'End If
        Case ADVTINDEX
            imLbcArrowSetting = True
            gMatchLookAhead edcRGDropdown, lbcRGAdvt, imBSMode, imComboBoxIndex
        Case COPYINDEX
    End Select
    imLbcArrowSetting = False
    bmRGKeyPressed = False
End Sub

Private Sub edcRGDropdown_GotFocus()
    Select Case lmRGEnableCol
        Case RGVEHICLEINDEX
            If lbcRGVehicle.SelCount <= 1 Then
                imComboBoxIndex = lbcRGVehicle.ListIndex
            End If
        Case REGIONNAMEINDEX
            imComboBoxIndex = lbcRGRegion.ListIndex
        Case CATEGORYINDEX
            imComboBoxIndex = lbcRGCategory.ListIndex
        Case SELECTIONINDEX
            If lbcRGSelection(imRGSelection).SelCount <= 1 Then
                imComboBoxIndex = lbcRGSelection(imRGSelection).ListIndex
            End If
        Case INCLEXCLINDEX
        Case FORMATINDEX
            If lbcRGSelection(imRGSelection).SelCount <= 1 Then
                imComboBoxIndex = lbcRGSelection(imRGSelection).ListIndex
            End If
        Case ADVTINDEX
            imComboBoxIndex = lbcRGAdvt.ListIndex
        Case COPYINDEX
    End Select
    If Not imBypassFocus Then
        gCtrlGotFocus ActiveControl
    End If
    imBypassFocus = False
End Sub

Private Sub edcRGDropdown_KeyDown(KeyCode As Integer, Shift As Integer)
    'Delete key causes the charact to the right of the cursor to be deleted
    imBSMode = False
End Sub

Private Sub edcRGDropdown_KeyPress(KeyAscii As Integer)
    Dim ilFound As Integer
    Dim ilLoop As Integer
    Dim ilKey As Integer
    If KeyAscii = 8 Then    'Process backspace key (delete key handled as a KeyDown Event)
        If edcRGDropdown.SelLength <> 0 Then    'avoid deleting two characters
            imBSMode = True 'Force deletion of character prior to selected text
        End If
    End If
    Select Case lmRGEnableCol
        Case RGVEHICLEINDEX
            bmRGKeyPressed = True
        Case REGIONNAMEINDEX
        Case CATEGORYINDEX
        Case SELECTIONINDEX, FORMATINDEX
            bmRGKeyPressed = True
        Case INCLEXCLINDEX
        'Case FORMATINDEX
        Case ADVTINDEX
        Case COPYINDEX
    End Select

End Sub

Private Sub edcRGDropdown_KeyUp(KeyCode As Integer, Shift As Integer)
    If (KeyCode = KEYUP) Or (KeyCode = KeyDown) Then
        Select Case lmRGEnableCol
            Case RGVEHICLEINDEX
                gProcessArrowKey Shift, KeyCode, lbcRGVehicle, imLbcArrowSetting
            Case REGIONNAMEINDEX
                gProcessArrowKey Shift, KeyCode, lbcRGRegion, imLbcArrowSetting
            Case CATEGORYINDEX
                gProcessArrowKey Shift, KeyCode, lbcRGCategory, imLbcArrowSetting
            Case SELECTIONINDEX, FORMATINDEX
                gProcessArrowKey Shift, KeyCode, lbcRGSelection(imRGSelection), imLbcArrowSetting
            Case INCLEXCLINDEX
            'Case FORMATINDEX
            '    If lbcRGSelection(imRGSelection).SelCount <= 1 Then
            '        imLbcArrowSetting = True
            '        gProcessArrowKey Shift, KeyCode, lbcRGSelection(imRGSelection), imLbcArrowSetting
            '    End If
            Case ADVTINDEX
                gProcessArrowKey Shift, KeyCode, lbcRGAdvt, imLbcArrowSetting
            Case COPYINDEX
        End Select
        edcRGDropdown.SelStart = 0
        edcRGDropdown.SelLength = Len(edcRGDropdown.Text)
    End If
End Sub

Private Sub edcRGDropdown_LostFocus()
    Select Case lmRGEnableCol
        Case RGVEHICLEINDEX
        Case REGIONNAMEINDEX
        Case CATEGORYINDEX
        Case SELECTIONINDEX
        Case INCLEXCLINDEX
        Case FORMATINDEX
        Case ADVTINDEX
        Case COPYINDEX
    End Select
End Sub

Private Sub edcTimeDay_Change(Index As Integer)
    mSetChg STIMEINDEX + Index
End Sub

Private Sub edcTimeDay_GotFocus(Index As Integer)
    imTimeDayBoxNo = Index
    plcTme.Move pbcAirGame.Left + frcTimeDay.Left + edcTimeDay(Index).Left, pbcAirGame.Top + frcTimeDay.Top + edcTimeDay(Index).Top + edcTimeDay(Index).height
    If Not imBypassFocus Then
        If edcTimeDay(Index).Text = "" Then
            edcTimeDay(Index).Text = "12M"
        End If
        gCtrlGotFocus ActiveControl
    End If
    imBypassFocus = False
End Sub

Private Sub edcTimeDay_KeyDown(Index As Integer, KeyCode As Integer, Shift As Integer)
    'Delete key causes the charact to the right of the cursor to be deleted
    imBSMode = False
End Sub

Private Sub edcTimeDay_KeyPress(Index As Integer, KeyAscii As Integer)
    Dim ilFound As Integer
    Dim ilLoop As Integer
    Dim ilKey As Integer
    If KeyAscii = 8 Then    'Process backspace key (delete key handled as a KeyDown Event)
        If edcTimeDay(Index).SelLength <> 0 Then    'avoid deleting two characters
            imBSMode = True 'Force deletion of character prior to selected text
        End If
    End If
    If (KeyAscii <> KEYBACKSPACE) And ((KeyAscii < KEY0) Or (KeyAscii > KEY9)) Then
        ilFound = False
        For ilLoop = LBound(igLegalTime) To UBound(igLegalTime) Step 1
            If KeyAscii = igLegalTime(ilLoop) Then
                ilFound = True
                Exit For
            End If
        Next ilLoop
        If Not ilFound Then
            Beep
            KeyAscii = 0
            Exit Sub
        End If
    End If
End Sub

Private Sub edcTimeDay_KeyUp(Index As Integer, KeyCode As Integer, Shift As Integer)
    If (KeyCode = KEYUP) Or (KeyCode = KeyDown) Then
        If (Shift And vbAltMask) > 0 Then
            plcTme.Visible = Not plcTme.Visible
        End If
        edcTimeDay(Index).SelStart = 0
        edcTimeDay(Index).SelLength = Len(edcTimeDay(Index).Text)
    End If
    If (KeyCode = KEYLEFT) Or (KeyCode = KEYRIGHT) Then
        edcTimeDay(Index).SelStart = 0
        edcTimeDay(Index).SelLength = Len(edcTimeDay(Index).Text)
    End If
End Sub

Private Sub edcToolTip_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    imButtonIndex = 0
    edcToolTip.Visible = False
End Sub

Private Sub Form_Activate()
    If Not imFirstActivate Then
        DoEvents    'Process events so pending keys are not sent to this
                    'form when keypreview turn on
        gShowBranner imUpdateAllowed
        Me.KeyPreview = True  'To get Alt J and Alt L keys
        Exit Sub
    End If
    imFirstActivate = False
    If (igWinStatus(COPYJOB) = 1) And (Trim$(tgUrf(0).sName) <> sgCPName) And (Trim$(tgUrf(0).sName) <> sgSUName) Then
        imUpdateAllowed = False
        pbcRot.Enabled = False
        pbcSTab.Enabled = False
        pbcTab.Enabled = False
    Else
        pbcRot.Enabled = True
        pbcSTab.Enabled = True
        pbcTab.Enabled = True
        imUpdateAllowed = True
    End If
    pbcInvStatus_Paint
    gShowBranner imUpdateAllowed
    DoEvents    'Process events so pending keys are not sent to this
                'form when keypreview turn on
    'Copy.KeyPreview = True  'To get Alt J and Alt L keys
    Me.KeyPreview = True
    Me.ZOrder 0 'Send to front
    Copy.Refresh
End Sub
Private Sub Form_Click()
    pbcClickFocus.SetFocus
End Sub
Private Sub Form_Deactivate()
    'Copy.KeyPreview = False
    Me.KeyPreview = False
End Sub
Private Sub Form_KeyUp(KeyCode As Integer, Shift As Integer)
    'If ((Shift And vbAltMask) > 0) And (KeyCode = 74) Then    'J=74
    '    Copy.KeyPreview = False
    '    Traffic!gpcBasicWnd.Value = True   'Button up and unload
    'End If
    'If ((Shift And vbAltMask) > 0) And (KeyCode = 76) Then    'L=76
    '    Copy.KeyPreview = False
    '    Traffic!gpcAuxWnd.Value = True   'Button up and unload
    'End If
    Dim ilReSet As Integer

    If (KeyCode = KEYF1) Or (KeyCode = KEYF4) Or (KeyCode = KEYF5) Then
        plcCalendar.Visible = False
        plcTme.Visible = False
        If cbcAdvt.Enabled Then
            cbcAdvt.Enabled = False
            ilReSet = True
        Else
            ilReSet = False
        End If
        gFunctionKeyBranch KeyCode
        If ilReSet Then
            cbcAdvt.Enabled = True
        End If
    End If
End Sub
Private Sub Form_LinkExecute(CmdStr As String, Cancel As Integer)
    sgDoneMsg = CmdStr
    igChildDone = True
    Cancel = 0
End Sub
Private Sub Form_Load()
    imLBCtrls = 1
    If Screen.Width * 15 = 640 Then
        fmAdjFactorW = 1#
        fmAdjFactorH = 1#
    Else
        fmAdjFactorW = ((lgPercentAdjW * ((Screen.Width) / (640 * 15 / Me.Width))) / 100) / Me.Width
        Me.Width = (lgPercentAdjW * ((Screen.Width) / (640 * 15 / Me.Width))) / 100
        fmAdjFactorH = ((lgPercentAdjH * ((Screen.height) / (480 * 15 / Me.height))) / 100) / Me.height
        Me.height = (lgPercentAdjH * ((Screen.height) / (480 * 15 / Me.height))) / 100
    End If
    mInit
    If imTerminate Then
        tmcTerminate.Enabled = True
        'cmcCancel.SetFocus
    End If
End Sub

Private Sub Form_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    imButtonIndex = 0
    edcToolTip.Visible = False
End Sub

Private Sub Form_Unload(Cancel As Integer)
    Dim ilRet As Integer
    Dim ilValue As Integer
    
    
    On Error Resume Next
    rst_clf.Close
    rst_adf.Close
    
    Erase smCode
    Erase lmGenerateCode
    Erase lmWorkArea
    
    Erase tmCifInfo
    Erase tmCrfDates
    Erase tmSef
    
    Erase tmMMnf
    Erase imAllowedLens
    Erase lmMatchCode
    Erase lmRsfCode
    Erase tgActiveCode
    Erase tmPurgeCode
    Erase tmHistoryCode
    Erase tmShtTitleCode
    Erase tmCopyCntrCode
    Erase lmCifChecked
    Erase lmCifDateSet
    Erase tmSetInvRotDate
    Erase lmCifCode
    Erase tmTeam

    Erase tgCopySdfExtSort
    Erase tgCopySdfExt
    Erase tgClfCopy
    Erase tgCffCopy
    
    Erase tmRegionCategory
    
    Erase tmRegionDefinition
    Erase tmSplitCategoryInfo
    
    Erase smRGComment

    ilRet = btrClose(hmCrf)
    btrDestroy hmCrf
    ilRet = btrClose(hmCnf)
    btrDestroy hmCnf
    ilRet = btrClose(hmCif)
    btrDestroy hmCif
    ilRet = btrClose(hmCsf)
    btrDestroy hmCsf
    ilRet = btrClose(hmCyf)
    btrDestroy hmCyf
    ilRet = btrClose(hmCuf)
    btrDestroy hmCuf
    ilRet = btrClose(hmCvf)
    btrDestroy hmCvf
    ilRet = btrClose(hmGnf)
    btrDestroy hmGnf
    ilRet = btrClose(hmGpf)
    btrDestroy hmGpf
    ilRet = btrClose(hmGcf)
    btrDestroy hmGcf
    ilRet = btrClose(hmGtf)
    btrDestroy hmGtf
    '5882 no longer needed
'    ilRet = btrClose(hmIef)
'    btrDestroy hmIef
    ilRet = btrClose(hmVef)
    btrDestroy hmVef
    ilRet = btrClose(hmSif)
    btrDestroy hmSif
    ilRet = btrClose(hmCHF)
    btrDestroy hmCHF
    ilRet = btrClose(hmClf)
    btrDestroy hmClf
    ilRet = btrClose(hmCxf)
    btrDestroy hmCxf
    ilRet = btrClose(hmVsf)
    btrDestroy hmVsf
    'If tgSpf.sGUseAffFeed = "Y" Then
    ilValue = Asc(tgSpf.sUsingFeatures2)  'Option Fields in Orders/Proposals
    If (((ilValue And REGIONALCOPY) = REGIONALCOPY) Or ((ilValue And SPLITCOPY) = SPLITCOPY)) Then
        ilRet = btrClose(hmRsf)
        btrDestroy hmRsf
        ilRet = btrClose(hmRaf)
        btrDestroy hmRaf
        ilRet = btrClose(hmSef)
        btrDestroy hmSef
    End If
    ilRet = btrClose(hmCpf)
    btrDestroy hmCpf
    ilRet = btrClose(hmSdf)
    btrDestroy hmSdf
    ilRet = btrClose(hmSmf)
    btrDestroy hmSmf
    ilRet = btrClose(hmTzf)
    btrDestroy hmTzf
    ilRet = btrClose(hmUrf)
    btrDestroy hmUrf
    ilRet = btrClose(hmMnf)
    btrDestroy hmMnf
    ilRet = btrClose(hmSsf)
    btrDestroy hmSsf
    ilRet = btrClose(hmCaf)
    btrDestroy hmCaf
    
    ilRet = btrClose(hmLcf)
    btrDestroy hmLcf
    ilRet = btrClose(hmGhf)
    btrDestroy hmGhf
    ilRet = btrClose(hmGsf)
    btrDestroy hmGsf
    ilRet = btrClose(hmMcf)
    btrDestroy hmMcf
    igJobShowing(COPYJOB) = False
    
    Set Copy = Nothing   'Remove data segment

End Sub

Private Sub grdCopy_EnterCell()
    mCGSetShow
End Sub

Private Sub grdCopy_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    lmCGTopRow = grdCopy.TopRow
    grdCopy.Redraw = False
End Sub

Private Sub grdCopy_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim llRow As Long
    Dim llCol As Long
    Dim ilFound As Integer
    Dim llHeight As Long

    For llRow = 0 To grdCopy.FixedRows - 1 Step 1
        llHeight = grdCopy.rowHeight(llRow)
    Next llRow
    grdCopy.ToolTipText = ""
    If Y <= llHeight Then
        Exit Sub
    End If
    ilFound = gGrid_GetRowCol(grdCopy, X, Y, llRow, llCol)
    grdCopy.ToolTipText = Trim$(grdCopy.TextMatrix(llRow, llCol))
End Sub

Private Sub grdCopy_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim ilCol As Integer
    Dim ilRow As Integer

    imCGIgnoreScroll = False
    If Y < grdCopy.rowHeight(0) Then
        grdCopy.Row = 0
        grdCopy.Col = grdCopy.MouseCol
        If (grdCopy.CellBackColor = LIGHTBLUE) Then
            mCGSortCol grdCopy.MouseCol
        End If
        grdCopy.Redraw = True
        Exit Sub
    End If
    ilCol = grdCopy.MouseCol
    ilRow = grdCopy.MouseRow
    If ilCol < grdCopy.FixedCols Then
        grdCopy.Redraw = True
        Exit Sub
    End If
    If ilRow < grdCopy.FixedRows Then
        grdCopy.Redraw = True
        Exit Sub
    End If
    
    grdCopy.Row = ilRow
    grdCopy.Col = ilCol
    grdCopy.Redraw = True
    lmCGTopRow = grdCopy.TopRow
    If Not mCGColOk() Then
        Exit Sub
    End If

    mCGEnableBox


End Sub

Private Sub grdCopy_Scroll()
    If imCGIgnoreScroll Then  'Or igGridIgnoreScroll Then
        imCGIgnoreScroll = False
        Exit Sub
    End If
    If grdCopy.Redraw = False Then
        grdCopy.Redraw = True
        If lmTopRow < grdCopy.FixedRows Then
            grdCopy.TopRow = grdCopy.FixedRows
        Else
            grdCopy.TopRow = lmTopRow
        End If
        grdCopy.Refresh
        grdCopy.Redraw = False
    End If
    If (imCGCtrlVisible) And (grdCopy.Row >= grdCopy.FixedRows) And (grdCopy.Col >= 0) And (grdCopy.Col < grdCopy.cols) Then
        mCGSetShow
        grdCopy.Redraw = True
        pbcSetFocus.SetFocus
    End If

End Sub

Private Sub grdRot_EnterCell()
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    '1/17/14: 6597
    If Not grdRot.Visible Then
        pbcClickFocus.SetFocus
    End If
End Sub

Private Sub grdRot_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    lmTopRow = grdRot.TopRow
    grdRot.Redraw = False
End Sub

Private Sub grdRot_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim llRow As Long
    Dim llCol As Long
    Dim ilFound As Integer
    Dim llHeight As Long

    For llRow = 0 To grdRot.FixedRows - 1 Step 1
        llHeight = grdRot.rowHeight(llRow)
    Next llRow
    'grdRot.ToolTipText = ""
    If Y <= llHeight Then
        grdRot.ToolTipText = ""
        imButtonIndex = 0
        edcToolTip.Visible = False
        Exit Sub
    End If
    If grdRot.MouseCol = COPYINDEX Then
        grdRot.ToolTipText = ""
        If Trim$(grdRot.TextMatrix(grdRot.MouseRow, grdRot.MouseCol)) <> "" Then
            lacToolTip.Caption = Trim$(grdRot.TextMatrix(grdRot.MouseRow, COPYTIPINDEX))
            edcToolTip.Text = Trim$(grdRot.TextMatrix(grdRot.MouseRow, COPYTIPINDEX))
            edcToolTip.Width = lacToolTip.Width
            edcToolTip.height = lacToolTip.height + 60
            edcToolTip.Move grdRot.Left + grdRot.Width - GRIDSCROLLWIDTH - edcToolTip.Width, grdRot.Top + grdRot.RowPos(grdRot.MouseRow) - edcToolTip.height - grdRot.rowHeight(grdRot.MouseRow)
            edcToolTip.ZOrder
            edcToolTip.Visible = True
            Exit Sub
        End If
    Else
        ilFound = gGrid_GetRowCol(grdRot, X, Y, llRow, llCol)
        If Not ilFound Then
            grdRot.ToolTipText = ""
        Else
            grdRot.ToolTipText = Trim$(grdRot.TextMatrix(grdRot.MouseRow, grdRot.MouseCol))
        End If
    End If
    imButtonIndex = 0
    edcToolTip.Visible = False
End Sub

Private Sub grdRot_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim ilCol As Integer
    Dim ilRow As Integer

    '1/17/14: 6597
    If Not grdRot.Visible Then
        pbcClickFocus.SetFocus
        Exit Sub
    End If
    imIgnoreScroll = False
    imButtonIndex = 0
    edcToolTip.Visible = False
    If Y < grdRot.rowHeight(0) Then
        Exit Sub
    End If
    pbcArrow.Visible = False
    ilCol = grdRot.MouseCol
    ilRow = grdRot.MouseRow
    If ilCol < grdRot.FixedCols Then
        grdRot.Redraw = True
        Exit Sub
    End If
    If ilRow < grdRot.FixedRows Then
        grdRot.Redraw = True
        Exit Sub
    End If
    
    If ilCol = SELECTIONINDEX Then
        If grdRot.TextMatrix(ilRow, CATEGORYINDEX) = "[None]" Or grdRot.TextMatrix(ilRow, CATEGORYINDEX) = "" Then
            grdRot.Redraw = True
            Exit Sub
        End If
    End If
    If grdRot.TextMatrix(ilRow, REGIONNAMEINDEX) = "" Then
        grdRot.Redraw = False
        Do
            ilRow = ilRow - 1
        Loop While grdRot.TextMatrix(ilRow, REGIONNAMEINDEX) = ""
        grdRot.Row = ilRow + 1
        If ilCol = RGVEHICLEINDEX Then
            grdRot.Col = RGVEHICLEINDEX
        Else
            grdRot.Col = REGIONNAMEINDEX
        End If
        grdRot.Redraw = True
    Else
        grdRot.Row = ilRow
        grdRot.Col = ilCol
    End If
    grdRot.Redraw = True
    lmTopRow = grdRot.TopRow
    If Not mRGColOk() Then
        pbcArrow.Move grdRot.Left - pbcArrow.Width - 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + (grdRot.rowHeight(grdRot.Row) - pbcArrow.height) / 2
        pbcArrow.Visible = True
        Exit Sub
    End If

    mRGEnableBox

End Sub

Private Sub grdRot_Scroll()
    If imIgnoreScroll Then  'Or igGridIgnoreScroll Then
        imIgnoreScroll = False
        Exit Sub
    End If
    If grdRot.Redraw = False Then
        grdRot.Redraw = True
        If lmTopRow < grdRot.FixedRows Then
            grdRot.TopRow = grdRot.FixedRows
        Else
            grdRot.TopRow = lmTopRow
        End If
        grdRot.Refresh
        grdRot.Redraw = False
    End If
    If (imRGCtrlVisible) And (grdRot.Row >= grdRot.FixedRows) And (grdRot.Col >= 0) And (grdRot.Col < grdRot.cols - 1) Then
        mCGSetShow
        mRGSetShow
        pbcSetFocus.SetFocus
    Else
        pbcClickFocus.SetFocus
        pbcArrow.Visible = False
        imFromArrow = False
    End If

End Sub

Private Sub imcInst_DragDrop(Index As Integer, Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub imcInst_DragOver(Index As Integer, Source As Control, X As Single, Y As Single, State As Integer)
    mDragOver DRAGINST, State, Index    '0=Top; 1= botton
End Sub

Private Sub imcKey_Click()
    pbcKey.Visible = Not pbcKey.Visible
End Sub

Private Sub imcKey_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    pbcKey.ZOrder
    'pbcKey.Visible = True
End Sub

Private Sub imcKey_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    'pbcKey.Visible = False
End Sub

Private Sub imcTrash_Click()
    Dim llCol As Long
    Dim llSvEnableRow As Long
    Dim llSvEnableCol As Long
    
    If grdRot.Visible Then
        llSvEnableRow = lmRGEnableRow
        llSvEnableCol = lmRGEnableCol
        mCGSetShow
        mRGSetShow
        mSetShow imBoxNo
        lmRGEnableRow = llSvEnableRow
        lmRGEnableCol = llSvEnableCol
        grdRot.Row = lmRGEnableRow
        For llCol = 0 To grdRot.cols - 1 Step 1
            grdRot.TextMatrix(lmRGEnableRow, llCol) = ""
            grdRot.Col = llCol
            If lmRGEnableRow = grdRot.FixedRows Then
                If (llCol > RGVEHICLEINDEX) And (llCol < COPYINDEX) Then
                    grdRot.CellBackColor = LIGHTYELLOW
                    If llCol = REGIONNAMEINDEX Then
                        grdRot.TextMatrix(lmRGEnableRow, llCol) = "Generic"
                    End If
                Else
                    grdRot.CellBackColor = WHITE
                End If
            Else
                grdRot.CellBackColor = WHITE
            End If
        Next llCol
        lmRGEnableRow = -1
        lmRGEnableCol = -1
        pbcClickFocus.SetFocus
    Else
        imDragIndexSrce = lbcInst.ListIndex
        imcTrash_DragDrop lbcInst, 0, 0
        mSetFLPointer
        imcTrash.Visible = False
        imcTrash.Enabled = False
    End If
End Sub

Private Sub imcTrash_DragDrop(Source As Control, X As Single, Y As Single)
    Select Case imDragSrce
        Case DRAGINV
        Case DRAGINST
            '2/7/09:  Add to handle case were DragSrceIndex is in error
            On Error Resume Next
            lbcInst.RemoveItem imDragIndexSrce
            On Error GoTo 0
            pbcLbcInst_Paint
            DoEvents
            imRotHeaderChgOnly = False
            If lbcInst.ListCount - 1 < imFLValue Then
                imFLValue = 1   'lbcInst.ListCount
            End If
            mSetFLPointer
    End Select
    mClearDrag
End Sub
Private Sub imcTrash_DragOver(Source As Control, X As Single, Y As Single, State As Integer)
    Select Case imDragSrce
        Case DRAGINV
        Case DRAGINST
            If State = vbEnter Then    'Enter drag over
                lbcInst.DragIcon = IconTraf!imcIconDwnArrow.DragIcon
                imcTrash.Picture = IconTraf!imcTrashOpened.Picture
            ElseIf State = vbLeave Then
                lbcInst.DragIcon = IconTraf!imcIconDrag.DragIcon
                imcTrash.Picture = IconTraf!imcTrashClosed.Picture
            End If
    End Select
End Sub
Private Sub lbcAvail_Click()
    If imLbcMouseDown Then
        tmcClick.Interval = 300 'Delay processing encase double click
        tmcClick.Enabled = True
        imLbcMouseDown = False
    Else
        gProcessLbcClick lbcAvail, edcDropDown, imChgMode, imLbcArrowSetting
    End If
End Sub
Private Sub lbcAvail_DblClick()
    tmcClick.Enabled = False
    imDoubleClickName = True    'Double click event is followed by a mouse up event
                                'Process the double click event in the mouse up event
                                'to avoid the mouse up event being in next form
End Sub
Private Sub lbcAvail_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub
Private Sub lbcAvail_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    imLbcMouseDown = True
End Sub
Private Sub lbcAvail_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If imDoubleClickName Then
        imLbcArrowSetting = False
        gProcessLbcClick lbcAvail, edcDropDown, imChgMode, imLbcArrowSetting
        If imTabDirection = -1 Then  'Right To Left
            pbcSTab.SetFocus
        Else
            pbcTab.SetFocus
        End If
    End If
End Sub
Private Sub lbcCntr_Click()
    gProcessLbcClick lbcCntr, edcDropDown, imChgMode, imLbcArrowSetting
End Sub
Private Sub lbcCntr_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub

Private Sub lbcGameNo_Click()
    mSetChg STIMEINDEX
End Sub

Private Sub lbcInst_Click()
    imcTrash.Visible = True
    imcTrash.Enabled = True
    pbcLbcInst_Paint
End Sub

Private Sub lbcInst_DragDrop(Source As Control, X As Single, Y As Single)
    Dim ilRet As Integer
    Dim slName As String
    Dim slNameCode As String
    Dim slCode As String
    Dim ilRes As Integer
    Dim slShtTitle As String
    Dim ilClear As Integer
    Dim ilFound As Integer
    Dim ilLoop As Integer

    If imDragDest = -1 Then
        mClearDrag
        Exit Sub
    End If
    Select Case imDragSrce
        Case DRAGINV
            'Test if product must be the same as contract
            If (smSave(1) <> "") And (imBlackoutAdfCode <= 0) And (imBlackoutAdfCode <> POOLROTATION) Then
                ilFound = False
                For ilLoop = 0 To lbcInst.ListCount - 2 Step 1
                    If lbcInv.List(imDragIndexSrce) = lbcInst.List(ilLoop) Then
                        ilFound = True
                        Exit For
                    End If
                Next ilLoop
                gFindMatch smSave(1), 0, lbcCntr
                If (gLastFound(lbcCntr) >= 0) And (Not ilFound) Then
                    slNameCode = tmCopyCntrCode(gLastFound(lbcCntr)).sKey    'lbcCntrCode.List(gLastFound(lbcCntr))
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    If tmChf.lCode <> Val(slCode) Then
                        tmChfSrchKey.lCode = Val(slCode)
                        ilRet = btrGetEqual(hmCHF, tmChf, imCHFRecLen, tmChfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                    End If
                    If tmChf.sInvGp = "A" Then  'All Spots
                        If (((imDragIndexSrce > 0) And (tgSpf.sUseCartNo <> "B")) Or ((imDragIndexSrce > 1) And (tgSpf.sUseCartNo = "B"))) Then
                            If tgSpf.sUseCartNo <> "B" Then
                                slNameCode = tmCopyNameCode(imDragIndexSrce - 1).sKey  'lbcInvCode.List(imDragIndexSrce - 1)
                            Else
                                slNameCode = tmCopyNameCode(imDragIndexSrce - 2).sKey  'lbcInvCode.List(imDragIndexSrce - 1)
                            End If
                            ilRet = gParseItem(slNameCode, 2, "\", slCode)
                            tmCifSrchKey.lCode = Val(slCode)
                            ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                            If (ilRet = BTRV_ERR_NONE) And (tmCif.lcpfCode > 0) Then
                                tmCpfSrchKey.lCode = tmCif.lcpfCode
                                ilRet = btrGetEqual(hmCpf, tmCpf, imCpfRecLen, tmCpfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                                If (ilRet = BTRV_ERR_NONE) And (Trim$(tmCpf.sName) <> "") Then
                                    If tgSpf.sUseProdSptScr = "P" Then  'Short Title
                                        slShtTitle = ""
                                        If (tmChf.lSifCode > 0) Then
                                            tmSifSrchKey0.lCode = tmChf.lSifCode
                                            ilRet = btrGetEqual(hmSif, tmSif, imSifRecLen, tmSifSrchKey0, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                                            If ilRet = BTRV_ERR_NONE Then
                                                slShtTitle = Trim$(tmSif.sName)
                                            End If
                                        End If
                                        If StrComp(Trim$(slShtTitle), Trim$(tmCpf.sName), 1) <> 0 Then
                                            ilRes = MsgBox("Short Title Names Don't Match. Copy: " & Trim$(tmCpf.sName) & " Contract: " & tmChf.sProduct, vbOKCancel + vbExclamation, "Product Conflict")
                                            If ilRes = vbCancel Then
                                                mClearDrag
                                                Exit Sub
                                            End If
                                        End If
                                    Else
                                        If StrComp(Trim$(tmChf.sProduct), Trim$(tmCpf.sName), 1) <> 0 Then
                                            ilRes = MsgBox("Product Names Don't Match. Copy: " & Trim$(tmCpf.sName) & " Contract: " & tmChf.sProduct, vbOKCancel + vbExclamation, "Product Conflict")
                                            If ilRes = vbCancel Then
                                                mClearDrag
                                                Exit Sub
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        Else
                            mClearDrag
                            Exit Sub
                        End If
                    End If
                End If
            End If
            lbcInst.AddItem lbcInv.List(imDragIndexSrce), imDragIndexDest
            lbcInst.ItemData(imDragIndexDest) = lbcInv.ItemData(imDragIndexSrce)
            imRotHeaderChgOnly = False
            'Scroll if required
            If (imDragIndexDest + 1 - lbcInst.TopIndex = imNoRowLbc) And (lbcInst.ListCount >= imNoRowLbc) Then
                lbcInst.TopIndex = lbcInst.TopIndex + 1
                DoEvents
            End If
            lbcInst.ListIndex = imDragIndexDest
            mSetFLPointer
        Case DRAGINST
            If imDragIndexSrce < imDragIndexDest Then
                lbcInst.AddItem lbcInst.List(imDragIndexSrce), imDragIndexDest
                lbcInst.ItemData(imDragIndexDest) = lbcInst.ItemData(imDragIndexSrce)
                lbcInst.RemoveItem imDragIndexSrce
                imRotHeaderChgOnly = False
            Else
                slName = lbcInst.List(imDragIndexSrce)
                ilClear = lbcInst.ItemData(imDragIndexSrce)
                lbcInst.RemoveItem imDragIndexSrce
                lbcInst.AddItem slName, imDragIndexDest
                lbcInst.ItemData(imDragIndexDest) = ilClear
                imRotHeaderChgOnly = False
            End If
            lbcInst.ListIndex = -1
    End Select
    pbcLbcInst_Paint
    mClearDrag
End Sub
Private Sub lbcInst_DragOver(Source As Control, X As Single, Y As Single, State As Integer)
    Dim ilListIndex As Integer
    Dim llRg As Long
    Dim llRet As Long
    imDragIndexDest = 0
    If imDragSrce = DRAGINV Then
        If State = vbLeave Then
            lbcInv.DragIcon = IconTraf!imcIconDrag.DragIcon
            If lbcInst.ListCount > 1 Then
                llRg = CLng(lbcInst.ListCount - 2) * &H10000 Or 0
                llRet = SendMessageByNum(lbcInst.HWnd, LB_SELITEMRANGE, False, llRg)
            End If
            Exit Sub
        End If
        ilListIndex = Y \ fgListHtArial825 + lbcInst.TopIndex
        If (ilListIndex <= lbcInst.ListCount - 1) Then
            lbcInv.DragIcon = IconTraf!imcIconInsert.DragIcon
            imDragIndexDest = ilListIndex
            imDragDest = DRAGINST
            If ilListIndex <> lbcInst.ListIndex Then
                If lbcInst.ListCount > 1 Then
                    llRg = CLng(lbcInst.ListCount - 2) * &H10000 Or 0
                    llRet = SendMessageByNum(lbcInst.HWnd, LB_SELITEMRANGE, False, llRg)
                End If
            End If
            If ilListIndex <> lbcInst.ListCount - 2 Then
                lbcInst.ListIndex = ilListIndex
            End If
            DoEvents
        Else
            lbcInv.DragIcon = IconTraf!imcIconDrag.DragIcon
        'ElseIf ilListIndex >= lbcInst.ListCount Then
        '    lbcInv.DragIcon = IconTraf!imcIconInsert.DragIcon
        '    imDragIndexDest = lbcInst.ListCount
        '    imDragDest = DRAGINST
        '    If lbcInst.ListCount > 0 Then
        '        llRg = CLng(lbcInst.ListCount - 1) * &H10000 Or 0
        '        llRet = SendMessageByNum(lbcInst.Hwnd, LB_SELITEMRANGE, False, llRg)
        '    End If
        End If
    ElseIf imDragSrce = DRAGINST Then
        If State = vbLeave Then
            lbcInst.DragIcon = IconTraf!imcIconDrag.DragIcon
            If lbcInst.ListCount > 1 Then
                llRg = CLng(lbcInst.ListCount - 2) * &H10000 Or 0
                llRet = SendMessageByNum(lbcInst.HWnd, LB_SELITEMRANGE, False, llRg)
            End If
            lbcInst.ListIndex = imDragIndexSrce
            DoEvents
            Exit Sub
        End If
        ilListIndex = Y \ fgListHtArial825 + lbcInst.TopIndex
        If (ilListIndex <= lbcInst.ListCount - 1) And (ilListIndex <> imDragIndexSrce) Then
            lbcInst.DragIcon = IconTraf!imcIconMove.DragIcon
            imDragIndexDest = ilListIndex
            imDragDest = DRAGINST
            If ilListIndex <> lbcInst.ListIndex Then
                If lbcInst.ListCount > 1 Then
                    llRg = CLng(lbcInst.ListCount - 2) * &H10000 Or 0
                    llRet = SendMessageByNum(lbcInst.HWnd, LB_SELITEMRANGE, False, llRg)
                End If
            End If
            If ilListIndex <> lbcInst.ListCount - 2 Then
                lbcInst.ListIndex = ilListIndex
            End If
            lbcInst.ListIndex = imDragIndexSrce
            DoEvents
        End If
    End If
End Sub
Private Sub lbcInst_GotFocus()
    'lbcRot.Visible = False
    imcTrash.Visible = False
    imcTrash.Enabled = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mSetShow imBoxNo
    imBoxNo = -1
    gCtrlGotFocus ActiveControl
End Sub

Private Sub lbcInst_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If imUpdateAllowed Then
        fmDragX = X
        fmDragY = Y
        imDragButton = Button
        imDragType = 0
        imDragShift = Shift
        imDragSrce = DRAGINST
        imDragIndexDest = 0
        tmcDrag.Enabled = True  'Start timer to see if drag or click
    End If
End Sub
Private Sub lbcInst_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If tmcDrag.Enabled Then
        imDragType = -1
        tmcDrag.Enabled = False
    End If
    
End Sub

Private Sub lbcInst_Scroll()
    'Determine location of pointers
    mSetFLPointer
    pbcLbcInst_Paint
End Sub

Private Sub lbcInv_Click()
    Dim slStr As String

    pbcLbcInv_Paint
    'If lbcInv.ListIndex = 0 Then
    '    cmcInv.Caption = "New"
    '    cmcInv.Enabled = True
    'ElseIf lbcInv.ListIndex > 0 Then
    '    cmcInv.Caption = "Change"
    '    cmcInv.Enabled = True
    If lbcInv.ListIndex >= 0 Then
        slStr = lbcInv.List(lbcInv.ListIndex)
        If InStr(1, slStr, "[New", vbTextCompare) > 0 Then
            cmcInv.Caption = "New"
        Else
            cmcInv.Caption = "Change"
        End If
        cmcInv.Enabled = True
    Else
        cmcInv.Enabled = False
    End If
End Sub

Private Sub lbcInv_DblClick()
    If imUpdateAllowed Then
        imDoubleClick = True    'Double click event is followed by a mouse up event
                            'Process the double click event in the mouse up event
                            'to avoid the mouse up event being in next form
    End If
End Sub
Private Sub lbcInv_GotFocus()
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    tmcClick.Enabled = False
    mSetShow imBoxNo
    imBoxNo = -1
    gCtrlGotFocus ActiveControl
End Sub

Private Sub lbcInv_LostFocus()
    imcTrash.Enabled = False
    imcTrash.Visible = False
End Sub

Private Sub lbcInv_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If Button = 2 Then  'Right Mouse
        imButton = Button
        imButtonIndex = Y \ fgListHtArial825 + lbcInv.TopIndex
        imIgnoreRightMove = True
        If imInvStatus = 0 Then
            If tgSpf.sUseCartNo <> "B" Then
                If imButtonIndex > 0 Then
                    mShowInvInfo
                End If
            Else
                If imButtonIndex > 1 Then
                    mShowInvInfo
                End If
            End If
        Else
            If imButtonIndex >= 0 Then
                mShowInvInfo
            End If
        End If
        imIgnoreRightMove = False
    End If
    If imUpdateAllowed And (imInvStatus = 0) Then
        fmDragX = X
        fmDragY = Y
        imDragButton = Button
        imDragType = 0
        imDragShift = Shift
        imDragSrce = DRAGINV
        imDragIndexDest = -1
        tmcDrag.Enabled = True  'Start timer to see if drag or click
    End If
End Sub
Private Sub lbcInv_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    imButtonIndex = 0
    edcToolTip.Visible = False
    If imIgnoreRightMove Then
        Exit Sub
    End If
    If Button = 2 Then
        If (Y < 0) Or (Y > lbcInv.height) Then
            imButtonIndex = 0
            plcRotInfo.Visible = False
            edcToolTip.Visible = False
            Exit Sub
        End If
        If (X < 0) Or (X > lbcInv.Width) Then
            imButtonIndex = 0
            plcRotInfo.Visible = False
            edcToolTip.Visible = False
            Exit Sub
        End If
        If imButtonIndex <> (Y \ fgListHtArial825) + lbcInv.TopIndex Then
            imIgnoreRightMove = True
            imButtonIndex = Y \ fgListHtArial825 + lbcInv.TopIndex
'            If imButtonIndex > 0 Then
'                mShowInvInfo
'            Else
'                plcRotInfo.Visible = False
'            End If
            If imInvStatus = 0 Then
                If tgSpf.sUseCartNo <> "B" Then
                    If imButtonIndex > 0 Then
                        mShowInvInfo
                    Else
                        plcRotInfo.Visible = False
                        edcToolTip.Visible = False
                    End If
                Else
                    If imButtonIndex > 1 Then
                        mShowInvInfo
                    Else
                        plcRotInfo.Visible = False
                        edcToolTip.Visible = False
                    End If
                End If
            Else
                If imButtonIndex >= 0 Then
                    mShowInvInfo
                Else
                    plcRotInfo.Visible = False
                    edcToolTip.Visible = False
                End If
            End If
            imIgnoreRightMove = False
        End If
    End If
End Sub
Private Sub lbcInv_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim slNameCode As String
    Dim ilRet As Integer
    Dim slCode As String
    Dim slStr As String
    Dim slSvUseCartNo As String
    Dim ilLoop As Integer
    Dim sSelectedISCI As String
    Dim sActiveISCI As String
    
    If Button = 2 Then
        imButtonIndex = -1  'indicate a mouse up
        plcRotInfo.Visible = False
        edcToolTip.Visible = False
    End If
    If tmcDrag.Enabled Then
        imDragType = -1
        tmcDrag.Enabled = False
    End If
    If imDoubleClick Then
        imDoubleClick = False
        If (imAdvtIndex < 0) Then
            Exit Sub
        End If
        If (lbcInv.ListIndex < 0) Or (lbcInv.ListIndex > lbcInv.ListCount - 1) Then
            Exit Sub
        End If
        'Unload IconTraf
        'If Not gWinRoom(igNoExeWinRes(COPYINVEXE)) Then
        '    Exit Sub
        'End If
        igCopyInvCallSource = COPYJOB
        
        If imInvStatus = 0 Then
        'If rbcShow(0).Value = True Then
            If imInvStatus = 0 And ((lbcInv.ListIndex = 0) Or ((lbcInv.ListIndex = 1) And (tgSpf.sUseCartNo = "B"))) Then 'TTP 10728 JJB 2023-06-07
           'If (lbcInv.ListIndex = 0) Or ((lbcInv.ListIndex = 1) And (tgSpf.sUseCartNo = "B")) Then
                lgCopyInvCifCode = 0    'New mode
            Else
                'TTP 10728 JJB 2023-06-07
                If tgSpf.sUseCartNo = "B" Or tgSpf.sUseCartNo = "Y" Then  'TTP 10798 JJB 2023-08-15
                    ilRet = gParseItem(lbcInv.List(lbcInv.ListIndex), 3, "~", sSelectedISCI)
                Else
                    ilRet = gParseItem(lbcInv.List(lbcInv.ListIndex), 1, "~", sSelectedISCI)
                End If
                
                For ilLoop = 0 To UBound(tgActiveCode) - 1
                   If tgSpf.sUseCartNo = "B" Or tgSpf.sUseCartNo = "Y" Then  'TTP 10798 JJB 2023-08-15
                        ilRet = gParseItem(tmCopyNameCode(ilLoop).sKey, 3, "~", sActiveISCI)
                    Else
                        ilRet = gParseItem(tmCopyNameCode(ilLoop).sKey, 1, "~", sActiveISCI)
                    End If
                    
                    If Left(sActiveISCI, Len(sSelectedISCI)) = sSelectedISCI Then
                        slNameCode = tmCopyNameCode(ilLoop).sKey
                        Exit For
                    End If
                Next ilLoop
                
'                If tgSpf.sUseCartNo <> "B" Then
'                    slNameCode = tmCopyNameCode(lbcInv.ListIndex - 1).sKey 'lbcInvCode.List(lbcInv.ListIndex - 1)
'                Else
'                    slNameCode = tmCopyNameCode(lbcInv.ListIndex - 2).sKey 'lbcInvCode.List(lbcInv.ListIndex - 1)
'                End If
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                lgCopyInvCifCode = Val(slCode)   'Change mode
            End If
        Else
            If tgSpf.sUseCartNo = "B" Or tgSpf.sUseCartNo = "Y" Then  'TTP 10798 JJB 2023-08-15
                ilRet = gParseItem(lbcInv.List(lbcInv.ListIndex), 2, "~", sSelectedISCI)
            Else
                ilRet = gParseItem(lbcInv.List(lbcInv.ListIndex), 1, "~", sSelectedISCI)
            End If
            
           For ilLoop = 0 To UBound(tgActiveCode) - 1
            'For ilLoop = 0 To UBound(tmCopyNameCode) - 1
                If tgSpf.sUseCartNo = "B" Or tgSpf.sUseCartNo = "Y" Then  'TTP 10798 JJB 2023-08-15
                    ilRet = gParseItem(tmCopyNameCode(ilLoop).sKey, 2, "~", sActiveISCI)
                Else
                    ilRet = gParseItem(tmCopyNameCode(ilLoop).sKey, 1, "~", sActiveISCI)
                End If
                
                If Left(sActiveISCI, Len(sSelectedISCI)) = sSelectedISCI Then
                    slNameCode = tmCopyNameCode(ilLoop).sKey
                    Exit For
                End If
            Next ilLoop
            
            'slNameCode = tmCopyNameCode(lbcInv.ListIndex).sKey 'lbcInvCode.List(lbcInv.ListIndex)
            
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            lgCopyInvCifCode = Val(slCode)   'Change mode
            
            ''''''''''''''''''''''''''''' end 'TTP 10728 JJB 2023-06-07
        End If
        If (cbcType.ListIndex = 0) Or ((cbcType.ListIndex <= 2) And (tgSpf.sUsingBBs = "Y")) Then
            slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            igCopyInvAdfCode = Val(slCode)   '
            igCopyInvEtfCode = 0
            igCopyInvEnfCode = 0
        Else
            igCopyInvAdfCode = 0
        End If
        If igCopyInvAdfCode <= 0 Then
            Exit Sub
        End If
        'If Blackout selected, then pass the blackout advertiser code
        If imBlackoutAdfCode > 0 Then
            igCopyInvAdfCode = imBlackoutAdfCode
        End If
        sgUseCartNo = tgSpf.sUseCartNo
        If (tgSpf.sUseCartNo = "B") And (lgCopyInvCifCode = 0) Then
            If lbcInv.ListIndex = 1 Then
                sgUseCartNo = "N"
            Else
                sgUseCartNo = "Y"
            End If
        Else
            If (tgSpf.sUseCartNo <> "N") And (lgCopyInvCifCode > 0) Then
                tmCifSrchKey.lCode = lgCopyInvCifCode
                ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                If (ilRet = BTRV_ERR_NONE) And (tmCif.iMcfCode = 0) Then
                    sgUseCartNo = "N"
                End If
            End If
        End If
        If imTypeIndex <= 0 Then
            sgCopyForBBs = "N"
        Else
            sgCopyForBBs = "Y"
        End If
        If imSave(9) < 0 Then
            igCopyInvRotLen = -1
        Else
            igCopyInvRotLen = lbcLen.List(imSave(9))
        End If
        ''Screen.MousePointer = vbHourGlass  'Wait
        'igChildDone = False 'edcLinkDestDoneMsg.Text = ""
        'edcLinkSrceDoneMsg.Text = ""
        'If (Not igStdAloneMode) And (imShowHelpMsg) Then
        '    If igTestSystem Then
        '        slStr = "Copy^Test\" & sgUserName & "\" & Trim$(Str$(igCopyInvCallSource)) & "\" & Trim$(Str$(lgCopyInvCifCode)) & "\" & Trim$(Str$(igCopyInvAdfCode)) & "\" & Trim$(Str$(igCopyInvEtfCode)) & "\" & Trim$(Str$(igCopyInvEnfCode)) & "\" & Trim$(Str$(imInvStatus))
        '    Else
        '        slStr = "Copy^Prod\" & sgUserName & "\" & Trim$(Str$(igCopyInvCallSource)) & "\" & Trim$(Str$(lgCopyInvCifCode)) & "\" & Trim$(Str$(igCopyInvAdfCode)) & "\" & Trim$(Str$(igCopyInvEtfCode)) & "\" & Trim$(Str$(igCopyInvEnfCode)) & "\" & Trim$(Str$(imInvStatus))
        '    End If
        'Else
            If igTestSystem Then
                slStr = "Copy^Test^NOHELP\" & sgUserName & "\" & Trim$(str$(igCopyInvCallSource)) & "\" & Trim$(str$(lgCopyInvCifCode)) & "\" & Trim$(str$(igCopyInvAdfCode)) & "\" & Trim$(str$(igCopyInvEtfCode)) & "\" & Trim$(str$(igCopyInvEnfCode)) & "\" & Trim$(str$(imInvStatus))
            Else
                slStr = "Copy^Prod^NOHELP\" & sgUserName & "\" & Trim$(str$(igCopyInvCallSource)) & "\" & Trim$(str$(lgCopyInvCifCode)) & "\" & Trim$(str$(igCopyInvAdfCode)) & "\" & Trim$(str$(igCopyInvEtfCode)) & "\" & Trim$(str$(igCopyInvEnfCode)) & "\" & Trim$(str$(imInvStatus))
            End If
        'End If
        'lgShellRet = Shell(sgExePath & "CopyInv.Exe " & slStr, 1)
        'Copy.Enabled = False
        ''Screen.MousePointer = vbDefault  'Wait
        'Do While Not igChildDone
        '    DoEvents
        'Loop
        sgCommandStr = slStr
        slSvUseCartNo = tgSpf.sUseCartNo
        tgSpf.sUseCartNo = sgUseCartNo
        CopyInv.Show vbModal
        tgSpf.sUseCartNo = slSvUseCartNo
        slStr = sgDoneMsg
        'Copy.Enabled = True
        'edcLinkSrceDoneMsg.Text = "Ok"
        'For ilLoop = 0 To 10
        '    DoEvents
        'Next ilLoop
        lbcActive.Clear
        smActiveCodeTag = ""
        lbcPurge.Clear
        smPurgeCodeTag = ""
        lbcHistory.Clear
        smHistoryCodeTag = ""
        mInvPop
        lbcInst.ListIndex = -1
        pbcLbcInst_Paint
        
        bmInvStatusChange = True
        bmInvStatusChange = False
        pbcInvStatus_Paint
        mResetInvPop
        
        mChangeFilter_Main
    Else
    End If
End Sub

Private Sub lbcInv_Scroll()
    pbcLbcInv_Paint
End Sub

Private Sub lbcLen_Click()
    gProcessLbcClick lbcLen, edcDropDown, imChgMode, imLbcArrowSetting
End Sub
Private Sub lbcLen_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub

Private Sub lbcMGCopyAssign_Click()
    gProcessLbcClick lbcMGCopyAssign, edcDropDown, imChgMode, imLbcArrowSetting
End Sub

Private Sub lbcMGCopyAssign_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub

Private Sub lbcRGAdvt_Click()
    gProcessLbcClick lbcRGAdvt, edcRGDropdown, imChgMode, imLbcArrowSetting
End Sub

Private Sub lbcRGAdvt_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub

Private Sub lbcRGCategory_Click()
    gProcessLbcClick lbcRGCategory, edcRGDropdown, imChgMode, imLbcArrowSetting
End Sub

Private Sub lbcRGCategory_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub

Private Sub lbcRGRegion_Click()
    gProcessLbcClick lbcRGRegion, edcRGDropdown, imChgMode, imLbcArrowSetting
End Sub

Private Sub lbcRGRegion_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub

Private Sub lbcRGSelection_Click(Index As Integer)
    If imEdcChgMode = True Then
        Exit Sub
    End If
    If lbcRGSelection(imRGSelection).SelCount <= 1 Then
        imLbcArrowSetting = True
        imChgMode = False
        gProcessLbcClick lbcRGSelection(imRGSelection), edcRGDropdown, imChgMode, imLbcArrowSetting
        If lbcRGSelection(imRGSelection).SelCount <= 0 Then
            edcRGDropdown.Text = ""
        End If
    Else
        edcRGDropdown.Text = "Multi-Select"
    End If
End Sub

Private Sub lbcRGVehicle_Click()
    If imEdcChgMode = True Then
        Exit Sub
    End If
    If lbcRGVehicle.SelCount <= 1 Then
        imLbcArrowSetting = True
        imChgMode = False
        gProcessLbcClick lbcRGVehicle, edcRGDropdown, imChgMode, imLbcArrowSetting
        If lbcRGVehicle.SelCount <= 0 Then
            edcRGDropdown.Text = ""
        End If
    Else
        edcRGDropdown.Text = "Multi-Select"
    End If
End Sub

Private Sub lbcRot_Click()
    Dim ilRet As Integer
    Dim llRg As Long
    Dim llRet As Long
    If imInAllSaveRec = True Then
        Exit Sub
    End If
    If lbcInst.ListCount > 1 Then
        llRg = CLng(lbcInst.ListCount - 2) * &H10000 Or 0
        llRet = SendMessageByNum(lbcInst.HWnd, LB_SELITEMRANGE, False, llRg)
    End If
    If lbcInv.ListCount > 0 Then
        llRg = CLng(lbcInv.ListCount - 1) * &H10000 Or 0
        llRet = SendMessageByNum(lbcInv.HWnd, LB_SELITEMRANGE, False, llRg)
    End If
    If lbcRot.ListIndex > 0 Then
        imRotIndex = lbcRot.ListIndex
        ilRet = mReadRec(imRotIndex, False, SETFORREADONLY)
        If Not imLbcArrowSetting Then
            'pbcSTab.SetFocus
            'lbcRot.Visible = False
        End If
    Else
        imRotIndex = 0
        mClearCtrlFields
        pbcRot.Cls
        mPaintRot
        '3/1/06: Reload inventory if New selected
        mInvPop
        If Not imLbcArrowSetting Then
            'pbcSTab.SetFocus
            'lbcRot.Visible = False
        End If
    End If
    pbcLbcRot_Paint
End Sub
Private Sub lbcRot_DblClick()
    'lbcRot_Change
    imBoxNo = -1
    pbcSTab.SetFocus
End Sub
Private Sub lbcRot_GotFocus()
    tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
    If (lbcRot.ListCount <= 0) Then
        If cbcAdvt.Enabled Then
            cbcAdvt.SetFocus
        Else
            cmcCancel.SetFocus
        End If
    End If
    If (lbcRot.ListCount > 1) Then
        If lbcRot.ListIndex < 0 Then
            lbcRot.ListIndex = 1
        End If
    Else
        If lbcRot.ListCount = 1 Then
            lbcRot.ListIndex = 0
        Else
            pbcClickFocus.SetFocus
        End If
    End If
    gCtrlGotFocus ActiveControl
End Sub
Private Sub lbcRot_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    imButton = Button
    If Button = 2 Then  'Right Mouse
        imButtonIndex = Y \ fgListHtArial825 + lbcRot.TopIndex
        imIgnoreRightMove = True
        If imButtonIndex > 0 Then
            mShowRotInfo
        End If
        imIgnoreRightMove = False
    End If
End Sub
Private Sub lbcRot_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If imIgnoreRightMove Then
        Exit Sub
    End If
    If Button = 2 Then
        If (Y < 0) Or (Y > lbcRot.height) Then
            imButtonIndex = 0
            plcRotInfo.Visible = False
            edcToolTip.Visible = False
            Exit Sub
        End If
        If (X < 0) Or (X > lbcRot.Width) Then
            imButtonIndex = 0
            plcRotInfo.Visible = False
            edcToolTip.Visible = False
            Exit Sub
        End If
        If imButtonIndex <> (Y \ fgListHtArial825) + lbcRot.TopIndex Then
            imIgnoreRightMove = True
            imButtonIndex = Y \ fgListHtArial825 + lbcRot.TopIndex
            If imButtonIndex > 0 Then
                mShowRotInfo
            Else
                plcRotInfo.Visible = False
                edcToolTip.Visible = False
            End If
            imIgnoreRightMove = False
        End If
    ElseIf Button = 0 Then
        If (Y < 0) Or (Y > lbcRot.height) Then
            imButtonIndex = 0
            plcRotInfo.Visible = False
            edcToolTip.Visible = False
            Exit Sub
        End If
        If (X < 0) Or (X > lbcRot.Width) Then
            imButtonIndex = 0
            plcRotInfo.Visible = False
            edcToolTip.Visible = False
            Exit Sub
        End If
        'If (X < tmCtrls(VEHICLEINDEX).fBoxX) Or (X > tmCtrls(VEHICLEINDEX).fBoxX + tmCtrls(VEHICLEINDEX).fBoxW) Then
        '    imButtonIndex = 0
        '    edcToolTip.Visible = False
        '    Exit Sub
        'End If
        'If imButtonIndex <> (Y \ fgListHtArial825) + lbcRot.TopIndex Then
        '    imIgnoreRightMove = True
        '    imButtonIndex = Y \ fgListHtArial825 + lbcRot.TopIndex
        '    If imButtonIndex > 0 Then
        '        mShowToolTip X, Y
        '    Else
        '        edcToolTip.Visible = False
        '    End If
        '    imIgnoreRightMove = False
        'End If
    End If
End Sub
Private Sub lbcRot_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If Button = 2 Then
        imButtonIndex = -1
        plcRotInfo.Visible = False
        edcToolTip.Visible = False
    End If
End Sub

Private Sub lbcRot_Scroll()
    pbcLbcRot_Paint
End Sub

Private Sub lbcShtTitle_Click()
    If imLbcMouseDown Then
        tmcClick.Interval = 300 'Delay processing encase double click
        tmcClick.Enabled = True
        imLbcMouseDown = False
    Else
        gProcessLbcClick lbcShtTitle, edcDropDown, imChgMode, imLbcArrowSetting
    End If
End Sub
Private Sub lbcShtTitle_DblClick()
    tmcClick.Enabled = False
    imDoubleClickName = True    'Double click event is followed by a mouse up event
                                'Process the double click event in the mouse up event
                                'to avoid the mouse up event being in next form
End Sub
Private Sub lbcShtTitle_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub
Private Sub lbcShtTitle_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    imLbcMouseDown = True
End Sub
Private Sub lbcShtTitle_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If imDoubleClickName Then
        imLbcArrowSetting = False
        gProcessLbcClick lbcShtTitle, edcDropDown, imChgMode, imLbcArrowSetting
        If imTabDirection = -1 Then  'Right To Left
            pbcSTab.SetFocus
        Else
            pbcTab.SetFocus
        End If
    End If
End Sub

Private Sub lbcTeam_Click()
    mSetChg STIMEINDEX
End Sub

Private Sub lbcType_Click()
    gProcessLbcClick lbcType, edcDropDown, imChgMode, imLbcArrowSetting
End Sub
Private Sub lbcType_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub
Private Sub lbcVehicle_Click()
    Dim ilLoop As Integer
    Dim ilCount As Integer

    'gProcessLbcClick lbcVehicle, edcDropDown, imChgMode, imLbcArrowSetting
    For ilLoop = 0 To lbcVehicle.ListCount - 1 Step 1
        If lbcVehicle.Selected(ilLoop) Then
            ilCount = ilCount + 1
        End If
    Next ilLoop
    If ilCount <= 1 Then
        gProcessLbcClick lbcVehicle, edcDropDown, imChgMode, True  'imLbcArrowSetting
    Else
        'ilIgnoreSetting = True
        edcDropDown.Text = smSeveral
    End If
End Sub
Private Sub lbcVehicle_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub
Private Sub lbcZones_Click()
    gProcessLbcClick lbcZones, edcDropDown, imChgMode, imLbcArrowSetting
End Sub
Private Sub lbcZones_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mAddRegion                      *
'*                                                     *
'*             Created:5/13/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Add Regions to zone list box   *
'*                                                     *
'*******************************************************
Private Sub mAddRegion()
    Dim ilLoop As Integer
    Dim slNameCode As String
    Dim slName As String
    Dim slCode As String
    Dim ilRet As Integer
    Dim blRegionAdded As Boolean

    lbcZones.Width = 1155
    'Don't include regions if selected Live Copy
    If (imSave(12) = 0) Or (imSave(12) = 2) Then
        Exit Sub
    End If
    blRegionAdded = False
    lbcRGRegion.Clear
    For ilLoop = LBound(tmRegionCode) To UBound(tmRegionCode) - 1 Step 1
        slNameCode = tmRegionCode(ilLoop).sKey    'lbcVehicleCode.List(ilLoop)
        ilRet = gParseItem(slNameCode, 1, "\", slName)
        ilRet = gParseItem(slNameCode, 2, "\", slCode)
        '1/21/09: Always bypass Dormant, add the name if required in mMoveRecToCtrl
        'If (imRotIndex <= 0) Then  'Bypass Dormant
            If right$(Trim$(slNameCode), 1) = "A" Then
                lbcZones.AddItem slName
                lbcZones.Width = pbcRot.Width - tmCtrls(ZONEINDEX).fBoxX - cmcRot.Width '6030
                If ((Asc(tgSpf.sUsingFeatures2) And SPLITCOPY) = SPLITCOPY) Then
                    If (imRotIndex <= 0) Then
                        blRegionAdded = True
                        lbcRGRegion.AddItem slName
                        lbcRGRegion.ItemData(lbcRGRegion.NewIndex) = Val(slCode)
                    End If
                End If
            End If
        'Else
        '    lbcZones.AddItem slName
        '    lbcZones.Width = pbcRot.Width - tmCtrls(ZONEINDEX).fBoxX - cmcRot.Width
        'End If
    Next ilLoop
    If ((Asc(tgSpf.sUsingFeatures2) And SPLITCOPY) = SPLITCOPY) Then
        'If (blRegionAdded) And (imRotIndex <= 0) Then
        If (imRotIndex <= 0) Then
            '11/8/14: Removed special password
            'If (Trim$(tgUrf(0).sName) = sgCPName) Or (Trim$(tgUrf(0).sName) = sgSUName) Or ((Len(Trim$(sgSpecialPassword)) = 4) And (Val(sgSpecialPassword) >= 1) And (Val(sgSpecialPassword) < 10000)) Or bgAllowCopyGrid Then
                lbcZones.AddItem "[Grid]", 0
            'End If
            lbcRGRegion.AddItem "[Model]", 0
            lbcRGRegion.ItemData(lbcRGRegion.NewIndex) = 0
            lbcRGRegion.AddItem "[Generic]", 0
            lbcRGRegion.ItemData(lbcRGRegion.NewIndex) = 0
        End If
    End If
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mAddVehToLbc                    *
'*                                                     *
'*             Created:5/13/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Add vehicle to list box        *
'*                                                     *
'*******************************************************
Private Sub mAddVehToLbc(ilVefCode As Integer, slLnSort As String)
'
''   slLnSort(I)-  0= Normal; 1= Hidden Line; 2=Airing; 3= MG
'   slLnSort(I)-  0= Package; 1= Conventional/Sports; 2= Hidden Line; 4=Airing; 3= MG
'
    Dim slStr As String
    Dim ilVef As Integer
    Dim ilVpf As Integer
    Dim ilVeh As Integer
    Dim ilMnf As Integer
    Dim slVehSort As String
    Dim slGpSort As String
    Dim ilRet As Integer
    Dim slName As String
    Dim slNameCode As String
    Dim slFormat As String
    Dim slCode As String
    Dim slMedium As String
    Dim ilFound As Integer
    Dim ilSortVehbyGroup As Integer 'True=Sort vehicle by groups; False=Sort by name only
    ilSortVehbyGroup = False
    
    If tmVef.iCode <> ilVefCode Then
        'tmVefSrchKey.iCode = tmChf.lVefCode
        'ilRet = btrGetEqual(hmVef, tmVef, imVefRecLen, tmVefSrchKey, INDEXKEY0, BTRV_LOCK_NONE)
        'For ilVef = LBound(tgMVef) To UBound(tgMVef) - 1 Step 1
        '    If tgMVef(ilVef).iCode = ilVefCode Then
            ilVef = gBinarySearchVef(ilVefCode)
            If ilVef <> -1 Then
                tmVef = tgMVef(ilVef)
        '        Exit For
            End If
            slMedium = ""
            ilVpf = gBinarySearchVpf(tmVef.iCode)
            If ilVpf <> -1 Then
                slMedium = tgVpf(ilVpf).sGMedium
            End If
        'Next ilVef
    End If
    If ilSortVehbyGroup Then
        slVehSort = Trim$(str$(tmVef.iSort))
        tmMnfSrchKey.iCode = tmVef.iOwnerMnfCode
        If tmVef.iOwnerMnfCode > 0 Then
            'If tmMnf.iCode <> tmMnfSrchKey.iCode Then
            '    ilRet = btrGetEqual(hmMnf, tmMnf, imMnfRecLen, tmMnfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            '    If ilRet <> BTRV_ERR_NONE Then
            '        tmMnf.iGroupNo = 999
            '    End If
            'End If
            tmMnf.iGroupNo = 999
            For ilMnf = LBound(tmMMnf) To UBound(tmMMnf) - 1 Step 1
                If tmVef.iOwnerMnfCode = tmMMnf(ilMnf).iCode Then
                    tmMnf = tmMMnf(ilMnf)
                    Exit For
                End If
            Next ilMnf
        Else
            tmMnf.iGroupNo = 999
        End If
        slGpSort = Trim$(str$(tmMnf.iGroupNo))
        Do While Len(slGpSort) < 3
            slGpSort = "0" & slGpSort
        Loop
        Do While Len(slVehSort) < 3
            slVehSort = "0" & slVehSort
        Loop
    Else
        slGpSort = "000"
        slVehSort = "000"
    End If
    slFormat = ""
    If tmVef.iMnfVehGp4Fmt > 0 Then
        For ilMnf = LBound(tmMMnf) To UBound(tmMMnf) - 1 Step 1
            If tmVef.iMnfVehGp4Fmt = tmMMnf(ilMnf).iCode Then
                slFormat = tmMMnf(ilMnf).sName
                Exit For
            End If
        Next ilMnf
    End If
    slName = tmVef.sName 'trim cause xxx and xxx y to sort in wrong order Trim$(tlVef.sName)
    slName = slLnSort & slGpSort & "|" & slVehSort & "|" & slName & "|" & slFormat '& "\" & Trim$(Str$(tgMVef(ilLoop).iCode))
    slStr = slName & "\" & Trim$(str$(tmVef.iCode))
    ilFound = False
    For ilVeh = 0 To UBound(tgCVehicle) - 1 Step 1 'lbcVehicleCode.ListCount - 1 Step 1
        'If StrComp(slStr, Trim$(tgCVehicle(ilVeh).sKey), 1) = 0 Then
        slNameCode = tgCVehicle(ilVeh).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
        ilRet = gParseItem(slNameCode, 2, "\", slCode)
        If Val(slCode) = tmVef.iCode Then
            If slLnSort <> "3" Then
                If StrComp(Left$(slNameCode, 1), slLnSort, 1) = 0 Then
                    ilFound = True
                    Exit For
                End If
            Else
                If StrComp(Left$(slNameCode, 1), slLnSort, 1) = 0 Then
                    ilFound = True
                    Exit For
                End If
            End If
        End If
    Next ilVeh
    
    
'    If slMedium = "P" Then 'Podcast vehicle
'        If ((Asc(tgSaf(0).sFeatures8) And PODADSERVER) = PODADSERVER) Then
'            If gExistLtf(tmVef.iCode) = False Then
'                ilFound = True 'Hide this Vehicle: set ilFound to true to prevent this vehicle from being Added to list.
'            End If
'        End If
'    End If
        
'    '1/22/21 - exclude CPM vehicles from vehicle selection
'    If Not ilFound And slMedium <> "M" Then
    If Not ilFound Then
        'lbcVehicleCode.AddItem slStr
        gAddItemToSortCode slStr, tgCVehicle(), True
    End If
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mAdvtPop                        *
'*                                                     *
'*             Created:7/19/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Populate Advertiser list box   *
'*                      if requireds                   *
'*                                                     *
'*******************************************************
Private Sub mAdvtPop()
'******************************************************************************************
'* Note: VBC id'd the following unreferenced items and handled them as described:         *
'*                                                                                        *
'* Local Variables (Removed)                                                              *
'*  ilLoop                        slNameCode                    slCode                    *
'*                                                                                        *
'******************************************************************************************

'
'   mAdvtPop
'   Where:
'
    Dim ilRet As Integer
    Dim slName As String
    Dim ilIndex As Integer

    ilIndex = cbcAdvt.ListIndex
    If ilIndex >= 0 Then
        slName = cbcAdvt.List(ilIndex)
    End If
    'Repopulate if required- if sales source changed by another user while in this screen
    'ilRet = gPopAdvtBox(Copy, cbcAdvt, Traffic!lbcAdvertiser)
    ilRet = gPopAdvtBox(Copy, cbcAdvt, tgCopyAdvertiser(), sgCopyAdvertiserTag)
    If ilRet <> CP_MSG_NOPOPREQ Then
        On Error GoTo mAdvtPopErr
        gCPErrorMsg ilRet, "mAdvtPop (gPopAdvtBox)", Copy
        On Error GoTo 0
'        cbcAdvt.AddItem "[New]", 0  'Force as first item on list
        If ilIndex >= 0 Then
            gFindMatch slName, 0, cbcAdvt
            If gLastFound(cbcAdvt) >= 0 Then
                cbcAdvt.ListIndex = gLastFound(cbcAdvt)
            Else
                cbcAdvt.ListIndex = -1
            End If
        Else
            cbcAdvt.ListIndex = ilIndex
        End If
        'cbcBlackout.Clear
        'For ilLoop = 0 To cbcAdvt.ListCount - 1 Step 1
        '    cbcBlackout.AddItem cbcAdvt.List(ilLoop)
        '    slNameCode = tgCopyAdvertiser(ilLoop).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
        '    ilRet = gParseItem(slNameCode, 2, "\", slCode)
        '    cbcBlackout.ItemData(cbcBlackout.NewIndex) = Val(slCode)   '
        'Next ilLoop
        'cbcBlackout.AddItem "[None]", 0
        'cbcBlackout.ItemData(cbcBlackout.NewIndex) = 0
    End If
    Exit Sub
mAdvtPopErr:
    On Error GoTo 0
    imTerminate = True
    Exit Sub
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mAirVehPop                      *
'*                                                     *
'*             Created:5/13/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Populate the selection combo   *
'*                      box                            *
'*                                                     *
'*******************************************************
Private Sub mAirVehPop()
    Dim ilSAGroupNo As Integer
    Dim ilIndex As Integer
    Dim ilVef As Integer
    If tmVef.sType <> "S" Then
        Exit Sub
    End If
    'Don't include airing vehicle if selected Live Copy
    If (imSave(12) = 0) Or (imSave(12) = 2) Then
        Exit Sub
    End If
    ilSAGroupNo = -1
    'For ilIndex = 0 To UBound(tgVpf) Step 1
    '    If tmVef.iCode = tgVpf(ilIndex).iVefKCode Then
        ilIndex = gBinarySearchVpf(tmVef.iCode)
        If ilIndex <> -1 Then
            ilSAGroupNo = tgVpf(ilIndex).iSAGroupNo
    '        Exit For
        End If
    'Next ilIndex
    For ilIndex = 0 To UBound(tgVpf) Step 1
        If (ilSAGroupNo = tgVpf(ilIndex).iSAGroupNo) And (tgVpf(ilIndex).sCopyOnAir = "Y") Then
            'For ilVef = LBound(tgMVef) To UBound(tgMVef) - 1 Step 1
            '    If tgMVef(ilVef).iCode = tgVpf(ilIndex).iVefKCode Then
                ilVef = gBinarySearchVef(tgVpf(ilIndex).iVefKCode)
                If ilVef <> -1 Then
                    ''Exclude CPM Vehicles
                    'If (tgMVef(ilVef).sType = "A") And tgVpf(ilIndex).sGMedium <> "M" Then
                    If (tgMVef(ilVef).sType = "A") Then
                        mAddVehToLbc tgMVef(ilVef).iCode, "4"
                    End If
            '        Exit For
                End If
            'Next ilVef
        End If
    Next ilIndex
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mAllowedLens                    *
'*                                                     *
'*             Created:7/19/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Determine allowed lengths for  *
'*                      a contract                    *
'*                                                     *
'*******************************************************
Private Sub mAllowedLens()
    Dim ilRet As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim llChfCode As Long
    Dim ilCntrSelected As Integer
    Dim ilUpper As Integer
    Dim ilLoop As Integer
    Dim ilFound As Integer

    'Populate with vehicles defined for a contract if selected
    'If not selected- then populate all selling and conventional vehicles
    If smSave(1) <> "" Then
        gFindMatch smSave(1), 0, lbcCntr
        If gLastFound(lbcCntr) >= 0 Then
            slNameCode = tmCopyCntrCode(gLastFound(lbcCntr)).sKey    'lbcCntrCode.List(gLastFound(lbcCntr))
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            llChfCode = Val(slCode)
            ilCntrSelected = True
        Else
            ilCntrSelected = False
        End If
    Else
        ilCntrSelected = False
    End If
    If ilCntrSelected Then
        tmChfSrchKey.lCode = llChfCode
        ilRet = btrGetEqual(hmCHF, tmChf, imCHFRecLen, tmChfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        If lmCntrForLen = tmChf.lCntrNo Then
            Exit Sub
        End If
        ReDim imAllowedLens(0 To 0) As Integer
        ilUpper = 0
        lmCntrForLen = tmChf.lCntrNo
        'Obtain lines- ignore deleted lines
        tmClfSrchKey.lChfCode = llChfCode
        tmClfSrchKey.iLine = 0
        tmClfSrchKey.iCntRevNo = 32000  '0
        tmClfSrchKey.iPropVer = 32000  '0
        ilRet = btrGetGreaterOrEqual(hmClf, tmClf, imClfRecLen, tmClfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
        Do While (ilRet = BTRV_ERR_NONE) And (tmClf.lChfCode = llChfCode)
            If tmClf.sDelete <> "Y" Then
                ilFound = False
                If imTypeIndex = 0 Then
                    For ilLoop = 0 To ilUpper - 1 Step 1
                        If imAllowedLens(ilLoop) = tmClf.iLen Then
                            ilFound = True
                            Exit For
                        End If
                    Next ilLoop
                ElseIf imTypeIndex = 1 Then
                    If tmClf.iBBOpenLen > 0 Then
                        For ilLoop = 0 To ilUpper - 1 Step 1
                            If imAllowedLens(ilLoop) = tmClf.iBBOpenLen Then
                                ilFound = True
                                Exit For
                            End If
                        Next ilLoop
                    Else
                        ilFound = True
                    End If
                ElseIf imTypeIndex = 2 Then
                    If tmClf.iBBCloseLen > 0 Then
                        For ilLoop = 0 To ilUpper - 1 Step 1
                            If imAllowedLens(ilLoop) = tmClf.iBBCloseLen Then
                                ilFound = True
                                Exit For
                            End If
                        Next ilLoop
                    Else
                        ilFound = True
                    End If
                End If
                If Not ilFound Then
                    If imTypeIndex = 0 Then
                        imAllowedLens(ilUpper) = tmClf.iLen
                    ElseIf imTypeIndex = 1 Then
                        imAllowedLens(ilUpper) = tmClf.iBBOpenLen
                    ElseIf imTypeIndex = 2 Then
                        imAllowedLens(ilUpper) = tmClf.iBBCloseLen
                    End If
                    ReDim Preserve imAllowedLens(0 To ilUpper + 1) As Integer
                    ilUpper = ilUpper + 1
                End If
            End If
            ilRet = btrGetNext(hmClf, tmClf, imClfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
    Else
        ReDim imAllowedLens(0 To 0) As Integer
        ilUpper = 0
        lmCntrForLen = -1
        For ilLoop = LBound(tgSpf.iSLen) To UBound(tgSpf.iSLen) Step 1
            If tgSpf.iSLen(ilLoop) <> 0 Then
                If (imTypeIndex = 0) Or ((imTypeIndex = 1) And (tgSpf.iSLen(ilLoop) < 30)) Or ((imTypeIndex = 2) And (tgSpf.iSLen(ilLoop) < 30)) Then
                    imAllowedLens(ilUpper) = tgSpf.iSLen(ilLoop)
                    ReDim Preserve imAllowedLens(0 To ilUpper + 1) As Integer
                End If
            End If
        Next ilLoop
    End If
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mAllSaveRec                     *
'*                                                     *
'*             Created:5/14/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments:Update or added record          *
'*                                                     *
'*******************************************************
Private Function mAllSaveRec() As Integer
    Dim ilRet As Integer
    Dim blGridVisible As Boolean
    Dim ilRotIndex As Integer
    Dim ilLoop As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim ilAdfCode As Integer
    Dim ilVefCode As Integer
    Dim ilIndex As Integer
    Dim ilLen As Integer
    Dim ilFound As Integer
    Dim ilTest As Integer
    Dim ilCls As Integer
    Dim ilVef As Integer
    Dim ilSAGroupNo As Integer
    Dim ilVpf As Integer
    Dim llRow As Long
    Dim ilZone As Integer
    Dim ilBlackout As Integer
    Dim slSvComment As String
    Dim ilCategory As Integer
    Dim ilRafCategory As Integer
    Dim ilMaxCategory As Integer
    Dim ilExitDo As Integer
    Dim tlSef As SEF

    If Trim$(smSave(2)) = "[None]" Then
        mAllSaveRec = False
        Exit Function
    End If
    
    If imAdvtIndex < 0 Then
        mAllSaveRec = False
        Exit Function
    End If

    ilFound = False
    blGridVisible = False
    If grdRot.Visible Then
        blGridVisible = True
        For llRow = grdRot.FixedRows To grdRot.rows - 1 Step 1
            If Trim$(grdRot.TextMatrix(llRow, COPYINDEX)) <> "" Then
                ilFound = True
                Exit For
            End If
        Next llRow
        If Not ilFound Then
            MsgBox "No Copy Found", vbInformation + vbOKOnly, "Name Missing"
            mAllSaveRec = False
            Exit Function
        End If
    Else
        If Len(Trim$(lbcInst.List(0))) <= 0 Then
            MsgBox "No Copy Found", vbInformation + vbOKOnly, "Name Missing"
            mAllSaveRec = False
            Exit Function
        End If
    End If

    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    ilAdfCode = Val(slCode)
    
    imAskQuestions = True
    imRetailHourGlass = True
    If imSave(9) < 0 Then
        ilLen = 0
    Else
        ilLen = lbcLen.List(imSave(9))
    End If
    gSetMousePointer grdRot, grdRot, vbHourglass
    ReDim lmCifChecked(0 To 0) As Long
    ReDim lmCifDateSet(0 To 0) As Long
    ReDim ilVehicleListIndex(0 To 0) As Integer
    ReDim tmSetInvRotDate(0 To 0) As SETINVROTDATE
    ReDim lmCifCode(0 To 0) As Long
    '12/23/14: Initialize Copy Vehicle table
    ReDim tmCrfVefCode(0 To 0) As CRFVEFCODE
    If Trim$(smSave(2)) = "[All]" Then
        For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1  'lbcVehicleCode.ListCount - 1 Step 1
            slNameCode = tgCVehicle(ilLoop).sKey    'lbcVehicleCode.List(ilLoop)
            ''If (Left$(slNameCode, 1) <> "1") And (Left$(slNameCode, 1) <> "2") And (Left$(slNameCode, 1) <> "3") Then
            'If (Left$(slNameCode, 1) <> "1") And (Left$(slNameCode, 1) <> "2") Then
            If (Left$(slNameCode, 1) <> "2") And (Left$(slNameCode, 1) <> "4") Then
                '12/23/14: Move vehicle check here instead with each category/vehicle
                'ilVehicleListIndex(UBound(ilVehicleListIndex)) = ilLoop
                'ReDim Preserve ilVehicleListIndex(0 To UBound(ilVehicleListIndex) + 1) As Integer
                '4/21/15: Filter out disallowed split copy vehicles
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                ilVefCode = Val(slCode)
                If mTestIfRegionAllowed(True, ilVefCode) Then
                    If mVehicleOk(slNameCode, ilLen) Then
                        ilVehicleListIndex(UBound(ilVehicleListIndex)) = ilLoop
                        ReDim Preserve ilVehicleListIndex(0 To UBound(ilVehicleListIndex) + 1) As Integer
                    End If
                End If
            End If
        Next ilLoop
    ElseIf Trim$(smSave(2)) = smSeveral Then
        If lbcVehicle.Selected(0) And (imAllVehAdj = 1) Then  'All
            For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1  'lbcVehicleCode.ListCount - 1 Step 1
                slNameCode = tgCVehicle(ilLoop).sKey    'lbcVehicleCode.List(ilLoop)
                ''If (Left$(slNameCode, 1) <> "1") And (Left$(slNameCode, 1) <> "2") And (Left$(slNameCode, 1) <> "3") Then
                'If (Left$(slNameCode, 1) <> "1") And (Left$(slNameCode, 1) <> "2") Then
                If (Left$(slNameCode, 1) <> "2") And (Left$(slNameCode, 1) <> "4") Then
                    '12/23/14: Move vehicle check here instead with each category/vehicle
                    'ilVehicleListIndex(UBound(ilVehicleListIndex)) = ilLoop
                    'ReDim Preserve ilVehicleListIndex(0 To UBound(ilVehicleListIndex) + 1) As Integer
                    '4/21/15: Filter out disallowed split copy vehicles
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    ilVefCode = Val(slCode)
                    If mTestIfRegionAllowed(True, ilVefCode) Then
                        If mVehicleOk(slNameCode, ilLen) Then
                            ilVehicleListIndex(UBound(ilVehicleListIndex)) = ilLoop
                            ReDim Preserve ilVehicleListIndex(0 To UBound(ilVehicleListIndex) + 1) As Integer
                        End If
                    End If
                End If
            Next ilLoop
        End If
        For ilLoop = imAllVehAdj To lbcVehicle.ListCount - 1 Step 1
            If lbcVehicle.Selected(ilLoop) Then
                ilFound = False
                For ilIndex = 0 To UBound(ilVehicleListIndex) - 1 Step 1
                    If ilVehicleListIndex(ilIndex) = ilLoop - imAllVehAdj Then
                        ilFound = True
                        Exit For
                    End If
                Next ilIndex
                If Not ilFound Then
                    ''12/23/14: Move vehicle check here instead with each category/vehicle
                    ''ilVehicleListIndex(UBound(ilVehicleListIndex)) = ilLoop - imAllVehAdj
                    ''ReDim Preserve ilVehicleListIndex(0 To UBound(ilVehicleListIndex) + 1) As Integer
                    '4/20/15: Retain first character as required in mVehicleOk test
                    'slNameCode = Mid(tgCVehicle(ilLoop - imAllVehAdj).sKey, 2)
                    slNameCode = tgCVehicle(ilLoop - imAllVehAdj).sKey
                    '4/21/15: Filter out disallowed split copy vehicles
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    ilVefCode = Val(slCode)
                    If mTestIfRegionAllowed(True, ilVefCode) Then
                        If mVehicleOk(slNameCode, ilLen) Then
                            ilVehicleListIndex(UBound(ilVehicleListIndex)) = ilLoop - imAllVehAdj
                            ReDim Preserve ilVehicleListIndex(0 To UBound(ilVehicleListIndex) + 1) As Integer
                        End If
                    End If
                End If
            End If
        Next ilLoop
    End If
    slSvComment = smComment
    lmPrevSupersedeRotStartDate = 0
    lmPrevSupersedeRotEndDate = 0
'    If Trim$(smSave(2)) = "[All]" Then
    imCheckInv = True
    blGridVisible = False
    ReDim tmRegionCategory(0 To 0) As REGIONCATEGORY
    If grdRot.Visible Then
        blGridVisible = True
        For ilLoop = 2 To lbcRGRegion.ListCount - 1 Step 1
            tmRafSrchKey.lCode = lbcRGRegion.ItemData(ilLoop)
            ilRet = btrGetEqual(hmRaf, tmRaf, imRafRecLen, tmRafSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            If ilRet = BTRV_ERR_NONE Then
                Select Case tmRaf.sCategory
                    Case "T"    'Time zone
                        ilRafCategory = 2
                    Case "N"    'State
                        ilRafCategory = 3
                    Case "M"    'DMA Market
                        ilRafCategory = 4
                    Case "A"    'MSA Market
                        ilRafCategory = 5
                    Case "S"    'Station
                        ilRafCategory = 6
                    Case "F"    'Format
                        ilRafCategory = 7
                End Select
            Else
                ilRafCategory = -1
            End If
            ilMaxCategory = -1
            tmSefSrchKey1.lRafCode = lbcRGRegion.ItemData(ilLoop)
            tmSefSrchKey1.iSeqNo = 0
            ilRet = btrGetGreaterOrEqual(hmSef, tlSef, imSefRecLen, tmSefSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
            Do While (ilRet = BTRV_ERR_NONE) And (tlSef.lRafCode = lbcRGRegion.ItemData(ilLoop))
                ilCategory = -1
                Select Case tlSef.sCategory
                    Case "T"    'Time zone
                        ilCategory = 2
                    Case "N"    'State
                        ilCategory = 3
                    Case "M"    'DMA Market
                        ilCategory = 4
                    Case "A"    'MSA Market
                        ilCategory = 5
                    Case "S"    'Station
                        ilCategory = 6
                    Case "F"    'Format
                        ilCategory = 7
                End Select
                If (ilCategory = -1) And (ilRafCategory >= 0) Then
                    ilCategory = ilRafCategory
                End If
                If ilCategory >= 0 Then
                    If ilMaxCategory <= 7 Then
                        If ilCategory > ilMaxCategory Then
                            ilMaxCategory = ilCategory
                        End If
                    Else
                        If (ilCategory + 6 > ilMaxCategory) And (ilCategory < 7) Then
                            ilMaxCategory = ilCategory + 6
                        End If
                    End If
                End If
                ilRet = btrGetNext(hmSef, tlSef, imSefRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
            Loop
            If ilMaxCategory >= 0 Then
                tmRegionCategory(UBound(tmRegionCategory)).lRafCode = lbcRGRegion.ItemData(ilLoop)
                tmRegionCategory(UBound(tmRegionCategory)).iMaxCategory = ilMaxCategory
                ReDim Preserve tmRegionCategory(0 To UBound(tmRegionCategory) + 1) As REGIONCATEGORY
            End If
        Next ilLoop
    End If
    If blGridVisible Then
        ilMaxCategory = 12
    Else
        ilMaxCategory = 1
    End If
    If blGridVisible Then
        Do
            '5/4/15: change wording and update current if name not changed
            'sgGenMsg = "Save Current Grid in addition to the Rotation Instructions with Name"
            sgGenMsg = "In addition to saving the copy rotation instructions, do you want to name and save the current grid?"
            sgCMCTitle(0) = "Yes"
            sgCMCTitle(1) = "No"
            sgCMCTitle(2) = "Cancel"
            sgCMCTitle(3) = ""
            igDefCMC = 0
            igEditBox = 1
            sgEditValue = ""
            '5/4/15: Restore showing name
            'If smGridName <> "Current Working" Then
            '    sgEditValue = smGridName
            'End If
            If smRefGridName <> "" Then
                sgEditValue = smRefGridName
            End If
            GenMsg.Show vbModal
            If igAnsCMC = 0 Then
                If Trim$(sgEditValue) <> "" Then
                    ilExitDo = True
                    If (smRefGridName = sgEditValue) And (smRefGridName <> "") Then
                        ilRet = MsgBox("Replace existing Grid Information for " & smRefGridName, vbInformation + vbYesNo, "Replace Grid")
                        If ilRet = vbNo Then
                            ilExitDo = False
                        Else
                            ilRet = mGridSavedRemoved(smRefGridName)
                        End If
                    Else
                        '5/22/13: Pervasive is key sensitive, therefore use key 1 instead of key 2
                        'tmGnfSrchKey2.iAdfCode = ilAdfCode
                        'tmGnfSrchKey2.sGridName = sgEditValue
                        'ilRet = btrGetEqual(hmGnf, tmGnf, imGnfRecLen, tmGnfSrchKey2, INDEXKEY2, BTRV_LOCK_NONE, SETFORREADONLY)
                        tmGnfSrchKey1.iAdfCode = ilAdfCode
                        ilRet = btrGetEqual(hmGnf, tmGnf, imGnfRecLen, tmGnfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)
                        Do While (ilRet = BTRV_ERR_NONE) And (tmGnf.iAdfCode = ilAdfCode)
                            If UCase(sgEditValue) = UCase(Trim(tmGnf.sGridName)) Then
                                ilExitDo = False
                                MsgBox "Name previously used", vbInformation + vbOKOnly, "Duplicate"
                                Exit Do
                            End If
                            ilRet = btrGetNext(hmGnf, tmGnf, imGnfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
                        Loop
                    End If
                    If ilExitDo Then
                        smGridName = sgEditValue
                        lmGnfCode = 0
                        For llRow = grdRot.FixedRows To grdRot.rows - 1 Step 1
                            If grdRot.TextMatrix(llRow, COPYINDEX) <> "" Then
                                'Force add
                                grdRot.TextMatrix(llRow, GPFCODEINDEX) = 0
                                grdRot.TextMatrix(llRow, CSFCODEINDEX) = 0
                                ilRet = mGridSaved(llRow, True)
                            End If
                        Next llRow
                        Exit Do
                    End If
                Else
                    MsgBox "Grid Name not defined", vbInformation + vbOKOnly, "Name Missing"
                End If
            ElseIf igAnsCMC = 2 Then
                gSetMousePointer grdRot, grdRot, vbDefault
                mAllSaveRec = False
                Exit Function
            Else
                Exit Do
            End If
        Loop
    End If
    'If UBound(ilVehicleListIndex) > 0 Then
    If UBound(ilVehicleListIndex) > 1 Then
        imInAllSaveRec = True
        ilRotIndex = imRotIndex
        imRotIndex = 0  'Force add mode
        '12/23/14: Move vehicles into Copy Vehicle table and re-set vehicle index
        ReDim tmCrfVefCode(0 To UBound(ilVehicleListIndex)) As CRFVEFCODE
        For ilLoop = 0 To UBound(ilVehicleListIndex) - 1 Step 1
            gSetMousePointer grdRot, grdRot, vbHourglass
            slNameCode = tgCVehicle(ilVehicleListIndex(ilLoop)).sKey
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            ilVefCode = Val(slCode)
            tmCrfVefCode(ilLoop).iVefCode = ilVefCode
            tmCrfVefCode(ilLoop).iNextFinal = 1
            tmCrfVefCode(ilLoop).iNextPrelim = 1
        Next ilLoop
        'retain one vehicle so that the save works.  In save routine the vehicle will be ignored
        ReDim Preserve ilVehicleListIndex(0 To 1) As Integer

'        For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1  'lbcVehicleCode.ListCount - 1 Step 1
        For ilCategory = 1 To ilMaxCategory Step 1
            For ilLoop = 0 To UBound(ilVehicleListIndex) - 1 Step 1
                gSetMousePointer grdRot, grdRot, vbHourglass
    '            slNameCode = tgCVehicle(ilLoop).sKey    'lbcVehicleCode.List(ilLoop)
    '            If (Left$(slNameCode, 1) <> "1") And (Left$(slNameCode, 1) <> "2") Then
                    slNameCode = tgCVehicle(ilVehicleListIndex(ilLoop)).sKey
    '                smSave(2) = lbcVehicle.List(ilLoop + 1)
                    smSave(2) = lbcVehicle.List(ilVehicleListIndex(ilLoop) + imAllVehAdj)
                    If ilCategory = ilMaxCategory Then
                        If ilLoop = UBound(ilVehicleListIndex) - 1 Then
                            imInAllSaveRec = False
                        End If
                    End If
                    imChgMode = True
    '                lbcVehicle.ListIndex = ilLoop + 1
                    For ilCls = 0 To lbcVehicle.ListCount - 1 Step 1
                        lbcVehicle.Selected(ilCls) = False
                    Next ilCls
                    lbcVehicle.ListIndex = ilVehicleListIndex(ilLoop) + imAllVehAdj
                    lbcVehicle.Selected(lbcVehicle.ListIndex) = True
                    imChgMode = False
                    For ilIndex = imLBCtrls To UBound(tmCtrls) Step 1
                        tmCtrls(ilIndex).iChg = True
                    Next ilIndex
                    '12/23/14: Move above
                    'ilFound = False
                    'ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    'ilVefCode = Val(slCode)
                    'ilVef = gBinarySearchVef(ilVefCode)
                    'If ilVef <> -1 Then
                    '    If (Left$(slNameCode, 1) <> "3") Then
                    '        If tgMVef(ilVef).sType = "A" Then
                    '            ilVpf = gBinarySearchVpf(ilVefCode)
                    '            If ilVpf <> -1 Then
                    '                ilSAGroupNo = tgVpf(ilVpf).iSAGroupNo
                    '                For ilTest = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
                    '                    If ((tgClfCopy(ilTest).ClfRec.iLen = ilLen) And (imTypeIndex = 0)) Or ((tgClfCopy(ilTest).ClfRec.iBBOpenLen = ilLen) And (imTypeIndex = 1)) Or ((tgClfCopy(ilTest).ClfRec.iBBCloseLen = ilLen) And (imTypeIndex = 2)) Then
                    '                        'Test if in same Group
                    '                        ilVef = gBinarySearchVef(tgClfCopy(ilTest).ClfRec.iVefCode)
                    '                        If ilVef <> -1 Then
                    '                            If tgMVef(ilVef).sType = "S" Then
                    '                                ilVpf = gBinarySearchVpf(tgClfCopy(ilTest).ClfRec.iVefCode)
                    '                                If ilVpf <> -1 Then
                    '                                    If ilSAGroupNo = tgVpf(ilVpf).iSAGroupNo Then
                    '                                        ilFound = True
                    '                                        Exit For
                    '                                    End If
                    '                                End If
                    '                            End If
                    '                        End If
                    '                    End If
                    '                Next ilTest
                    '            End If
                    '        Else
                    '            For ilTest = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
                    '                If (tgClfCopy(ilTest).ClfRec.iVefCode = ilVefCode) And (((tgClfCopy(ilTest).ClfRec.iLen = ilLen) And (imTypeIndex = 0)) Or ((tgClfCopy(ilTest).ClfRec.iBBOpenLen = ilLen) And (imTypeIndex = 1)) Or ((tgClfCopy(ilTest).ClfRec.iBBCloseLen = ilLen) And (imTypeIndex = 2))) Then
                    '                    ilFound = True
                    '                    Exit For
                    '                End If
                    '            Next ilTest
                    '        End If
                    '    Else
                    '        ilFound = True
                    '    End If
                    'End If
                    ilFound = True
                    If ilFound Then
                        If blGridVisible Then
    '                        For llRow = grdRot.FixedRows To grdRot.Rows - 1 Step 1
    '                            If grdRot.TextMatrix(llRow, COPYINDEX) <> "" Then
    '                                'Set Region field
    '                                imSave(1) = -1
    '                                If llRow = grdRot.FixedRows Then
    '                                    If lbcZones.List(0) = "[Generic]" Then
    '                                        imSave(1) = 0
    '                                    ElseIf lbcZones.List(1) = "[Generic]" Then
    '                                        imSave(1) = 1
    '                                    End If
    '                                Else
    '                                    If grdRot.TextMatrix(llRow, STATUSINDEX) = "N" Then 'New
    '                                        'Create Region and add to list
    '                                        ilRet = mCreateRafSef(llRow)
    '                                        If ilRet Then
    '                                            ilRet = mAddRafSef()
    '                                            If ilRet Then
    '                                                'Add name to Zone
    '                                                mVehOptIndex
    '                                            End If
    '                                        End If
    '                                    ElseIf grdRot.TextMatrix(llRow, STATUSINDEX) = "M" Then 'Model
    '                                        'Create Region and add to list
    '                                        ilRet = mReadRecRafSef(grdRot.TextMatrix(llRow, RAFCODEINDEX))
    '                                        If ilRet Then
    '                                            ilRet = mAddRafSef()
    '                                            If ilRet Then
    '                                                'Add name to Zone
    '                                                mVehOptIndex
    '                                            End If
    '                                        End If
    '                                    End If
    '                                    For ilZone = 0 To lbcZones.ListCount - 1 Step 1
    '                                        If grdRot.TextMatrix(llRow, REGIONNAMEINDEX) = lbcZones.List(ilZone) Then
    '                                            imSave(1) = ilZone
    '                                        End If
    '                                    Next ilZone
    '                                End If
    '                                'Set Blackout field
    '                                If grdRot.TextMatrix(llRow, ADVTINDEX) <> "" Then
    '                                    For ilBlackout = 0 To cbcBlackout.ListCount - 1 Step 1
    '                                        If cbcBlackout.List(ilBlackout) = grdRot.TextMatrix(llRow, ADVTINDEX) Then
    '                                            imBlackoutIndex = ilBlackout
    '                                            cbcBlackout.Visible = True
    '                                            Exit For
    '                                        End If
    '                                    Next ilBlackout
    '                                Else
    '                                    imBlackoutIndex = -1
    '                                End If
    '                                'Set copy
    '                                ilRet = mGeneratePattern(llRow)
    '
    '                                If imSave(1) <> -1 Then
    '                                    ilFound = mTestIfRegionAllowed(True)
    '                                    If ilFound Then
    '                                        ilRet = mSaveRec()
    '                                        If ilRet = False Then
    '                                            imInAllSaveRec = False
    '                                            imRetailHourGlass = False
    '                                            Screen.MousePointer = vbDefault
    '                                            imRotIndex = ilRotIndex
    '                                            mAllSaveRec = False
    '                                            Exit Function
    '                                        End If
    '                                        imAskQuestions = False
    '                                        imCheckInv = False
    '                                    End If
    '                                End If
    '                            End If
    '                        Next llRow
                            ilRet = mSaveGridRot(ilCategory, ilMaxCategory)
                            If ilRet = False Then
                                smComment = slSvComment
                                imInAllSaveRec = False
                                imRetailHourGlass = False
                                gSetMousePointer grdRot, grdRot, vbDefault
                                imRotIndex = ilRotIndex
                                mAllSaveRec = False
                                Exit Function
                            End If
                        Else
                            '4/21/15: Test moved up to top
                            'ilFound = mTestIfRegionAllowed(True)
                            'If ilFound Then
                                ilRet = mSaveRec()
                                If ilRet = False Then
                                    imInAllSaveRec = False
                                    imRetailHourGlass = False
                                    gSetMousePointer grdRot, grdRot, vbDefault
                                    imRotIndex = ilRotIndex
                                    mAllSaveRec = False
                                    Exit Function
                                End If
                                gSetMousePointer grdRot, grdRot, vbHourglass
                                If imInAllSaveRec Then
                                    mAdjustCufAndCif "U", tmCrf, lmCifCode()
                                    ReDim lmCifCode(0 To 0) As Long
                                End If
                                imAskQuestions = False
                                imCheckInv = False
                            'End If
                        End If
                    End If
    '            End If
            Next ilLoop
        Next ilCategory
        imChgMode = True
        lbcVehicle.ListIndex = 0
        imChgMode = False
        imRotIndex = ilRotIndex
        mAllSaveRec = True
    Else
        ReDim tmCrfVefCode(0 To 1) As CRFVEFCODE
        If UBound(ilVehicleListIndex) = 1 Then
            slNameCode = tgCVehicle(ilVehicleListIndex(0)).sKey
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            ilVefCode = Val(slCode)
            tmCrfVefCode(0).iVefCode = ilVefCode
            tmCrfVefCode(0).iNextFinal = 1
            tmCrfVefCode(0).iNextPrelim = 1
        Else
            gFindMatch smSave(2), 0, lbcVehicle
            If gLastFound(lbcVehicle) >= 0 Then
                slNameCode = tgCVehicle(gLastFound(lbcVehicle) - imAllVehAdj).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                tmCrfVefCode(0).iVefCode = Val(slCode)
                tmCrfVefCode(0).iNextFinal = 1
                tmCrfVefCode(0).iNextPrelim = 1
            Else
                ReDim tmCrfVefCode(0 To 0) As CRFVEFCODE
            End If
        End If
        If blGridVisible Then
            For ilCategory = 1 To 12 Step 1
                ilRet = mSaveGridRot(ilCategory, 12)
            Next ilCategory
            mAllSaveRec = ilRet
        Else
            If (Trim$(smSave(2)) = "[All]") Or (Trim$(smSave(2)) = smSeveral) Then
                ilFound = True
            Else
                ilFound = mTestIfRegionAllowed(False)
            End If
            If ilFound Then
                ilRet = mSaveRec()
                mAllSaveRec = ilRet
            Else
                mAllSaveRec = False
            End If
        End If
    End If
    smComment = slSvComment
    imInAllSaveRec = False
    imRetailHourGlass = False
    If blGridVisible Then
        ilRet = mGridSavedRemoved("Current Working")
    End If
    lmGnfCode = 0
    gSetMousePointer grdRot, grdRot, vbDefault
    Exit Function
End Function
'*******************************************************
'*                                                     *
'*      Procedure Name:mAvailsBranch                   *
'*                                                     *
'*             Created:6/30/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Set up communication to Avail  *
'*                      names and process communication*
'*                      back from avail names          *
'*                                                     *
'*                                                     *
'*  General flow: pbc--Tab calls this function which   *
'*                initiates a task as a MODAL form.    *
'*                This form and the control loss focus *
'*                When the called task terminates two  *
'*                events are generated (Form activated;*
'*                GotFocus to pbc-Tab).  Also, control *
'*                is sent back to this function (the   *
'*                GotFocus event is initiated after    *
'*                this function finishes processing)   *
'*                                                     *
'*******************************************************
Private Function mAvailsBranch()
'
'   ilRet = mAvailsBranch()
'   Where:
'       ilRet (O)- True = Stay on control
'                  False = go to next control
'
    Dim ilRet As Integer
    Dim slStr As String
    Dim ilParse As Integer
    Dim ilUpdateAllowed As Integer
    ilRet = gOptionalLookAhead(edcDropDown, lbcAvail, imBSMode, slStr)
    If (ilRet = 0) And (Not imDoubleClickName) Then
        mAvailsBranch = False
        Exit Function
    End If
    'Unload IconTraf
    'If Not gWinRoom(igNoLJWinRes(AVAILNAMESLIST)) Then
    '    mAvailsBranch = True
    '    mEnableBox imBoxNo
    '    Exit Function
    'End If
    'Screen.MousePointer = vbHourGlass  'Wait
    igANmCallSource = CALLSOURCECOPY
    If edcDropDown.Text = "[New]" Then
        sgANmName = ""
    Else
        sgANmName = slStr
    End If
    ilUpdateAllowed = imUpdateAllowed
    'igChildDone = False 'edcLinkDestDoneMsg.Text = ""
    'edcLinkSrceDoneMsg.Text = ""
    'If (Not igStdAloneMode) And (imShowHelpMsg) Then
        If igTestSystem Then
            slStr = "Copy^Test\" & sgUserName & "\" & Trim$(str$(igANmCallSource)) & "\" & sgANmName
        Else
            slStr = "Copy^Prod\" & sgUserName & "\" & Trim$(str$(igANmCallSource)) & "\" & sgANmName
        End If
    'Else
    '    If igTestSystem Then
    '        slStr = "Copy^Test^NOHELP\" & sgUserName & "\" & Trim$(Str$(igANmCallSource)) & "\" & sgANmName
    '    Else
    '        slStr = "Copy^Prod^NOHELP\" & sgUserName & "\" & Trim$(Str$(igANmCallSource)) & "\" & sgANmName
    '    End If
    'End If
    'lgShellRet = Shell(sgExePath & "AName.Exe " & slStr, 1)
    'Copy.Enabled = False
    ''Screen.MousePointer = vbDefault  'Wait
    'Do While Not igChildDone
    '    DoEvents
    'Loop
    sgCommandStr = slStr
    AName.Show vbModal
    slStr = sgDoneMsg
    ilParse = gParseItem(slStr, 1, "\", sgANmName)
    igANmCallSource = Val(sgANmName)
    ilParse = gParseItem(slStr, 2, "\", sgANmName)
    'Copy.Enabled = True
    'edcLinkSrceDoneMsg.Text = "Ok"
    'For ilLoop = 0 To 10
    '    DoEvents
    'Next ilLoop
    'MousePointer = vbDefault    'Default
    imDoubleClickName = False
    mAvailsBranch = True
    imUpdateAllowed = ilUpdateAllowed
    'If imUpdateAllowed = False Then
    '    mSendHelpMsg "BF"
    'Else
    '    mSendHelpMsg "BT"
    'End If
    gShowBranner imUpdateAllowed
    If igANmCallSource = CALLDONE Then  'Done
        igANmCallSource = CALLNONE
        lbcAvail.Clear
        smAvailCodeTag = ""
        sgAvailAnfStamp = ""
        mAvailsPop
        If imTerminate Then
            mAvailsBranch = False
            Exit Function
        End If
        gFindMatch sgANmName, 1, lbcAvail
        sgANmName = ""
        If gLastFound(lbcAvail) > 0 Then
            imChgMode = True
            lbcAvail.ListIndex = gLastFound(lbcAvail)
            edcDropDown.Text = lbcAvail.List(lbcAvail.ListIndex)
            imChgMode = False
            mAvailsBranch = False
        Else
            imChgMode = True
            lbcAvail.ListIndex = 1
            edcDropDown.Text = lbcAvail.List(lbcAvail.ListIndex)
            imChgMode = False
            edcDropDown.SetFocus
            Exit Function
        End If
    End If
    If igANmCallSource = CALLCANCELLED Then  'Cancelled
        igANmCallSource = CALLNONE
        sgANmName = ""
        mEnableBox imBoxNo
        Exit Function
    End If
    If igANmCallSource = CALLTERMINATED Then
        igANmCallSource = CALLNONE
        sgANmName = ""
        mEnableBox imBoxNo
        Exit Function
    End If
    Exit Function

    On Error GoTo 0
    imTerminate = True
    Exit Function
End Function
'*******************************************************
'*                                                     *
'*      Procedure Name:mAvailsPop                      *
'*                                                     *
'*             Created:5/13/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Populate the selection combo   *
'*                      box                            *
'*                                                     *
'*******************************************************
Private Sub mAvailsPop()
    ReDim ilFilter(0) As Integer
    ReDim slFilter(0) As String
    ReDim ilOffSet(0) As Integer
    Dim ilRet As Integer
    Dim slName As String
    Dim ilIndex As Integer
    Dim ilLoop As Integer
    Dim ilLp As Integer
    Dim slStr As String
    ilIndex = lbcAvail.ListIndex
    If ilIndex > 0 Then
        slName = lbcAvail.List(ilIndex)
    End If
'    ilFilter(0) = NOFILTER
'    slFilter(0) = ""
'    ilOffset(0) = 0
    ilFilter(0) = CHARFILTERNOT
    slFilter(0) = "F"
    ilOffSet(0) = gFieldOffset("Anf", "AnfBookLocalFeed") '2
    'ilRet = gIMoveListBox(Copy, lbcAvail, lbcAvailCode, "Anf.Btr", gFieldOffset("Anf", "AnfName"), 20, ilFilter(), slFilter(), ilOffset())
    ilRet = gIMoveListBox(Copy, lbcAvail, tmAvailCode(), smAvailCodeTag, "Anf.Btr", gFieldOffset("Anf", "AnfName"), 20, ilFilter(), slFilter(), ilOffSet())
    If ilRet <> CP_MSG_NOPOPREQ Then
        'Remove "Post Log" avail name
        For ilLoop = 0 To lbcAvail.ListCount - 1 Step 1
            slStr = Trim$(lbcAvail.List(ilLoop))
            If StrComp(slStr, "Post Log", 1) = 0 Then
                lbcAvail.RemoveItem ilLoop
                For ilLp = ilLoop To UBound(tmAvailCode) - 1 Step 1
                    tmAvailCode(ilLp) = tmAvailCode(ilLp + 1)
                Next ilLp
                ReDim Preserve tmAvailCode(LBound(tmAvailCode) To UBound(tmAvailCode) - 1) As SORTCODE
                Exit For
            End If
        Next ilLoop
        On Error GoTo mAvailsErr
        gCPErrorMsg ilRet, "mAvailsPop (gIMoveListBox: Avails)", Copy
        On Error GoTo 0
        lbcAvail.AddItem "[New]", 0  'Force as first item on list
        imChgMode = True
        If ilIndex > 0 Then
            gFindMatch slName, 2, lbcAvail
            If gLastFound(lbcAvail) > 1 Then
                lbcAvail.ListIndex = gLastFound(lbcAvail)
            Else
                lbcAvail.ListIndex = -1
            End If
        Else
            lbcAvail.ListIndex = ilIndex
        End If
        imChgMode = False
    End If
    Exit Sub
mAvailsErr:
    On Error GoTo 0
    imTerminate = True
    Exit Sub
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mBoxCalDate                     *
'*                                                     *
'*             Created:8/25/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Place box around calendar date *
'*                                                     *
'*******************************************************
Private Sub mBoxCalDate()
    Dim slStr As String
    Dim ilRowNo As Integer
    Dim llInputDate As Long
    Dim ilWkDay As Integer
    Dim slDay As String
    Dim llDate As Long
    slStr = edcDropDown.Text
    If gValidDate(slStr) Then
        llInputDate = gDateValue(slStr)
        If (llInputDate >= lmCalStartDate) And (llInputDate <= lmCalEndDate) Then
            ilRowNo = 0
            llDate = lmCalStartDate
            Do
                ilWkDay = gWeekDayLong(llDate)
                slDay = Trim$(str$(Day(llDate)))
                If llDate = llInputDate Then
                    lacDate.Caption = slDay
                    lacDate.Move tmCDCtrls(ilWkDay + 1).fBoxX - 30, tmCDCtrls(ilWkDay + 1).fBoxY + ilRowNo * (tmCDCtrls(ilWkDay + 1).fBoxH + 15) - 30
                    lacDate.Visible = True
                    Exit Sub
                End If
                If ilWkDay = 6 Then
                    ilRowNo = ilRowNo + 1
                End If
                llDate = llDate + 1
            Loop Until llDate > lmCalEndDate
            lacDate.Visible = False
        Else
            lacDate.Visible = False
        End If
    Else
        lacDate.Visible = False
    End If
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mCbcAdvtChange                  *
'*                                                     *
'*             Created:10/17/93      By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Process vehicle change         *
'*                                                     *
'*******************************************************
Private Sub mCbcAdvtChange()
    Dim ilLoopCount As Integer
    If imChgMode = False Then
        imChgMode = True
        imAdvtIndex = -1
        ilLoopCount = 0
        Do
            If ilLoopCount > 0 Then
                If cbcAdvt.ListIndex >= 0 Then
                    cbcAdvt.Text = cbcAdvt.List(cbcAdvt.ListIndex)
                End If
            End If
            ilLoopCount = ilLoopCount + 1
            If cbcAdvt.Text <> "" Then
                gManLookAhead cbcAdvt, imBSMode, imComboBoxIndexAdvt
            End If
            imAdvtIndex = cbcAdvt.ListIndex
            gSetMousePointer grdRot, grdRot, vbHourglass
            smRegionCodeTag = ""
            imRotIndex = -1
            lbcRot.Clear
            pbcRot.Cls
            txtISCI_Filter = ""
            txtISCI_Filter_Main = ""
            mPaintRot
            lbcInv.Clear
            lbcInst.Clear
            lbcInst.AddItem " "
            smActiveCodeTag = ""
            lbcActive.Clear
            smPurgeCodeTag = ""
            lbcPurge.Clear
            smHistoryCodeTag = ""
            lbcHistory.Clear
            pbcLbcInst.Cls
            mClearCtrlFields
            gSetMousePointer grdRot, grdRot, vbHourglass
            'mRotPop False
            'Added because of the removal of the call to mRotPop
            mObtainRegions
            mCntrPop
            gSetMousePointer grdRot, grdRot, vbHourglass
            mInvPop
            mShtTitlePop
        Loop While imAdvtIndex <> cbcAdvt.ListIndex
        gSetMousePointer grdRot, grdRot, vbDefault
        mSetCommands
        imChgMode = False
    End If
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mClearCtrlFields                *
'*                                                     *
'*             Created:9/24/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Clear each control on the      *
'*                      screen                         *
'*                                                     *
'*******************************************************
Private Sub mClearCtrlFields()
'
'   mClearCtrlFields
'   Where:
'
    Dim ilLoop As Integer
    Dim ilValue As Integer

    ReDim lmCrfCvfCode(0 To 0) As Integer
    For ilLoop = LBound(smSave) To UBound(smSave) Step 1
        smSave(ilLoop) = ""
    Next ilLoop
    For ilLoop = LBound(imSave) To UBound(imSave) Step 1
        imSave(ilLoop) = -1
    Next ilLoop
    ilValue = Asc(tgSpf.sUsingFeatures)  'Option Fields in Orders/Proposals
    If ((Asc(tgSpf.sUsingFeatures) And LIVECOPY) <> LIVECOPY) And ((Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) <> PROMOCOPY) Then 'Using Live Copy
        imSave(12) = 1  'Recorded
    End If
    edcHdLnComment.Text = ""
    tmChf.lCode = 0
    lbcCntr.ListIndex = -1
    lbcLen.ListIndex = -1
    lbcType.ListIndex = -1
    lbcVehicle.ListIndex = -1
    For ilLoop = 0 To lbcVehicle.ListCount - 1 Step 1
        lbcVehicle.Selected(ilLoop) = False
    Next ilLoop
    imVehPopReq = True
    lbcZones.ListIndex = -1
    ReDim smRGComment(0 To 0)
    mSetRGCtrl
    mClearRG
    imEnteredOrderNo = 0
    lbcInst.Clear
    lbcInst.AddItem " "
    pbcLbcInst.Cls
    imRotChg = False
    lbcShtTitle.ListIndex = -1
    smShtTitle = ""
    smInitShtTitle = ""
    smOrigCntr = ""
    smOrigVehicle = ""
    smOrigZone = ""
    smOrigSDate = ""
    imAllowErase = False
    smOrigEDate = ""
    smOrigSTime = ""
    smOrigETime = ""
    smOrigAvail = ""
    smOrigType = ""
    smComment = ""
    smOrigComment = ""
    imRotHeaderChgOnly = True
    tmCrf.sInOut = " "
    For ilLoop = 0 To 6 Step 1
        tmCrf.sDay(ilLoop) = ""
    Next ilLoop
    tmCrf.iLen = -1
    tmCrf.ianfCode = 0
    tmCrf.sLiveCopy = ""
    tmCrf.sMGCopyAssign = ""
    'tmCsf.iStrLen = 0
    tmCsf.sComment = ""
    tmCsf.lCode = 0
    imBlackoutAdfCode = 0
    cbcBlackout.Clear
    cbcBlackout.ListIndex = -1
    imBlackoutIndex = -1
    lbcRGAdvt.Clear
    For ilLoop = imLBCtrls To UBound(tmCtrls) Step 1
        tmCtrls(ilLoop).iChg = False
        tmCtrls(ilLoop).sShow = ""
    Next ilLoop
    imFLValue = 1
    imInitNextFinal = 1 'Force change
    mSetFLPointer
    'mAllowedLens
    'mVehPop
    imGameVefCode = -1
    imGameVehicle = False
    imAGDirection = 1
    imDateChanged = False
    lbcTeam.Clear
    lbcGameNo.Clear
    tmChf.lCode = 0
    If ((Asc(tgSpf.sUsingFeatures9) And IDCRESTRICTION) <> IDCRESTRICTION) Then
        bmIDCMsgShown = True
    Else
        bmIDCMsgShown = False
    End If
    bmInCmcGrid = False
    bmBypassGridSave = False
    lmGnfCode = 0
    smGridName = "Current Working"
    smRefGridName = ""
    ReDim tgCVehicle(0 To 0) As SORTCODE
    For ilLoop = 0 To 5 Step 1
        bmAllowedAudioTypes(ilLoop) = False
    Next ilLoop
    bmAllowedAudioTypes(1) = True
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mClearDrag                      *
'*                                                     *
'*             Created:10/17/93      By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Clear drag when drop on illegal*
'*                      object                         *
'*                                                     *
'*******************************************************
Private Sub mClearDrag()
    tmcScroll.Enabled = False   'incase dropped within scroll area
    imcTrash.Picture = IconTraf!imcTrashClosed.Picture
    imcTrash.Enabled = False
    imcTrash.Visible = False
    imDragIndexSrce = -1
    imDragSrce = -1
    imDragScroll = -1
    mSetCommands
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mCntrPop                        *
'*                                                     *
'*             Created:6/04/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Populate the selection combo   *
'*                      box                            *
'*                                                     *
'*******************************************************
Private Sub mCntrPop()
'
'   mCntrPop
'   Where:
'
    Dim ilRet As Integer 'btrieve status
    Dim ilAdfCode As Integer
    Dim slNameCode As String  'Name and code
    Dim slCode As String    'Code number
    Dim ilCurrent As Integer
    Dim ilVehCode As Integer
    Dim llTodayDate As Long
    Dim ilAAS As Integer
    Dim ilShow As Integer
    Dim slCntrStatus As String
    Dim slCntrType As String
    Dim ilState As Integer
    If (cbcType.ListIndex = 0) Or ((cbcType.ListIndex <= 2) And (tgSpf.sUsingBBs = "Y")) Then
        If imAdvtIndex < 0 Then
            Exit Sub
        End If
        slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
        ilRet = gParseItem(slNameCode, 2, "\", slCode)
        ilAdfCode = Val(slCode)   '
    Else
        lbcCntr.Clear
        Exit Sub
    End If

    gSetMousePointer grdRot, grdRot, vbHourglass
    llTodayDate = gDateValue(gNow())
    'If rbcCRShow(0).Value Then
    If ckcCurrentRot.Value = vbChecked Then
        ilCurrent = 0   'Current (1=All)
    Else
        ilCurrent = 1
    End If
    ilVehCode = -1
    ilAAS = 0
    slCntrStatus = "HO"
    slCntrType = ""
    ilShow = 2
    ilState = 1
    'ilRet = gPopCntrBox(Copy, 1, ilAdfCode, ilCurrent, 0, ilVehCode, lbcCntr, lbcCntrCode, False, True, True, True)
    'ilRet = gPopCntrForAASWithRotBox(Copy, ilAAS, ilAdfCode, slCntrStatus, slCntrType, ilCurrent, ilState, ilShow, lbcRot, lbcCntr, lbcCntrCode)
    ilRet = gPopCntrForAASWithRotBox(Copy, ilAAS, ilAdfCode, slCntrStatus, slCntrType, ilCurrent, ilState, ilShow, lbcRot, lbcCntr, tmCopyCntrCode(), smCopyCntrCodeTag)
    If ilRet <> CP_MSG_NOPOPREQ Then
        On Error GoTo mCntrPopErr
        gCPErrorMsg ilRet, "mCntrPop (gPopCntrForAASBox)", Copy
        On Error GoTo 0
    End If

    'If rbcCRShow(0).Value Then  'Current only
    '    'Retain Current Contracts and and rotation that references a past contract
    '    For ilLoop = lbcCntrCode.ListCount - 1 To 0 Step -1
    '        slNameCode = lbcCntrCode.List(ilLoop)
    '        ilRet = gParseItem(slNameCode, 2, "\", slCode)
    '        llChfCode = Val(slCode)
    '        tmChfSrchKey.lCode = llChfCode
    '        ilRet = btrGetEqual(hmChf, tmChf, imChfRecLen, tmChfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)
    '        gUnpackDate tmChf.iEndDate(0), tmChf.iEndDate(1), slDate
    '        If gDateValue(slDate) < llTodayDate Then
    '            'Determine if required because of rotation
    '            ilFound = False
    '            For ilRot = 0 To lbcRot.ListCount - 1 Step 1
    '                slNameCode = lbcRot.List(ilRot)
    '                ilRet = gParseItem(slNameCode, 1, "|", slCode)
    '                If Val(slCode) = tmChf.lCntrNo Then
    '                    ilFound = True
    '                    Exit For
    '                End If
    '            Next ilRot
    '            If Not ilFound Then
    '                lbcCntrCode.RemoveItem ilLoop
    '                lbcCntr.RemoveItem ilLoop
    '            End If
    '        End If
    '
    '    Next ilLoop
    'End If
    gSetMousePointer grdRot, grdRot, vbDefault
    Exit Sub
mCntrPopErr:
    On Error GoTo 0
    imTerminate = True
    gSetMousePointer grdRot, grdRot, vbDefault
    Exit Sub
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mDragOver                       *
'*                                                     *
'*             Created:10/17/93      By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Process drag over              *
'*                                                     *
'*******************************************************
Private Sub mDragOver(ilObject As Integer, State As Integer, Index As Integer)
    imDragScroll = ilObject
    If State = vbEnter Then
        tmcScroll.Enabled = True
        imScrollDir = Index
        Exit Sub
    End If
    If State = vbLeave Then
        tmcScroll.Enabled = False
        imDragScroll = -1
        Exit Sub
    End If
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mEnableBox                      *
'*                                                     *
'*             Created:6/28/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Enable specified control       *
'*                                                     *
'*******************************************************
Private Sub mEnableBox(ilBoxNo As Integer)
'
'   mEnableBox ilBoxNo
'   Where:
'       ilBoxNo (I)- Number of the Control to be enabled
'
    Dim ilLoop As Integer   'For loop control parameter
    Dim ilRet As Integer    'Return call status
    Dim slCode As String    'code number
    Dim slNameCode As String
    Dim slDate As String
    Dim slLen As String
    Dim slName As String
    Dim llDate As Long
    Dim sl1Len As String
    Dim sl2Len As String
    Dim ilValue As Integer
    Dim ilDay As Integer
    ReDim ilValidDay(0 To 6) As Integer
    If (ilBoxNo < imLBCtrls) Or (ilBoxNo > UBound(tmCtrls)) Then
        Exit Sub
    End If

    Select Case ilBoxNo 'Branch on box type (control)
        Case CNTRINDEX
            mCntrPop
            lbcCntr.height = gListBoxHeight(lbcCntr.ListCount, 10)
            edcDropDown.Width = tmCtrls(CNTRINDEX).fBoxW + tmCtrls(VEHICLEINDEX).fBoxW - 2 * cmcDropDown.Width
            edcDropDown.MaxLength = 0
            gMoveTableCtrl pbcRot, edcDropDown, tmCtrls(CNTRINDEX).fBoxX, tmCtrls(CNTRINDEX).fBoxY '- 30 '(fgBoxGridH + 15)
            cmcDropDown.Move edcDropDown.Left + edcDropDown.Width, edcDropDown.Top
            'Vehicle default should be set in mSetDefInSave for all lines except first
            imChgMode = True
            gFindMatch smSave(1), 0, lbcCntr
            If gLastFound(lbcCntr) >= 0 Then
                lbcCntr.ListIndex = gLastFound(lbcCntr)
            Else
                lbcCntr.ListIndex = -1
            End If
            imComboBoxIndex = lbcCntr.ListIndex
            If lbcCntr.ListIndex >= 0 Then
                edcDropDown.Text = lbcCntr.List(lbcCntr.ListIndex)
            Else
                edcDropDown.Text = ""
            End If
            imChgMode = False
            lbcCntr.Move edcDropDown.Left, edcDropDown.Top + edcDropDown.height
            edcDropDown.SelStart = 0
            edcDropDown.SelLength = Len(edcDropDown.Text)
            edcDropDown.Visible = True
            cmcDropDown.Visible = True
            lbcCntr.Visible = True
            edcDropDown.SetFocus
        Case LENINDEX
            mAllowedLens
            'mVehOptIndex
            mLenPop
            lbcLen.height = gListBoxHeight(lbcLen.ListCount, 10)
            edcDropDown.Width = tmCtrls(LENINDEX).fBoxW
            edcDropDown.MaxLength = 4
            gMoveTableCtrl pbcRot, edcDropDown, tmCtrls(LENINDEX).fBoxX, tmCtrls(LENINDEX).fBoxY '- 30 '(fgBoxGridH + 15)
            cmcDropDown.Move edcDropDown.Left + edcDropDown.Width, edcDropDown.Top
            'Vehicle default should be set in mSetDefInSave for all lines except first
            imChgMode = True
            If imSave(9) >= 0 Then
                lbcLen.ListIndex = imSave(9)
            Else
                'Check lengths of inventory- if all one length then use it
                slLen = ""
                If imInvStatus = 0 Then
                    For ilLoop = 1 To lbcInv.ListCount - 1 Step 1
                        slNameCode = lbcInv.List(ilLoop)
                        ilRet = gParseItem(slNameCode, 1, " ", slName)
                        If slLen = "" Then
                            slLen = slName
                        Else
                            If Val(slLen) <> Val(slName) Then
                                slLen = ""
                                Exit For
                            End If
                        End If
                    Next ilLoop
                Else
                    For ilLoop = 0 To lbcInv.ListCount - 1 Step 1
                        slNameCode = lbcInv.List(ilLoop)
                        ilRet = gParseItem(slNameCode, 1, " ", slName)
                        If slLen = "" Then
                            slLen = slName
                        Else
                            If Val(slLen) <> Val(slName) Then
                                slLen = ""
                                Exit For
                            End If
                        End If
                    Next ilLoop
                End If
                sl1Len = "30"
                sl2Len = "60"
                If imTypeIndex = 1 Or imTypeIndex = 2 Then
                    sl1Len = "5"
                    sl2Len = "10"
                End If
                If slLen = "" Then
                    If UBound(imAllowedLens) = 1 Then
                        slLen = Trim$(str$(imAllowedLens(0)))
                    Else
                        slLen = sl1Len
                    End If
                    gFindMatch slLen, 0, lbcLen
                    If gLastFound(lbcLen) >= 0 Then
                        lbcLen.ListIndex = gLastFound(lbcLen)
                    Else
                        gFindMatch sl2Len, 0, lbcLen
                        If gLastFound(lbcLen) >= 0 Then
                            lbcLen.ListIndex = gLastFound(lbcLen)
                        Else
                            lbcLen.ListIndex = -1
                        End If
                    End If
                Else
                    gFindMatch slLen, 0, lbcLen
                    If gLastFound(lbcLen) >= 0 Then
                        lbcLen.ListIndex = gLastFound(lbcLen)
                    Else
                        If UBound(imAllowedLens) = 1 Then
                            slLen = Trim$(str$(imAllowedLens(0)))
                        Else
                            slLen = sl1Len
                        End If
                        gFindMatch slLen, 0, lbcLen
                        If gLastFound(lbcLen) >= 0 Then
                            lbcLen.ListIndex = gLastFound(lbcLen)
                        Else
                            gFindMatch sl2Len, 0, lbcLen
                            If gLastFound(lbcLen) >= 0 Then
                                lbcLen.ListIndex = gLastFound(lbcLen)
                            Else
                                lbcLen.ListIndex = -1
                            End If
                        End If
                    End If
                End If
            End If
            imComboBoxIndex = lbcLen.ListIndex
            If lbcLen.ListIndex >= 0 Then
                edcDropDown.Text = lbcLen.List(lbcLen.ListIndex)
            Else
                edcDropDown.Text = ""
            End If
            imChgMode = False
            lbcLen.Move edcDropDown.Left, edcDropDown.Top + edcDropDown.height
            edcDropDown.SelStart = 0
            edcDropDown.SelLength = Len(edcDropDown.Text)
            edcDropDown.Visible = True
            cmcDropDown.Visible = True
            edcDropDown.SetFocus
        Case LIVECOPYINDEX
            imSvLive = imSave(12)
            If imSave(12) < 0 Then
                imSave(12) = mGetDefaultAudioType() '1    'Rec Cmml
                tmCtrls(LIVECOPYINDEX).iChg = True
                mSetCommands
            End If
            pbcYN.Width = (3 * tmCtrls(ilBoxNo).fBoxW) / 2
            gMoveTableCtrl pbcRot, pbcYN, tmCtrls(ilBoxNo).fBoxX, tmCtrls(ilBoxNo).fBoxY '- 30 ' (fgBoxGridH + 15)
            pbcYN_Paint
            pbcYN.Visible = True
            pbcYN.SetFocus
        Case VEHICLEINDEX 'Vehicle
            'If (Trim$(smSave(2)) <> smSeveral) Then
            If imVehPopReq Then
                mVehPop
            End If
            lbcVehicle.height = gListBoxHeight(lbcVehicle.ListCount, 15)
            edcDropDown.Width = tmCtrls(VEHICLEINDEX).fBoxW
            If tgSpf.iVehLen <= 40 Then
                edcDropDown.MaxLength = tgSpf.iVehLen
            Else
                edcDropDown.MaxLength = 20
            End If
            gMoveTableCtrl pbcRot, edcDropDown, tmCtrls(VEHICLEINDEX).fBoxX, tmCtrls(VEHICLEINDEX).fBoxY '- 30 '(fgBoxGridH + 15)
            cmcDropDown.Move edcDropDown.Left + edcDropDown.Width, edcDropDown.Top
            'Vehicle default should be set in mSetDefInSave for all lines except first
            imChgMode = True
            If (Trim$(smSave(2)) <> smSeveral) Then
                If lbcVehicle.ListCount > 0 Then
                    gFindMatch smSave(2), 0, lbcVehicle
                    If gLastFound(lbcVehicle) >= 0 Then
                        lbcVehicle.ListIndex = gLastFound(lbcVehicle)
                        lbcVehicle.Selected(lbcVehicle.ListIndex) = True
                    Else
                        lbcVehicle.ListIndex = 0
                        lbcVehicle.Selected(lbcVehicle.ListIndex) = True
                    End If
                    imComboBoxIndex = lbcVehicle.ListIndex
                    If lbcVehicle.ListIndex >= 0 Then
                        edcDropDown.Text = lbcVehicle.List(lbcVehicle.ListIndex)
                    Else
                        edcDropDown.Text = ""
                    End If
                Else
                    edcDropDown.Text = ""
                End If
            Else
                edcDropDown.Text = smSeveral
            End If
            imChgMode = False
            lbcVehicle.Move edcDropDown.Left, edcDropDown.Top + edcDropDown.height
            edcDropDown.SelStart = 0
            edcDropDown.SelLength = Len(edcDropDown.Text)
            edcDropDown.Visible = True
            cmcDropDown.Visible = True
            lbcVehicle.Visible = True
            edcDropDown.SetFocus
        Case MGASSIGNINDEX
            lbcMGCopyAssign.height = gListBoxHeight(lbcMGCopyAssign.ListCount, 10)
            edcDropDown.Width = lbcMGCopyAssign.Width '- cmcDropDown.Width
            edcDropDown.MaxLength = 0
            gMoveTableCtrl pbcRot, edcDropDown, tmCtrls(MGASSIGNINDEX).fBoxX, tmCtrls(MGASSIGNINDEX).fBoxY '- 30 '(fgBoxGridH + 15)
            cmcDropDown.Move edcDropDown.Left + edcDropDown.Width, edcDropDown.Top
            'Vehicle default should be set in mSetDefInSave for all lines except first
            imChgMode = True
            If imSave(13) >= 0 Then
                lbcMGCopyAssign.ListIndex = imSave(13)
            Else
                'If ckcIncludeMG.Value = vbUnchecked Then
                    ilValue = Asc(tgSpf.sMOFCopyAssign)  'Mg Copy Assignment
                    If (ilValue And MGORIGVEHONLY) = MGORIGVEHONLY Then
                        lbcMGCopyAssign.ListIndex = 0
                    ElseIf (ilValue And MGSCHVEHONLY) = MGSCHVEHONLY Then
                        lbcMGCopyAssign.ListIndex = 1
                    Else
                        lbcMGCopyAssign.ListIndex = 2
                    End If
                'Else
                '    lbcMGCopyAssign.ListIndex = 1
                'End If
                imSave(13) = lbcMGCopyAssign.ListIndex
            End If
            imComboBoxIndex = lbcMGCopyAssign.ListIndex
            If lbcMGCopyAssign.ListIndex >= 0 Then
                edcDropDown.Text = lbcMGCopyAssign.List(lbcMGCopyAssign.ListIndex)
            Else
                edcDropDown.Text = ""
            End If
            imChgMode = False
            lbcMGCopyAssign.Move edcDropDown.Left, edcDropDown.Top + edcDropDown.height
            edcDropDown.SelStart = 0
            edcDropDown.SelLength = Len(edcDropDown.Text)
            edcDropDown.Visible = True
            cmcDropDown.Visible = True
            edcDropDown.SetFocus
        Case ZONEINDEX
            mVehOptIndex
            lbcZones.height = gListBoxHeight(lbcZones.ListCount, 10)
            edcDropDown.Width = 3 * tmCtrls(ZONEINDEX).fBoxW
            'If (tgSpf.sGUseAffFeed = "Y") Then
            ilValue = Asc(tgSpf.sUsingFeatures2)  'Option Fields in Orders/Proposals
            If (((ilValue And REGIONALCOPY) = REGIONALCOPY) Or ((ilValue And SPLITCOPY) = SPLITCOPY)) Then
                edcDropDown.MaxLength = 80
            Else
                edcDropDown.MaxLength = 5
            End If
            gMoveTableCtrl pbcRot, edcDropDown, tmCtrls(ZONEINDEX).fBoxX, tmCtrls(ZONEINDEX).fBoxY '- 30 '(fgBoxGridH + 15)
            cmcDropDown.Move edcDropDown.Left + edcDropDown.Width, edcDropDown.Top
            'Vehicle default should be set in mSetDefInSave for all lines except first
            imChgMode = True
            If imSave(1) >= 0 Then
                lbcZones.ListIndex = imSave(1)
            Else
                lbcZones.ListIndex = 0
            End If
            imComboBoxIndex = lbcZones.ListIndex
            If lbcZones.ListIndex >= 0 Then
                edcDropDown.Text = lbcZones.List(lbcZones.ListIndex)
            Else
                edcDropDown.Text = ""
            End If
            imChgMode = False
            lbcZones.Move edcDropDown.Left, edcDropDown.Top + edcDropDown.height
            edcDropDown.SelStart = 0
            edcDropDown.SelLength = Len(edcDropDown.Text)
            edcDropDown.Visible = True
            cmcDropDown.Visible = True
            edcDropDown.SetFocus
        Case SDATEINDEX
            smSvRotStartDate = smSave(3)
            smSvRotEndDate = smSave(4)
            edcDropDown.Width = (5 * tmCtrls(SDATEINDEX).fBoxW) / 4
            edcDropDown.MaxLength = 10
            gMoveTableCtrl pbcRot, edcDropDown, tmCtrls(SDATEINDEX).fBoxX, tmCtrls(SDATEINDEX).fBoxY '- 30
            If smSave(3) = "" Then
                gFindMatch smSave(1), 0, lbcCntr
                If gLastFound(lbcCntr) >= 0 Then
                    slNameCode = tmCopyCntrCode(gLastFound(lbcCntr)).sKey    'lbcCntrCode.List(gLastFound(lbcCntr))
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    If tmChf.lCode <> Val(slCode) Then
                        tmChfSrchKey.lCode = Val(slCode)
                        ilRet = btrGetEqual(hmCHF, tmChf, imCHFRecLen, tmChfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                    End If
                End If
                gUnpackDate tmChf.iStartDate(0), tmChf.iStartDate(1), smSave(3)
                If gDateValue(smSave(3)) < gDateValue(smMonDefStartDate) Then
                    gUnpackDate tmChf.iEndDate(0), tmChf.iEndDate(1), slDate
                    If gDateValue(smMonDefStartDate) <= gDateValue(slDate) Then
                        smSave(3) = smMonDefStartDate
                    Else
                        smSave(3) = smDefStartDate
                    End If
                End If
                '3/8/13
                'Default all remaining fields if not defined
                If smSave(4) = "" Then
                    If smSave(3) <> "" Then
                        smSave(4) = gObtainNextSunday(smSave(3))
                    Else
                        smSave(4) = gObtainNextSunday(smMonDefStartDate)
                    End If
                    gUnpackDate tmChf.iEndDate(0), tmChf.iEndDate(1), slDate
                    If gDateValue(slDate) < gDateValue(smSave(4)) Then
                        smSave(4) = slDate
                        gSetShow pbcRot, smSave(4), tmCtrls(ilBoxNo)
                        '5882 no longer needed
'                        If (Trim$(smSave(3)) <> "") And (Trim$(smSave(4)) <> "") Then
'                            mSetIDCDefaults
'                        End If
                    End If
                    tmCtrls(SDATEINDEX).iChg = True
                    imBoxNo = EDATEINDEX
                    edcDropDown.Text = smSave(4)
                    smSave(4) = ""
                    mSetShow EDATEINDEX
                    tmCtrls(EDATEINDEX).iChg = True
                    If Not imGameVehicle Then
                        If smSave(5) = "" Then  'default to midnight
                            imBoxNo = STIMEINDEX
                            edcDropDown.Text = "12M"
                            mSetShow STIMEINDEX
                            tmCtrls(STIMEINDEX).iChg = True
                        End If
                        If smSave(6) = "" Then  'default to midnight
                            imBoxNo = ETIMEINDEX
                            edcDropDown.Text = "12M"
                            mSetShow ETIMEINDEX
                            tmCtrls(ETIMEINDEX).iChg = True
                        End If
                        For ilDay = 0 To 6 Step 1
                            ilValidDay(ilDay) = False
                            imSave(2 + ilDay) = 0
                        Next ilDay
                        For llDate = gDateValue(smSave(3)) To gDateValue(smSave(4)) Step 1
                            ilDay = gWeekDayLong(llDate)
                            ilValidDay(ilDay) = True
                            imSave(2 + ilDay) = 1
                        Next llDate
                        For ilDay = 0 To 6 Step 1
                            mSetShow MONINDEX + ilDay
                            tmCtrls(MONINDEX + ilDay).iChg = True
                        Next ilDay
                        pbcRot.Cls
                        pbcRot_Paint
                    End If
                    If imSave(10) < 0 Then
                        imSave(10) = 0    'All avails
                        tmCtrls(AVAILINDEX).iChg = True
                        mSetShow AVAILINDEX
                    End If
                    imChgMode = True
                    lbcType.ListIndex = 0
                    imChgMode = False
                    mSetShow TYPEINDEX
                    tmCtrls(TYPEINDEX).iChg = True
                    imBoxNo = SDATEINDEX
                End If
            End If
            For ilLoop = LBound(imSvSave) To UBound(imSvSave) Step 1
                imSvSave(ilLoop) = -1
            Next ilLoop
            For llDate = gDateValue(smSave(3)) To gDateValue(smSave(4)) Step 1
                ilDay = gWeekDayLong(llDate)
                imSvSave(2 + ilDay) = imSave(2 + ilDay)
            Next llDate
            edcDropDown.Text = smSave(3)
            cmcDropDown.Move edcDropDown.Left + edcDropDown.Width, edcDropDown.Top
            plcCalendar.Move edcDropDown.Left, edcDropDown.Top + edcDropDown.height
            'If not defined, use contract start date, if in past use today + 1
            gObtainMonthYear imCalType, smSave(3), imCalMonth, imCalYear
            edcDropDown.SelStart = 0
            edcDropDown.SelLength = Len(edcDropDown.Text)
            edcDropDown.Visible = True
            cmcDropDown.Visible = True
            plcCalendar.Visible = True
            edcDropDown.SetFocus
        Case EDATEINDEX
            smSvRotEndDate = smSave(4)
            edcDropDown.Width = (5 * tmCtrls(EDATEINDEX).fBoxW) / 4
            edcDropDown.MaxLength = 10
            gMoveTableCtrl pbcRot, edcDropDown, tmCtrls(EDATEINDEX).fBoxX, tmCtrls(EDATEINDEX).fBoxY '- 30
            If smSave(4) = "" Then
                If smSave(3) <> "" Then
                    smSave(4) = gObtainNextSunday(smSave(3))
                Else
                    smSave(4) = gObtainNextSunday(smMonDefStartDate)
                End If
                gFindMatch smSave(1), 0, lbcCntr
                If gLastFound(lbcCntr) >= 0 Then
                    slNameCode = tmCopyCntrCode(gLastFound(lbcCntr)).sKey    'lbcCntrCode.List(gLastFound(lbcCntr))
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    If tmChf.lCode <> Val(slCode) Then
                        tmChfSrchKey.lCode = Val(slCode)
                        ilRet = btrGetEqual(hmCHF, tmChf, imCHFRecLen, tmChfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                    End If
                End If
                gUnpackDate tmChf.iEndDate(0), tmChf.iEndDate(1), slDate
                If gDateValue(slDate) < gDateValue(smSave(4)) Then
                    smSave(4) = slDate
                End If
                If smSave(3) <> "" Then
                    If gDateValue(smSave(4)) < gDateValue(smSave(3)) Then
                        smSave(4) = smSave(3)
                    End If
                End If
            End If
            For ilLoop = LBound(imSvSave) To UBound(imSvSave) Step 1
                imSvSave(ilLoop) = -1
            Next ilLoop
            For llDate = gDateValue(smSave(3)) To gDateValue(smSave(4)) Step 1
                ilDay = gWeekDayLong(llDate)
                imSvSave(2 + ilDay) = imSave(2 + ilDay)
            Next llDate
            edcDropDown.Text = smSave(4)
            cmcDropDown.Move edcDropDown.Left + edcDropDown.Width, edcDropDown.Top
            plcCalendar.Move edcDropDown.Left, edcDropDown.Top + edcDropDown.height
            gObtainMonthYear imCalType, smSave(4), imCalMonth, imCalYear
            edcDropDown.SelStart = 0
            edcDropDown.SelLength = Len(edcDropDown.Text)
            edcDropDown.Visible = True
            cmcDropDown.Visible = True
            plcCalendar.Visible = True
            edcDropDown.SetFocus
        Case STIMEINDEX
            imTimeDayBoxNo = -1
            If imGameVehicle Then
                gMoveTableCtrl pbcRot, pbcAirGame, tmCtrls(ilBoxNo).fBoxX, tmCtrls(ilBoxNo).fBoxY '- 30
                pbcAirGame.Visible = True
                imAGDirection = 0
                pbcAGSTab.SetFocus
            Else
                edcDropDown.Width = tmCtrls(ilBoxNo).fBoxW '- cmcDropDown.Width
                edcDropDown.MaxLength = 10
                gMoveTableCtrl pbcRot, edcDropDown, tmCtrls(ilBoxNo).fBoxX, tmCtrls(ilBoxNo).fBoxY '- 30
                cmcDropDown.Move edcDropDown.Left + edcDropDown.Width, edcDropDown.Top
                plcTme.Move edcDropDown.Left, edcDropDown.Top + edcDropDown.height
                If smSave(5) = "" Then  'default to midnight
                    smSave(5) = "12M"
                End If
                edcDropDown.Text = smSave(5)
                edcDropDown.Visible = True  'Set visibility
                cmcDropDown.Visible = True
                edcDropDown.SetFocus
            End If
        Case ETIMEINDEX
            imTimeDayBoxNo = -1
            If imGameVehicle Then
                pbcAirGame.Visible = True
            Else
                edcDropDown.Width = tmCtrls(ilBoxNo).fBoxW '- cmcDropDown.Width
                edcDropDown.MaxLength = 10
                gMoveTableCtrl pbcRot, edcDropDown, tmCtrls(ilBoxNo).fBoxX, tmCtrls(ilBoxNo).fBoxY '- 30
                cmcDropDown.Move edcDropDown.Left + edcDropDown.Width, edcDropDown.Top
                plcTme.Move edcDropDown.Left, edcDropDown.Top + edcDropDown.height
                If smSave(6) = "" Then  'default to midnight
                    smSave(6) = "12M"
                End If
                edcDropDown.Text = smSave(6)
                edcDropDown.Visible = True  'Set visibility
                cmcDropDown.Visible = True
                edcDropDown.SetFocus
            End If
        Case MONINDEX To SUNINDEX
            If imGameVehicle Then
                pbcAirGame.Visible = True
                imAGDirection = 1
                pbcAGTab.SetFocus
            Else
                If imSave(2 + ilBoxNo - MONINDEX) < 0 Then
                    'Test date span- if day included default to Yes
                    If (smSave(3) <> "") And (smSave(4) <> "") Then
                        If gValidDate(smSave(3)) And gValidDate(smSave(4)) Then
                            If gDateValue(smSave(3)) + 6 <= gDateValue(smSave(4)) Then
                                imSave(2 + ilBoxNo - MONINDEX) = 1    'Yes
                            Else
                                For ilLoop = 0 To 6 Step 1
                                    ilValidDay(ilLoop) = False
                                Next ilLoop
                                For llDate = gDateValue(smSave(3)) To gDateValue(smSave(4)) Step 1
                                    ilValidDay(gWeekDayLong(llDate)) = True
                                Next llDate
                                If ilValidDay(ilBoxNo - MONINDEX) Then
                                    imSave(2 + ilBoxNo - MONINDEX) = 1    'Yes
                                Else
                                    imSave(2 + ilBoxNo - MONINDEX) = 0    'No
                                End If
                            End If
                        Else
                            imSave(2 + ilBoxNo - MONINDEX) = 1    'Yes
                        End If
                    Else
                        imSave(2 + ilBoxNo - MONINDEX) = 1    'Yes
                    End If
                    tmCtrls(ilBoxNo).iChg = True
                    mSetCommands
                End If
                pbcDay.Width = tmCtrls(ilBoxNo).fBoxW
                gMoveTableCtrl pbcRot, pbcDay, tmCtrls(ilBoxNo).fBoxX, tmCtrls(ilBoxNo).fBoxY '- 30 ' (fgBoxGridH + 15)
                pbcDay_Paint
                pbcDay.Visible = True
                pbcDay.SetFocus
            End If
        Case AVAILINDEX
            If imSave(10) < 0 Then
                imSave(10) = 0    'All avails
                tmCtrls(AVAILINDEX).iChg = True
                mSetCommands
            End If
            pbcAvType.Width = tmCtrls(ilBoxNo).fBoxW
            gMoveTableCtrl pbcRot, pbcAvType, tmCtrls(ilBoxNo).fBoxX, tmCtrls(ilBoxNo).fBoxY '- 30 ' (fgBoxGridH + 15)
            pbcAvType_Paint
            pbcAvType.Visible = True
            pbcAvType.SetFocus
        Case AVAILINDEX + 1
            mAvailsPop
            If imTerminate Then
                Exit Sub
            End If
            lbcAvail.height = gListBoxHeight(lbcAvail.ListCount, 10)
            edcDropDown.Width = tmCtrls(ilBoxNo).fBoxW
            edcDropDown.MaxLength = 20
            gMoveTableCtrl pbcRot, edcDropDown, tmCtrls(ilBoxNo).fBoxX, tmCtrls(ilBoxNo).fBoxY '- 30 ' (fgBoxGridH + 15)
            cmcDropDown.Move edcDropDown.Left + edcDropDown.Width, edcDropDown.Top
            lbcAvail.Move cmcDropDown.Left + cmcDropDown.Width - lbcAvail.Width, edcDropDown.Top + edcDropDown.height
            imChgMode = True
            gFindMatch smSave(7), 0, lbcAvail
            If gLastFound(lbcAvail) >= 0 Then
                lbcAvail.ListIndex = gLastFound(lbcAvail)
                edcDropDown.Text = lbcAvail.List(lbcAvail.ListIndex)
            Else
                If lbcAvail.ListCount > 1 Then
                    lbcAvail.ListIndex = 1
                    edcDropDown.Text = lbcAvail.List(lbcAvail.ListIndex)
                Else
                    lbcAvail.ListIndex = -1
                    edcDropDown.Text = ""
                End If
            End If
            imChgMode = False
            edcDropDown.SelStart = 0
            edcDropDown.SelLength = Len(edcDropDown.Text)
            edcDropDown.Visible = True
            cmcDropDown.Visible = True
            edcDropDown.SetFocus
        Case TYPEINDEX
            lbcType.height = gListBoxHeight(lbcType.ListCount, 5)
            edcDropDown.Width = tmCtrls(TYPEINDEX).fBoxW + cmcDropDown.Width \ 2
            edcDropDown.MaxLength = 13
            gMoveTableCtrl pbcRot, edcDropDown, tmCtrls(TYPEINDEX).fBoxX, tmCtrls(TYPEINDEX).fBoxY '- 30 '(fgBoxGridH + 15)
            cmcDropDown.Move edcDropDown.Left + edcDropDown.Width, edcDropDown.Top
            'Vehicle default should be set in mSetDefInSave for all lines except first
            imChgMode = True
            If imSave(11) >= 0 Then
                lbcType.ListIndex = imSave(11)
            Else
                lbcType.ListIndex = 0
            End If
            imComboBoxIndex = lbcType.ListIndex
            If lbcType.ListIndex >= 0 Then
                edcDropDown.Text = lbcType.List(lbcType.ListIndex)
            Else
                edcDropDown.Text = ""
            End If
            imChgMode = False
            lbcType.Move cmcDropDown.Left + cmcDropDown.Width - lbcType.Width, edcDropDown.Top + edcDropDown.height
            edcDropDown.SelStart = 0
            edcDropDown.SelLength = Len(edcDropDown.Text)
            edcDropDown.Visible = True
            cmcDropDown.Visible = True
            edcDropDown.SetFocus
        Case SHTTITLEINDEX   'Short Title
            mShtTitlePop
            If imTerminate Then
                Exit Sub
            End If
            lbcShtTitle.height = gListBoxHeight(lbcShtTitle.ListCount, 14)
            edcDropDown.Width = tmCtrls(ilBoxNo).fBoxW + tmCtrls(TYPEINDEX).fBoxW + tmCtrls(AVAILINDEX).fBoxW \ 2 '- cmcDropDown.Width
            edcDropDown.MaxLength = 15    'tgSpf.iAProd
            gMoveTableCtrl pbcRot, edcDropDown, tmCtrls(AVAILINDEX).fBoxX + tmCtrls(AVAILINDEX).fBoxW \ 2, tmCtrls(ilBoxNo).fBoxY '- 30
            cmcDropDown.Move edcDropDown.Left + edcDropDown.Width, edcDropDown.Top
            lbcShtTitle.Move cmcDropDown.Left + cmcDropDown.Width - lbcShtTitle.Width, edcDropDown.Top + edcDropDown.height
            imChgMode = True
            gFindMatch smShtTitle, 1, lbcShtTitle
            If gLastFound(lbcShtTitle) >= 1 Then
                lbcShtTitle.ListIndex = gLastFound(lbcShtTitle)
                edcDropDown.Text = lbcShtTitle.List(lbcShtTitle.ListIndex)
            Else
                If smShtTitle <> "" Then
                    lbcShtTitle.ListIndex = -1
                    edcDropDown.Text = smShtTitle
                Else
                    lbcShtTitle.ListIndex = 0
                    edcDropDown.Text = lbcShtTitle.List(lbcShtTitle.ListIndex)
                End If
            End If
            imChgMode = False
            edcDropDown.SelStart = 0
            edcDropDown.SelLength = Len(edcDropDown.Text)
            edcDropDown.Visible = True
            cmcDropDown.Visible = True
            edcDropDown.SetFocus
        Case COMMENTINDEX
            'edcComment.Width = tmCtrls(ilBoxNo).fBoxW
            edcComment.MaxLength = 5000
            gMoveTableCtrl pbcRot, edcComment, tmCtrls(ilBoxNo).fBoxX + tmCtrls(ilBoxNo).fBoxW - edcComment.Width, tmCtrls(ilBoxNo).fBoxY '- 30
            cmcMoveComment.Move edcComment.Left, edcComment.Top + edcComment.height + 15
            imChgMode = True
            edcComment.Text = smComment
            imChgMode = False
            If Len(Trim$(edcHdLnComment.Text)) > 0 Then
                cmcMoveComment.Visible = True  'Set visibility
            End If
            edcComment.Visible = True
            edcComment.SetFocus
    End Select
    mSetChg ilBoxNo 'set change flag encase the setting of the value didn't cause a change event
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mEraseRot                       *
'*                                                     *
'*             Created:6/28/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Erase rotation and its         *
'*                      instructions                   *
'*                                                     *
'*******************************************************
Private Function mEraseRot(tlInCrf As CRF, llCrfRecPos As Long, ilRet As Integer) As Integer
    'Dim ilRet As Integer
    Dim ilCRet As Integer
    Dim llCnfRecPos As Long
    Dim ilFound As Integer
    Dim ilCif As Integer
    Dim tlCrf As CRF
    Dim tlCnf As CNF
    Dim tlCvf As CVF

    'Remove assign instruction from Sdf- similar code in mSaveRec when instruction terminated
    If Not mUnassignSpots(True, 0, 0, tlInCrf, ilRet) Then
        mEraseRot = False
        Exit Function
    End If
    '8/14/12: Speed-up setting of copy inventory rotation dates
    'ReDim Preserve tmSetInvRotDate(0 To 0) As SETINVROTDATE    'Delete instruction and update inventory rotation dates
    ReDim llCifCode(0 To 0) As Long
    Do
        tmCnfSrchKey.lCrfCode = tlInCrf.lCode
        tmCnfSrchKey.iInstrNo = 0
        ilRet = btrGetGreaterOrEqual(hmCnf, tlCnf, imCnfRecLen, tmCnfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
        If (ilRet <> BTRV_ERR_NONE) Or (tlCnf.lCrfCode <> tlInCrf.lCode) Then
            Exit Do
        End If
        'Set date for instruction
        If tlCnf.lCifCode > 0 Then
            ilFound = False
            For ilCif = 0 To UBound(llCifCode) - 1 Step 1
                If llCifCode(ilCif) = tlCnf.lCifCode Then
                    ilFound = True
                    Exit For
                End If
            Next ilCif
            If Not ilFound Then
                llCifCode(UBound(llCifCode)) = tlCnf.lCifCode
                ReDim Preserve llCifCode(0 To UBound(llCifCode) + 1) As Long
            End If
        End If
        ilRet = btrDelete(hmCnf)
    Loop
    imCvfRecLen = Len(tlCvf)
    Do
        tmCvfSrchKey1.lCode = tlInCrf.lCode
        ilRet = btrGetEqual(hmCvf, tlCvf, imCvfRecLen, tmCvfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORWRITE)  'Get first record as starting point of extend operation
        If (ilRet <> BTRV_ERR_NONE) Then
            Exit Do
        End If
        ilRet = btrDelete(hmCvf)
    Loop
    If (tlInCrf.lCsfCode <> 0) And (tgSpf.sGUseAffSys <> "Y") Then
        Do
            tmCsfSrchKey.lCode = tlInCrf.lCsfCode
            imCsfRecLen = Len(tmCsf) '5011
            ilRet = btrGetEqual(hmCsf, tmCsf, imCsfRecLen, tmCsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
            If ilRet <> BTRV_ERR_NONE Then
                mEraseRot = False
                Exit Function
            End If
            ilRet = btrDelete(hmCsf)
        Loop While ilRet = BTRV_ERR_CONFLICT
        If ilRet <> BTRV_ERR_NONE Then
            mEraseRot = False
            Exit Function
        End If
    End If
    '5882 no longer needed
'    'ttp 5329
'    'If ((Asc(tgSpf.sUsingFeatures9) And IDCRESTRICTION) = IDCRESTRICTION) Then
'    If bmIsIDC Then
'        If tlInCrf.lRafCode > 0 Then
'            tmIefSrchKey2.lCode = tlInCrf.lRafCode
'            ilRet = btrGetEqual(hmIef, tmIef, imIefRecLen, tmIefSrchKey2, INDEXKEY2, BTRV_LOCK_NONE, SETFORREADONLY)
'            Do While (ilRet = BTRV_ERR_NONE) And (tmIef.lSplitRafCode = tlInCrf.lRafCode)
'                If tmIef.lSplitCrfCode = tlInCrf.lCode Then
'                    If (tmIef.sExportStatus = "N") Or (tmIef.lTriggerID <= 0) Then
'                        ilRet = btrDelete(hmIef)
'                    Else
'                        tmIef.sExportStatus = "D"
'                        ilRet = btrUpdate(hmIef, tmIef, imIefRecLen)
'                    End If
'                    Exit Do
'                End If
'                ilRet = btrGetNext(hmIef, tmIef, imIefRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
'            Loop
'        End If
'    End If
    
    imCrfRecLen = Len(tlCrf)
    Do
        tmCrfSrchKey.lCode = tlInCrf.lCode
        ilRet = btrGetEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)  'Get first record as starting point of extend operation
        If (ilRet <> BTRV_ERR_NONE) Then
            Exit Do
        End If
        ilRet = btrDelete(hmCrf)
    Loop While ilRet = BTRV_ERR_CONFLICT
    '8/14/12: Speed-up setting of copy inventory rotation dates
    'If tlInCrf.iBkoutInstAdfCode <= 0 Then
    '    tmCrfSrchKey2.sRotType = tlInCrf.sRotType
    '    tmCrfSrchKey2.iAdfCode = tlInCrf.iAdfCode
    '    gPackDateLong lmNowDate, tmCrfSrchKey2.iEndDate(0), tmCrfSrchKey2.iEndDate(1)
    '    ilRet = btrGetGreaterOrEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey2, INDEXKEY2, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
    '    Do While (ilRet = BTRV_ERR_NONE) And (tlCrf.sRotType = tlInCrf.sRotType) And (tlCrf.iAdfCode = tlInCrf.iAdfCode)
    '        mDetermineInvDates tlCrf
    '        ilRet = btrGetNext(hmCrf, tlCrf, imCrfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    '    Loop
    '    tmCrfSrchKey3.sRotType = tlInCrf.sRotType
    '    tmCrfSrchKey3.iBkoutInstAdfCode = tlInCrf.iAdfCode
    '    gPackDateLong lmNowDate, tmCrfSrchKey3.iEndDate(0), tmCrfSrchKey3.iEndDate(1)
    '    ilRet = btrGetGreaterOrEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey3, INDEXKEY3, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
    '    Do While (ilRet = BTRV_ERR_NONE) And (tlCrf.sRotType = tlInCrf.sRotType) And (tlCrf.iBkoutInstAdfCode = tlInCrf.iAdfCode)
    '        mDetermineInvDates tlCrf
    '        ilRet = btrGetNext(hmCrf, tlCrf, imCrfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    '    Loop
    'Else
    '    tmCrfSrchKey2.sRotType = tlInCrf.sRotType
    '    tmCrfSrchKey2.iAdfCode = tlInCrf.iBkoutInstAdfCode
    '    gPackDateLong lmNowDate, tmCrfSrchKey2.iEndDate(0), tmCrfSrchKey2.iEndDate(1)
    '    ilRet = btrGetGreaterOrEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey2, INDEXKEY2, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
    '    Do While (ilRet = BTRV_ERR_NONE) And (tlCrf.sRotType = tlInCrf.sRotType) And (tlCrf.iAdfCode = tlInCrf.iBkoutInstAdfCode)
    '        mDetermineInvDates tlCrf
    '        ilRet = btrGetNext(hmCrf, tlCrf, imCrfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    '    Loop
    '    tmCrfSrchKey3.sRotType = tlInCrf.sRotType
    '    tmCrfSrchKey3.iBkoutInstAdfCode = tlInCrf.iBkoutInstAdfCode
    '    gPackDateLong lmNowDate, tmCrfSrchKey3.iEndDate(0), tmCrfSrchKey3.iEndDate(1)
    '    ilRet = btrGetGreaterOrEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey3, INDEXKEY3, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
    '    Do While (ilRet = BTRV_ERR_NONE) And (tlCrf.sRotType = tlInCrf.sRotType) And (tlCrf.iBkoutInstAdfCode = tlInCrf.iBkoutInstAdfCode)
    '        mDetermineInvDates tlCrf
    '        ilRet = btrGetNext(hmCrf, tlCrf, imCrfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    '    Loop
    'End If
    'mSetInvDates
    mAdjustCufAndCif "R", tlInCrf, llCifCode()
    mEraseRot = True
End Function
'*******************************************************
'*                                                     *
'*      Procedure Name:mInit                           *
'*                                                     *
'*             Created:9/02/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Initialize modular             *
'*                                                     *
'*******************************************************
Private Sub mInit()
'
'   mInit
'   Where:
'
    Dim ilRet As Integer
    Dim ilLoop As Integer
    Dim ilValue As Integer

    gSetMousePointer grdRot, grdRot, vbHourglass
    igJobShowing(COPYJOB) = True
    imInAllSaveRec = False
    imFirstActivate = True
    imRetailHourGlass = False
    imcTrash.Picture = IconTraf!imcTrashClosed.Picture
    'DoEvents
    mInitBox
    'Copy.Height = cmcReport.Top + 5 * cmcReport.Height / 3
    gCenterForm Copy
    Copy.Show
    gSetMousePointer grdRot, grdRot, vbHourglass
    sgCVehicleTag = ""
    'imcHelp.Picture = IconTraf!imcHelp.Picture
    imLBCDCtrls = 1
    imFirstFocus = True
    imTerminate = False         'terminate if true
    imBypassFocus = False       'don't bypass focus on any control
    imChgMode = False           'no change made
    imBSMode = False            'back space key
    imCalType = 0               'Standard type
    imBoxNo = -1                'Initialize current Box to N/A
    imTabDirection = 0          'Left to right movement
    imVehPopReq = True
    imStartMode = True
    imInvStatus = 0 'Active
    imSelectDelay = -1
    imFirstFocusType = True
    smSeveral = "[Several]"
    imAdvtIndex = -1
    imBlackoutIndex = -1
    imTypeIndex = -1
    imRotIndex = -1
    imVefCode = -1
    imGameVefCode = -1
    imVpfIndex = -1
    imGameVehicle = False
    imAGDirection = -1
    imDateChanged = False
    imAllVehAdj = 0
    imIgnoreRightMove = False
    tmVef.iCode = 0
    tmChf.lCode = 0
    imLbcArrowSetting = False
    imLastUsedRotNo = 0
    imDoubleClickName = False
    imDoubleClick = False
    imFromArrow = False
    imEdcChgMode = False
    imLastColSorted = -1
    imLastSort = -1
    imIgnoreScroll = False
    bmRGKeyPressed = False
    imCGIgnoreScroll = False
    imCurrentBlackoutAdfCode = -1
    bmInCmcGrid = False
    bmBypassGridSave = False
    bmExitCG = False
    ReDim tmCopyRotCode(0 To 0) As SORTCODE
    ReDim tmRegionCode(0 To 0) As SORTCODE
    ReDim tmCopyCntrCode(0 To 0) As SORTCODE
    If tgSpf.sUseCartNo <> "N" Then
        lmListField(1) = 15
        lmListField(2) = 5 * fmAdjFactorW * igAlignCharWidth 'igAvgCharWidth * 5
        lmListField(3) = 15 * fmAdjFactorW * igAlignCharWidth 'igAvgCharWidth * 12
        lmListField(4) = 34 * fmAdjFactorW * igAlignCharWidth 'igAvgCharWidth * 34
    Else
        'Only len and ISCI show- no ~ separate fields
        lmListField(1) = 15
        lmListField(2) = 60 * fmAdjFactorW * igAlignCharWidth 'igAvgCharWidth * 5
        lmListField(3) = 70 * fmAdjFactorW * igAlignCharWidth 'igAvgCharWidth * 12
        lmListField(4) = 80 * fmAdjFactorW * igAlignCharWidth 'igAvgCharWidth * 34
    End If
    lmListFieldRot(1) = 15      'Start of ontract
    lmListFieldRot(2) = fmAdjFactorW * 990 '1020    'Start Length
    lmListFieldRot(3) = fmAdjFactorW * 1320  '1365    'Start Live Copy
    lmListFieldRot(4) = fmAdjFactorW * 1620  '1575    'Start Vehicle
    lmListFieldRot(5) = fmAdjFactorW * 2775  'Start MG,Outside and Fill assign by
    lmListFieldRot(6) = fmAdjFactorW * 2985  'Start zone
    lmListFieldRot(7) = fmAdjFactorW * 3300 '3210  'Start of date
    lmListFieldRot(8) = fmAdjFactorW * 4770  'Start of Time
    lmListFieldRot(9) = fmAdjFactorW * 5985  'Start of Monday
    lmListFieldRot(10) = fmAdjFactorW * 6210  'Start of Tuesday
    lmListFieldRot(11) = fmAdjFactorW * 6440  'Start of Wednesday
    lmListFieldRot(12) = fmAdjFactorW * 6660 'Start of Thursday
    lmListFieldRot(13) = fmAdjFactorW * 6895 'Start of Friday
    lmListFieldRot(14) = fmAdjFactorW * 7125 'Start of Saturday
    lmListFieldRot(15) = fmAdjFactorW * 7350 'Start of Sunday
    lmListFieldRot(16) = fmAdjFactorW * 7575 'Start of Avail
    lmListFieldRot(17) = fmAdjFactorW * 8460 'Start of Type
    lmListFieldRot(18) = fmAdjFactorW * 8800 'Start of Comment
    lmListFieldRot(19) = fmAdjFactorW * 9000 'End If Comment
    For ilLoop = 0 To 16 Step 1
        lacRotInfo(ilLoop).Move 105, 210 * ilLoop + 90
    Next ilLoop
    ReDim tgActiveCode(0 To 0) As SORTCODE   'VB list box clear (list box used to retain code number so record can be found)
    ReDim tmPurgeCode(0 To 0) As SORTCODE   'VB list box clear (list box used to retain code number so record can be found)
    ReDim tmHistoryCode(0 To 0) As SORTCODE   'VB list box clear (list box used to retain code number so record can be found)
    imNoRowLbc = lbcInst.height \ fgListHtArial825
    smMonDefStartDate = Format$(gNow(), "m/d/yy")
    smDefStartDate = Format$(gDateValue(smMonDefStartDate) + 1, "m/d/yy")
    lmNowDate = gDateValue(smMonDefStartDate)
    smMonDefStartDate = gObtainNextMonday(smMonDefStartDate)
    smDefaultEndDate = gObtainNextSunday(smMonDefStartDate)
    imRotChg = False
    imcTrash.Visible = False
    imcTrash.Enabled = False
    imcTrash.Picture = IconTraf!imcTrashClosed.Picture
    hmCrf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmCrf, "", sgDBPath & "Crf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Crf.Btr)", Copy
    On Error GoTo 0
    imCrfRecLen = Len(tmCrf)
    hmCif = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmCif, "", sgDBPath & "Cif.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Cif.Btr)", Copy
    On Error GoTo 0
    imCifRecLen = Len(tmCif)
    hmCnf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmCnf, "", sgDBPath & "Cnf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Cnf.Btr)", Copy
    On Error GoTo 0
    imCnfRecLen = Len(tmCnf)
    hmMcf = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmMcf, "", sgDBPath & "Mcf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Mcf.Btr)", Copy
    On Error GoTo 0
    '5882 no longer needed
'    hmIef = CBtrvTable(TWOHANDLES)
'    ilRet = btrOpen(hmIef, "", sgDBPath & "Ief.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
'    On Error GoTo mInitErr
'    gBtrvErrorMsg ilRet, "mInit (btrOpen: Ief.Btr)", Copy
'    On Error GoTo 0
'    imIefRecLen = Len(tmIef)
    hmCsf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmCsf, "", sgDBPath & "Csf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Csf.Btr)", Copy
    On Error GoTo 0
    imCsfRecLen = Len(tmCsf)
    hmCyf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmCyf, "", sgDBPath & "Cyf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Cyf.Btr)", Copy
    On Error GoTo 0
    imCyfRecLen = Len(tmCyf)
    hmCuf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmCuf, "", sgDBPath & "Cuf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Cuf.Btr)", Copy
    On Error GoTo 0
    imCufRecLen = Len(tmCuf)
    hmCvf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmCvf, "", sgDBPath & "Cvf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Cvf.Btr)", Copy
    On Error GoTo 0
    imCvfRecLen = Len(tmCvf)
    hmGnf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmGnf, "", sgDBPath & "Gnf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Gnf.Btr)", Copy
    On Error GoTo 0
    imGnfRecLen = Len(tmGnf)
    hmGpf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmGpf, "", sgDBPath & "Gpf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Gpf.Btr)", Copy
    On Error GoTo 0
    imGpfRecLen = Len(tmGpf)
    hmGcf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmGcf, "", sgDBPath & "Gcf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Gcf.Btr)", Copy
    On Error GoTo 0
    imGcfRecLen = Len(tmGcf)
    hmGtf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmGtf, "", sgDBPath & "Gtf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Gtf.Btr)", Copy
    On Error GoTo 0
    imGtfRecLen = Len(tmGtf)
    hmVef = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmVef, "", sgDBPath & "Vef.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Vef.Btr)", Copy
    On Error GoTo 0
    imVefRecLen = Len(tmVef)
    hmSif = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmSif, "", sgDBPath & "Sif.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Sif.Btr)", Copy
    On Error GoTo 0
    imSifRecLen = Len(tmSif)
    hmCHF = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmCHF, "", sgDBPath & "Chf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Chf.Btr)", Copy
    On Error GoTo 0
    imCHFRecLen = Len(tmChf)
    hmClf = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmClf, "", sgDBPath & "Clf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Clf.Btr)", Copy
    On Error GoTo 0
    imClfRecLen = Len(tmClf)
    hmCxf = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmCxf, "", sgDBPath & "Cxf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Cxf.Btr)", Copy
    On Error GoTo 0
    imCxfRecLen = Len(tmCxf)
    hmVsf = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmVsf, "", sgDBPath & "Vsf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Vsf.Btr)", Copy
    On Error GoTo 0
    imVsfRecLen = Len(tmVsf)
    'If tgSpf.sGUseAffFeed = "Y" Then
    cbcBlackout.Enabled = False
    lacBlackout.Visible = False
    cbcBlackout.Visible = False
    ReDim tmSef(0 To 0) As SEF
    ilValue = Asc(tgSpf.sUsingFeatures2)  'Option Fields in Orders/Proposals
    If (((ilValue And REGIONALCOPY) = REGIONALCOPY) Or ((ilValue And SPLITCOPY) = SPLITCOPY)) Then
        If Not gRecLengthOk("Rsf.btr", Len(tmRsf)) Then
'            Screen.MousePointer = vbDefault
            imTerminate = True
'            Exit Sub
        End If

        hmRsf = CBtrvTable(TWOHANDLES)
        ilRet = btrOpen(hmRsf, "", sgDBPath & "Rsf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
        On Error GoTo mInitErr
        gBtrvErrorMsg ilRet, "mInit (btrOpen: Rsf.Btr)", Copy
        On Error GoTo 0
        imRsfRecLen = Len(tmRsf)
        hmRaf = CBtrvTable(ONEHANDLE)
        ilRet = btrOpen(hmRaf, "", sgDBPath & "Raf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
        On Error GoTo mInitErr
        gBtrvErrorMsg ilRet, "mInit (btrOpen: Raf.Btr)", Copy
        On Error GoTo 0
        imRafRecLen = Len(tmRaf)
        hmSef = CBtrvTable(ONEHANDLE)
        ilRet = btrOpen(hmSef, "", sgDBPath & "Sef.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
        On Error GoTo mInitErr
        gBtrvErrorMsg ilRet, "mInit (btrOpen: Sef.Btr)", Copy
        On Error GoTo 0
        imSefRecLen = Len(tmSef(0))
    End If
    hmCpf = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmCpf, "", sgDBPath & "Cpf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Cpf.Btr)", Copy
    On Error GoTo 0
    imCpfRecLen = Len(tmCpf)
    hmSdf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmSdf, "", sgDBPath & "Sdf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Sdf.Btr)", Copy
    On Error GoTo 0
    imSdfRecLen = Len(tmSdf)
    hmSmf = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmSmf, "", sgDBPath & "Smf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Smf.Btr)", Copy
    On Error GoTo 0
    imSmfRecLen = Len(tmSmf)
    hmTzf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmTzf, "", sgDBPath & "Tzf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Tzf.Btr)", Copy
    On Error GoTo 0
    imTzfRecLen = Len(tmTzf)
    hmSsf = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmSsf, "", sgDBPath & "Ssf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Ssf.Btr)", Copy
    On Error GoTo 0
    hmUrf = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmUrf, "", sgDBPath & "Urf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Urf.Btr)", Copy
    On Error GoTo 0
    imUrfRecLen = Len(tmUrf)
    hmMnf = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmMnf, "", sgDBPath & "Mnf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Mnf.Btr)", Copy
    On Error GoTo 0
    imMnfRecLen = Len(tmMnf)
    hmMtf = CBtrvTable(ONEHANDLE) 'CBtrvObj()
    ilRet = btrOpen(hmMtf, "", sgDBPath & "Mtf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    If ilRet = BTRV_ERR_NONE Then
        lgMtfNoRecs = btrRecords(hmMtf)
        btrDestroy hmMtf
    Else
        lgMtfNoRecs = 0
    End If
    hmCaf = CBtrvTable(TWOHANDLES)
    ilRet = btrOpen(hmCaf, "", sgDBPath & "Caf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Caf.Btr)", Copy
    On Error GoTo 0
    imCafRecLen = Len(tmCaf)
    
    hmLcf = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmLcf, "", sgDBPath & "Lcf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Lcf.Btr)", Copy
    On Error GoTo 0
    hmGhf = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmGhf, "", sgDBPath & "Ghf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Ghf.Btr)", Copy
    On Error GoTo 0
    hmGsf = CBtrvTable(ONEHANDLE)
    ilRet = btrOpen(hmGsf, "", sgDBPath & "Gsf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    On Error GoTo mInitErr
    gBtrvErrorMsg ilRet, "mInit (btrOpen: Gsf.Btr)", Copy
    On Error GoTo 0
    
    cbcType.AddItem "Spots"
    If tgSpf.sUsingBBs = "Y" Then
        If ((Asc(tgSpf.sUsingFeatures6) And BBCLOSEST) = BBCLOSEST) Then
            cbcType.AddItem "BB", 1
        Else
            cbcType.AddItem "Open BB", 1
            cbcType.AddItem "Close BB", 2
        End If
    End If
    'cbcType.AddItem "PSA"
    'cbcType.AddItem "Promo"
    'Fill cbcType in with event types
    If tgSpf.sUseCartNo = "N" Then
        plcShow.Visible = False
        'cmcPurge.Enabled = False
    End If
    'mInvPop
    'If imTerminate Then
    '    Exit Sub
    'End If
    mAdvtPop
    If imTerminate Then
        Exit Sub
    End If
    mAvailsPop
    If imTerminate Then
        Exit Sub
    End If
    smMMnfStamp = ""
    ilRet = gObtainMnfForType("H", smMMnfStamp, tmMMnf())
    ilRet = gObtainVef()
    'mVehPop     'incase right click on inventory have tgCVehicle defined
    'If imTerminate Then
    '    Exit Sub
    'End If
    mTeamPop
    If imTerminate Then
        Exit Sub
    End If
    
    lbcMGCopyAssign.AddItem "MG & Outside Assigned by: Original Vehicle"
    lbcMGCopyAssign.AddItem "MG & Outside Assigned by: Scheduled Vehicle"
    lbcMGCopyAssign.AddItem "MG & Outside Assigned by: Scheduled Vehicle or Original Vehicle"
    ilValue = Asc(tgSpf.sMOFCopyAssign)  'Option Fields in Orders/Proposals
    If (ilValue And MGRULESINCOPY) <> MGRULESINCOPY Then 'Define MG rules within Copy
        If (ilValue And MGSCHVEHONLY) = MGSCHVEHONLY Then
            ckcIncludeMG.Value = vbChecked
        End If
    End If
    mPopFormats
    mPopDMAMarkets
    mPopMSAMarkets
    mPopStates
    mPopTimeZones
    mPopCategory
    
    lbcZones.Clear
    'lbcZones.AddItem "[All]"
    'lbcZones.AddItem "EST"
    'lbcZones.AddItem "CST"
    'lbcZones.AddItem "MST"
    'lbcZones.AddItem "PST"
    lbcType.AddItem "Contract Spot"
    'lbcType.AddItem "Open BB"
    'lbcType.AddItem "Close BB"
    'lbcType.AddItem "Any BB"
'    mInitBox
    'Copy.Height = cmcReport.Top + 5 * cmcReport.Height / 3
    'gCenterForm Copy
    'lbcRot.Top = plcRot.Top + 30
    'lbcRot.ZOrder vbSendToBack
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    'lbcRot.AddItem "field1|Field2|3|Field4|Field5|6|7|8|9|A|B|C|120|Avail|C|T"
    plcScreen_Paint
    plcInv_Paint
    plcShow_Paint
    plcInst_Paint
    gSetCtrlReadOnly edcHdLnComment
    '5882 no longer needed
'    'ttp 5329
'    If gChrRefExist(Me, "     ", "att.mkd", "attIDCReceiverId", True) Then
'        bmIsIDC = True
'    End If
    gSetMousePointer grdRot, grdRot, vbDefault
    Exit Sub
mInitErr:
    On Error GoTo 0
    imTerminate = True
    Exit Sub
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mInitBox                        *
'*                                                     *
'*             Created:7/19/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Set mouse and control locations*
'*                                                     *
'*******************************************************
Private Sub mInitBox()
'
'   mInitBox
'   Where:
'
    Dim flTextHeight As Single  'Standard text height
    Dim ilLoop As Integer
    Dim ilValue As Integer
    Dim ilSpaceBetweenButtons As Integer
    Dim llMax As Long

    flTextHeight = pbcRot.TextHeight("1") - 35
    'Position panel and picture areas with panel
    plcRot.Move 30, 525, pbcRot.Width + fgPanelAdj, pbcRot.height + fgPanelAdj
    pbcRot.Move plcRot.Left + fgBevelX, plcRot.Top + fgBevelY
    cmcRot.Move pbcRot.Left + pbcRot.Width - cmcRot.Width - 15, pbcRot.Top + 30
    lbcRot.Move plcRot.Left, pbcRot.Top + pbcRot.height
    pbcLbcRot.Move lbcRot.Left, lbcRot.Top
    edcHdLnComment.Move plcRot.Left, 1170
    lacBlackout.Move 60, 1980
    cbcBlackout.Move 930, 2010
    plcShow.Move 360, 2335
    plcInv.Move 300, 2565
    plcInst.Move 5250, 2340 'plcInv.Top
    plcFL.Top = plcInst.Top + lbcInst.Top
    cmcFLUp.Top = plcFL.Top - cmcFLUp.height + 15
    cmcFLDn.Top = plcFL.Top + plcFL.height + 60
    plcFL.height = cmcFLDn.Top - cmcFLUp.Top - cmcFLDn.height
    pbcFL.Move plcFL.Left + 15, plcFL.Top + 30
    imcInst(0).Top = plcInst.Top - imcInst(0).height
    imcInst(1).Top = plcInst.Top + plcInst.height
    'cmcRatio.Move plcInst.Left + plcInst.Width - cmcRatio.Width - fgBevelX, plcInst.Top + fgBevelY
    'cmcClear.Move cmcRatio.Left - cmcClear.Width - 15, plcInst.Top + fgBevelY
    pbcKey.Move plcRot.Left, plcRot.Top
    'Contract number
    gSetCtrl tmCtrls(CNTRINDEX), 30, 255, 870, fgBoxGridH
    'Length
    gSetCtrl tmCtrls(LENINDEX), 915, tmCtrls(CNTRINDEX).fBoxY, 315, fgBoxGridH
    'Live
    gSetCtrl tmCtrls(LIVECOPYINDEX), 1245, tmCtrls(CNTRINDEX).fBoxY, 255, fgBoxGridH
    If ((Asc(tgSpf.sUsingFeatures) And LIVECOPY) <> LIVECOPY) And ((Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) <> PROMOCOPY) Then 'Using Live Copy
        tmCtrls(LIVECOPYINDEX).iReq = False
    End If
    'Vehicle
    gSetCtrl tmCtrls(VEHICLEINDEX), 1515, tmCtrls(CNTRINDEX).fBoxY, 1185, fgBoxGridH
    'MG
    gSetCtrl tmCtrls(MGASSIGNINDEX), 2715, tmCtrls(CNTRINDEX).fBoxY, 180, fgBoxGridH
    'Remove MG Column: Temporary set to false to avoid checking if answered- remove if going to use column
    ilValue = Asc(tgSpf.sMOFCopyAssign)  'Option Fields in Orders/Proposals
    If (ilValue And MGRULESINCOPY) <> MGRULESINCOPY Then 'Define MG rules within Copy
        tmCtrls(MGASSIGNINDEX).iReq = False
    End If
    'Zone
    'gSetCtrl tmCtrls(ZONEINDEX), 2910, tmCtrls(CNTRINDEX).fBoxY, 180, fgBoxGridH
    gSetCtrl tmCtrls(ZONEINDEX), 2910, tmCtrls(CNTRINDEX).fBoxY, 360, fgBoxGridH
    'Start date
    'gSetCtrl tmCtrls(SDATEINDEX), 3105, tmCtrls(CNTRINDEX).fBoxY, 780, fgBoxGridH
    gSetCtrl tmCtrls(SDATEINDEX), 3285, tmCtrls(CNTRINDEX).fBoxY, 690, fgBoxGridH
    'End Date
    'gSetCtrl tmCtrls(EDATEINDEX), 3900, tmCtrls(CNTRINDEX).fBoxY, 780, fgBoxGridH
    gSetCtrl tmCtrls(EDATEINDEX), 3990, tmCtrls(CNTRINDEX).fBoxY, 690, fgBoxGridH
    'Start time
    gSetCtrl tmCtrls(STIMEINDEX), 4695, tmCtrls(CNTRINDEX).fBoxY, 600, fgBoxGridH
    'End time
    gSetCtrl tmCtrls(ETIMEINDEX), 5295, tmCtrls(CNTRINDEX).fBoxY, 600, fgBoxGridH
    'Monady
    gSetCtrl tmCtrls(MONINDEX), 5910, tmCtrls(CNTRINDEX).fBoxY, 210, fgBoxGridH
    For ilLoop = 1 To 6 Step 1
        gSetCtrl tmCtrls(MONINDEX + ilLoop), tmCtrls(MONINDEX + ilLoop - 1).fBoxX + tmCtrls(MONINDEX).fBoxW + 15, tmCtrls(CNTRINDEX).fBoxY, 210, fgBoxGridH
    Next ilLoop
    'Avail
    gSetCtrl tmCtrls(AVAILINDEX), 7485, tmCtrls(CNTRINDEX).fBoxY, 885, fgBoxGridH
    'Avail
    gSetCtrl tmCtrls(AVAILINDEX + 1), 7485, tmCtrls(CNTRINDEX).fBoxY, 885, fgBoxGridH

    tmCtrls(AVAILINDEX + 1).iReq = False
    'If tgSpf.sUseProdSptScr = "P" Then
    '    'Type
    '    gSetCtrl tmCtrls(TYPEINDEX), 8190, tmCtrls(CNTRINDEX).fBoxY, 345, fgBoxGridH
    '    'Short Title
    '    gSetCtrl tmCtrls(SHTTITLEINDEX), 8550, tmCtrls(CNTRINDEX).fBoxY, 180, fgBoxGridH
    '    tmCtrls(SHTTITLEINDEX).iReq = False
    'Else
        'Type
        gSetCtrl tmCtrls(TYPEINDEX), 8385, tmCtrls(CNTRINDEX).fBoxY, 345, fgBoxGridH
        'Short Title
        gSetCtrl tmCtrls(SHTTITLEINDEX), -100, -100, 0, fgBoxGridH
        tmCtrls(SHTTITLEINDEX).iReq = False
    'End If
    'Comment
    gSetCtrl tmCtrls(COMMENTINDEX), 8745, tmCtrls(CNTRINDEX).fBoxY, 180, fgBoxGridH
    tmCtrls(COMMENTINDEX).iReq = False

    'Calendar
    For ilLoop = 1 To 7 Step 1
        gSetCtrl tmCDCtrls(ilLoop), 30 + 255 * (ilLoop - 1), 225, 240, fgBoxGridH
    Next ilLoop

    llMax = 0
    For ilLoop = imLBCtrls To UBound(tmCtrls) Step 1
        tmCtrls(ilLoop).fBoxW = CLng(fmAdjFactorW * tmCtrls(ilLoop).fBoxW)
        Do While (tmCtrls(ilLoop).fBoxW Mod 15) <> 0
            tmCtrls(ilLoop).fBoxW = tmCtrls(ilLoop).fBoxW + 1
        Loop
        If ilLoop > imLBCtrls Then
            tmCtrls(ilLoop).fBoxX = CLng(fmAdjFactorW * tmCtrls(ilLoop).fBoxX)
        End If
        Do While (tmCtrls(ilLoop).fBoxX Mod 15) <> 0
            tmCtrls(ilLoop).fBoxX = tmCtrls(ilLoop).fBoxX + 1
        Loop
        If ilLoop > imLBCtrls Then
            'Bypass negative box area like short title
            If tmCtrls(ilLoop).fBoxX > 90 Then
                If ilLoop <> AVAILINDEX + 1 Then
                    Do
                        If tmCtrls(ilLoop - 1).fBoxX > 0 Then
                            If tmCtrls(ilLoop - 1).fBoxX + tmCtrls(ilLoop - 1).fBoxW + 15 < tmCtrls(ilLoop).fBoxX Then
                                tmCtrls(ilLoop - 1).fBoxW = tmCtrls(ilLoop - 1).fBoxW + 15
                            ElseIf tmCtrls(ilLoop - 1).fBoxX + tmCtrls(ilLoop - 1).fBoxW + 15 > tmCtrls(ilLoop).fBoxX Then
                                tmCtrls(ilLoop - 1).fBoxW = tmCtrls(ilLoop - 1).fBoxW - 15
                            Else
                                Exit Do
                            End If
                        Else
                            If tmCtrls(ilLoop - 2).fBoxX + tmCtrls(ilLoop - 2).fBoxW + 15 < tmCtrls(ilLoop).fBoxX Then
                                tmCtrls(ilLoop - 2).fBoxW = tmCtrls(ilLoop - 2).fBoxW + 15
                            ElseIf tmCtrls(ilLoop - 2).fBoxX + tmCtrls(ilLoop - 2).fBoxW + 15 > tmCtrls(ilLoop).fBoxX Then
                                tmCtrls(ilLoop - 2).fBoxW = tmCtrls(ilLoop - 2).fBoxW - 15
                            Else
                                Exit Do
                            End If
                        End If
                    Loop
                End If
            End If
        End If
        If tmCtrls(ilLoop).fBoxX + tmCtrls(ilLoop).fBoxW + 15 > llMax Then
            llMax = tmCtrls(ilLoop).fBoxX + tmCtrls(ilLoop).fBoxW + 15
        End If
    Next ilLoop
    pbcRot.Picture = LoadPicture("")
    pbcRot.Width = llMax
    plcRot.Width = pbcRot.Width + 2 * fgBevelX + cmcRot.Width
    pbcRot.Left = plcRot.Left + fgBevelX
    cmcRot.Top = plcRot.Top + fgBevelY + 15
    cmcRot.Left = plcRot.Left + plcRot.Width - cmcRot.Width - fgBevelX
    lbcRot.Width = plcRot.Width
    pbcLbcRot.Width = lbcRot.Width - igScrollBarWidth - 15
    edcHdLnComment.Width = plcRot.Width
    Copy.Width = plcRot.Width + 210
    plcCopy.Width = fmAdjFactorW * plcCopy.Width
    Do While plcCopy.Width Mod 15 <> 0
        plcCopy.Width = plcCopy.Width + 1
    Loop
    cbcAdvt.Width = fmAdjFactorW * cbcAdvt.Width
    Do While cbcAdvt.Width Mod 15 <> 0
        cbcAdvt.Width = cbcAdvt.Width + 1
    Loop
    cbcAdvt.Left = plcCopy.Width - cbcAdvt.Width - fgBevelX
    plcInv.Width = fmAdjFactorW * plcInv.Width
    lbcInv.Width = plcInv.Width - 3 * fgBevelX
    lbcInv.Left = fgBevelX
    pbcLbcInv.Width = lbcInv.Width - igScrollBarWidth - 15
    pbcLbcInv.Left = lbcInv.Left + 15
    plcInst.Width = fmAdjFactorW * plcInst.Width
    lbcInst.Width = plcInst.Width - 3 * fgBevelX
    lbcInst.Left = fgBevelX
    pbcLbcInst.Width = lbcInst.Width - igScrollBarWidth - 15
    pbcLbcInst.Left = lbcInst.Left + 15
    plcInst.Left = Copy.Width - plcInv.Left - plcInst.Width
    cmcMoveTo.Left = plcInv.Left + plcInv.Width + (plcInst.Left - plcInv.Left - plcInv.Width) / 2 - cmcMoveTo.Width / 2
    pbcDnMove.Left = cmcMoveTo.Left + cmcMoveTo.Width - pbcDnMove.Width - fgBevelX
    cmcMoveFrom.Left = cmcMoveTo.Left
    pbcUpMove.Left = cmcMoveTo.Left + fgBevelX
    cmcFLUp.Left = cmcMoveTo.Left + cmcMoveTo.Width + 60
    cmcFLDn.Left = cmcFLUp.Left
    plcFL.Left = cmcFLUp.Left + cmcFLUp.Width / 2 - plcFL.Width / 2
    pbcFL.Left = plcFL.Left
    imcInst(0).Left = plcInst.Left
    imcInst(0).Width = plcInst.Width
    imcInst(1).Left = plcInst.Left
    imcInst(1).Width = plcInst.Width
    ilSpaceBetweenButtons = fmAdjFactorW * (cmcCancel.Left - (cmcDone.Left + cmcDone.Width))
    Do While ilSpaceBetweenButtons Mod 15 <> 0
        ilSpaceBetweenButtons = ilSpaceBetweenButtons + 1
    Loop
    cmcDone.Left = (Copy.Width - 11 * (cmcDone.Width + ilSpaceBetweenButtons) + ilSpaceBetweenButtons) / 2
    cmcDone.Top = Copy.height - cmcDone.height - 120
    cmcCancel.Move cmcDone.Left + cmcDone.Width + ilSpaceBetweenButtons, cmcDone.Top
    cmcUpdate.Move cmcCancel.Left + cmcCancel.Width + ilSpaceBetweenButtons, cmcDone.Top
    cmcErase.Move cmcUpdate.Left + cmcUpdate.Width + ilSpaceBetweenButtons, cmcDone.Top
    cmcPurge.Move cmcErase.Left + cmcErase.Width + ilSpaceBetweenButtons, cmcDone.Top
    cmcAsgn.Move cmcPurge.Left + cmcPurge.Width + ilSpaceBetweenButtons, cmcDone.Top
    cmcUndo.Move cmcAsgn.Left + cmcAsgn.Width + ilSpaceBetweenButtons, cmcDone.Top
    cmcNewInv.Move cmcUndo.Left + cmcUndo.Width + ilSpaceBetweenButtons, cmcDone.Top
    cmcInvNo.Move cmcNewInv.Left + cmcNewInv.Width + ilSpaceBetweenButtons, cmcDone.Top
    cmcRegion.Move cmcInvNo.Left + cmcInvNo.Width + ilSpaceBetweenButtons, cmcDone.Top
    cmcPool.Move cmcRegion.Left + cmcRegion.Width + ilSpaceBetweenButtons, cmcDone.Top

    plcInv.height = cmcDone.Top - plcInv.Top - 120  '- cmcFLDn.Height - 120
    lbcInv.height = plcInv.height - cmcInv.height - 2 * fgBevelY
    pbcLbcInv.height = lbcInv.height - 30
    plcInv.height = lbcInv.height + cmcInv.height + 2 * fgBevelY
    plcInst.height = plcInv.height
    lbcInst.height = lbcInv.height
    pbcLbcInst.height = pbcLbcInv.height
    plcFL.height = lbcInv.height
    cmcFLDn.Top = plcFL.Top + plcFL.height
    lacBlackout.Left = plcInv.Left
    cbcBlackout.Width = plcInv.Width - lacBlackout.Width
    cbcBlackout.Left = lacBlackout.Left + lacBlackout.Width
    imcTrash.Top = cmcDone.Top + cmcDone.height - imcTrash.height
    imcTrash.Left = Copy.Width - (3 * imcTrash.Width) / 2
    imcInst(1).Top = plcInst.Top + plcInst.height
    
    frcTimeDay.Move 165, 495
    frcGameNo.Move frcTimeDay.Left, frcTimeDay.Top
    frcTeam.Move frcTimeDay.Left, frcTimeDay.Top

    grdRot.Move plcInv.Left, lacBlackout.Top, plcInst.Left + plcInst.Width - plcInv.Left, cmcDone.Top - lacBlackout.Top - fgFlexGridRowH
    cmcGrid.Move plcCopy.Left + plcCopy.Width + 120, plcCopy.Top
    mRGColumnWidths
    mRGColumnTitles
    mRGLayout
    'gGrid_IntegralHeight grdRot, fgBoxGridH + 15
    gGrid_IntegralHeight grdRot, CInt(fgFlexGridRowH) 'fgBoxGridH + 15
    gGrid_FillWithRows grdRot, CInt(fgFlexGridRowH)    'fgBoxGridH + 15
    
    mRGLayout
    gGrid_IntegralHeight grdRot, CInt(fgFlexGridRowH) 'fgBoxGridH + 15
    
    grdRot.height = grdRot.height + 30
    pbcRGSTab.Left = -pbcRGSTab.Width
    pbcRGTab.Left = -pbcRGTab.Width
    pbcCGSTab.Left = -pbcCGSTab.Width
    pbcCGTab.Left = -pbcCGTab.Width
    pbcSetFocus.Left = -pbcSetFocus.Width

    grdCopy.height = grdRot.height / 2
    mCGColumnWidths
    mCGColumnTitles
    mCGLayout
    'gGrid_IntegralHeight grdRot, fgBoxGridH + 15
    gGrid_IntegralHeight grdCopy, CInt(fgFlexGridRowH) 'fgBoxGridH + 15
    gGrid_FillWithRows grdCopy, CInt(fgFlexGridRowH)    'fgBoxGridH + 15
    
    mCGLayout
    gGrid_IntegralHeight grdCopy, CInt(fgFlexGridRowH) 'fgBoxGridH + 15
    
    grdCopy.height = grdCopy.height + 30
    imCGRows = grdCopy.rows

    'gSetPictureBoxFontSize Copy
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mInitShow                       *
'*                                                     *
'*             Created:5/14/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Format user input for a control*
'*                      to be displayed on the form    *
'*                                                     *
'*******************************************************
Private Sub mInitShow()
    Dim ilBoxNo As Integer
    Dim slStr As String
    Dim ilLoop As Integer
    Dim ilCvf As Integer
    Dim ilCheck As Integer
    Dim slNameCode As String
    Dim slName As String
    Dim slCode As String
    Dim ilRet As Integer
    Dim slRotVefName As String

    For ilBoxNo = imLBCtrls To UBound(tmCtrls) Step 1
        Select Case ilBoxNo
            Case CNTRINDEX
                gSetShow pbcRot, smSave(1), tmCtrls(ilBoxNo)
                imChgMode = True
                gFindMatch smSave(1), 0, lbcCntr
                If gLastFound(lbcCntr) >= 0 Then
                    lbcCntr.ListIndex = gLastFound(lbcCntr)
                End If
                imChgMode = False
            Case LENINDEX
                If imSave(9) < 0 Then
                    slStr = ""
                Else
                    slStr = lbcLen.List(imSave(9))
                End If
                gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
                imChgMode = True
                If imSave(9) >= 0 Then
                    lbcLen.ListIndex = imSave(9)
                End If
                imChgMode = False
            Case LIVECOPYINDEX
                Select Case imSave(12)
                    Case 0
                        slStr = "LC"
                    Case 1
                        slStr = "RC"
                    Case 2
                        slStr = "LP"
                    Case 3
                        slStr = "RP"
                    Case 4
                        slStr = "PC"
                    Case 5
                        slStr = "PP"
                    Case Else
                        slStr = ""
                End Select
                gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
            Case VEHICLEINDEX 'Vehicle
                gSetShow pbcRot, smSave(2), tmCtrls(ilBoxNo)
                imChgMode = True
                For ilLoop = 0 To lbcVehicle.ListCount - 1 Step 1
                    lbcVehicle.Selected(ilLoop) = False
                Next ilLoop
                
                ''gFindMatch smSave(2), 0, lbcVehicle
                ''If gLastFound(lbcVehicle) >= 0 Then
                ''    lbcVehicle.ListIndex = gLastFound(lbcVehicle)
                ''    lbcVehicle.Selected(lbcVehicle.ListIndex) = True
                ''End If
                'For ilCvf = 0 To UBound(imCrfVefCode) - 1 Step 1
                '    For ilLoop = 0 To lbcVehicle.ListCount - 1 Step 1
                '        ilRet = gParseItem(Trim(lbcVehicle.List(ilLoop)), 1, "/", slRotVefName)
                '        For ilCheck = 0 To UBound(tgCVehicle) - 1 Step 1
                '            slNameCode = tgCVehicle(ilCheck).sKey
                '            ilRet = gParseItem(slNameCode, 1, "\", slName)
                '            ilRet = gParseItem(slName, 3, "|", slName)
                '            ilRet = gParseItem(slNameCode, 2, "\", slCode)
                '            If slRotVefName = slName Then
                '                lbcVehicle.Selected(ilLoop) = True
                '                Exit For
                '            End If
                '        Next ilCheck
                '    Next ilLoop
                'Next ilCvf
                mSelectRotVehicles
                mSetIfGameVehicle
                imChgMode = False
            Case MGASSIGNINDEX
                Select Case imSave(13)
                    Case 0
                        slStr = "O"
                    Case 1
                        slStr = "S"
                    Case 2
                        slStr = "B"
                    Case Else
                        slStr = ""
                End Select
                If (imSave(13) >= 0) And (imSave(13) <= 2) Then
                    lbcMGCopyAssign.ListIndex = imSave(13)
                End If
                gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
            Case ZONEINDEX
                If imSave(1) < 0 Then
                    slStr = ""
                ElseIf imSave(1) = 0 Then
                    slStr = "Generic"
                Else
                    slStr = lbcZones.List(imSave(1))
                End If
                gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
                imChgMode = True
                If imSave(1) >= 0 Then
                    lbcZones.ListIndex = imSave(1)
                Else
                    lbcZones.ListIndex = 0
                End If
                mSetRGCtrl
                imChgMode = False
            Case SDATEINDEX
                gSetShow pbcRot, smSave(3), tmCtrls(ilBoxNo)
            Case EDATEINDEX
                gSetShow pbcRot, smSave(4), tmCtrls(ilBoxNo)
            Case STIMEINDEX
                gSetShow pbcRot, smSave(5), tmCtrls(ilBoxNo)
            Case ETIMEINDEX
                gSetShow pbcRot, smSave(6), tmCtrls(ilBoxNo)
            Case MONINDEX To SUNINDEX
                Select Case imSave(2 + ilBoxNo - MONINDEX)
                    Case 0  'No
                        slStr = "N"
                    Case 1  'Yes
                        slStr = "Y"
                    Case Else
                        slStr = ""
                End Select
                gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
            Case AVAILINDEX
                Select Case imSave(10)
                    Case 0  'All avails
                        slStr = "All avails"
                    Case 1  'Book into selected avail
                        slStr = smSave(7)
                    Case 2  'Exclused selected avail
                        slStr = "" & smSave(7)    'Alt+0216 or 0248
                    Case Else
                        slStr = ""
                End Select
                gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
                tmCtrls(ilBoxNo + 1).sShow = tmCtrls(ilBoxNo).sShow
                If imSave(10) > 0 Then
                    gFindMatch smSave(7), 0, lbcAvail
                    If gLastFound(lbcAvail) >= 0 Then
                        lbcAvail.ListIndex = gLastFound(lbcAvail)
                    End If
                    imChgMode = False
                End If
            'Case AVAILINDEX + 1
            '    Select Case imSave(10)
            '        Case 0  'All avails
            '            slStr = "All avails"
            '        Case 1  'Book into selected avail
            '            slStr = smSave(7)
            '        Case 2  'Exclused selected avail
            '            slStr = "" & smSave(7)    'alt + 0216 or 0248
            '        Case Else
            '            slStr = ""
            '    End Select
            '    gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
            Case TYPEINDEX
                If imSave(11) < 0 Then
                    slStr = ""
                Else
                    Select Case imTypeIndex 'imSave(11)
                        Case 0
                            slStr = "C S"
                        Case 1
                            If ((Asc(tgSpf.sUsingFeatures6) And BBCLOSEST) = BBCLOSEST) Then
                                slStr = "BB"
                            Else
                                slStr = "OBB"
                            End If
                        Case 2
                            slStr = "CBB"
                        Case 3
                            slStr = "ABB"
                    End Select
                    'slStr = lbcType.List(imSave(11))
                End If
                gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
                imChgMode = True
                If imSave(11) >= 0 Then
                    lbcType.ListIndex = imSave(11)
                End If
                imChgMode = False
            Case SHTTITLEINDEX   'Short Title
                'If tgSpf.sUseProdSptScr = "P" Then
                '    If (Trim$(smShtTitle) = "") Or (Trim$(smShtTitle) = "[None]") Then
                '        slStr = " "
                '    Else
                '        slStr = "Y"
                '    End If
                'Else
                    slStr = " "
                'End If
                gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
            Case COMMENTINDEX
                If smComment <> "" Then
                    slStr = "C"
                Else
                    slStr = ""
                End If
                gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
        End Select
    Next ilBoxNo
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mInvPop                        *
'*                                                     *
'*             Created:2/28/94       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Populate the selection Name    *
'*                      box                            *
'*                                                     *
'*******************************************************
Private Sub mInvPop()
'******************************************************************************************
'* Note: VBC id'd the following unreferenced items and handled them as described:         *
'*                                                                                        *
'* Local Variables (Removed)                                                              *
'*  ilValue                                                                               *
'******************************************************************************************

    'ilPopIndex=-1; All, 0=Active; 1=Purge; 2=History
    Dim ilRet As Integer
    Dim ilAdvtCode As Integer
    Dim ilISCIProd As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim ilExpand As Integer
    Dim slLive As String
    Dim ilLength As Integer
    Dim ilVefCode As Integer
    Dim llRotStartDate As Long
    Dim llRotEndDate As Long
    Dim slCntrNo As String
    Dim llCntrNo As Long
    Dim ilInputInvType As Integer

'3/1/06:  Show all copy if length not specified
'    If imSave(12) < 0 Then
'        lbcInv.Clear
'        If imAdvtIndex >= 0 Then
'            If tgSpf.sUseCartNo <> "B" Then
'                lbcInv.AddItem "[New]", 0
'            Else
'                lbcInv.AddItem "[New-ISCI]", 0
'                lbcInv.AddItem "[New-Cart]", 0
'            End If
'        End If
'        pbcLbcInv_Paint
'        Exit Sub
'    End If
'    If imSave(9) < 0 Then
'        lbcInv.Clear
'        If imAdvtIndex >= 0 Then
'            If tgSpf.sUseCartNo <> "B" Then
'                lbcInv.AddItem "[New]", 0
'            Else
'                lbcInv.AddItem "[New-ISCI]", 0
'                lbcInv.AddItem "[New-CART]", 0
'            End If
'        End If
'        pbcLbcInv_Paint
'        Exit Sub
'    End If
    '5/10/13: Add Contract filter
    slCntrNo = ""
    llCntrNo = -1
    If (Asc(tgSpf.sUsingFeatures10) And VCREATIVEEXPORT) = VCREATIVEEXPORT Then
        gFindMatch smSave(1), 0, lbcCntr
        If gLastFound(lbcCntr) >= 0 Then
            slNameCode = tmCopyCntrCode(gLastFound(lbcCntr)).sKey    'lbcCntrCode.List(gLastFound(lbcCntr))
            ilRet = gParseItem(slNameCode, 1, "|", slCntrNo)
            llCntrNo = 99999999 - Val(slCntrNo)
        End If
    End If
    '3/1/06:  Show all copy if length not defined
    If imSave(9) < 0 Then
        ilLength = -1
    Else
        ilLength = Val(lbcLen.List(imSave(9)))
    End If
    If tgSpf.sUseCartNo <> "N" Then
        If rbcShow(0).Value Then
            ilISCIProd = 1
        Else
            ilISCIProd = 3
        End If
    Else
        ilISCIProd = 4
    End If
    ilISCIProd = ilISCIProd Or &H100    '&H100=Include Length
    If imBlackoutAdfCode = POOLROTATION Then
        imCurrentAdvtIndex = -1
        mInvPopPool ilISCIProd
        Exit Sub
    End If
    If imAdvtIndex < 0 Then
        If imInvStatus = 0 Then
            If lbcInv.ListCount <= 0 Then
                If tgSpf.sUseCartNo <> "B" Then
                    lbcInv.AddItem "[New]", 0
                Else
                    lbcInv.AddItem "[New-ISCI]", 0
                    lbcInv.AddItem "[New-CART]", 0
                End If
            End If
        Else
        End If
        pbcLbcInv_Paint
        Exit Sub
    End If
    slLive = ""
    'If ckcIncludeMG.Value = vbUnchecked Then
        If ((Asc(tgSpf.sUsingFeatures) And LIVECOPY) = LIVECOPY) Or ((Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) = PROMOCOPY) Then 'Using Live Copy
            '3/1/06: Show Live and Recorded if option not de4fined
            If imSave(12) >= 0 Then
                If imSave(12) = 0 Then
                    slLive = "L"
                ElseIf imSave(12) = 2 Then
                    slLive = "L"
                ElseIf imSave(12) = 3 Then
                    slLive = "R"
                ElseIf imSave(12) = 4 Then
                    slLive = "R"
                ElseIf imSave(12) = 5 Then
                    slLive = "R"
                Else
                    slLive = "R"
                End If
            End If
        End If
    'End If
    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    ilAdvtCode = Val(slCode)
    If imBlackoutAdfCode > 0 Then
        ilAdvtCode = imBlackoutAdfCode
        llRotStartDate = gDateValue(smSave(3))
        llRotEndDate = gDateValue(smSave(4))
    Else
        llRotStartDate = 0
        llRotEndDate = 0
    End If

    ilVefCode = -1
    If (Asc(tgSpf.sUsingFeatures3) And MEDIACODEBYVEH) = MEDIACODEBYVEH Then
        If (Trim$(smSave(2)) <> smSeveral) And (Trim$(smSave(2)) <> "") Then
            If lbcVehicle.ListCount > 0 Then
                gFindMatch smSave(2), 0, lbcVehicle
                If gLastFound(lbcVehicle) >= 0 Then
                    slNameCode = tgCVehicle(gLastFound(lbcVehicle) - imAllVehAdj).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    ilVefCode = Val(slCode)
                End If
            End If
        End If
    End If
    'ilRet = gPopCopyForAdvtBox(Copy, ilAdvtCode, ilISCIProd, 0, lbcActive, lbcActiveCode)
    If imTypeIndex = 0 Then
        'ilRet = gPopCopyForAdvtBoxWithTest(Copy, ilAdvtCode, ilVefCode, ilLength, slLive, ilISCIProd, 0, lbcActive, tgActiveCode(), smActiveCodeTag, llRotStartDate, llRotEndDate, True, llCntrNo)
        ilInputInvType = 0
    Else
        'ilRet = gPopCopyForAdvtBoxWithTest(Copy, ilAdvtCode, ilVefCode, ilLength, slLive, ilISCIProd, &H200, lbcActive, tgActiveCode(), smActiveCodeTag, llRotStartDate, llRotEndDate, True, llCntrNo)
        ilInputInvType = &H200
    End If
    '10/7/19: The rot date are set when copy is assigned even if to a blackout so this is not required
    'If imBlackoutAdfCode > 0 Then
    '    ilInputInvType = ilInputInvType + &H800
    'End If
    ilRet = gPopCopyForAdvtBoxWithTest(Copy, ilAdvtCode, ilVefCode, ilLength, slLive, ilISCIProd, ilInputInvType, lbcActive, tgActiveCode(), smActiveCodeTag, llRotStartDate, llRotEndDate, True, llCntrNo)
    If ilRet <> CP_MSG_NOPOPREQ Then
        On Error GoTo mInvPopErr
        gCPErrorMsg ilRet, "mInvPop (gPopCopyForAdvtBoxWithTest: Copy)", Copy
        On Error GoTo 0
        If tgSpf.sUseCartNo <> "B" Then
            lbcActive.AddItem "[New]", 0
        Else
            lbcActive.AddItem "[New-ISCI]", 0
            lbcActive.AddItem "[New-Cart]", 0
        End If
    End If
    ''ilRet = gPopCopyForAdvtBox(Copy, ilAdvtCode, ilISCIProd, 4, lbcPurge, lbcPurgeCode)
    'If imTypeIndex = 0 Then
    '    ilRet = gPopCopyForAdvtBoxWithTest(Copy, ilAdvtCode, ilVefCode, ilLength, slLive, ilISCIProd, 4, lbcPurge, tmPurgeCode(), smPurgeCodeTag, 0, 0, False, llCntrNo)
    'Else
    '    ilRet = gPopCopyForAdvtBoxWithTest(Copy, ilAdvtCode, ilVefCode, ilLength, slLive, ilISCIProd, 4 + &H200, lbcPurge, tmPurgeCode(), smPurgeCodeTag, 0, 0, False, llCntrNo)
    'End If
    ilRet = gPopCopyForAdvtBoxWithTest(Copy, ilAdvtCode, ilVefCode, ilLength, slLive, ilISCIProd, 4 + ilInputInvType, lbcPurge, tmPurgeCode(), smPurgeCodeTag, 0, 0, False, llCntrNo)
    If ilRet <> CP_MSG_NOPOPREQ Then
        On Error GoTo mInvPopErr
        gCPErrorMsg ilRet, "mInvPop (gPopCopyForAdvtBoxWithTest: Copy)", Copy
        On Error GoTo 0
        'lbcPurge.AddItem "[New]", 0
    End If
    ''ilRet = gPopCopyForAdvtBox(Copy, ilAdvtCode, ilISCIProd, 5, lbcHistory, lbcHistoryCode)
    'If imTypeIndex = 0 Then
    '    ilRet = gPopCopyForAdvtBoxWithTest(Copy, ilAdvtCode, ilVefCode, ilLength, slLive, ilISCIProd, 5, lbcHistory, tmHistoryCode(), smHistoryCodeTag, 0, 0, False, llCntrNo)
    'Else
    '    ilRet = gPopCopyForAdvtBoxWithTest(Copy, ilAdvtCode, ilVefCode, ilLength, slLive, ilISCIProd, 5 + &H200, lbcHistory, tmHistoryCode(), smHistoryCodeTag, 0, 0, False, llCntrNo)
    'End If
    ilRet = gPopCopyForAdvtBoxWithTest(Copy, ilAdvtCode, ilVefCode, ilLength, slLive, ilISCIProd, 5 + ilInputInvType, lbcHistory, tmHistoryCode(), smHistoryCodeTag, 0, 0, False, llCntrNo)
    If ilRet <> CP_MSG_NOPOPREQ Then
        On Error GoTo mInvPopErr
        gCPErrorMsg ilRet, "mInvPop (gPopCopyForAdvtBoxWithTest: Copy)", Copy
        On Error GoTo 0
        'lbcHistory.AddItem "[New]", 0
    End If
    'Replace Blank delimiter with "~"
    If tgSpf.sUseCartNo <> "N" Then
'        For ilLoop = 0 To UBound(tgActiveCode) - 1 Step 1 'lbcActiveCode.ListCount - 1 Step 1
'            slNameCode = tgActiveCode(ilLoop).sKey  'lbcActiveCode.List(ilLoop)
'            ilRet = gParseItem(slNameCode, 2, "\", slCode)
'            tmCifSrchKey.lCode = Val(slCode)
'            ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
'            If ilRet <> BTRV_ERR_NONE Then
'                tmCif.iMcfCode = -1
'            End If
'            ilFirstPos = InStr(slNameCode, " ")
'            ilLastPos = 0
'            If tmCif.iMcfCode <> 0 Then
'                ilPos = ilFirstPos + 1
'                ilPos = InStr(ilPos, slNameCode, " ")
'                If rbcShow(0).Value Then
'                    ilLastPos = ilPos
'                Else
'                    Do While ilPos > 0
'                        ilLastPos = ilPos
'                        ilPos = ilPos + 1
'                        ilPos = InStr(ilPos, slNameCode, " ")
'                    Loop
'                End If
'            End If
'            If ilFirstPos > 0 Then
'                Mid$(slNameCode, ilFirstPos, 1) = "~"
'            End If
'            If ilLastPos > 0 Then
'                Mid$(slNameCode, ilLastPos, 1) = "~"
'            End If
'            'lbcActiveCode.List(ilLoop) = slNameCode
'            tgActiveCode(ilLoop).sKey = slNameCode
'        Next ilLoop
'        For ilLoop = 0 To lbcActive.ListCount - 1 Step 1
'            If ilLoop <> 0 Then
'                slNameCode = tgActiveCode(ilLoop - 1).sKey 'lbcActiveCode.List(ilLoop)
'                ilRet = gParseItem(slNameCode, 2, "\", slCode)
'                tmCifSrchKey.lCode = Val(slCode)
'                ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
'                If ilRet <> BTRV_ERR_NONE Then
'                    tmCif.iMcfCode = -1
'                End If
'            End If
'            slName = lbcActive.List(ilLoop)
'            ilFirstPos = InStr(slName, " ")
'            ilLastPos = 0
'            If tmCif.iMcfCode <> 0 Then
'                ilPos = ilFirstPos + 1
'                ilPos = InStr(ilPos, slName, " ")
'                If rbcShow(0).Value Then
'                    ilLastPos = ilPos
'                Else
'                    Do While ilPos > 0
'                        ilLastPos = ilPos
'                        ilPos = ilPos + 1
'                        ilPos = InStr(ilPos, slName, " ")
'                    Loop
'                End If
'            End If
'            If ilFirstPos > 0 Then
'                Mid$(slName, ilFirstPos, 1) = "~"
'            End If
'            If ilLastPos > 0 Then
'                Mid$(slName, ilLastPos, 1) = "~"
'            End If
'            lbcActive.List(ilLoop) = slName
'        Next ilLoop
'        For ilLoop = 0 To UBound(tmPurgeCode) - 1 Step 1  'lbcPurgeCode.ListCount - 1 Step 1
'            slNameCode = tmPurgeCode(ilLoop).sKey    'lbcPurgeCode.List(ilLoop)
'            ilFirstPos = InStr(slNameCode, " ")
'            ilLastPos = 0
'            ilPos = ilFirstPos + 1
'            ilPos = InStr(ilPos, slNameCode, " ")
'            If rbcShow(0).Value Then
'                ilLastPos = ilPos
'            Else
'                Do While ilPos > 0
'                    ilLastPos = ilPos
'                    ilPos = ilPos + 1
'                    ilPos = InStr(ilPos, slNameCode, " ")
'                Loop
'            End If
'            If ilFirstPos > 0 Then
'                Mid$(slNameCode, ilFirstPos, 1) = "~"
'            End If
'            If ilLastPos > 0 Then
'                Mid$(slNameCode, ilLastPos, 1) = "~"
'            End If
'            'lbcPurgeCode.List(ilLoop) = slNameCode
'            tmPurgeCode(ilLoop).sKey = slNameCode
'        Next ilLoop
'        For ilLoop = 0 To lbcPurge.ListCount - 1 Step 1
'            slName = lbcPurge.List(ilLoop)
'            ilFirstPos = InStr(slName, " ")
'            ilLastPos = 0
'            ilPos = ilFirstPos + 1
'            ilPos = InStr(ilPos, slName, " ")
'            If rbcShow(0).Value Then
'                ilLastPos = ilPos
'            Else
'                Do While ilPos > 0
'                    ilLastPos = ilPos
'                    ilPos = ilPos + 1
'                    ilPos = InStr(ilPos, slName, " ")
'                Loop
'            End If
'            If ilFirstPos > 0 Then
'                Mid$(slName, ilFirstPos, 1) = "~"
'            End If
'            If ilLastPos > 0 Then
'                Mid$(slName, ilLastPos, 1) = "~"
'            End If
'            lbcPurge.List(ilLoop) = slName
'        Next ilLoop
'        For ilLoop = 0 To UBound(tmHistoryCode) - 1 Step 1  'lbcHistoryCode.ListCount - 1 Step 1
'            slNameCode = tmHistoryCode(ilLoop).sKey    'lbcHistoryCode.List(ilLoop)
'            ilFirstPos = InStr(slNameCode, " ")
'            ilLastPos = 0
'            ilPos = ilFirstPos + 1
'            ilPos = InStr(ilPos, slNameCode, " ")
'            If rbcShow(0).Value Then
'                ilLastPos = ilPos
'            Else
'                Do While ilPos > 0
'                    ilLastPos = ilPos
'                    ilPos = ilPos + 1
'                    ilPos = InStr(ilPos, slNameCode, " ")
'                Loop
'            End If
'            If ilFirstPos > 0 Then
'                Mid$(slNameCode, ilFirstPos, 1) = "~"
'            End If
'            If ilLastPos > 0 Then
'                Mid$(slNameCode, ilLastPos, 1) = "~"
'            End If
'            'lbcHistoryCode.List(ilLoop) = slNameCode
'            tmHistoryCode(ilLoop).sKey = slNameCode
'        Next ilLoop
'        For ilLoop = 0 To lbcHistory.ListCount - 1 Step 1
'            slName = lbcHistory.List(ilLoop)
'            ilFirstPos = InStr(slName, " ")
'            ilLastPos = 0
'            ilPos = ilFirstPos + 1
'            ilPos = InStr(ilPos, slName, " ")
'            If rbcShow(0).Value Then
'                ilLastPos = ilPos
'            Else
'                Do While ilPos > 0
'                    ilLastPos = ilPos
'                    ilPos = ilPos + 1
'                    ilPos = InStr(ilPos, slName, " ")
'                Loop
'            End If
'            If ilFirstPos > 0 Then
'                Mid$(slName, ilFirstPos, 1) = "~"
'            End If
'            If ilLastPos > 0 Then
'                Mid$(slName, ilLastPos, 1) = "~"
'            End If
'            lbcHistory.List(ilLoop) = slName
'        Next ilLoop
        If tgSpf.sUseCartNo <> "B" Then
            mReplaceSpaces lbcActive, tgActiveCode, 1
        Else
            mReplaceSpaces lbcActive, tgActiveCode, 2
        End If
        mReplaceSpaces lbcPurge, tmPurgeCode, 0
        mReplaceSpaces lbcHistory, tmHistoryCode, 0
    End If
    lbcExpandActive.Clear
    For ilExpand = 0 To lbcActive.ListCount - 1 Step 1
        lbcExpandActive.AddItem lbcActive.List(ilExpand)
    Next ilExpand
    lbcExpandPurge.Clear
    For ilExpand = 0 To lbcPurge.ListCount - 1 Step 1
        lbcExpandPurge.AddItem lbcPurge.List(ilExpand)
    Next ilExpand
    lbcExpandHistory.Clear
    For ilExpand = 0 To lbcHistory.ListCount - 1 Step 1
        lbcExpandHistory.AddItem lbcHistory.List(ilExpand)
    Next ilExpand
    If imBlackoutAdfCode > 0 Then
        imCurrentBlackoutAdfCode = imBlackoutAdfCode
        imCurrentAdvtIndex = -1
    Else
        imCurrentBlackoutAdfCode = -1
        imCurrentAdvtIndex = imAdvtIndex
    End If
    mResetInvPop
    Exit Sub
mInvPopErr:
    On Error GoTo 0
    imTerminate = True
    Exit Sub
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mLenPop                         *
'*                                                     *
'*             Created:7/21/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Populate the selection length  *
'*                      box                            *
'*                                                     *
'*******************************************************
Private Sub mLenPop()
'******************************************************************************************
'* Note: VBC id'd the following unreferenced items and handled them as described:         *
'*                                                                                        *
'* Local Variables (Removed)                                                              *
'*  ilLoop                        ilIndex                       ilTest                    *
'*  ilFound                       ilAddLen                                                *
'******************************************************************************************

    Dim slLen As String
    Dim slStr As String
    Dim ilClf As Integer

    If imSave(9) >= 0 Then
        If imSave(9) < lbcLen.ListCount Then
            slLen = lbcLen.List(imSave(9))
        Else
            slLen = ""
        End If
    Else
        slLen = ""
    End If
'    If (imVefCode < 0) Or (imVpfIndex < 0) Then
'        'Use length from Spf
'        For ilIndex = LBound(tgVpf) To UBound(tgVpf) - 1 Step 1
'            For ilLoop = LBound(tgVpf(ilIndex).iSLen) To UBound(tgVpf(ilIndex).iSLen) Step 1
'                If tgVpf(ilIndex).iSLen(ilLoop) <> 0 Then
'                    slStr = Trim$(Str$(tgVpf(ilIndex).iSLen(ilLoop)))
'                    ilFound = False
'                    For ilTest = 0 To lbcLen.ListCount - 1 Step 1
'                        If slStr = lbcLen.List(ilTest) Then
'                            ilFound = True
'                            Exit For
'                        End If
'                    Next ilTest
'                    If (imTypeIndex = 1) Or (imTypeIndex = 2) Then
'                        If tgVpf(ilIndex).iSLen(ilLoop) >= 30 Then
'                            ilFound = True
'                        End If
'                    End If
'                    If Not ilFound Then
'                        lbcLen.AddItem slStr
'                    End If
'                End If
'            Next ilLoop
'        Next ilIndex
'    Else
'        lbcLen.Clear
'        For ilLoop = LBound(tgVpf(imVpfIndex).iSLen) To UBound(tgVpf(imVpfIndex).iSLen) Step 1
'            If tgVpf(imVpfIndex).iSLen(ilLoop) <> 0 Then
'                If (imTypeIndex = 0) Or ((imTypeIndex = 1) And (tgVpf(imVpfIndex).iSLen(ilLoop) < 30)) Or ((imTypeIndex = 2) And (tgVpf(imVpfIndex).iSLen(ilLoop) < 30)) Then
'                    lbcLen.AddItem Trim$(Str$(tgVpf(imVpfIndex).iSLen(ilLoop)))
'                End If
'            End If
'        Next ilLoop
'    End If
    lbcLen.Clear
    If tmChf.lCode > 0 Then
        For ilClf = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
            'TTP: 1473
            slStr = ""
            If imTypeIndex = 0 Then
                slStr = Trim$(str$(tgClfCopy(ilClf).ClfRec.iLen))
            ElseIf (imTypeIndex = 1) And (tgClfCopy(ilClf).ClfRec.iBBOpenLen > 0) Then
                slStr = Trim$(str$(tgClfCopy(ilClf).ClfRec.iBBOpenLen))
            ElseIf (imTypeIndex = 2) And (tgClfCopy(ilClf).ClfRec.iBBCloseLen > 0) Then
                slStr = Trim$(str$(tgClfCopy(ilClf).ClfRec.iBBCloseLen))
            End If
            If slStr <> "" Then
                gFindMatch slStr, 0, lbcLen    'Determine if name exist
                If gLastFound(lbcLen) < 0 Then   'Name Not found
                    lbcLen.AddItem slStr
                End If
            End If
        Next ilClf
    End If
    If slLen <> "" Then
        imChgMode = True
        gFindMatch slLen, 0, lbcLen
        If gLastFound(lbcLen) >= 0 Then
            lbcLen.ListIndex = gLastFound(lbcLen)
            imSave(9) = lbcLen.ListIndex    'gLastFound(lbcLen)
        Else
            lbcLen.ListIndex = -1
            imSave(9) = -1
        End If
        imChgMode = False
    End If
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mMoveCtrlToRec                  *
'*                                                     *
'*             Created:5/01/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Move control values to record  *
'*                                                     *
'*******************************************************
Private Sub mMoveCtrlToRec(ilTestChg As Integer)
'
'   mMoveCtrlToRec iTest
'   Where:
'       iTest (I)- True = only move if field changed
'                  False = move regardless of change state
'
    Dim ilLoop As Integer
    Dim ilRet As Integer    'Return call status
    Dim slCode As String    'code number
    Dim slNameCode As String
    Dim slStr As String
    Dim slName As String
    Dim ilValue As Integer

    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    tmCrf.iAdfCode = Val(slCode)   '
    'Only allowed answer at this time is zero for EnfCode and EtfCode
    tmCrf.iEnfCode = 0
    tmCrf.iEtfCode = 0
    '9/8/05:  Set FsfCode to zero until we code for Network feed spots copy definition
    tmCrf.lFsfCode = 0

    If Not ilTestChg Or tmCtrls(CNTRINDEX).iChg Then
        gFindMatch smSave(1), 0, lbcCntr
        If gLastFound(lbcCntr) >= 0 Then
            slNameCode = tmCopyCntrCode(gLastFound(lbcCntr)).sKey    'lbcCntrCode.List(gLastFound(lbcCntr))
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            tmCrf.lChfCode = Val(slCode)
        Else
            tmCrf.lChfCode = 0
        End If
    End If
    'Length
    If Not ilTestChg Or tmCtrls(LENINDEX).iChg Then
        If imSave(9) < 0 Then
            tmCrf.iLen = 0
        Else
            tmCrf.iLen = lbcLen.List(imSave(9))
        End If
    End If
    'Live Copy
    If ((Asc(tgSpf.sUsingFeatures) And LIVECOPY) = LIVECOPY) Or ((Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) = PROMOCOPY) Then 'Using Live Copy
        If Not ilTestChg Or tmCtrls(LIVECOPYINDEX).iChg Then
            If imSave(12) < 0 Then
                tmCrf.sLiveCopy = "R"
            Else
                If imSave(12) = 0 Then
                    tmCrf.sLiveCopy = "L"
                ElseIf imSave(12) = 2 Then
                    tmCrf.sLiveCopy = "M"
                ElseIf imSave(12) = 3 Then
                    tmCrf.sLiveCopy = "S"
                ElseIf imSave(12) = 4 Then
                    tmCrf.sLiveCopy = "P"
                ElseIf imSave(12) = 5 Then
                    tmCrf.sLiveCopy = "Q"
                Else
                    tmCrf.sLiveCopy = "R"
                End If
            End If
        End If
    Else
        tmCrf.sLiveCopy = "R"
    End If
    If (tmCrf.sLiveCopy <> "R") And (tmCrf.sLiveCopy <> "L") And (tmCrf.sLiveCopy <> "M") And (tmCrf.sLiveCopy <> "S") And (tmCrf.sLiveCopy <> "P") And (tmCrf.sLiveCopy <> "Q") Then
        tmCrf.sLiveCopy = "R"
    End If
    If Not ilTestChg Or tmCtrls(VEHICLEINDEX).iChg Then
        gFindMatch smSave(2), 0, lbcVehicle
        If gLastFound(lbcVehicle) >= 0 Then
            slNameCode = tgCVehicle(gLastFound(lbcVehicle) - imAllVehAdj).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            tmCrf.iVefCode = Val(slCode)
        Else
            tmCrf.iVefCode = 0
        End If
    End If
    ilValue = Asc(tgSpf.sMOFCopyAssign)  'Option Fields in Orders/Proposals
    If (ilValue And MGRULESINCOPY) = MGRULESINCOPY Then 'Define MG rules within Copy
        If Not ilTestChg Or tmCtrls(MGASSIGNINDEX).iChg Then
            'MG assigned by
            If imSave(13) = 0 Then
                tmCrf.sMGCopyAssign = "O"
            ElseIf imSave(13) = 1 Then
                tmCrf.sMGCopyAssign = "S"
            Else
                tmCrf.sMGCopyAssign = "B"
            End If
        End If
    Else
        tmCrf.sMGCopyAssign = ""
    End If
    If Not ilTestChg Or tmCtrls(ZONEINDEX).iChg Then
        'If imSave(1) = 0 Then
        If lbcZones.List(imSave(1)) = "[Generic]" Then
            tmCrf.sZone = ""
            tmCrf.lRafCode = 0
        Else
            tmCrf.sZone = lbcZones.List(imSave(1))
            tmCrf.lRafCode = 0
            slStr = lbcZones.List(imSave(1))
            For ilLoop = LBound(tmRegionCode) To UBound(tmRegionCode) - 1 Step 1
                slNameCode = tmRegionCode(ilLoop).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
                ilRet = gParseItem(slNameCode, 1, "\", slName)
                If StrComp(slStr, slName, 1) = 0 Then
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    tmCrf.lRafCode = Val(slCode)
                    tmCrf.sZone = "R"
                    Exit For
                End If
            Next ilLoop
        End If
    End If
    'Dates
    If Not ilTestChg Or tmCtrls(SDATEINDEX).iChg Then
        gPackDate smSave(3), tmCrf.iStartDate(0), tmCrf.iStartDate(1)
    End If
    If Not ilTestChg Or tmCtrls(EDATEINDEX).iChg Then
        gPackDate smSave(4), tmCrf.iEndDate(0), tmCrf.iEndDate(1)
    End If
    tmCrf.sAirGameType = "D"
    If imGameVehicle Then
        If rbcAirTimeCopyBy(1).Value Then  'Game
            tmCrf.sAirGameType = "G"
            gPackTime "12M", tmCrf.iStartTime(0), tmCrf.iStartTime(1)
            gPackTime "12M", tmCrf.iEndTime(0), tmCrf.iEndTime(1)
            For ilLoop = 0 To 6 Step 1
                tmCrf.sDay(ilLoop) = "Y"
            Next ilLoop
        ElseIf rbcAirTimeCopyBy(2).Value Then   'Team
            tmCrf.sAirGameType = "T"
            gPackTime "12M", tmCrf.iStartTime(0), tmCrf.iStartTime(1)
            gPackTime "12M", tmCrf.iEndTime(0), tmCrf.iEndTime(1)
            For ilLoop = 0 To 6 Step 1
                tmCrf.sDay(ilLoop) = "Y"
            Next ilLoop
        Else
            gPackTime edcTimeDay(0).Text, tmCrf.iStartTime(0), tmCrf.iStartTime(1)
            gPackTime edcTimeDay(1).Text, tmCrf.iEndTime(0), tmCrf.iEndTime(1)
            For ilLoop = 0 To 6 Step 1
                If ckcTimeDay(ilLoop).Value = vbChecked Then
                    tmCrf.sDay(ilLoop) = "Y"
                Else
                    tmCrf.sDay(ilLoop) = "N"
                End If
            Next ilLoop
        End If
    Else
        'Time
        If Not ilTestChg Or tmCtrls(STIMEINDEX).iChg Then
            gPackTime smSave(5), tmCrf.iStartTime(0), tmCrf.iStartTime(1)
        End If
        If Not ilTestChg Or tmCtrls(ETIMEINDEX).iChg Then
            gPackTime smSave(6), tmCrf.iEndTime(0), tmCrf.iEndTime(1)
        End If
        'Days
        For ilLoop = 0 To 6 Step 1
            If Not ilTestChg Or tmCtrls(MONINDEX + ilLoop).iChg Then
                If imSave(2 + ilLoop) = 1 Then
                    tmCrf.sDay(ilLoop) = "Y"
                Else
                    tmCrf.sDay(ilLoop) = "N"
                End If
            End If
        Next ilLoop
    End If
    If Not ilTestChg Or tmCtrls(AVAILINDEX).iChg Then
        If imSave(10) = 1 Then
            tmCrf.sInOut = "I"
        ElseIf imSave(10) = 2 Then
            tmCrf.sInOut = "O"
        Else
            tmCrf.sInOut = "N"
        End If
    End If
    If Not ilTestChg Or tmCtrls(AVAILINDEX + 1).iChg Or tmCtrls(AVAILINDEX).iChg Then
        If tmCrf.sInOut = "N" Then
            tmCrf.ianfCode = 0
        Else
            gFindMatch smSave(7), 0, lbcAvail
            If gLastFound(lbcAvail) >= 0 Then
                slNameCode = tmAvailCode(gLastFound(lbcAvail) - 1).sKey  'lbcAvailCode.List(gLastFound(lbcAvail) - 1)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                tmCrf.ianfCode = Val(slCode)
            Else
                tmCrf.ianfCode = 0
            End If
        End If
    End If
    'Type
    'If Not ilTestChg Or tmCtrls(TYPEINDEX).iChg Then
        Select Case imTypeIndex 'imSave(11)
            Case 0
                tmCrf.sRotType = "A"
            Case 1
                tmCrf.sRotType = "O"
            Case 2
                tmCrf.sRotType = "C"
        End Select
    'End If
    'If tgSpf.sUseProdSptScr = "P" Then
    '    If Not ilTestChg Or tmCtrls(SHTTITLEINDEX).iChg Then
    '        If smShtTitle = "[None]" Then
    '            smShtTitle = ""
    '        End If
    '    End If
    'Else
        smShtTitle = ""
    'End If
    If Not ilTestChg Or tmCtrls(COMMENTINDEX).iChg Then
        'tmCsf.iStrLen = Len(smComment)
        tmCsf.iAdfCode = tmCrf.iAdfCode
        tmCsf.sType = "R"
        tmCsf.sComment = Trim$(smComment) & Chr$(0) '& Chr$(0) 'sgTB
    End If
    tmCrf.iBkoutInstAdfCode = 0
    'If cbcBlackout.ListIndex > 0 Then
    If (cbcBlackout.Visible) And (imBlackoutIndex > 0) Then
        tmCrf.iBkoutInstAdfCode = imBlackoutAdfCode
    ElseIf (cbcBlackout.Visible) And (imBlackoutIndex = 0) And (imBlackoutAdfCode = POOLROTATION) Then
        tmCrf.iBkoutInstAdfCode = imBlackoutAdfCode
    End If
    Exit Sub

    On Error GoTo 0
    imTerminate = True
    Exit Sub
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mMoveRecToCtrl                  *
'*                                                     *
'*             Created:5/13/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Move record values to controls *
'*                      on the screen                  *
'*                                                     *
'*******************************************************
Private Sub mMoveRecToCtrl()
'******************************************************************************************
'* Note: VBC id'd the following unreferenced items and handled them as described:         *
'*                                                                                        *
'* Local Labels (Marked)                                                                  *
'*  mMoveRecToCtrlErr                                                                     *
'******************************************************************************************

'
'   mMoveRecToCtrl
'   Where:
'
    Dim ilLoop As Integer
    Dim slStr As String
    Dim slNameCode As String
    Dim slCode As String
    Dim slRecCode As String
    Dim ilRet As Integer    'Return call status
    Dim ilTest As Integer
    Dim slName As String
    Dim slDate As String
    Dim slPrefix As String
    Dim slFormat As String
    Dim ilVef As Integer
    Dim ilValue As Integer
    Dim ilFound As Integer
    Dim ilCvf As Integer
    Dim blShowAll As Boolean
    Dim ilMGAdded As Boolean
    Dim ilISCIProd As Integer

    smOrigCntr = ""
    'If tmChf.lCode <> tmCrf.lChfCode Then
    '    tmChfSrchKey.lCode = tmCrf.lChfCode
    '    ilRet = btrGetEqual(hmChf, tmChf, imChfRecLen, tmChfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)
    '    On Error GoTo mMoveRecToCtrlErr
    '    gBtrvErrorMsg ilRet, "mMoveRecToCtrl (btrGetEqual):" & "Chf.Btr", Copy
    '    On Error GoTo 0
    'End If
    'Contract number
    smSave(1) = ""
    For ilLoop = 0 To UBound(tmCopyCntrCode) - 1 Step 1 'lbcCntrCode.ListCount - 1 Step 1
        slNameCode = tmCopyCntrCode(ilLoop).sKey   'lbcCntrCode.List(ilLoop)
        ilRet = gParseItem(slNameCode, 2, "\", slCode)
        If Val(slCode) = tmCrf.lChfCode Then
            smSave(1) = lbcCntr.List(ilLoop)
            smOrigCntr = smSave(1)
            Exit For
        End If
    Next ilLoop
    If tmChf.lCode <> tmCrf.lChfCode Then
        ilRet = gObtainChfClf(hmCHF, hmClf, tmCrf.lChfCode, False, tmChf, tgClfCopy())
    End If
    'Length
    mLenPop
    If tmCrf.iLen <> 0 Then
        slStr = Trim$(str$(tmCrf.iLen))
        gFindMatch slStr, 0, lbcLen    'Determine if name exist
        If gLastFound(lbcLen) <> -1 Then   'Name found
            imSave(9) = gLastFound(lbcLen)
        Else
            imSave(9) = -1
        End If
    Else
        imSave(9) = -1
    End If
    'Live Copy
    imSave(12) = 1  '-1
    If tmCrf.sLiveCopy = "L" Then
        imSave(12) = 0
    ElseIf tmCrf.sLiveCopy = "M" Then
        imSave(12) = 2
    ElseIf tmCrf.sLiveCopy = "S" Then
        imSave(12) = 3
    ElseIf tmCrf.sLiveCopy = "P" Then
        imSave(12) = 4
    ElseIf tmCrf.sLiveCopy = "Q" Then
        imSave(12) = 5
    Else
        imSave(12) = 1
    End If
    'Vehicle
    smOrigVehicle = ""
    ReDim tmCrfVefCode(0 To 0) As CRFVEFCODE
    If (tmCrf.iVefCode = 0) And (tmCrf.lCvfCode > 0) Then
        imFLValue = -1
        tmCvfSrchKey.lCode = tmCrf.lCvfCode
        ilRet = btrGetEqual(hmCvf, tmCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        Do While ilRet = BTRV_ERR_NONE
            For ilCvf = 0 To 99 Step 1
                If tmCvf.iVefCode(ilCvf) > 0 Then
                    If tmCvf.iNextFinal(ilCvf) > 0 Then
                        If imFLValue = -1 Then
                            imFLValue = tmCvf.iNextFinal(ilCvf)
                        Else
                            If tmCvf.iNextFinal(ilCvf) <> imFLValue Then
                                imFLValue = -2
                            End If
                        End If
                    Else
                        If imFLValue = -1 Then
                            imFLValue = tmCrf.iNextFinal
                        Else
                            If tmCrf.iNextFinal <> imFLValue Then
                                imFLValue = -2
                            End If
                        End If
                    End If
                    tmCrfVefCode(UBound(tmCrfVefCode)).iVefCode = tmCvf.iVefCode(ilCvf)
                    tmCrfVefCode(UBound(tmCrfVefCode)).iNextFinal = tmCvf.iNextFinal(ilCvf)
                    tmCrfVefCode(UBound(tmCrfVefCode)).iNextPrelim = tmCvf.iNextPrelim(ilCvf)
                    ReDim Preserve tmCrfVefCode(0 To UBound(tmCrfVefCode) + 1) As CRFVEFCODE
                End If
            Next ilCvf
            If tmCvf.lLkCvfCode <= 0 Then
                Exit Do
            End If
            tmCvfSrchKey.lCode = tmCvf.lLkCvfCode
            ilRet = btrGetEqual(hmCvf, tmCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
        smSave(2) = smSeveral
    ElseIf tmVef.iCode <> tmCrf.iVefCode Then
        'tmVefSrchKey.iCode = tmCrf.iVefCode
        'ilRet = btrGetEqual(hmVef, tmVef, imVefRecLen, tmVefSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        'On Error GoTo mMoveRecToCtrlErr
        'gBtrvErrorMsg ilRet, "mMoveRecToCtrl (btrGetEqual):" & "Vef.Btr", Copy
        'On Error GoTo 0
        ReDim tmCrfVefCode(0 To 1) As CRFVEFCODE
        tmCrfVefCode(0).iVefCode = tmCrf.iVefCode
        tmCrfVefCode(0).iNextFinal = tmCrf.iNextFinal
        tmCrfVefCode(0).iNextPrelim = tmCrf.iNextPrelim
        ilVef = gBinarySearchVef(tmCrf.iVefCode)
        If ilVef <> -1 Then
            tmVef = tgMVef(ilVef)
        Else
            tmVef.sName = "Missing Vef" & str$(tmCrf.iVefCode)
        End If
        smSave(2) = Trim$(tmVef.sName)
    Else
        smSave(2) = Trim$(tmVef.sName)
        ReDim tmCrfVefCode(0 To 1) As CRFVEFCODE
        tmCrfVefCode(0).iVefCode = tmVef.iCode
        tmCrfVefCode(0).iNextFinal = 1
        tmCrfVefCode(0).iNextPrelim = 1
    End If
    'Added from V4.5
    mVehPop
    mVehOptIndex
    blShowAll = False
    If lbcVehicle.List(0) = "[All]" Then
        blShowAll = True
        lbcVehicle.RemoveItem 0
    ElseIf lbcVehicle.List(0) = "[None]" Then
        blShowAll = True
        lbcVehicle.RemoveItem 0
    End If
    'Add vehicle if not already include (add as MG)
    ilMGAdded = False
    For ilCvf = 0 To UBound(tmCrfVefCode) - 1 Step 1
        ilFound = False
        For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1  'lbcVehicleCode.ListCount - 1 Step 1
            slNameCode = tgCVehicle(ilLoop).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            'If tmCrf.iVefCode = Val(slCode) Then
            If tmCrfVefCode(ilCvf).iVefCode = Val(slCode) Then
                ilFound = True
            End If
        Next ilLoop
        If Not ilFound Then
            ilMGAdded = True
            'mAddVehToLbc tmCrf.iVefCode, "3"
            mAddVehToLbc tmCrfVefCode(ilCvf).iVefCode, "3"
        End If
    Next ilCvf
    If ilMGAdded Then
        lbcVehicle.Clear
        For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1  'lbcVehicleCode.ListCount - 1 Step 1
            slNameCode = tgCVehicle(ilLoop).sKey    'lbcVehicleCode.List(ilLoop)
            slPrefix = ""
            If Left$(slNameCode, 1) = "2" Then
                slPrefix = "H:"
            'ElseIf Left$(slNameCode, 1) = "2" Then
            '    slPrefix = "MG:"
            ElseIf Left$(slNameCode, 1) = "4" Then
                slPrefix = "A:"
            ElseIf Left$(slNameCode, 1) = "3" Then
                slPrefix = "MG:"
            End If
            ilRet = gParseItem(slNameCode, 1, "\", slName)
            ilRet = gParseItem(slName, 4, "|", slFormat)
            ilRet = gParseItem(slName, 3, "|", slName)
            If Trim$(slFormat) <> "" Then
                lbcVehicle.AddItem slPrefix & Trim$(slName) & "/" & Trim$(slFormat)
            Else
                lbcVehicle.AddItem slPrefix & Trim$(slName)
            End If
        Next ilLoop
        'If lbcVehicle.ListCount > 0 Then
        '    lbcVehicle.AddItem "[All]", 0
        'Else
        '    lbcVehicle.AddItem "[None]", 0
        'End If
        'imAllVehAdj = 1
    End If
    If (lbcVehicle.ListCount > 0) Or (blShowAll) Then
        lbcVehicle.AddItem "[All]", 0
    Else
        lbcVehicle.AddItem "[None]", 0
    End If
    imAllVehAdj = 1
    If (tmCrf.iVefCode <> 0) Then
        For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1  'lbcVehicleCode.ListCount - 1 Step 1
            slNameCode = tgCVehicle(ilLoop).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            If tmCrf.iVefCode = Val(slCode) Then
                slPrefix = ""
                If Left$(slNameCode, 1) = "2" Then
                    slPrefix = "H:"
                'ElseIf Left$(slNameCode, 1) = "2" Then
                '    slPrefix = "MG:"
                ElseIf Left$(slNameCode, 1) = "4" Then
                    slPrefix = "A:"
                ElseIf Left$(slNameCode, 1) = "3" Then
                    slPrefix = "MG:"
                End If
                ilRet = gParseItem(slNameCode, 1, "\", slName)
                ilRet = gParseItem(slName, 4, "|", slFormat)
                ilRet = gParseItem(slName, 3, "|", slName)
                If Trim$(slFormat) <> "" Then
                    smSave(2) = slPrefix & Trim$(slName) & "/" & Trim$(slFormat)
                Else
                    smSave(2) = slPrefix & Trim$(slName)
                End If
                Exit For
            End If
        Next ilLoop
    End If
    'End of v4.5 Add
    smOrigVehicle = smSave(2)
    mSelectRotVehicles
    'MG assigned by
    ilValue = Asc(tgSpf.sMOFCopyAssign)  'Option Fields in Orders/Proposals
    If (ilValue And MGRULESINCOPY) = MGRULESINCOPY Then 'Define MG rules within Copy
        If tmCrf.sMGCopyAssign = "O" Then
            imSave(13) = 0
        ElseIf tmCrf.sMGCopyAssign = "S" Then
            imSave(13) = 1
        ElseIf tmCrf.sMGCopyAssign = "B" Then
            imSave(13) = 2
        Else
            If (ilValue And MGORIGVEHONLY) = MGORIGVEHONLY Then
                imSave(13) = 0
            ElseIf (ilValue And MGSCHVEHONLY) = MGSCHVEHONLY Then
                imSave(13) = 1
            Else
                imSave(13) = 2
            End If
        End If
    Else
        If (ilValue And MGORIGVEHONLY) = MGORIGVEHONLY Then
            imSave(13) = 0
        ElseIf (ilValue And MGSCHVEHONLY) = MGSCHVEHONLY Then
            imSave(13) = 1
        Else
            imSave(13) = 2
        End If
    End If
    'Time zone
    'Pop done above
    'mVehPop
    'mVehOptIndex
    If (tmCrf.lRafCode > 0) And (Trim$(tmCrf.sZone) = "R") Then
        imSave(1) = 0   'All zones
        smOrigZone = lbcZones.List(0)
        For ilLoop = LBound(tmRegionCode) To UBound(tmRegionCode) - 1 Step 1
            slNameCode = tmRegionCode(ilLoop).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            If Val(slCode) = tmCrf.lRafCode Then
                ilRet = gParseItem(slNameCode, 1, "\", slName)
                smOrigZone = Trim$(slName)
                gFindMatch smOrigZone, 0, lbcZones   'Determine if name exist
                If gLastFound(lbcZones) <> -1 Then   'Name found
                    imSave(1) = gLastFound(lbcZones)
                Else
                    lbcZones.AddItem smOrigZone
                    gFindMatch smOrigZone, 0, lbcZones   'Determine if name exist
                    If gLastFound(lbcZones) <> -1 Then   'Name found
                        imSave(1) = gLastFound(lbcZones)
                    Else
                        imSave(1) = 0   'All zones
                        smOrigZone = lbcZones.List(0)
                    End If
                End If
                Exit For
            End If
        Next ilLoop
    Else
        smOrigZone = Trim$(tmCrf.sZone)
        gFindMatch smOrigZone, 0, lbcZones   'Determine if name exist
        If gLastFound(lbcZones) <> -1 Then   'Name found
            imSave(1) = gLastFound(lbcZones)
        Else
            imSave(1) = 0   'All zones
            smOrigZone = lbcZones.List(0)
        End If
    End If
    'Dates and time
    gUnpackDate tmCrf.iStartDate(0), tmCrf.iStartDate(1), smSave(3)
    'If in past- blank dates
    slDate = Format$(gNow(), "m/d/yy")
    'If gDateValue(smSave(3)) <= gDateValue(slDate) Then
    '    smSave(3) = ""
    'End If
    gUnpackDate tmCrf.iEndDate(0), tmCrf.iEndDate(1), smSave(4)
    'If gDateValue(smSave(4)) <= gDateValue(slDate) Then
    '    smSave(4) = ""
    'End If
    smOrigSDate = smSave(3)
    If gDateValue(smOrigSDate) <= lmNowDate Then
        imAllowErase = False
    Else
        imAllowErase = True
    End If
    smOrigEDate = smSave(4)
    
    imVefCode = tmCrf.iVefCode
    mSetIfGameVehicle
    If tmCrf.sAirGameType = "G" Then
        rbcAirTimeCopyBy(1).Value = True
        mGameTeamPop
        tmCafSrchKey1.lCrfCode = tmCrf.lCode
        ilRet = btrGetEqual(hmCaf, tmCaf, imCafRecLen, tmCafSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)
        Do While (ilRet = BTRV_ERR_NONE) And (tmCaf.lCrfCode = tmCrf.lCode)
            If tmCaf.sType = "G" Then
                For ilLoop = 0 To lbcGameNo.ListCount - 1 Step 1
                    If tmCaf.iGameNo = lbcGameNo.ItemData(ilLoop) Then
                        lbcGameNo.Selected(ilLoop) = True
                        Exit For
                    End If
                Next ilLoop
            End If
            ilRet = btrGetNext(hmCaf, tmCaf, imCafRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
        smSave(5) = "By Event"
        smSave(6) = ""
        For ilLoop = MONINDEX To SUNINDEX Step 1
            imSave(2 + ilLoop - MONINDEX) = -1
        Next ilLoop
    ElseIf tmCrf.sAirGameType = "T" Then
        rbcAirTimeCopyBy(2).Value = True
        mGameTeamPop
        tmCafSrchKey1.lCrfCode = tmCrf.lCode
        ilRet = btrGetEqual(hmCaf, tmCaf, imCafRecLen, tmCafSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)
        Do While (ilRet = BTRV_ERR_NONE) And (tmCaf.lCrfCode = tmCrf.lCode)
            If tmCaf.sType = "T" Then
                For ilLoop = 0 To lbcTeam.ListCount - 1 Step 1
                    If tmCaf.iTeamMnfCode = lbcTeam.ItemData(ilLoop) Then
                        lbcTeam.Selected(ilLoop) = True
                        Exit For
                    End If
                Next ilLoop
            End If
            ilRet = btrGetNext(hmCaf, tmCaf, imCafRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
        smSave(5) = "By Team"
        smSave(6) = ""
        For ilLoop = MONINDEX To SUNINDEX Step 1
            imSave(2 + ilLoop - MONINDEX) = -1
        Next ilLoop
    Else
        gUnpackTime tmCrf.iStartTime(0), tmCrf.iStartTime(1), "A", "1", smSave(5)
        gUnpackTime tmCrf.iEndTime(0), tmCrf.iEndTime(1), "A", "1", smSave(6)
        smOrigSTime = smSave(5)
        smOrigETime = smSave(6)
        'Days
        For ilLoop = 0 To 6 Step 1
            If Trim$(tmCrf.sDay(ilLoop)) = "Y" Then
                imSave(ilLoop + 2) = 1
            Else
                imSave(ilLoop + 2) = 0
            End If
        Next ilLoop
        If imGameVehicle Then
            rbcAirTimeCopyBy(0).Value = True
            edcTimeDay(0).Text = smSave(5)
            edcTimeDay(1).Text = smSave(6)
            For ilLoop = 0 To 6 Step 1
                If Trim$(tmCrf.sDay(ilLoop)) = "Y" Then
                    ckcTimeDay(ilLoop).Value = vbChecked
                Else
                    ckcTimeDay(ilLoop).Value = vbUnchecked
                End If
            Next ilLoop
        End If
    End If
    'Avail
    'imSave(10), smSave(7)
    smSave(7) = ""
    imSave(10) = -1
    If (tmCrf.sInOut = "I") Or (tmCrf.sInOut = "O") Then
        slRecCode = Trim$(str$(tmCrf.ianfCode))
        For ilTest = 0 To UBound(tmAvailCode) - 1 Step 1 'lbcAvailCode.ListCount - 1 Step 1
            slNameCode = tmAvailCode(ilTest).sKey  'lbcAvailCode.List(ilTest)
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            If ilRet = CP_MSG_NONE Then
                If slRecCode = slCode Then
                    ilRet = gParseItem(slNameCode, 1, "\", slName)
                    If tmCrf.sInOut = "O" Then
                        imSave(10) = 2
                        smSave(7) = Trim$(slName)
                    Else
                        imSave(10) = 1
                        smSave(7) = Trim$(slName)
                    End If
                    Exit For
                End If
            End If
        Next ilTest
    Else
        imSave(10) = 0
        smSave(7) = ""
    End If
    smOrigAvail = smSave(7)
    'Type
'    Select Case tmCrf.sRotType
'        Case "A"    'Contract spot
'            imSave(11) = 0
'            smOrigType = lbcType.List(0)
'        Case "O"
'            imSave(11) = 1
'            smOrigType = lbcType.List(1)
'        Case "C"
'            imSave(11) = 2
'            smOrigType = lbcType.List(2)
'    End Select
    imSave(11) = 0
    smOrigType = lbcType.List(0)
    smInitShtTitle = ""
    smShtTitle = ""
    'If tgSpf.sUseProdSptScr = "P" Then
    '    'mShtTitlePop
    '    slRecCode = Trim$(Str$(tmCrf.lSifCode))
    '    For ilLoop = 0 To UBound(tmShtTitleCode) - 1 Step 1 'lbcShtTitleCode.ListCount - 1 Step 1
    '        slNameCode = tmShtTitleCode(ilLoop).sKey   'lbcShtTitleCode.List(ilLoop)
    '        ilRet = gParseItem(slNameCode, 2, "\", slCode)
    '        On Error GoTo mMoveRecToCtrlErr
    '        gCPErrorMsg ilRet, "mMoveRecToCtrl (gParseItem field 2)", Copy
    '        On Error GoTo 0
    '        If slRecCode = slCode Then
    '            lbcShtTitle.ListIndex = ilLoop + 1
    '            smShtTitle = lbcShtTitle.List(ilLoop + 1)
    '            smInitShtTitle = smShtTitle
    '            Exit For
    '        End If
    '    Next ilLoop
    'End If
    'Comment
    'smComment = ""
    'If tmCsf.iStrLen > 0 Then
    '    smComment = Trim$(Left$(tmCsf.sComment, tmCsf.iStrLen))
    'End If
    smComment = gStripChr0(tmCsf.sComment)
    smOrigComment = smComment
    For ilLoop = imLBCtrls To UBound(tmCtrls) Step 1
        tmCtrls(ilLoop).iChg = False
    Next ilLoop
    'Blackout Advertiser
    If tmCrf.iBkoutInstAdfCode > 0 Then
        mAdvtBlackoutPop
        imBlackoutAdfCode = 0
        cbcBlackout.ListIndex = 0
        If tmCrf.iBkoutInstAdfCode > 0 Then
            For ilLoop = 0 To cbcBlackout.ListCount - 1 Step 1
                If cbcBlackout.ItemData(ilLoop) = tmCrf.iBkoutInstAdfCode Then
                    cbcBlackout.ListIndex = ilLoop
                    imBlackoutIndex = ilLoop
                    imBlackoutAdfCode = tmCrf.iBkoutInstAdfCode
                    Exit For
                End If
            Next ilLoop
        End If
    ElseIf tmCrf.iBkoutInstAdfCode = POOLROTATION Then
        If tgSpf.sUseCartNo <> "N" Then
            If rbcShow(0).Value Then
                ilISCIProd = 1
            Else
                ilISCIProd = 3
            End If
        Else
            ilISCIProd = 4
        End If
        mAdvtBlackoutPop
        For ilLoop = 0 To cbcBlackout.ListCount - 1 Step 1
            If cbcBlackout.ItemData(ilLoop) = tmCrf.iBkoutInstAdfCode Then
                cbcBlackout.ListIndex = ilLoop
                imBlackoutIndex = ilLoop
                imBlackoutAdfCode = tmCrf.iBkoutInstAdfCode
                Exit For
            End If
        Next ilLoop
        mInvPopPool ilISCIProd
    End If
    Exit Sub
mMoveRecToCtrlErr: 'VBC NR
    On Error GoTo 0
    imTerminate = True
    Exit Sub
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mNoSpot4Wks                     *
'*                                                     *
'*             Created:5/13/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Number of spots in first 4     *
'*                      weeks of the rotation          *
'*                                                     *
'*******************************************************
Private Function mNoSpot4Wks() As Integer
    Dim llDate As Long
    Dim llStartDate As Long
    Dim llEndDate As Long
    Dim slDate As String
    Dim slTime As String
    Dim llStartTime As Long
    Dim llEndTime As Long
    Dim ilAsgnDate0 As Integer
    Dim ilAsgnDate1 As Integer
    Dim ilDay As Integer
    Dim llChfCode As Long
    Dim ilVefCode As Integer
    Dim ilRet As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim ilEvtIndex As Integer
    Dim ilSpotIndex As Integer
    Dim llAvailTime As Long
    Dim ilSpotCount As Integer
    Dim ilLength As Integer
    Dim slInOut As String
    Dim ilAnfCode As Integer
    Dim ilAvailOk As Integer
    Dim ilAdfCode As Integer
    Dim ilType As Integer
    Dim ilVef As Integer
    
    If Not cmcUpdate.Enabled Then
        'Test if rotation defined
        If (smSave(3) = "") Or (Not gValidDate(smSave(3))) Or (smSave(4) = "") Or (Not gValidDate(smSave(4))) Then
            mNoSpot4Wks = -1
            Exit Function
        Else
            If (smSave(5) = "") Or (Not gValidTime(smSave(5))) Or (smSave(6) = "") Or (Not gValidTime(smSave(6))) Then
                mNoSpot4Wks = -1
                Exit Function
            Else
                If (imSave(2) <> 1) And (imSave(3) <> 1) And (imSave(4) <> 1) And (imSave(5) <> 1) And (imSave(6) <> 1) And (imSave(7) <> 1) And (imSave(8) <> 1) Then
                    mNoSpot4Wks = -1
                    Exit Function
                End If
            End If
       End If
    End If
    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    ilAdfCode = Val(slCode)   '
    gFindMatch smSave(2), 0, lbcVehicle
    If Trim$(smSave(2)) <> "[All]" Then
        If gLastFound(lbcVehicle) >= 0 Then
            slNameCode = tgCVehicle(gLastFound(lbcVehicle) - imAllVehAdj).sKey 'lbcVehicleCode.List(gLastFound(lbcVehicle))
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            ilVefCode = Val(slCode)
        Else
            mNoSpot4Wks = -1
            Exit Function
        End If
    Else
        mNoSpot4Wks = -1
        Exit Function
    End If
    gFindMatch smSave(1), 0, lbcCntr
    If gLastFound(lbcCntr) >= 0 Then
        slNameCode = tmCopyCntrCode(gLastFound(lbcCntr)).sKey    'lbcCntrCode.List(gLastFound(lbcCntr))
        ilRet = gParseItem(slNameCode, 2, "\", slCode)
        llChfCode = Val(slCode)
    Else
        mNoSpot4Wks = -1
        Exit Function
    End If
    If imSave(9) < 0 Then
        mNoSpot4Wks = -1
        Exit Function
    Else
        ilLength = lbcLen.List(imSave(9))
    End If
    If imSave(10) = 1 Then
        slInOut = "I"
        gFindMatch smSave(7), 0, lbcAvail
        If gLastFound(lbcAvail) >= 0 Then
            slNameCode = tmAvailCode(gLastFound(lbcAvail) - 1).sKey  'lbcAvailCode.List(gLastFound(lbcAvail) - 1)
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            ilAnfCode = Val(slCode)
        Else
            mNoSpot4Wks = -1
            Exit Function
        End If
    ElseIf imSave(10) = 2 Then
        slInOut = "O"
        gFindMatch smSave(7), 0, lbcAvail
        If gLastFound(lbcAvail) >= 0 Then
            slNameCode = tmAvailCode(gLastFound(lbcAvail) - 1).sKey  'lbcAvailCode.List(gLastFound(lbcAvail) - 1)
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            ilAnfCode = Val(slCode)
        Else
            mNoSpot4Wks = -1
            Exit Function
        End If
    Else
        slInOut = "N"
        ilAnfCode = 0
    End If
    llStartDate = gDateValue(smSave(3))
    llEndDate = gDateValue(smSave(4))
    If llEndDate > llStartDate + 27 Then
        llEndDate = llStartDate + 27
    End If
    llStartTime = CLng(gTimeToCurrency(smSave(5), False))
    llEndTime = CLng(gTimeToCurrency(smSave(6), True)) - 1
    ilSpotCount = 0
    ilVef = gBinarySearchVef(ilVefCode)
    If ilVef = -1 Then
        mNoSpot4Wks = -1
        Exit Function
    End If
    For llDate = llStartDate To llEndDate Step 1
        slDate = Format$(llDate, "m/d/yy")
        gPackDate slDate, ilAsgnDate0, ilAsgnDate1
        ilDay = gWeekDayStr(slDate)
        If (imSave(2 + ilDay) = 1) And (ilVef <> -1) Then
            If tgMVef(ilVef).sType <> "G" Then
                ilType = 0
                tmSsfSrchKey.iType = 0 'slSsfType
                tmSsfSrchKey.iVefCode = ilVefCode
                tmSsfSrchKey.iDate(0) = ilAsgnDate0
                tmSsfSrchKey.iDate(1) = ilAsgnDate1
                tmSsfSrchKey.iStartTime(0) = 0
                tmSsfSrchKey.iStartTime(1) = 0
                imSsfRecLen = Len(tmSsf)
                ilRet = gSSFGetEqual(hmSsf, tmSsf, imSsfRecLen, tmSsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)   'Get last current record to obtain date
            Else
                tmSsfSrchKey2.iVefCode = ilVefCode
                tmSsfSrchKey2.iDate(0) = ilAsgnDate0
                tmSsfSrchKey2.iDate(1) = ilAsgnDate1
                imSsfRecLen = Len(tmSsf)
                ilRet = gSSFGetGreaterOrEqualKey2(hmSsf, tmSsf, imSsfRecLen, tmSsfSrchKey2, INDEXKEY2, BTRV_LOCK_NONE)
                ilType = tmSsf.iType
            End If
            Do While (ilRet = BTRV_ERR_NONE) And (tmSsf.iType = ilType) And (tmSsf.iVefCode = ilVefCode) And (tmSsf.iDate(0) = ilAsgnDate0) And (tmSsf.iDate(1) = ilAsgnDate1)
                For ilEvtIndex = 1 To tmSsf.iCount
                    'Scan for avail that matches time of spot- then test avail name
                   LSet tmAvail = tmSsf.tPas(ADJSSFPASBZ + ilEvtIndex)
                    If (tmAvail.iRecType >= 2) And (tmAvail.iRecType <= 9) Then 'Contract Avail subrecord
                        gUnpackTime tmAvail.iTime(0), tmAvail.iTime(1), "A", "1", slTime
                        llAvailTime = CLng(gTimeToCurrency(slTime, False))
                        If llAvailTime > llEndTime Then
                            Exit Do
                        End If
                        If llAvailTime >= llStartTime Then
                            ilAvailOk = True
                            If slInOut = "I" Then
                                If ilAnfCode <> tmAvail.ianfCode Then
                                    ilAvailOk = False   'No
                                End If
                            ElseIf slInOut = "O" Then
                                If ilAnfCode = tmAvail.ianfCode Then
                                    ilAvailOk = False   'No
                                End If
                            End If
                            If ilAvailOk Then
                                For ilSpotIndex = ilEvtIndex + 1 To ilEvtIndex + tmAvail.iNoSpotsThis Step 1
                                   LSet tmSpot = tmSsf.tPas(ADJSSFPASBZ + ilSpotIndex)
                                    If (tmSpot.iAdfCode = ilAdfCode) And ((tmSpot.iPosLen And &HFFF) = ilLength) Then
                                        tmSdfSrchKey3.lCode = tmSpot.lSdfCode
                                        ilRet = btrGetEqual(hmSdf, tmSdf, imSdfRecLen, tmSdfSrchKey3, INDEXKEY3, BTRV_LOCK_NONE, SETFORREADONLY)
                                        If ilRet = BTRV_ERR_NONE Then
                                            If tmSdf.lChfCode = llChfCode Then
                                                ilSpotCount = ilSpotCount + 1
                                            End If
                                        End If
                                    End If
                                Next ilSpotIndex
                            End If
                        End If
                    End If
                Next ilEvtIndex
                imSsfRecLen = Len(tmSsf)
                ilRet = gSSFGetNext(hmSsf, tmSsf, imSsfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
                If tgMVef(ilVef).sType = "G" Then
                    ilType = tmSsf.iType
                End If
            Loop
        End If
    Next llDate
    mNoSpot4Wks = ilSpotCount
End Function

'*******************************************************
'*                                                     *
'*      Procedure Name:mReadRec                        *
'*                                                     *
'*             Created:6/28/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Read a record                  *
'*                                                     *
'*******************************************************
Private Function mReadRec(ilSelectIndex As Integer, ilOnlyCrfCsf As Integer, ilForUpdate As Integer) As Integer
'
'   iRet = mReadRec(ilSelectIndex, ilOnlyCrfCsf, ilForUpdate)
'   Where:
'       ilSelectIndex (I) - list box index
'       iRet (O)- True if record read,
'                 False if not read
'
    Dim slNameCode As String  'Code and Code strings from Traffic!lbcLockBox or Traffic!lbcAgencyDP
    Dim slCode As String    'Code number- so record can be found
    Dim ilLoop As Integer
    Dim slName As String
    Dim ilRet As Integer    'Return status
    Dim llRecPos As Long
    Dim ilFound As Integer
    Dim slStr As String
    
    slNameCode = tmCopyRotCode(ilSelectIndex - 1).sKey    'lbcRotCode.List(ilSelectIndex - 1)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    On Error GoTo mReadRecErr
    gCPErrorMsg ilRet, "mReadRec (gParseItem field 2)", Copy
    On Error GoTo 0
    slCode = Trim$(slCode)
    llRecPos = CLng(slCode)
    ilRet = btrGetDirect(hmCrf, tmCrf, imCrfRecLen, llRecPos, INDEXKEY0, BTRV_LOCK_NONE)
    On Error GoTo mReadRecErr
    gBtrvErrorMsg ilRet, "mReadRec (btrGetEqual)", Copy
    On Error GoTo 0
    If ilForUpdate = SETFORWRITE Then
        'tmRec = tmCrf
        'ilRet = gGetByKeyForUpdate("CRF", hmCrf, tmRec)
        'tmCrf = tmRec
        'If ilRet <> BTRV_ERR_NONE Then
        '    'ilRet = MsgBox("Erase Not Completed, Try Later", vbOkOnly + vbExclamation, "Erase")
        '    mReadRec = False
        '    Exit Function
        'End If
    End If
    tmCsfSrchKey.lCode = tmCrf.lCsfCode
    If tmCrf.lCsfCode <> 0 Then
        tmCsf.sComment = ""
        imCsfRecLen = Len(tmCsf) '5011
        ilRet = btrGetEqual(hmCsf, tmCsf, imCsfRecLen, tmCsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, ilForUpdate)
        If ilRet <> BTRV_ERR_NONE Then
            tmCsf.lCode = 0
            tmCsf.sComment = ""
            'tmCsf.iStrLen = 0
        End If
    Else
        tmCsf.lCode = 0
        tmCsf.sComment = ""
        'tmCsf.iStrLen = 0
    End If
    If ilOnlyCrfCsf Then
        mReadRec = True
        Exit Function
    End If
    pbcRot.Cls
    mPaintRot
    cbcBlackout.Clear
    imBlackoutIndex = -1
    imBlackoutAdfCode = 0
    imCurrentAdvtIndex = -1
    lbcInst.Clear
    imRotHeaderChgOnly = True
    mMoveRecToCtrl
    mInitShow
    pbcRot_Paint
    smActiveCodeTag = ""
    lbcActive.Clear
    smPurgeCodeTag = ""
    lbcPurge.Clear
    smHistoryCodeTag = ""
    lbcHistory.Clear
    imBlackoutAdfCode = tmCrf.iBkoutInstAdfCode
    mInvPop
    tmCnfSrchKey.lCrfCode = tmCrf.lCode
    tmCnfSrchKey.iInstrNo = 0
    ilRet = btrGetGreaterOrEqual(hmCnf, tmCnf, imCnfRecLen, tmCnfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
    Do While (ilRet = BTRV_ERR_NONE) And (tmCnf.lCrfCode = tmCrf.lCode)
        ilFound = False
        For ilLoop = 0 To UBound(tgActiveCode) - 1 Step 1 'lbcActiveCode.ListCount - 1 Step 1
            slNameCode = tgActiveCode(ilLoop).sKey  'lbcActiveCode.List(ilLoop)
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            If tmCnf.lCifCode = Val(slCode) Then
                ilRet = gParseItem(slNameCode, 1, "\", slName)
                lbcInst.AddItem slName
                ilFound = True
                Exit For
            End If
        Next ilLoop
        If Not ilFound Then
            For ilLoop = 0 To UBound(tmPurgeCode) - 1 Step 1  'lbcPurgeCode.ListCount - 1 Step 1
                slNameCode = tmPurgeCode(ilLoop).sKey    'lbcPurgeCode.List(ilLoop)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                If tmCnf.lCifCode = Val(slCode) Then
                    ilRet = gParseItem(slNameCode, 1, "\", slName)
                    lbcInst.AddItem slName
                    ilFound = True
                    Exit For
                End If
            Next ilLoop
        End If
        If Not ilFound Then
            For ilLoop = 0 To UBound(tmHistoryCode) - 1 Step 1  'lbcHistoryCode.ListCount - 1 Step 1
                slNameCode = tmHistoryCode(ilLoop).sKey    'lbcHistoryCode.List(ilLoop)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                If tmCnf.lCifCode = Val(slCode) Then
                    ilRet = gParseItem(slNameCode, 1, "\", slName)
                    lbcInst.AddItem slName
                    ilFound = True
                    Exit For
                End If
            Next ilLoop
        End If
        If Not ilFound Then
            tmCifSrchKey.lCode = tmCnf.lCifCode
            ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            If (ilRet = BTRV_ERR_NONE) Then
                tmCpfSrchKey.lCode = tmCif.lcpfCode
                ilRet = btrGetEqual(hmCpf, tmCpf, imCpfRecLen, tmCpfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                If (ilRet = BTRV_ERR_NONE) Then
                    slStr = Trim$(tmCpf.sISCI)
                Else
                    slStr = ""
                End If
                If Trim$(tmCif.sName) <> "" Then
                    slStr = "#:" & Trim$(tmCif.sName) & " ISCI: " & slStr
                End If
                ilRet = MsgBox("The Copy Inventory item " & Trim$(slStr) & " has been ignored due to non-matching spot lengths", vbOKOnly + vbExclamation, "Warning")
            End If
        End If
        ilRet = btrGetNext(hmCnf, tmCnf, imCnfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
    lbcInst.AddItem " "
    pbcLbcInst_Paint
    'Set pointer
    If (tmCrf.iVefCode <> 0) Or (tmCrf.lCvfCode <= 0) Then
        If tmCrf.iNextFinal < lbcInst.ListCount Then
            imFLValue = tmCrf.iNextFinal
            imInitNextFinal = imFLValue
        Else
            imFLValue = 1
            imInitNextFinal = 1
        End If
    Else
        imInitNextFinal = imFLValue
    End If
    mSetFLPointer
    mReadRec = True
    Exit Function
mReadRecErr:
    On Error GoTo 0
    mReadRec = False
    Exit Function
End Function
'*******************************************************
'*                                                     *
'*      Procedure Name:mResetInvPop                    *
'*                                                     *
'*             Created:2/28/94       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Populate the selection Name    *
'*                      box                            *
'*            6/8/05- Changed true to false as it was
'*                    changing the sort order 5~ sorted
'*                    after 55~ but in the original
'*                    arrays 5blank sorted before
'*                    55blank
'*                                                     *
'*******************************************************
Private Sub mResetInvPop()
    Dim ilLoop As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim ilRet As Integer
    
    lbcInv.Clear
   
     
    ReDim tmCopyNameCode(0 To 0) As SORTCODE
    
    If imInvStatus = 1 Then
        For ilLoop = 0 To UBound(tmPurgeCode) - 1 Step 1  'lbcPurgeCode.ListCount - 1 Step 1
            'lbcInvCode.AddItem lbcPurgeCode.List(ilLoop)
            gAddItemToSortCode tmPurgeCode(ilLoop).sKey, tmCopyNameCode(), False    'True
            lbcInv.AddItem lbcPurge.List(ilLoop)
        Next ilLoop
    ElseIf imInvStatus = 2 Then
        For ilLoop = 0 To UBound(tmHistoryCode) - 1 Step 1  'lbcHistoryCode.ListCount - 1 Step 1
            'lbcInvCode.AddItem lbcHistoryCode.List(ilLoop)
            gAddItemToSortCode tmHistoryCode(ilLoop).sKey, tmCopyNameCode(), False  'True
            lbcInv.AddItem lbcHistory.List(ilLoop)
        Next ilLoop
    Else
        For ilLoop = 0 To UBound(tgActiveCode) - 1 Step 1 'lbcActiveCode.ListCount - 1 Step 1
            gAddItemToSortCode tgActiveCode(ilLoop).sKey, tmCopyNameCode(), False 'True
        Next ilLoop
        
        For ilLoop = 0 To lbcActive.ListCount - 1 Step 1
            lbcInv.AddItem lbcActive.List(ilLoop)
        Next ilLoop
    End If
    
    ' TTP 10816 JJB 2023-08-21
    For ilLoop = 0 To 9999
        smInvFColor(0) = ""
    Next ilLoop
    ' TTP 10816 JJB 2023-08-21 END
    
    For ilLoop = 0 To lbcInv.ListCount - 1 Step 1
        lbcInv.ItemData(ilLoop) = 0
        If tgSpf.sTapeShowForm = "C" Then
            If imInvStatus = 0 Then
                If (ilLoop = 0) Or ((ilLoop = 1) And (tgSpf.sUseCartNo = "B")) Then
                    lgCopyInvCifCode = 0    'New mode
                Else
                    If tgSpf.sUseCartNo <> "B" Then
                        slNameCode = tmCopyNameCode(ilLoop - 1).sKey 'lbcInvCode.List(ilLoop - 1)
                    Else
                        slNameCode = tmCopyNameCode(ilLoop - 2).sKey 'lbcInvCode.List(ilLoop - 1)
                    End If
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    lgCopyInvCifCode = Val(slCode)   'Change mode
                End If
            Else
                slNameCode = tmCopyNameCode(ilLoop).sKey 'lbcInvCode.List(ilLoop)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                lgCopyInvCifCode = Val(slCode)   'Change mode
            End If
            If (tgSpf.sUseCartNo = "B") And (lgCopyInvCifCode = 0) Then
            Else
                If (tgSpf.sUseCartNo <> "N") And (lgCopyInvCifCode > 0) Then
                    tmCifSrchKey.lCode = lgCopyInvCifCode
                    ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                    If (ilRet = BTRV_ERR_NONE) And (tmCif.iMcfCode > 0) Then
                        If tmCif.sCleared = "N" Then
                            lbcInv.ItemData(ilLoop) = 1
                            
                            smInvFColor(ilLoop) = lbcInv.List(ilLoop) ' TTP 10816 JJB 2023-08-21
                            
                        End If
                    End If
                End If
            End If
        End If
    Next ilLoop
    pbcLbcInv_Paint
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mRotPop                         *
'*                                                     *
'*             Created:8/01/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Obtain rotation specifications *
'*                                                     *
'*******************************************************
Private Sub mRotPop(ilSetInvRotDate As Integer)
'
'   iRet = mRotPop
'   Where:
'
    Dim ilRet As Integer    'Return status
    Dim llLoop As Long
    Dim slStr As String
    Dim llNoRec As Long
    Dim llRecPos As Long
    Dim slNameCode As String
    Dim slName As String
    Dim slCode As String
    Dim ilAdfCode As Integer
    Dim ilOffSet As Integer
    Dim llRevCntrNo As Long
    Dim slRevCntrNo As String
    Dim llRevRotNo As Long
    Dim slRevRotNo As String
    Dim llCntrNo As Long
    Dim slStartDate As String
    Dim slEndDate As String
    Dim slStartTime As String
    Dim slEndTime As String
    Dim ilDay As Integer
    Dim slDay As String
    Dim slRecCode As String
    Dim ilTest As Integer
    Dim ilExtLen As Integer
    Dim slDate As String
    Dim llLen As Long
    Dim slType As String
    Dim ilValue As Integer
    Dim ilVef As Integer
    Dim tlCharTypeBuff As POPCHARTYPE   'Type field record
    'lbcRotCode.Clear
    ReDim tmCopyRotCode(0 To 0) As SORTCODE
    'ReDim tmRegionCode(0 To 0) As SORTCODE
'    ReDim ilListField(1 To 16) As Integer
'    ReDim ilListFieldChar(1 To 16) As Integer
'
'    ilListField(1) = 1170  '13
'    ilListField(2) = 2370  '24
'    ilListField(3) = 2565  '26
'    ilListField(4) = 4155  '41
'    ilListField(5) = 5370  '53
'    ilListField(6) = 5595  '55
'    ilListField(7) = 5825  '57
'    ilListField(8) = 6047  '59
'    ilListField(9) = 6270  '61
'    ilListField(10) = 6505 '63
'    ilListField(11) = 6730 '65
'    ilListField(12) = 6945 '68
'    ilListField(13) = 7290 '71
'    ilListField(14) = 8175 '80
'    ilListField(15) = 8550 '85
'    ilListField(16) = 8745 '87
'
'    ilListFieldChar(1) = 0
'    ilListFieldChar(2) = 0
'    ilListFieldChar(3) = 0
'    ilListFieldChar(4) = 0
'    ilListFieldChar(5) = 0
'    ilListFieldChar(6) = 0
'    ilListFieldChar(7) = 0
'    ilListFieldChar(8) = 0
'    ilListFieldChar(9) = 0
'    ilListFieldChar(10) = 0
'    ilListFieldChar(11) = 0
'    ilListFieldChar(12) = 0
'    ilListFieldChar(13) = 0
'    ilListFieldChar(14) = 0
'    ilListFieldChar(15) = 0
'    ilListFieldChar(16) = 0

    'smRegionCodeTag = ""
    lbcRot.Clear
    cbcBlackout.Clear
    imBlackoutIndex = -1
    imBlackoutAdfCode = 0
    If imTypeIndex < 0 Then
        Exit Sub
    End If
    llLen = 0
    imLastUsedRotNo = 0
    If (imTypeIndex = 0) Or ((imTypeIndex <= 2) And (tgSpf.sUsingBBs = "Y")) Then
        If imAdvtIndex < 0 Then
            Exit Sub
        End If
        slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
        ilRet = gParseItem(slNameCode, 2, "\", slCode)
        If ilRet <> CP_MSG_NONE Then
            Exit Sub
        End If
        ilAdfCode = Val(slCode)   'Change mode
    Else
        'Obtain event type and event name codes
        Exit Sub
    End If
    igAdfCode = ilAdfCode
    'ilValue = Asc(tgSpf.sUsingFeatures2)  'Option Fields in Orders/Proposals
    'If (ilValue And REGIONALCOPY) = REGIONALCOPY Then
    '    ilRet = gObtainRegion(ilAdfCode, "R", True, tmRegionCode(), smRegionCodeTag)
    'Else
    '    ilRet = gObtainRegion(ilAdfCode, "C", True, tmRegionCode(), smRegionCodeTag)
    'End If
    btrExtClear hmCrf   'Clear any previous extend operation
    ilExtLen = Len(tmCrf)  'Extract operation record size
    If (imTypeIndex = 0) Or ((imTypeIndex <= 2) And (tgSpf.sUsingBBs = "Y")) Then
        If imTypeIndex = 0 Then
            slType = "A"
        ElseIf imTypeIndex = 1 Then
            slType = "O"
        Else
            slType = "C"
        End If
        If (ckcCurrentRot.Value = vbUnchecked) Then
            tmCrfSrchKey1.sRotType = slType
            tmCrfSrchKey1.iEtfCode = 0
            tmCrfSrchKey1.iEnfCode = 0
            tmCrfSrchKey1.iAdfCode = ilAdfCode
            tmCrfSrchKey1.lChfCode = 0
            tmCrfSrchKey1.lFsfCode = 0
            tmCrfSrchKey1.iVefCode = 0
            tmCrfSrchKey1.iRotNo = 32000
            ilRet = btrGetGreaterOrEqual(hmCrf, tmCrf, imCrfRecLen, tmCrfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
        Else
            tmCrfSrchKey2.sRotType = slType
            tmCrfSrchKey2.iAdfCode = ilAdfCode
            gPackDateLong lmNowDate, tmCrfSrchKey2.iEndDate(0), tmCrfSrchKey2.iEndDate(1)
            ilRet = btrGetGreaterOrEqual(hmCrf, tmCrf, imCrfRecLen, tmCrfSrchKey2, INDEXKEY2, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
        End If
        If (tmCrf.iAdfCode = ilAdfCode) And (ilRet <> BTRV_ERR_END_OF_FILE) Then
            llNoRec = gExtNoRec(ilExtLen) 'btrRecords(hlAdf) 'Obtain number of records
            Call btrExtSetBounds(hmCrf, llNoRec, -1, "UC", "CRF", "") 'Set extract limits (all records)
            ilOffSet = gFieldOffset("Crf", "CrfAdfCode")
            ilRet = btrExtAddLogicConst(hmCrf, BTRV_KT_INT, ilOffSet, 2, BTRV_EXT_EQUAL, BTRV_EXT_AND, ilAdfCode, 2)
            On Error GoTo mRotPopErr
            gBtrvErrorMsg ilRet, "mRotPop (btrExtAddLogicConst):" & "Crf.Btr", Copy
            On Error GoTo 0
'            ilOffset = gFieldOffset("Crf", "CrfRotType")
'            ilRet = btrExtAddLogicConst(hmCrf, BTRV_KT_STRING, ilOffset, 1, BTRV_EXT_NOT_EQUAL, BTRV_EXT_AND, ByVal "M", 1)
'            On Error GoTo mRotPopErr
'            gBtrvErrorMsg ilRet, "mRotPop (btrExtAddLogicConst):" & "Crf.Btr", Copy
'            On Error GoTo 0
'            ilOffset = gFieldOffset("Crf", "CrfRotType")
'            ilRet = btrExtAddLogicConst(hmCrf, BTRV_KT_STRING, ilOffset, 1, BTRV_EXT_NOT_EQUAL, BTRV_EXT_AND, ByVal "S", 1)
'            On Error GoTo mRotPopErr
'            gBtrvErrorMsg ilRet, "mRotPop (btrExtAddLogicConst):" & "Crf.Btr", Copy
'            On Error GoTo 0
'            ilOffset = gFieldOffset("Crf", "CrfRotType")
'            ilRet = btrExtAddLogicConst(hmCrf, BTRV_KT_STRING, ilOffset, 1, BTRV_EXT_NOT_EQUAL, BTRV_EXT_AND, ByVal "R", 1)
'            On Error GoTo mRotPopErr
'            gBtrvErrorMsg ilRet, "mRotPop (btrExtAddLogicConst):" & "Crf.Btr", Copy
'            On Error GoTo 0
'            ilOffset = gFieldOffset("Crf", "CrfRotType")
'            ilRet = btrExtAddLogicConst(hmCrf, BTRV_KT_STRING, ilOffset, 1, BTRV_EXT_NOT_EQUAL, BTRV_EXT_LAST_TERM, ByVal "X", 1)
'            On Error GoTo mRotPopErr
'            gBtrvErrorMsg ilRet, "mRotPop (btrExtAddLogicConst):" & "Crf.Btr", Copy
'            On Error GoTo 0
            tlCharTypeBuff.sType = slType
            ilOffSet = gFieldOffset("Crf", "CrfRotType")
            ilRet = btrExtAddLogicConst(hmCrf, BTRV_KT_STRING, ilOffSet, 1, BTRV_EXT_EQUAL, BTRV_EXT_LAST_TERM, tlCharTypeBuff, 1)
            On Error GoTo mRotPopErr
            gBtrvErrorMsg ilRet, "mRotPop (btrExtAddLogicConst):" & "Crf.Btr", Copy
            On Error GoTo 0
            ilOffSet = 0
            ilRet = btrExtAddField(hmCrf, ilOffSet, ilExtLen)  'Extract start/end time, and days
            On Error GoTo mRotPopErr
            gBtrvErrorMsg ilRet, "mRotPop (btrExtAddField):" & "Crf.Btr", Copy
            On Error GoTo 0
            'ilRet = btrExtGetNextExt(hmClf)    'Extract record
            ilRet = btrExtGetNext(hmCrf, tmCrf, ilExtLen, llRecPos)
            If (ilRet <> BTRV_ERR_END_OF_FILE) And (ilRet <> BTRV_ERR_FILTER_LIMIT) Then
                On Error GoTo mRotPopErr
                gBtrvErrorMsg ilRet, "mRotPop (btrExtGetNextExt):" & "Clf.Btr", Copy
                On Error GoTo 0
                'ilRet = btrExtGetFirst(hmClf, tlClfExt, ilExtLen, llRecPos)
                If ilRet = BTRV_ERR_REJECT_COUNT Then
                    ilRet = btrExtGetNext(hmCrf, tmCrf, ilExtLen, llRecPos)
                End If
                Do While ilRet = BTRV_ERR_NONE
                    '12/14/08:  Set Inentory Rotation Date
                    If ilSetInvRotDate Then
                        'mDetermineInvDates
                        mCheckAndSetInvDates
                    End If
                    '12/2/05:  Added Dormant
                    'If tmCrf.sState <> "D" Then
                        If tmCrf.iRotNo > imLastUsedRotNo Then
                            imLastUsedRotNo = tmCrf.iRotNo
                        End If
                    '12/2/05:  Added Dormant, 5-9-06 move from above
                    If tmCrf.sState <> "D" Then
                        If tmChf.lCode <> tmCrf.lChfCode Then
                            tmChfSrchKey.lCode = tmCrf.lChfCode
                            ilRet = btrGetEqual(hmCHF, tmChf, imCHFRecLen, tmChfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                            On Error GoTo mRotPopErr
                            gBtrvErrorMsg ilRet, "mRotPop (btrGetEqual):" & "Chf.Btr", Copy
                            On Error GoTo 0
                        End If
                        'Exclude expired contracts or show all
                        'gUnpackDate tmChf.iEndDate(0), tmChf.iEndDate(1), slDate
                        gUnpackDate tmCrf.iEndDate(0), tmCrf.iEndDate(1), slDate
                        'If (gDateValue(slDate) > lmNowDate) Or (rbcCRShow(1).Value) Then
                        If ((gDateValue(slDate) > lmNowDate) And ((Asc(tgSpf.sUsingFeatures4) And ALLOWMOVEONTODAY) <> ALLOWMOVEONTODAY)) Or ((gDateValue(slDate) >= lmNowDate) And ((Asc(tgSpf.sUsingFeatures4) And ALLOWMOVEONTODAY) = ALLOWMOVEONTODAY)) Or (ckcCurrentRot.Value = vbUnchecked) Then
                            llRevCntrNo = 99999999 - tmChf.lCntrNo
                            slRevCntrNo = Trim$(str$(llRevCntrNo))
                            Do While Len(slRevCntrNo) < 8
                                slRevCntrNo = "0" & slRevCntrNo
                            Loop
                            'Scan for vehicle
                            If (tmCrf.iVefCode = 0) And (tmCrf.lCvfCode <> 0) Then
                                tmVef.sName = smSeveral
                                tmVef.iCode = -1
                            ElseIf tmVef.iCode <> tmCrf.iVefCode Then
    '                            tmVefSrchKey.iCode = tmCrf.iVefCode
    '                            ilRet = btrGetEqual(hmVef, tmVef, imVefRecLen, tmVefSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    '                            On Error GoTo mRotPopErr
    '                            gBtrvErrorMsg ilRet, "mRotPop (btrGetEqual):" & "Vef.Btr", Copy
    '                            On Error GoTo 0
                                ilVef = gBinarySearchVef(tmCrf.iVefCode)
                                If ilVef <> -1 Then
                                    tmVef = tgMVef(ilVef)
                                Else
                                    tmVef.sName = "Missing Vef" & str$(tmCrf.iVefCode)
                                End If
                            End If
                            slName = tmVef.sName
                            llRevRotNo = 99999 - tmCrf.iRotNo
                            slRevRotNo = Trim$(str$(llRevRotNo))
                            Do While Len(slRevRotNo) < 6
                                slRevRotNo = "0" & slRevRotNo
                            Loop
                            'lbcRotCode.AddItem slRevCntrNo & "| " & slName & "|" & slRevRotNo & "\" & Trim$(Str$(llRecPos))
                            'gAddItemToSortCode slRevCntrNo & "| " & slName & "|" & slRevRotNo & "\" & Trim$(Str$(llRecPos)), tmCopyRotCode(), True
                            'Force all airing vehicle rotation to be first 6/29/99- Jim request
                            If tmVef.sType = "A" Then
                                gAddItemToSortCode slRevCntrNo & "|" & "A" & "| " & slName & "|" & slRevRotNo & "\" & Trim$(str$(llRecPos)), tmCopyRotCode(), True
                            Else
                                gAddItemToSortCode slRevCntrNo & "|" & "B" & "| " & slName & "|" & slRevRotNo & "\" & Trim$(str$(llRecPos)), tmCopyRotCode(), True
                            End If
                        End If
                    End If
                    ilRet = btrExtGetNext(hmCrf, tmCrf, ilExtLen, llRecPos)
                    If ilRet = BTRV_ERR_REJECT_COUNT Then
                        ilRet = btrExtGetNext(hmCrf, tmCrf, ilExtLen, llRecPos)
                    End If
                Loop
                If ilSetInvRotDate Then
                    '2/20/09:  Check if inventory used within any blackout, expand date if required
                    tmCrfSrchKey3.sRotType = slType
                    tmCrfSrchKey3.iBkoutInstAdfCode = ilAdfCode
                    gPackDateLong lmNowDate, tmCrfSrchKey3.iEndDate(0), tmCrfSrchKey3.iEndDate(1)
                    ilRet = btrGetGreaterOrEqual(hmCrf, tmCrf, imCrfRecLen, tmCrfSrchKey3, INDEXKEY3, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
                    Do While (ilRet = BTRV_ERR_NONE) And (tmCrf.sRotType = slType) And (tmCrf.iBkoutInstAdfCode = ilAdfCode)
                        mDetermineInvDates tmCrf
                        ilRet = btrGetNext(hmCrf, tmCrf, imCrfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
                    Loop
                    mSetInvDates
                End If
            End If
            btrExtClear hmCrf   'Clear any previous extend operation
            For llLoop = 0 To UBound(tmCopyRotCode) - 1 Step 1 'lbcRotCode.ListCount - 1 Step 1
                slNameCode = tmCopyRotCode(llLoop).sKey   'lbcRotCode.List(llLoop)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                On Error GoTo mRotPopErr
                gCPErrorMsg ilRet, "mRotPop (gParseItem field 2: lbcRotCode)", Copy
                On Error GoTo 0
                slCode = Trim$(slCode)
                llRecPos = CLng(slCode)
                ilRet = btrGetDirect(hmCrf, tmCrf, imCrfRecLen, llRecPos, INDEXKEY0, BTRV_LOCK_NONE)
                On Error GoTo mRotPopErr
                gBtrvErrorMsg ilRet, "ReadClfRec (btrGetDirect):" & "Crf.Btr", Copy
                On Error GoTo 0
                ilRet = gParseItem(slNameCode, 1, "|", slCode)
                If ilRet <> CP_MSG_NONE Then
                    llCntrNo = 0
                Else
                    llCntrNo = 99999999 - CLng(slCode)
                End If
                slStr = Trim$(str$(llCntrNo)) & " i" & tmCrf.iRotNo & "|"
                slStr = slStr & Trim$(str$(tmCrf.iLen)) & "|"
                'Live Copy
                If ((Asc(tgSpf.sUsingFeatures) And LIVECOPY) = LIVECOPY) Or ((Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) = PROMOCOPY) Then 'Using Live Copy
                    If tmCrf.sLiveCopy = "L" Then
                        slStr = slStr & "LC" & "|"
                    ElseIf tmCrf.sLiveCopy = "M" Then
                        slStr = slStr & "LP" & "|"
                    ElseIf tmCrf.sLiveCopy = "S" Then
                        slStr = slStr & "RP" & "|"
                    ElseIf tmCrf.sLiveCopy = "P" Then
                        slStr = slStr & "PC" & "|"
                    ElseIf tmCrf.sLiveCopy = "Q" Then
                        slStr = slStr & "PP" & "|"
                    Else
                        slStr = slStr & "RC" & "|"
                    End If
                Else
                    slStr = slStr & "|"
                End If
                ilRet = gParseItem(slNameCode, 3, "|", slName)
                If ilRet <> CP_MSG_NONE Then
                    slName = "Missing"
                End If
                slStr = slStr & slName & "|"
                If tmCrf.sMGCopyAssign = "O" Then
                    slStr = slStr & "O" & "|"
                ElseIf tmCrf.sMGCopyAssign = "S" Then
                    slStr = slStr & "S" & "|"
                ElseIf tmCrf.sMGCopyAssign = "B" Then
                    slStr = slStr & "B" & "|"
                Else
                    ilValue = Asc(tgSpf.sMOFCopyAssign)  'Mg Copy Assignment
                    If (ilValue And MGORIGVEHONLY) = MGORIGVEHONLY Then
                        slStr = slStr & "O" & "|"
                    ElseIf (ilValue And MGSCHVEHONLY) = MGSCHVEHONLY Then
                        slStr = slStr & "S" & "|"
                    Else
                        slStr = slStr & "B" & "|"
                    End If
                End If
                If (tmCrf.lRafCode > 0) And (Trim$(tmCrf.sZone) = "R") Then
                    If (tmCrf.iBkoutInstAdfCode <= 0) And (tmCrf.iBkoutInstAdfCode <> POOLROTATION) Then
                        slStr = slStr & "r" & "|"
                    Else
                        slStr = slStr & "b" & "|"
                    End If
                Else
                    slStr = slStr & Trim$(tmCrf.sZone) & "|"
                End If
                gUnpackDate tmCrf.iStartDate(0), tmCrf.iStartDate(1), slStartDate
                gUnpackDate tmCrf.iEndDate(0), tmCrf.iEndDate(1), slEndDate
                slStr = slStr & slStartDate & "-" & slEndDate & "|"
                If tmCrf.sAirGameType = "G" Then
                    slStr = slStr & "By Event" & "|"
                    For ilDay = 0 To 6 Step 1
                        slStr = slStr & "" & "|"
                    Next ilDay
                ElseIf tmCrf.sAirGameType = "T" Then
                    slStr = slStr & "By Team" & "|"
                    For ilDay = 0 To 6 Step 1
                        slStr = slStr & "" & "|"
                    Next ilDay
                Else
                    gUnpackTime tmCrf.iStartTime(0), tmCrf.iStartTime(1), "A", "1", slStartTime
                    gUnpackTime tmCrf.iEndTime(0), tmCrf.iEndTime(1), "A", "1", slEndTime
                    slStr = slStr & slStartTime & "-" & slEndTime & "|"
                    For ilDay = 0 To 6 Step 1
                        slDay = tmCrf.sDay(ilDay)
                        If Trim$(slDay) = "" Then
                            slDay = "N"
                        End If
                        slStr = slStr & slDay & "|"
                    Next ilDay
                End If
                If (tmCrf.sInOut = "I") Or (tmCrf.sInOut = "O") Then
                    slName = "Missing"
                    slRecCode = Trim$(str$(tmCrf.ianfCode))
                    For ilTest = 0 To UBound(tmAvailCode) - 1 Step 1 'lbcAvailCode.ListCount - 1 Step 1
                        slNameCode = tmAvailCode(ilTest).sKey  'lbcAvailCode.List(ilTest)
                        ilRet = gParseItem(slNameCode, 2, "\", slCode)
                        If ilRet = CP_MSG_NONE Then
                            If slRecCode = slCode Then
                                ilRet = gParseItem(slNameCode, 1, "\", slName)
                                If tmCrf.sInOut = "O" Then
                                    slName = "" & slName
                                End If
                                Exit For
                            End If
                        End If
                    Next ilTest
                Else
                    slName = "All avails"
                End If
                slStr = slStr & slName & "|"
                Select Case tmCrf.sRotType
                    Case "A"
                        slStr = slStr & "C S" & "|"
                    Case "O"
                        If ((Asc(tgSpf.sUsingFeatures6) And BBCLOSEST) = BBCLOSEST) Then
                            slStr = slStr & "BB" & "|"
                        Else
                            slStr = slStr & "OBB" & "|"
                        End If
                    Case "C"
                        slStr = slStr & "CBB" & "|"
                    Case "E"
                        slStr = slStr & "ABB" & "|"
                End Select
                'If tgSpf.sUseProdSptScr = "P" Then
                '    'Short Title
                '    If tmCrf.lSifCode > 0 Then
                '        slStr = slStr & "Y" & "|"
                '    Else
                '        slStr = slStr & " " & "|"
                '    End If
                'Else
'                    slStr = slStr & " " & "|"
                'End If
                If tmCrf.lCsfCode > 0 Then
                    slStr = slStr & "C"
                Else
                    slStr = slStr & " "
                End If
                If Not gOkAddStrToListBox(slStr, llLen, True) Then
                    Exit For
                End If
                'slStr = gAlignStringByPixel(slStr, "|", ilListField(), ilListFieldChar())
                lbcRot.AddItem slStr
            Next llLoop
        End If
        lbcRot.AddItem "[New]", 0
    End If
    tmChf.lCode = 0
    Exit Sub
mRotPopErr:
    On Error GoTo 0
    Exit Sub
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mSaveRec                        *
'*                                                     *
'*             Created:5/14/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments:Update or added record          *
'*                                                     *
'*******************************************************
Private Function mSaveRec() As Integer
'
'   iRet = mSaveRec()
'   Where:
'       iRet (O)- True if updated or added, False if not updated or added
'
    Dim ilLoop As Integer   'For loop control
    Dim llLoop As Long
    Dim slName As String    'Name
    Dim ilRet As Integer
    Dim ilCRet As Integer
    Dim llCnfRecPos As Long
    Dim slNameCode As String  'Name and Code number
    Dim slCode As String    'Code number
    Dim slTestCode As String    'Code number
    Dim slMsg As String
    Dim ilNewRot As Integer
    Dim slDate As String
    Dim llDate As Long
    Dim ilAltered As Integer
    Dim tlCrf As CRF
    Dim tlCnf As CNF
    Dim tlCif As CIF
    Dim ilCrfRet As Integer
    Dim ilInstNo As Integer
    Dim ilRes As Integer
    Dim llRevRotNo As Long
    Dim slRevRotNo As String
    Dim llRevCntrNo As Long
    Dim slRevCntrNo As String
    Dim llIndex As Long
    Dim ilFLValue As Integer
    Dim ilDay As Integer
    Dim llStartDate As Long
    Dim llEndDate As Long
    Dim llStartTime As Long
    Dim llEndTime As Long
    Dim llTStartDate As Long
    Dim llTEndDate As Long
    Dim llTStartTime As Long
    Dim llTEndTime As Long
    Dim ilSupersede As Integer
    Dim llCrfRecPos As Long
    Dim llRStartDate As Long
    Dim llLatestDateAssg As Long
    Dim ilSDayIndex As Integer
    Dim ilEDayIndex As Integer
    Dim ilFound As Integer
    Dim ilCif As Integer
    Dim ilVef As Integer
    Dim ilCheckIfRotInPast As Integer
    Dim ilSupersedeCase As Integer '1=Mark as Dormant; 2=Set End date to startdate minus 1; 3= set old end date to new end date
    Dim ilCvf As Integer
    Dim llFirstCvfCode As Long
    ReDim llCifCode(0 To 0) As Long
    ReDim llCvfCode(0 To 0) As Long
    Dim blVehMatch As Boolean
    Dim ilEndDateChangedOnly As Integer    '01=end dated expanded only; 2= end date reduced only; 0=all other cases
    
    ilFLValue = imFLValue
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    If mTestFields(TESTALLCTRLS, ALLMANDEFINED + SHOWMSG) = NO Then
        gSetMousePointer grdRot, grdRot, vbDefault
        mSaveRec = False
        Exit Function
    End If
    If Not mTestInvDates() Then
        gSetMousePointer grdRot, grdRot, vbDefault
        imBoxNo = -1
        ilRes = MsgBox("Rotation dates cause Inventory to overlap", vbOKOnly + vbExclamation, "Error")
        mSaveRec = False
        Exit Function
    End If
    If mTestForPurge() Then
        gSetMousePointer grdRot, grdRot, vbDefault
        imBoxNo = -1
        ilRes = MsgBox("Purged/History Inventory can't be part of the Instructions", vbOKOnly + vbExclamation, "Error")
        mSaveRec = False
        Exit Function
    End If
    If UBound(tmCrfVefCode) = 0 Then
        gSetMousePointer grdRot, grdRot, vbDefault
        imBoxNo = -1
        ilRes = MsgBox("Vehicle not specified", vbOKOnly + vbExclamation, "Error")
        mSaveRec = False
        Exit Function
    End If
    '5882
'    If mTestForRegionConflicts() Then
'        gSetMousePointer grdRot, grdRot, vbDefault
'        imBoxNo = -1
'        ilRes = MsgBox("Rotation Regions in Conflict", vbOkOnly + vbExclamation, "Error")
'        mSaveRec = False
'        Exit Function
'    End If
    'Screen.MousePointer = vbHourglass  'Wait
    gSetMousePointer grdRot, grdRot, vbHourglass
    ilRet = btrBeginTrans(hmCrf, 1000)
    If ilRet <> BTRV_ERR_NONE Then
        gSetMousePointer grdRot, grdRot, vbDefault
        If ilRet = 30002 Then
            ilRet = csiHandleValue(0, 7)
        End If
        ilRet = MsgBox("File in Use [Re-save] (BeginTran" & str$(ilRet) & "), Try Later", vbOKOnly + vbExclamation, "Save Copy")
        'imTerminate = True
        mSaveRec = False
        Exit Function
    End If
    
    'TTP 11055 - Copy Changed Alert not triggered when copy was added for vehicle/week that the final log had been generated for
    ilRet = gVpfRead(True)
    
    'If (Trim$(smShtTitle) <> "") And (Trim$(smShtTitle) <> "[None]") And (tgSpf.sUseProdSptScr = "P") Then
    '    gFindMatch smShtTitle, 0, lbcShtTitle
    '    If gLastFound(lbcShtTitle) < 0 Then
    '        imSifRecLen = Len(tmSif)
    '        Do  'Loop until record updated or added
    '            tmSif.lCode = 0
    '            tmSif.iAdfCode = tmCrf.iAdfCode
    '            tmSif.sName = smShtTitle
    '            tmSif.sState = "A"
    '            tmSif.iUrfCode = tgUrf(0).iCode 'Use first record retained for user
    '            ilRet = btrInsert(hmSif, tmSif, imSifRecLen, INDEXKEY0)
    '            slMsg = "mSaveRec (btrInsert:Shot Title)"
    '        Loop While ilRet = BTRV_ERR_CONFLICT
    '        If ilRet <> BTRV_ERR_NONE Then
    '            Screen.MousePointer = vbDefault
    '            ilRet = btrAbortTrans(hmCrf)
    '            ilRet = MsgBox("Save Not Completed, Try Later", vbOkOnly + vbExclamation, "Erase")
    '            imTerminate = True
    '            mSaveRec = False
    '            Exit Function
    '        End If
    '        tmCrf.lSifCode = tmSif.lCode
    '    Else
    '        slNameCode = tmShtTitleCode(gLastFound(lbcShtTitle) - 1).sKey    'lbcShtTitleCode.List(gLastFound(lbcShtTitle) - 1)
    '        ilRet = gParseItem(slNameCode, 2, "\", slCode)
    '        tmCrf.lSifCode = Val(slCode)
    '        'Do
    '        '    tmSifSrchKey0.lCode = Val(slCode)
    '        '    ilRet = btrGetEqual(hmSif, tmSif, imSifRecLen, tmSifSrchKey0, INDEXKEY0, BTRV_LOCK_NONE)
    '        '    If ilRet <> BTRV_ERR_NONE Then
    '        '        Exit Do
    '        '    End If
    '        '    tmSif.iUrfCode = tgUrf(0).iCode 'Use first record retained for user
    '        '    ilRet = btrUpdate(hmSif, tmSif, imSifRecLen)
    '        '    slMsg = "mSaveRec (btrUpdate:Short Title)"
    '        'Loop While ilRet = BTRV_ERR_CONFLICT
    '        'On Error GoTo mSaveRecErr
    '        'gBtrvErrorMsg ilRet, slMsg, Contract
    '        'On Error GoTo 0
    '    End If
    'Else
        tmCrf.lSifCode = 0
    'End If
    ilAltered = False
    ilEndDateChangedOnly = 0
    If imRotIndex <= 0 Then
        ilNewRot = True
    Else
        If imRotHeaderChgOnly Then
            For ilLoop = imLBCtrls To UBound(tmCtrls) Step 1
                If (ilLoop <> SDATEINDEX) And (ilLoop <> EDATEINDEX) And (ilLoop <> COMMENTINDEX) Then
                    If tmCtrls(ilLoop).iChg Then
                        ilAltered = True
                        Exit For
                    End If
                End If
            Next ilLoop
        Else
            ilAltered = True
        End If
        If ilAltered Then
            ilNewRot = True
        Else
            ilNewRot = False
            If (tmCtrls(SDATEINDEX).iChg = False) And (tmCtrls(EDATEINDEX).iChg = True) And (tmCtrls(COMMENTINDEX).iChg = False) Then
                If gDateValue(smSave(4)) > gDateValue(smOrigEDate) Then
                    ilEndDateChangedOnly = 1
                ElseIf gDateValue(smSave(4)) < gDateValue(smOrigEDate) Then
                    ilEndDateChangedOnly = 2
                End If
            End If
        End If
    End If
    slDate = Format$(gNow(), "m/d/yy")
    If Not ilNewRot Then
        ilRet = mReadRec(imRotIndex, True, SETFORWRITE)
        If ilRet Then
            gUnpackDateLong tmCrf.iStartDate(0), tmCrf.iStartDate(1), llRStartDate
            If llRStartDate <= gDateValue(slDate) Then
                ilCheckIfRotInPast = False
            Else
                ilCheckIfRotInPast = True
            End If
        Else
            ilCheckIfRotInPast = False
        End If
    Else
        ilCheckIfRotInPast = True
    End If
    If ilCheckIfRotInPast Then
        If gDateValue(smSave(3)) <= gDateValue(slDate) Then
            If imAskQuestions Then
                'Screen.MousePointer = vbDefault
                gSetMousePointer grdRot, grdRot, vbDefault
                ilRet = MsgBox("Rotation specified starts on or before today's date  " & slDate, vbOKCancel + vbExclamation, "Question")
                If ilRet = vbCancel Then
                    ilCRet = btrAbortTrans(hmCrf)
                    Exit Function
                End If
                'Screen.MousePointer = vbHourglass  'Wait
                gSetMousePointer grdRot, grdRot, vbHourglass
            End If
        End If
    End If
    Do  'Loop until record updated or added
        If Not ilNewRot Then
            ilRet = mReadRec(imRotIndex, True, SETFORWRITE)
            If Not ilRet Then
                gSetMousePointer grdRot, grdRot, vbDefault
                ilCRet = btrAbortTrans(hmCrf)
                ilRet = MsgBox("File in Use [Re-save] (BeginTran), Try Later", vbOKOnly + vbExclamation, "Save Copy")
                'imTerminate = True
                mSaveRec = False
                Exit Function
            End If
            gUnpackDateLong tmCrf.iStartDate(0), tmCrf.iStartDate(1), llRStartDate
            gUnpackDateLong tmCrf.iLatestDateAssg(0), tmCrf.iLatestDateAssg(1), llLatestDateAssg
        End If
        mMoveCtrlToRec True
        'imCsfRecLen = 7 + Len(Trim$(tmCsf.sComment)) + 2   '5 = fixed record length; 2 is the length of the record which is part of the variable record
        imCsfRecLen = Len(tmCsf) '- Len(tmCsf.sComment) + Len(Trim$(tmCsf.sComment))
        If ilNewRot Then 'New selected
            'If Len(Trim$(tmCsf.sComment)) > 2 Then  'imCsfRecLen - 2 > 9 Then '-2 so the control character at the end is not counted
            If gStripChr0(tmCsf.sComment) <> "" Then
                tmCsf.lCode = 0 'Autoincrement
                ilRet = btrInsert(hmCsf, tmCsf, imCsfRecLen, INDEXKEY0)
            Else
                tmCsf.lCode = 0
                ilRet = BTRV_ERR_NONE
            End If
            slMsg = "mSaveRec (btrInsert: Comment)"
        Else 'Old record-Update
            'If Len(Trim$(tmCsf.sComment)) > 2 Then  'imCsfRecLen - 2 > 9 Then '-2 so the control character at the end is not counted
            If gStripChr0(tmCsf.sComment) <> "" Then
                If tmCsf.lCode = 0 Then
                    tmCsf.lCode = 0 'Autoincrement
                    ilRet = btrInsert(hmCsf, tmCsf, imCsfRecLen, INDEXKEY0)
                Else
                    ilRet = btrUpdate(hmCsf, tmCsf, imCsfRecLen)
                End If
            Else
                If (tmCrf.lCsfCode <> 0) And (tgSpf.sGUseAffSys <> "Y") Then
                    ilRet = btrDelete(hmCsf)
                Else
                    ilRet = BTRV_ERR_NONE
                End If
                tmCsf.lCode = 0
            End If
            slMsg = "mSaveRec (btrUpdate: Comment)"
        End If
    Loop While ilRet = BTRV_ERR_CONFLICT
    If ilRet <> BTRV_ERR_NONE Then
        gSetMousePointer grdRot, grdRot, vbDefault
        If ilRet = 30002 Then
            ilRet = csiHandleValue(0, 7)
        End If
        ilCRet = btrAbortTrans(hmCrf)
        ilRet = MsgBox("File in Use [Re-save] (Save Csf " & str$(ilRet) & "), Try Later", vbOKOnly + vbExclamation, "Save Copy")
        'imTerminate = True
        mSaveRec = False
        Exit Function
    End If
    tmCrf.lCsfCode = tmCsf.lCode
    '12/23/14: Add Copy Vehicle table
    If UBound(tmCrfVefCode) > 1 Then
        tmCrf.iVefCode = 0
        llFirstCvfCode = -1
        If Not ilNewRot Then
            If tmCrf.lCvfCode > 0 Then
                tmCvfSrchKey.lCode = tmCrf.lCvfCode
                ilRet = btrGetEqual(hmCvf, tmCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
                Do While ilRet = BTRV_ERR_NONE
                    Do While ilCvf < UBound(tmCrfVefCode)
                        For ilLoop = 0 To 99 Step 1
                            If (tgSaf(0).sSyncCopyInRot = "Y") Then
                                If ilCvf >= UBound(tmCrfVefCode) Then
                                    tmCvf.iVefCode(ilLoop) = 0
                                    tmCvf.iNextFinal(ilLoop) = 0
                                    tmCvf.iNextPrelim(ilLoop) = 0
                                Else
                                    tmCvf.iVefCode(ilLoop) = tmCrfVefCode(ilCvf).iVefCode
                                    tmCvf.iNextFinal(ilLoop) = tmCrfVefCode(ilCvf).iNextFinal
                                    tmCvf.iNextPrelim(ilLoop) = tmCrfVefCode(ilCvf).iNextPrelim
                                    ilCvf = ilCvf + 1
                                End If
                            Else
                                If ilCvf >= UBound(tmCrfVefCode) Then
                                    tmCvf.iVefCode(ilLoop) = 0
                                    tmCvf.iNextFinal(ilLoop) = 0
                                    tmCvf.iNextPrelim(ilLoop) = 0
                                Else
                                    tmCvf.iVefCode(ilLoop) = tmCrfVefCode(ilCvf).iVefCode
                                    tmCvf.iNextFinal(ilLoop) = 0
                                    tmCvf.iNextPrelim(ilLoop) = 0
                                    ilCvf = ilCvf + 1
                                End If
                            End If
                        Next ilLoop
                        ilRet = btrUpdate(hmCvf, tmCvf, imCvfRecLen)
                        If llFirstCvfCode = -1 Then
                            llFirstCvfCode = tmCvf.lCode
                        End If
                        llCvfCode(UBound(llCvfCode)) = tmCvf.lCode
                        ReDim Preserve llCvfCode(0 To UBound(llCvfCode) + 1) As Long
                        If tmCvf.lLkCvfCode <= 0 Then
                            Exit Do
                        End If
                    Loop
                    If tmCvf.lLkCvfCode <= 0 Then
                        Exit Do
                    End If
                    tmCvfSrchKey.lCode = tmCvf.lLkCvfCode
                    ilRet = btrGetEqual(hmCvf, tmCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
                    If ilCvf >= UBound(tmCrfVefCode) Then
                        ilRet = btrDelete(hmCvf)
                    End If
                Loop
            End If
        Else
            ilCvf = 0
        End If
        tmCvf.lCode = 0
        tmCvf.lCrfCode = 0
        tmCvf.lLkCvfCode = -1
        tmCvf.sUnused = ""
        Do While ilCvf < UBound(tmCrfVefCode)
            For ilLoop = 0 To 99 Step 1
                If (tgSaf(0).sSyncCopyInRot = "Y") Then
                    If ilCvf >= UBound(tmCrfVefCode) Then
                        tmCvf.iVefCode(ilLoop) = 0
                        tmCvf.iNextFinal(ilLoop) = 0
                        tmCvf.iNextPrelim(ilLoop) = 0
                    Else
                        tmCvf.iVefCode(ilLoop) = tmCrfVefCode(ilCvf).iVefCode
                        tmCvf.iNextFinal(ilLoop) = tmCrfVefCode(ilCvf).iNextFinal
                        tmCvf.iNextPrelim(ilLoop) = tmCrfVefCode(ilCvf).iNextPrelim
                        ilCvf = ilCvf + 1
                    End If
                Else
                    If ilCvf >= UBound(tmCrfVefCode) Then
                        tmCvf.iVefCode(ilLoop) = 0
                        tmCvf.iNextFinal(ilLoop) = 0
                        tmCvf.iNextPrelim(ilLoop) = 0
                    Else
                        tmCvf.iVefCode(ilLoop) = tmCrfVefCode(ilCvf).iVefCode
                        tmCvf.iNextFinal(ilLoop) = 0
                        tmCvf.iNextPrelim(ilLoop) = 0
                        ilCvf = ilCvf + 1
                    End If
                End If
            Next ilLoop
            ilRet = btrInsert(hmCvf, tmCvf, imCvfRecLen, INDEXKEY0)
            If llFirstCvfCode = -1 Then
                llFirstCvfCode = tmCvf.lCode
            End If
            llCvfCode(UBound(llCvfCode)) = tmCvf.lCode
            ReDim Preserve llCvfCode(0 To UBound(llCvfCode) + 1) As Long
            tmCvf.lCode = 0
            tmCvf.lCrfCode = 0
            tmCvf.lLkCvfCode = -1
            tmCvf.sUnused = ""
        Loop
    ElseIf UBound(tmCrfVefCode) = 1 Then
        tmCrf.iVefCode = tmCrfVefCode(0).iVefCode
        tmCrf.iNextFinal = tmCrfVefCode(0).iNextFinal
        tmCrf.iNextPrelim = tmCrfVefCode(0).iNextPrelim
        llFirstCvfCode = 0
    End If
    Do  'Loop until record updated or added
        If ilNewRot Then 'New selected

            mGetLastRotNo

            tmCrf.lCode = 0  'Autoincrement
            tmCrf.iRotNo = imLastUsedRotNo + 1
            'Obtain location from imcFinalLog pointer
            tmCrf.iNextFinal = ilFLValue
            tmCrf.iNextPrelim = ilFLValue
            slDate = Format$(gNow(), "m/d/yy")
            gPackDate slDate, tmCrf.iEntryDate(0), tmCrf.iEntryDate(1)
            tmCrf.iFeedDate(0) = 0
            tmCrf.iFeedDate(1) = 0
            tmCrf.sFeedStatus = "R"
            '12/23/14: Set Copy Vehicle table reference
            'tmCrf.lMixRotCode = 0
            tmCrf.lCvfCode = llFirstCvfCode
            tmCrf.iVersionDate(0) = 0
            tmCrf.iVersionDate(1) = 0
            tmCrf.iNoTimesMod = mDetermineModNo("SG")
            tmCrf.iEarliestDateAssg(0) = 0
            tmCrf.iEarliestDateAssg(1) = 0
            tmCrf.iLatestDateAssg(0) = 0
            tmCrf.iLatestDateAssg(1) = 0
            tmCrf.iLastDateAssg(0) = 0
            tmCrf.iLastDateAssg(1) = 0
            tmCrf.iDateAssgDone(0) = 0
            tmCrf.iDateAssgDone(1) = 0
            tmCrf.iTimeAssgDone(0) = 0
            tmCrf.iTimeAssgDone(1) = 0
            tmCrf.iAffFdDate(0) = 0
            tmCrf.iAffFdDate(1) = 0
            tmCrf.sAffFdStatus = "R"
            tmCrf.iAffFdWk = 0
            tmCrf.iAffTranDate(0) = 0
            tmCrf.iAffTranDate(1) = 0
            tmCrf.sAffXMitChar = ""
            tmCrf.iKCFdDate(0) = 0
            tmCrf.iKCFdDate(1) = 0
            tmCrf.sKCFdStatus = "R"
            tmCrf.iKCFdWk = 0
            tmCrf.iKCTranDate(0) = 0
            tmCrf.iKCTranDate(1) = 0
            tmCrf.sKCXMitChar = ""
            tmCrf.iKCNoTimesMod = mDetermineModNo("KC")
            tmCrf.iUrfCode = tgUrf(0).iCode
            tmCrf.sState = "A"
            ilRet = btrInsert(hmCrf, tmCrf, imCrfRecLen, INDEXKEY0)
            slMsg = "mSaveRec (btrInsert: Crf)"
        Else 'Old record-Update- date and/or comment changed only
            If ilFLValue <> imInitNextFinal Then
                tmCrf.iNextFinal = ilFLValue
                tmCrf.iNextPrelim = ilFLValue
            End If
            slDate = Format$(gNow(), "m/d/yy")
            gPackDate slDate, tmCrf.iVersionDate(0), tmCrf.iVersionDate(1)
            tmCrf.iFeedDate(0) = 0
            tmCrf.iFeedDate(1) = 0
            tmCrf.sFeedStatus = "R"
            'If (tmCrf.sAffFdStatus = "S") Then
            '    tmCrf.iNoTimesMod = tmCrf.iNoTimesMod + 1
            'End If
            tmCrf.iKCNoTimesMod = mDetermineModNo("KC")
            tmCrf.iNoTimesMod = mDetermineModNo("SG")
            'Restore reference
            tmCrfSrchKey.lCode = tmCrf.lCode
            ilCrfRet = btrGetEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
            tmCrf.iAffFdDate(0) = 0
            tmCrf.iAffFdDate(1) = 0
            tmCrf.sAffFdStatus = "R"
            tmCrf.iAffFdWk = 0
            tmCrf.sAffXMitChar = ""
            tmCrf.iKCFdDate(0) = 0
            tmCrf.iKCFdDate(1) = 0
            tmCrf.sKCFdStatus = "R"
            tmCrf.iKCFdWk = 0
            tmCrf.sKCXMitChar = ""
            tmCrf.iUrfCode = tgUrf(0).iCode
            ilRet = btrUpdate(hmCrf, tmCrf, imCrfRecLen)
            slMsg = "mSaveRec (btrUpdate: Crf)"
            If ilRet = BTRV_ERR_CONFLICT Then
                tmCrfSrchKey.lCode = tmCrf.lCode
                ilCrfRet = btrGetEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
                mMoveCtrlToRec True
            End If
        End If
    Loop While ilRet = BTRV_ERR_CONFLICT
    If ilRet <> BTRV_ERR_NONE Then
        gSetMousePointer grdRot, grdRot, vbDefault
        If ilRet = 30002 Then
            ilRet = csiHandleValue(0, 7)
        End If
        ilCRet = btrAbortTrans(hmCrf)
        ilRet = MsgBox("File in Use [Re-save] (Crf " & str$(ilRet) & "), Try Later", vbOKOnly + vbExclamation, "Save Copy")
        'imTerminate = True
        mSaveRec = False
        Exit Function
    End If
    
    For ilCvf = 0 To UBound(llCvfCode) - 1 Step 1
        tmCvfSrchKey.lCode = llCvfCode(ilCvf)
        ilRet = btrGetEqual(hmCvf, tmCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
        If ilRet = BTRV_ERR_NONE Then
            tmCvf.lCrfCode = tmCrf.lCode
            If ilCvf < UBound(llCvfCode) - 1 Then
                tmCvf.lLkCvfCode = llCvfCode(ilCvf + 1)
            Else
                tmCvf.lLkCvfCode = -1
            End If
            ilRet = btrUpdate(hmCvf, tmCvf, imCvfRecLen)
        End If
    Next ilCvf
    
    'Save Game/team information
    Do
        tmCafSrchKey1.lCrfCode = tmCrf.lCode
        ilRet = btrGetEqual(hmCaf, tmCaf, imCafRecLen, tmCafSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)
        If ilRet <> BTRV_ERR_NONE Then
            Exit Do
        End If
        ilRet = btrDelete(hmCaf)
    Loop
    If tmCrf.sAirGameType = "G" Then
        For ilLoop = 0 To lbcGameNo.ListCount - 1 Step 1
            If lbcGameNo.Selected(ilLoop) Then
                tmCaf.lCode = 0
                tmCaf.lCrfCode = tmCrf.lCode
                tmCaf.sType = "G"
                tmCaf.iGameNo = lbcGameNo.ItemData(ilLoop)
                tmCaf.iTeamMnfCode = 0
                tmCaf.sUnused = ""
                ilRet = btrInsert(hmCaf, tmCaf, imCafRecLen, INDEXKEY0)
                If ilRet <> BTRV_ERR_NONE Then
                    gSetMousePointer grdRot, grdRot, vbDefault
                    If ilRet = 30002 Then
                        ilRet = csiHandleValue(0, 7)
                    End If
                    ilCRet = btrAbortTrans(hmCrf)
                    ilRet = MsgBox("File in Use [Re-save] (Caf " & str$(ilRet) & "), Try Later", vbOKOnly + vbExclamation, "Save Copy Event #")
                    'imTerminate = True
                    mSaveRec = False
                    Exit Function
                End If
            End If
        Next ilLoop
    ElseIf tmCrf.sAirGameType = "T" Then
        For ilLoop = 0 To lbcTeam.ListCount - 1 Step 1
            If lbcTeam.Selected(ilLoop) Then
                tmCaf.lCode = 0
                tmCaf.lCrfCode = tmCrf.lCode
                tmCaf.sType = "T"
                tmCaf.iGameNo = 0
                tmCaf.iTeamMnfCode = lbcTeam.ItemData(ilLoop)
                tmCaf.sUnused = ""
                ilRet = btrInsert(hmCaf, tmCaf, imCafRecLen, INDEXKEY0)
                If ilRet <> BTRV_ERR_NONE Then
                    gSetMousePointer grdRot, grdRot, vbDefault
                    If ilRet = 30002 Then
                        ilRet = csiHandleValue(0, 7)
                    End If
                    ilCRet = btrAbortTrans(hmCrf)
                    ilRet = MsgBox("File in Use [Re-save] (Caf " & str$(ilRet) & "), Try Later", vbOKOnly + vbExclamation, "Save Copy Team")
                    'imTerminate = True
                    mSaveRec = False
                    Exit Function
                End If
            End If
        Next ilLoop
    End If
    
    'Update rotation assigned flag
    If (Left$(tmCrf.sZone, 1) = "R") And (tmCrf.lRafCode > 0) Then
        tmRafSrchKey.lCode = tmCrf.lRafCode
        ilRet = btrGetEqual(hmRaf, tmRaf, imRafRecLen, tmRafSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        If ilRet = BTRV_ERR_NONE Then
            tmRaf.sAssigned = "Y"
            ilRet = btrUpdate(hmRaf, tmRaf, imRafRecLen)
        End If
    End If
    '5882 no longer needed
'    'Update or add Ief (IDC export info)
'    ilRet = mUpdateOrAddIEF(tmCrf)
    
    'Unassign of start date changed
    If Not ilNewRot Then 'New selected
        If llLatestDateAssg >= llRStartDate Then
            ilRet = True
            gUnpackDateLong tmCrf.iStartDate(0), tmCrf.iStartDate(1), llStartDate
            gUnpackDateLong tmCrf.iEndDate(0), tmCrf.iEndDate(1), llEndDate
            If (llStartDate > llRStartDate) Then
                If llLatestDateAssg < llStartDate Then
                    ilRet = mUnassignSpots(False, llRStartDate, llLatestDateAssg, tmCrf, ilCRet)
                Else
                    ilRet = mUnassignSpots(False, llRStartDate, llStartDate - 1, tmCrf, ilCRet)
                End If
            End If
            If llEndDate < llLatestDateAssg Then
                ilRet = mUnassignSpots(False, llEndDate + 1, llLatestDateAssg, tmCrf, ilCRet)
            End If
            If Not ilRet Then
                gSetMousePointer grdRot, grdRot, vbDefault
                If ilCRet = 30002 Then
                    ilRet = csiHandleValue(0, 7)
                Else
                    ilRet = ilCRet
                End If
                ilCRet = btrAbortTrans(hmCrf)
                ilRet = MsgBox("File in Use [Re-save] (Unassign), Try Later" & str$(ilRet), vbOKOnly + vbExclamation, "Save Copy")
                'imTerminate = True
                mSaveRec = False
                Exit Function
            End If
        End If
    End If
    'Output instruction
    'Delete old instructions first (this is not required but do it for safety)
    If ilNewRot Then
        tmCnfSrchKey.lCrfCode = tmCrf.lCode
        tmCnfSrchKey.iInstrNo = 0
        ilRet = btrGetGreaterOrEqual(hmCnf, tmCnf, imCnfRecLen, tmCnfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
        Do While (ilRet = BTRV_ERR_NONE) And (tmCnf.lCrfCode = tmCrf.lCode)
            ilRet = btrGetPosition(hmCnf, llCnfRecPos)
            Do
                ilRet = btrDelete(hmCnf)
                If ilRet = BTRV_ERR_CONFLICT Then
                    ilCRet = btrGetDirect(hmCnf, tmCnf, imCnfRecLen, llCnfRecPos, INDEXKEY0, BTRV_LOCK_NONE)
                    If ilCRet <> BTRV_ERR_NONE Then
                        gSetMousePointer grdRot, grdRot, vbDefault
                        If ilCRet = 30002 Then
                            ilRet = csiHandleValue(0, 7)
                        Else
                            ilRet = ilCRet
                        End If
                        ilCRet = btrAbortTrans(hmCrf)
                        ilRet = MsgBox("File in Use [Re-save] (GetDirect Cnf " & str$(ilRet) & "), Try Later", vbOKOnly + vbExclamation, "Save Copy")
                        'imTerminate = True
                        mSaveRec = False
                        Exit Function
                    End If
                    'tmRec = tmCnf
                    'ilCRet = gGetByKeyForUpdate("CNF", hmCnf, tmRec)
                    'tmCnf = tmRec
                    'If ilCRet <> BTRV_ERR_NONE Then
                    '    Screen.MousePointer = vbDefault
                    '    If ilCRet = 30002 Then
                    '        ilRet = csiHandleValue(0, 7)
                    '    Else
                    '        ilRet = ilCRet
                    '    End If
                    '    ilCRet = btrAbortTrans(hmCrf)
                    '    ilRet = MsgBox("File in Use [Re-save] (GetByKey " & Str$(ilRet) & "), Try Later", vbOkOnly + vbExclamation, "Save Copy")
                    '    'imTerminate = True
                    '    mSaveRec = False
                    '    Exit Function
                    'End If
                End If
            Loop While ilRet = BTRV_ERR_CONFLICT
            If ilRet <> BTRV_ERR_NONE Then
                gSetMousePointer grdRot, grdRot, vbDefault
                If ilRet = 30002 Then
                    ilRet = csiHandleValue(0, 7)
                End If
                ilCRet = btrAbortTrans(hmCrf)
                ilRet = MsgBox("File in Use [Re-save] (Delete Cnf " & str$(ilRet) & "), Try Later", vbOKOnly + vbExclamation, "Save Copy")
                'imTerminate = True
                mSaveRec = False
                Exit Function
            End If
            ilRet = btrGetNext(hmCnf, tmCnf, imCnfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
        'Add instructions
        ilInstNo = 1
        For ilLoop = 0 To lbcInst.ListCount - 2 Step 1
            slName = lbcInst.List(ilLoop)
            gFindMatch slName, 0, lbcExpandActive
            If ((gLastFound(lbcExpandActive) > 0) And (tgSpf.sUseCartNo <> "B")) Or ((gLastFound(lbcExpandActive) > 1) And (tgSpf.sUseCartNo = "B")) Then
                If tgSpf.sUseCartNo <> "B" Then
                    slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 1).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
                Else
                    slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 2).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
                End If
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                tmCnf.lCrfCode = tmCrf.lCode
                tmCnf.iInstrNo = ilInstNo
                tmCnf.lCifCode = Val(slCode)
                tmCnf.lCode = 0
                ilRet = btrInsert(hmCnf, tmCnf, imCnfRecLen, INDEXKEY1)
                If ilRet <> BTRV_ERR_NONE Then
                    gSetMousePointer grdRot, grdRot, vbDefault
                    If ilRet = 30002 Then
                        ilRet = csiHandleValue(0, 7)
                    End If
                    ilCRet = btrAbortTrans(hmCrf)
                    ilRet = MsgBox("File in Use [Re-save] (Insert Cnf " & str$(ilRet) & "), Try Later", vbOKOnly + vbExclamation, "Save Copy")
                    'imTerminate = True
                    mSaveRec = False
                    Exit Function
                End If
                ilInstNo = ilInstNo + 1
            End If
        Next ilLoop
    End If
    'Check if this rotation supersede another rotation and if so
    'alter end date of rotation
    'Loop thru all rotation instructions for this advertiser setting the rotation dates
    'Same code in cmcErase
    ReDim lmCrfOverlap(0 To 0) As Long
    If (tmCrf.sAirGameType <> "G") And (tmCrf.sAirGameType <> "T") Then
        gUnpackDateLong tmCrf.iStartDate(0), tmCrf.iStartDate(1), llStartDate
        gUnpackDateLong tmCrf.iEndDate(0), tmCrf.iEndDate(1), llEndDate
        gUnpackTimeLong tmCrf.iStartTime(0), tmCrf.iStartTime(1), False, llStartTime
        gUnpackTimeLong tmCrf.iEndTime(0), tmCrf.iEndTime(1), True, llEndTime
        'tmCrfSrchKey1.sRotType = tmCrf.sRotType
        'tmCrfSrchKey1.iEtfCode = tmCrf.iEtfCode
        'tmCrfSrchKey1.iEnfCode = tmCrf.iEnfCode
        'tmCrfSrchKey1.iadfCode = tmCrf.iadfCode
        'tmCrfSrchKey1.lChfCode = tmCrf.lChfCode
        'tmCrfSrchKey1.lFsfCode = tmCrf.lFsfCode
        'tmCrfSrchKey1.iVefCode = tmCrf.iVefCode
        'tmCrfSrchKey1.iRotNo = 32000
        'ilRet = btrGetGreaterOrEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
        tmCrfSrchKey4.sRotType = tmCrf.sRotType
        tmCrfSrchKey4.iEtfCode = tmCrf.iEtfCode
        tmCrfSrchKey4.iEnfCode = tmCrf.iEnfCode
        tmCrfSrchKey4.iAdfCode = tmCrf.iAdfCode
        tmCrfSrchKey4.lChfCode = tmCrf.lChfCode
        tmCrfSrchKey4.lFsfCode = tmCrf.lFsfCode
        tmCrfSrchKey4.iRotNo = 32000
        ilRet = btrGetGreaterOrEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey4, INDEXKEY4, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
    Else
        tlCrf.sRotType = ""
        tlCrf.iAdfCode = -1
        tlCrf.lChfCode = -1
        tlCrf.iVefCode = -1
    End If
    'Do While (ilRet = BTRV_ERR_NONE) And (tlCrf.sRotType = tmCrf.sRotType) And (tlCrf.iEtfCode = tmCrf.iEtfCode) And (tlCrf.iEnfCode = tmCrf.iEnfCode) And (tlCrf.iadfCode = tmCrf.iadfCode) And (tlCrf.lChfCode = tmCrf.lChfCode) And (tlCrf.iVefCode = tmCrf.iVefCode)
    Do While (ilRet = BTRV_ERR_NONE) And (tlCrf.sRotType = tmCrf.sRotType) And (tlCrf.iEtfCode = tmCrf.iEtfCode) And (tlCrf.iEnfCode = tmCrf.iEnfCode) And (tlCrf.iAdfCode = tmCrf.iAdfCode) And (tlCrf.lChfCode = tmCrf.lChfCode) 'And (tlCrf.iVefCode = tmCrf.iVefCode)
        blVehMatch = mVehiclesMatch(tlCrf)
        'If (tmCrf.lCode <> tlCrf.lCode) And (tlCrf.iRotNo < tmCrf.iRotNo) And (tlCrf.iLen = tmCrf.iLen) And (tlCrf.sInOut = tmCrf.sInOut) And (tlCrf.ianfCode = tmCrf.ianfCode) And (tlCrf.sZone = tmCrf.sZone) And (tlCrf.lRafCode = tmCrf.lRafCode) And (tlCrf.sState <> "D") Then
        If (blVehMatch) And (tmCrf.lCode <> tlCrf.lCode) And (tlCrf.iRotNo < tmCrf.iRotNo) And (tlCrf.iLen = tmCrf.iLen) And (tlCrf.sInOut = tmCrf.sInOut) And (tlCrf.ianfCode = tmCrf.ianfCode) And (tlCrf.sZone = tmCrf.sZone) And (tlCrf.lRafCode = tmCrf.lRafCode) And (tlCrf.sState <> "D") Then
            'If Asc(tlCrf.sLiveCopy) < 32 Then
            If (tlCrf.sLiveCopy <> "R") And (tlCrf.sLiveCopy <> "L") And (tlCrf.sLiveCopy <> "M") And (tlCrf.sLiveCopy <> "S") And (tlCrf.sLiveCopy <> "P") And (tlCrf.sLiveCopy <> "Q") Then
                tlCrf.sLiveCopy = "R"
            End If
            'If ((tmCrf.sLiveCopy = "L") And (tlCrf.sLiveCopy = "L")) Or ((tmCrf.sLiveCopy = "M") And (tlCrf.sLiveCopy = "M")) Or ((tmCrf.sLiveCopy = "S") And (tlCrf.sLiveCopy = "S")) Or ((tmCrf.sLiveCopy = "P") And (tlCrf.sLiveCopy = "P")) Or ((tmCrf.sLiveCopy = "Q") And (tlCrf.sLiveCopy = "Q")) Or (((tmCrf.sLiveCopy = "R") Or (Trim$(tmCrf.sLiveCopy) = "")) And ((tlCrf.sLiveCopy = "R") Or (Trim$(tlCrf.sLiveCopy) = ""))) Or ((Asc(tmCrf.sLiveCopy) < 32) And (Asc(tlCrf.sLiveCopy) < 32)) Then
            If ((tmCrf.sLiveCopy = "L") And (tlCrf.sLiveCopy = "L")) Or ((tmCrf.sLiveCopy = "M") And (tlCrf.sLiveCopy = "M")) Or ((tmCrf.sLiveCopy = "S") And (tlCrf.sLiveCopy = "S")) Or ((tmCrf.sLiveCopy = "P") And (tlCrf.sLiveCopy = "P")) Or ((tmCrf.sLiveCopy = "Q") And (tlCrf.sLiveCopy = "Q")) Or (((tmCrf.sLiveCopy = "R") Or (Trim$(tmCrf.sLiveCopy) = "")) And ((tlCrf.sLiveCopy = "R") Or (Trim$(tlCrf.sLiveCopy) = ""))) Then
                ilSupersede = True
                ilSDayIndex = 0
                ilEDayIndex = 6
                If llEndDate - llStartDate < 6 Then
                    ilSDayIndex = gWeekDayLong(llStartDate)
                    ilEDayIndex = gWeekDayLong(llEndDate)
                    If ilEDayIndex < ilSDayIndex Then
                        For ilDay = ilSDayIndex To 6 Step 1
                            If (tlCrf.sDay(ilDay) = "Y") And (tmCrf.sDay(ilDay) <> "Y") Then
                                ilSupersede = False
                                Exit For
                            End If
                        Next ilDay
                        For ilDay = 0 To ilEDayIndex Step 1
                            If (tlCrf.sDay(ilDay) = "Y") And (tmCrf.sDay(ilDay) <> "Y") Then
                                ilSupersede = False
                                Exit For
                            End If
                        Next ilDay
                    Else
                        For ilDay = ilSDayIndex To ilEDayIndex Step 1
                            If (tlCrf.sDay(ilDay) = "Y") And (tmCrf.sDay(ilDay) <> "Y") Then
                                ilSupersede = False
                                Exit For
                            End If
                        Next ilDay
                    End If
                Else
                    For ilDay = ilSDayIndex To ilEDayIndex Step 1
                        If (tlCrf.sDay(ilDay) = "Y") And (tmCrf.sDay(ilDay) <> "Y") Then
                            ilSupersede = False
                            Exit For
                        End If
                    Next ilDay
                End If
                If ilSupersede Then
                    gUnpackDateLong tlCrf.iStartDate(0), tlCrf.iStartDate(1), llTStartDate
                    gUnpackDateLong tlCrf.iEndDate(0), tlCrf.iEndDate(1), llTEndDate
                    gUnpackTimeLong tlCrf.iStartTime(0), tlCrf.iStartTime(1), False, llTStartTime
                    gUnpackTimeLong tlCrf.iEndTime(0), tlCrf.iEndTime(1), True, llTEndTime
                    'If Old Time not completely covered, then leave rotation
                    If (llTStartTime < llStartTime) Or (llTEndTime > llEndTime) Then
                        ilSupersede = False
                    End If
                    'If new rotation end prior to old rotation or start after old
                    'rotation leave old roation alone
                    If (llTEndDate < llStartDate) Or (llTStartDate > llEndDate) Then
                        ilSupersede = False
                    End If
                    If ilSupersede Then
                        'llT------ => old rotation
                        ''9/22/05:  New Rules:  Retain rotation and assigned spot except if the New End date is prior
                        ''                      to the old end date.  Ask user if the Old end date should be shorten to the new end date
                        ''                      Only if yes, then remove spots between new end date + 1 and old end date
                        ''If (llTStartDate >= llStartDate) And (llTEndDate <= llEndDate) Then
                        ''    'Totally covered- remove later
                        ''    ilRet = btrGetPosition(hmCrf, lmCrfOverlap(UBound(lmCrfOverlap)))
                        ''    ReDim Preserve lmCrfOverlap(0 To UBound(lmCrfOverlap) + 1) As Long
                        ''    ilSupersede = False
                        ''ElseIf (llStartDate < llTStartDate) And (llEndDate >= llTStartDate) And (llEndDate < llTEndDate) Then
                        ''    'New rotation only covers the start date of the old rotation
                        ''    slMsg = "Rotation Partially Covering a Rotation Defined for " & Format$(llTStartDate, "m/d/yy") & " - " & Format$(llTEndDate, "m/d/yy") & ", Remove Partially Covered Rotation and Previously Assigned Copy"
                        ''    ilRes = MsgBox(slMsg, vbYesNo + vbQuestion + vbDefaultButton2, "Terminate Rotation")
                        ''    If ilRes = vbNo Then
                        ''        ilSupersede = False
                        ''    Else
                        ''        'remove later
                        ''        ilRet = btrGetPosition(hmCrf, lmCrfOverlap(UBound(lmCrfOverlap)))
                        ''        ReDim Preserve lmCrfOverlap(0 To UBound(lmCrfOverlap) + 1) As Long
                        ''        ilSupersede = False
                        ''    End If
                        ''ElseIf (llStartDate >= llTStartDate) And (llEndDate <= llTEndDate) Then
                        ''    'New only partially covered old- ask what to do
                        ''    If llStartDate > llTStartDate Then
                        ''        slMsg = "Rotation Partially Covering a Rotation Defined for " & Format$(llTStartDate, "m/d/yy") & " - " & Format$(llTEndDate, "m/d/yy") & ", Terminate Partially Covered Rotation as of " & Format$(llStartDate - 1, "m/d/yy")
                        ''    Else
                        ''        slMsg = "Rotation Partially Covering a Rotation Defined for " & Format$(llTStartDate, "m/d/yy") & " - " & Format$(llTEndDate, "m/d/yy") & ", Remove Partially Covered Rotation and Previously Assigned Copy since Start Dates Match"
                        ''    End If
                        ''    ilRes = MsgBox(slMsg, vbYesNo + vbQuestion + vbDefaultButton2, "Terminate Rotation")
                        ''    If ilRes = vbNo Then
                        ''        ilSupersede = False
                        ''    ElseIf llStartDate = llTStartDate Then
                        ''        'End date would be prior to start date- remove later
                        ''        ilRet = btrGetPosition(hmCrf, lmCrfOverlap(UBound(lmCrfOverlap)))
                        ''        ReDim Preserve lmCrfOverlap(0 To UBound(lmCrfOverlap) + 1) As Long
                        ''        ilSupersede = False
                        ''    End If
                        ''End If
                        'If (llEndDate >= llTStartDate) And (llEndDate < llTEndDate) Then
                        If (llTStartDate >= llStartDate) And (llTEndDate <= llEndDate) Then
                            '12/2/05:  Restore Totally covered- make dormant
                            ilSupersedeCase = 1
                            ilSupersede = True
                        ElseIf (llTEndDate >= llStartDate) And (llTEndDate <= llEndDate) Then
                            '12/2/05:  New roation covers end of old rotation
                            ilVef = gBinarySearchVef(tmCrf.iVefCode)
                            'If ilVef <> -1 Then
                            '    slMsg = "Rotation Defined for " & Trim$(tgMVef(ilVef).sName) & " Partially Covering a Rotation running " & " " & Format$(llTStartDate, "m/d/yy") & " - " & Format$(llTEndDate, "m/d/yy") & ", Continue Rotation after " & Format(llStartDate - 1, "m/d/yy")
                            'Else
                            '    slMsg = "Rotation Partially Covering a Rotation Defined for " & Format$(llTStartDate, "m/d/yy") & " - " & Format$(llTEndDate, "m/d/yy") & ", Continue Rotation after " & Format(llStartDate - 1, "m/d/yy")
                            'End If
                            If (lmPrevSupersedeRotStartDate <> llTStartDate) Or (lmPrevSupersedeRotEndDate <> llTEndDate) Then
                                If ilVef <> -1 Then
                                    slMsg = "Rotation Defined for " & Trim$(tgMVef(ilVef).sName) & " Partially Covering a Rotation running " & " " & Format$(llTStartDate, "m/d/yy") & " - " & Format$(llTEndDate, "m/d/yy") & ", Terminate Rotation as of " & Format(llStartDate - 1, "m/d/yy")
                                Else
                                    slMsg = "Rotation Partially Covering a Rotation Defined for " & Format$(llTStartDate, "m/d/yy") & " - " & Format$(llTEndDate, "m/d/yy") & ", Terminate Rotation as of " & Format(llStartDate - 1, "m/d/yy")
                                End If
                                'ilRes = MsgBox(slMsg, vbYesNo + vbQuestion + vbDefaultButton2, "Continue Rotation")
                                ilRes = MsgBox(slMsg, vbYesNo + vbQuestion + vbDefaultButton2, "Terminate Rotation")
                            Else
                                ilRes = imPrevSupersedeAns
                            End If
                            'If ilRes = vbYes Then
                            If ilRes = vbNo Then
                                ilSupersede = False
                            Else
                                ilSupersedeCase = 2
                                ilSupersede = True
                            End If
                            lmPrevSupersedeRotStartDate = llTStartDate
                            lmPrevSupersedeRotEndDate = llTEndDate
                            imPrevSupersedeAns = ilRes
                        ElseIf (llEndDate >= llTStartDate) And (llEndDate < llTEndDate) Then
                            ilVef = gBinarySearchVef(tmCrf.iVefCode)
                            'If ilVef <> -1 Then
                            '    slMsg = "Rotation Defined for " & Trim$(tgMVef(ilVef).sName) & " Partially Covering a Rotation running " & " " & Format$(llTStartDate, "m/d/yy") & " - " & Format$(llTEndDate, "m/d/yy") & ", Continue Rotation after " & Format(llEndDate, "m/d/yy")
                            'Else
                            '    slMsg = "Rotation Partially Covering a Rotation Defined for " & Format$(llTStartDate, "m/d/yy") & " - " & Format$(llTEndDate, "m/d/yy") & ", Continue Rotation after " & Format(llEndDate, "m/d/yy")
                            'End If
                            If (lmPrevSupersedeRotStartDate <> llTStartDate) Or (lmPrevSupersedeRotEndDate <> llTEndDate) Then
                                If ilVef <> -1 Then
                                    slMsg = "Rotation Defined for " & Trim$(tgMVef(ilVef).sName) & " Partially Covering a Rotation running " & " " & Format$(llTStartDate, "m/d/yy") & " - " & Format$(llTEndDate, "m/d/yy") & ", Terminate Rotation as of " & Format(llEndDate, "m/d/yy")
                                Else
                                    slMsg = "Rotation Partially Covering a Rotation Defined for " & Format$(llTStartDate, "m/d/yy") & " - " & Format$(llTEndDate, "m/d/yy") & ", Terminate Rotation as of " & Format(llEndDate, "m/d/yy")
                                End If
                                'ilRes = MsgBox(slMsg, vbYesNo + vbQuestion + vbDefaultButton2, "Continue Rotation")
                                ilRes = MsgBox(slMsg, vbYesNo + vbQuestion + vbDefaultButton2, "Terminate Rotation")
                            Else
                                ilRes = imPrevSupersedeAns
                            End If
                            'If ilRes = vbYes Then
                            If ilRes = vbNo Then
                                ilSupersede = False
                            Else
                                ''remove later
                                'ilRet = btrGetPosition(hmCrf, lmCrfOverlap(UBound(lmCrfOverlap)))
                                'ReDim Preserve lmCrfOverlap(0 To UBound(lmCrfOverlap) + 1) As Long
                                ilSupersedeCase = 3
                                ilSupersede = True
                            End If
                            lmPrevSupersedeRotStartDate = llTStartDate
                            lmPrevSupersedeRotEndDate = llTEndDate
                            imPrevSupersedeAns = ilRes
                        Else
                            ilSupersede = False
                        End If
                    End If
                End If
                If (ilSupersede) Then
                    ilRet = btrGetPosition(hmCrf, llCrfRecPos)
                    Do
                        '''tmRec = tlCrf
                        '''ilCRet = gGetByKeyForUpdate("CRF", hmCrf, tmRec)
                        '''tlCrf = tmRec
                        ''slDate = Format$(llStartDate - 1, "m/d/yy")
                        'slDate = Format$(llEndDate, "m/d/yy")
                        'gPackDate slDate, tlCrf.iEndDate(0), tlCrf.iEndDate(1)
                        If ilSupersedeCase = 1 Then
                            'Set Dormant flag
                            tlCrf.sState = "D"
                        ElseIf ilSupersedeCase = 2 Then
                            slDate = Format$(llStartDate - 1, "m/d/yy")
                            gPackDate slDate, tlCrf.iEndDate(0), tlCrf.iEndDate(1)
                        ElseIf ilSupersedeCase = 3 Then
                            slDate = Format$(llEndDate, "m/d/yy")
                            gPackDate slDate, tlCrf.iEndDate(0), tlCrf.iEndDate(1)
                        End If
                        ilRet = btrUpdate(hmCrf, tlCrf, imCrfRecLen)
                        If ilRet = BTRV_ERR_CONFLICT Then
                            ilCRet = btrGetDirect(hmCrf, tlCrf, imCrfRecLen, llCrfRecPos, INDEXKEY4, BTRV_LOCK_NONE)
                        End If
                    Loop While ilRet = BTRV_ERR_CONFLICT
                    If ilRet <> BTRV_ERR_NONE Then
                        gSetMousePointer grdRot, grdRot, vbDefault
                        If ilRet = 30002 Then
                            ilRet = csiHandleValue(0, 7)
                        End If
                        ilCRet = btrAbortTrans(hmCrf)
                        ilRet = MsgBox("File in Use [Re-save] (Update Supersede Crf " & str$(ilRet) & "), Try Later", vbOKOnly + vbExclamation, "Save Copy")
                        'imTerminate = True
                        mSaveRec = False
                        Exit Function
                    End If
                    '8/14/12: Speed-up setting of copy inventory rotation dates
                    ''Reset inventory rotation dates
                    'tmCnfSrchKey.lCrfCode = tlCrf.lCode
                    'tmCnfSrchKey.iInstrNo = 0
                    'ilRet = btrGetGreaterOrEqual(hmCnf, tlCnf, imCnfRecLen, tmCnfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
                    'Do While (ilRet = BTRV_ERR_NONE) And (tlCnf.lCrfCode = tlCrf.lCode)
                    '    ilRet = btrGetPosition(hmCnf, llCnfRecPos)
                    '    If tlCnf.lCifCode > 0 Then
                    '        '12/14/08:  Place setting dates to end to help speed up save
                    '        'ilRet = mSetInvRotDate(tlCnf.lCifCode, tlCrf)
                    '        If tlCrf.iBkoutInstAdfCode <= 0 Then
                    '            ilFound = False
                    '            For ilCif = 0 To UBound(tmSetInvRotDate) - 1 Step 1
                    '                If tmSetInvRotDate(ilCif).lCifCode = tlCnf.lCifCode Then
                    '                    ilFound = True
                    '                    Exit For
                    '                End If
                    '            Next ilCif
                    '            If Not ilFound Then
                    '                tmSetInvRotDate(UBound(tmSetInvRotDate)).lCifCode = tlCnf.lCifCode
                    '                If ilSupersedeCase = 1 Then
                    '                    tmSetInvRotDate(UBound(tmSetInvRotDate)).lStartDate = 0
                    '                    tmSetInvRotDate(UBound(tmSetInvRotDate)).lEndDate = 0
                    '                    ReDim Preserve tmSetInvRotDate(0 To UBound(tmSetInvRotDate) + 1) As SETINVROTDATE
                    '                Else
                    '                    tmCifSrchKey.lCode = tlCnf.lCifCode
                    '                    ilRet = btrGetEqual(hmCif, tlCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)   'Get first record as starting point of extend operation
                    '                    If ilRet = BTRV_ERR_NONE Then
                    '                        gUnpackDateLong tlCif.iRotStartDate(0), tlCif.iRotStartDate(1), tmSetInvRotDate(UBound(tmSetInvRotDate)).lStartDate
                    '                        gUnpackDateLong tlCrf.iEndDate(0), tlCrf.iEndDate(1), tmSetInvRotDate(UBound(tmSetInvRotDate)).lEndDate
                    '                        ReDim Preserve tmSetInvRotDate(0 To UBound(tmSetInvRotDate) + 1) As SETINVROTDATE
                    '                    End If
                    '                End If
                    '            End If
                    '        End If
                    '    Else
                    '        ilRet = BTRV_ERR_NONE
                    '    End If
                    '    If ilRet <> BTRV_ERR_NONE Then
                    '        Screen.MousePointer = vbDefault
                    '        If ilRet = 30002 Then
                    '            ilRet = csiHandleValue(0, 7)
                    '        End If
                    '        ilCRet = btrAbortTrans(hmCrf)
                    '        ilRet = MsgBox("File in Use [Re-save] (mSetRotDate " & Str$(ilRet) & "), Try Later", vbOkOnly + vbExclamation, "Save Copy")
                    '        'imTerminate = True
                    '        mSaveRec = False
                    '        Exit Function
                    '    End If
                    '    ilRet = btrGetDirect(hmCnf, tlCnf, imCnfRecLen, llCnfRecPos, INDEXKEY0, BTRV_LOCK_NONE)
                    '    If ilRet <> BTRV_ERR_NONE Then
                    '        Screen.MousePointer = vbDefault
                    '        If ilRet = 30002 Then
                    '            ilRet = csiHandleValue(0, 7)
                    '        End If
                    '        ilCRet = btrAbortTrans(hmCrf)
                    '        ilRet = MsgBox("File in Use [Re-save] (Get Direct Cnf " & Str$(ilRet) & "), Try Later", vbOkOnly + vbExclamation, "Save Copy")
                    '        'imTerminate = True
                    '        mSaveRec = False
                    '        Exit Function
                    '    End If
                    '    ilRet = btrGetNext(hmCnf, tlCnf, imCnfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
                    'Loop
                    ReDim llCifCode(0 To 0) As Long
                    mBuildCifArray tlCrf, llCifCode()
                    If tlCrf.sState = "D" Then
                        mAdjustCufAndCif "R", tlCrf, llCifCode()
                    Else
                        mAdjustCufAndCif "U", tlCrf, llCifCode()
                    End If
                    'Remove assign instruction from Sdf- similar code in cmcErase_Click
                    gUnpackDateLong tlCrf.iLatestDateAssg(0), tlCrf.iLatestDateAssg(1), llDate
                    'If llDate >= llStartDate Then
                    If llDate >= llEndDate + 1 Then
                        ''Remove assign instruction from Sdf
                        'ilRet = mUnassignSpots(llStartDate, 0, tlCrf, ilCRet)
                        ilRet = mUnassignSpots(False, llEndDate + 1, 0, tlCrf, ilCRet)
                        If Not ilRet Then
                            gSetMousePointer grdRot, grdRot, vbDefault
                            If ilCRet = 30002 Then
                                ilRet = csiHandleValue(0, 7)
                            Else
                                ilRet = ilCRet
                            End If
                            ilCRet = btrAbortTrans(hmCrf)
                            ilRet = MsgBox("File in Use [Re-save] (mUnassignSpots " & str$(ilRet) & "), Try Later", vbOKOnly + vbExclamation, "Save Copy")
                            'imTerminate = True
                            mSaveRec = False
                            Exit Function
                        End If
                    End If
                    '5882 no longer needed
                   ' ilRet = mUpdateOrAddIEF(tlCrf)
                    'Reset pointer within Btrieve
                    ilRet = btrGetDirect(hmCrf, tlCrf, imCrfRecLen, llCrfRecPos, INDEXKEY4, BTRV_LOCK_NONE)
                End If
            End If
        End If
        ilRet = btrGetNext(hmCrf, tlCrf, imCrfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
    'Remove rotations totally superseded
    For ilLoop = 0 To UBound(lmCrfOverlap) - 1 Step 1
        ilRet = btrGetDirect(hmCrf, tlCrf, imCrfRecLen, lmCrfOverlap(ilLoop), INDEXKEY0, BTRV_LOCK_NONE)
        If ilRet <> BTRV_ERR_NONE Then
            gSetMousePointer grdRot, grdRot, vbDefault
            If ilRet = 30002 Then
                ilRet = csiHandleValue(0, 7)
            End If
            ilCRet = btrAbortTrans(hmCrf)
            ilRet = MsgBox("File in Use [Re-save] (GetDirect Crf " & str$(ilRet) & "), Try Later", vbOKOnly + vbExclamation, "Save Copy")
            'imTerminate = True
            mSaveRec = False
            Exit Function
        End If
        ilRet = mEraseRot(tlCrf, lmCrfOverlap(ilLoop), ilCRet)
        If Not ilRet Then
            gSetMousePointer grdRot, grdRot, vbDefault
            If ilCRet = 30002 Then
                ilRet = csiHandleValue(0, 7)
            Else
                ilRet = ilCRet
            End If
            ilCRet = btrAbortTrans(hmCrf)
            ilRet = MsgBox("File in Use [Re-save] (mEraseRot), Try Later", vbOKOnly + vbExclamation, "Save Copy")
            'imTerminate = True
            mSaveRec = False
            Exit Function
        End If
    Next ilLoop
    'update inventory rotation dates
    'If dates shortened, and dates matched the original dates in the inventory, then other
    'rotation using the same inventory as used here should be check
    For ilLoop = 0 To lbcInst.ListCount - 2 Step 1  '-1 for blank line
        slName = lbcInst.List(ilLoop)
        gFindMatch slName, 0, lbcExpandActive
        If ((gLastFound(lbcExpandActive) > 0) And (tgSpf.sUseCartNo <> "B")) Or ((gLastFound(lbcExpandActive) > 1) And (tgSpf.sUseCartNo = "B")) Then
            If tgSpf.sUseCartNo <> "B" Then
                slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 1).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
            Else
                slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 2).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
            End If
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            'ilFound = False
            'For ilCif = 0 To UBound(lmCifDateSet) - 1 Step 1
            '    If Val(slCode) = lmCifDateSet(ilCif) Then
            '        ilFound = True
            '        Exit For
            '    End If
            'Next ilCif
            'If Not ilFound Then
            '    lmCifDateSet(UBound(lmCifDateSet)) = Val(slCode)
            '    ReDim Preserve lmCifDateSet(0 To UBound(lmCifDateSet) + 1) As Long
            '    ilRet = mSetInvRotDate(Val(slCode), tmCrf)
            '    If ilRet <> BTRV_ERR_NONE Then
            '        Screen.MousePointer = vbDefault
            '        If ilRet = 30002 Then
            '            ilRet = csiHandleValue(0, 7)
            '        End If
            '        ilCRet = btrAbortTrans(hmCrf)
            '        ilRet = MsgBox("File in Use [Re-save] (mSetInvRotDate " & str$(ilRet) & "), Try Later", vbOkOnly + vbExclamation, "Save Copy")
            '        'imTerminate = True
            '        mSaveRec = False
            '        Exit Function
            '    End If
            'End If
            '8/14/12: Speed-up setting of copy inventory rotation dates
            'ilFound = False
            'For ilCif = 0 To UBound(tmSetInvRotDate) - 1 Step 1
            '    If tmSetInvRotDate(ilCif).lCifCode = Val(slCode) Then
            '        ilFound = True
            '        Exit For
            '    End If
            'Next ilCif
            'If Not ilFound Then
            '    tmSetInvRotDate(UBound(tmSetInvRotDate)).lCifCode = Val(slCode)
            '    If tmCrf.iBkoutInstAdfCode <= 0 Then
            '        tmSetInvRotDate(UBound(tmSetInvRotDate)).lStartDate = 0
            '        tmSetInvRotDate(UBound(tmSetInvRotDate)).lEndDate = 0
            '        ReDim Preserve tmSetInvRotDate(0 To UBound(tmSetInvRotDate) + 1) As SETINVROTDATE
            '    Else
            '        'Set if new, otherwise ignore as inv rot date had to encompass current rotation dates to be used
            '        If imInAllSaveRec = False Then
            '            tmCifSrchKey.lCode = Val(slCode)
            '            ilRet = btrGetEqual(hmCif, tlCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)   'Get first record as starting point of extend operation
            '            If ilRet = BTRV_ERR_NONE Then
            '                gUnpackDateLong tlCif.iRotStartDate(0), tlCif.iRotStartDate(1), llStartDate
            '                gUnpackDateLong tlCif.iRotEndDate(0), tlCif.iRotEndDate(1), llEndDate
            '                If (llStartDate = 0) And (llEndDate = 0) Then
            '                    tlCif.iRotStartDate(0) = tmCrf.iStartDate(0)
            '                    tlCif.iRotStartDate(1) = tmCrf.iStartDate(1)
            '                    tlCif.iRotEndDate(0) = tmCrf.iEndDate(0)
            '                    tlCif.iRotEndDate(1) = tmCrf.iEndDate(1)
            '                    ilRet = btrUpdate(hmCif, tlCif, imCifRecLen)
            '                End If
            '                'ReDim Preserve tmSetInvRotDate(0 To UBound(tmSetInvRotDate) + 1) As SETINVROTDATE
            '            End If
            '        End If
            '    End If
            'End If
            
            ilFound = False
            For ilCif = 0 To UBound(lmCifCode) - 1 Step 1
                If lmCifCode(ilCif) = Val(slCode) Then
                    ilFound = True
                    Exit For
                End If
            Next ilCif
            If Not ilFound Then
                lmCifCode(UBound(lmCifCode)) = Val(slCode)
                ReDim Preserve lmCifCode(0 To UBound(lmCifCode) + 1) As Long
            End If
        End If
    Next ilLoop
    
    ilRet = mCreateStationRotation(tmCrf)
    
    ilRet = btrEndTrans(hmCrf)
    
    '10/23/13: Create Alters if required
    gUnpackDateLong tmCrf.iStartDate(0), tmCrf.iStartDate(1), llStartDate
    gUnpackDateLong tmCrf.iEndDate(0), tmCrf.iEndDate(1), llEndDate
    If ilNewRot Or ilEndDateChangedOnly = 0 Then
        mSetAlerts tmCrf.iVefCode, llStartDate, llEndDate, tmCrf.lCvfCode, tmCrf.lChfCode
    ElseIf ilEndDateChangedOnly = 1 Then
        mSetAlerts tmCrf.iVefCode, gDateValue(smOrigEDate) + 1, llEndDate, tmCrf.lCvfCode, tmCrf.lChfCode
    ElseIf ilEndDateChangedOnly = 2 Then
        mSetAlerts tmCrf.iVefCode, llEndDate + 1, gDateValue(smOrigEDate), tmCrf.lCvfCode, tmCrf.lChfCode
    End If
    'Save rotation number so that rotation can be selected
    llRevRotNo = 99999 - tmCrf.iRotNo
    slRevRotNo = Trim$(str$(llRevRotNo))
    Do While Len(slRevRotNo) < 6
        slRevRotNo = "0" & slRevRotNo
    Loop
    llIndex = -1
    '12/14/08:  Added to help sppedup copy, only need to populate rotations on last rotation being added
    If (imInAllSaveRec = False) And (Not grdRot.Visible) Then
        '8/14/12: SSpeed-up setting of copy inventory rotation dates
        mAdjustCufAndCif "U", tmCrf, lmCifCode()
        
        slRevCntrNo = ""
        If tmChf.lCode <> tmCrf.lChfCode Then
            tmChfSrchKey.lCode = tmCrf.lChfCode
            ilRet = btrGetEqual(hmCHF, tmChf, imCHFRecLen, tmChfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            If ilRet = BTRV_ERR_NONE Then
                llRevCntrNo = 99999999 - tmChf.lCntrNo
                slRevCntrNo = Trim$(str$(llRevCntrNo))
                Do While Len(slRevCntrNo) < 8
                    slRevCntrNo = "0" & slRevCntrNo
                Loop
            End If
        Else
            llRevCntrNo = 99999999 - tmChf.lCntrNo
            slRevCntrNo = Trim$(str$(llRevCntrNo))
            Do While Len(slRevCntrNo) < 8
                slRevCntrNo = "0" & slRevCntrNo
            Loop
        End If
        If (tmCrf.iBkoutInstAdfCode > 0) Or (tmCrf.iBkoutInstAdfCode = POOLROTATION) Then
            ReDim tmSetInvRotDate(0 To 0) As SETINVROTDATE
        End If
        '8/14/12: Speed-up setting of copy inventory rotation dates
        'mRotPop True
        mRotPop False
    'If ilNewRot Then
    '    ilIndex = 1
    'Else
    '    ilIndex = imRotIndex
    'End If
        llIndex = -1
        For llLoop = 0 To UBound(tmCopyRotCode) - 1 Step 1 'lbcRotCode.ListCount - 1 Step 1
            slNameCode = tmCopyRotCode(llLoop).sKey   'lbcRotCode.List(ilLoop)
            ilRet = gParseItem(slNameCode, 1, "\", slCode)
            'ilRet = gParseItem(slCode, 4, "|", slTestCode)
            'If slTestCode = slRevRotNo Then
            '    llIndex = llLoop + 1
            '    Exit For
            'End If
            ilRet = gParseItem(slCode, 1, "|", slTestCode)
            If (slTestCode = slRevCntrNo) Or (slRevCntrNo = "") Then
                ilRet = gParseItem(slCode, 4, "|", slTestCode)
                If slTestCode = slRevRotNo Then
                    llIndex = llLoop + 1
                    Exit For
                End If
            End If
        Next llLoop
    'End If
        For ilLoop = imLBCtrls To UBound(tmCtrls) Step 1
            tmCtrls(ilLoop).iChg = False
        Next ilLoop
        imRotHeaderChgOnly = True
        mSetCommands
        lbcRot.ListIndex = llIndex
        
        mSaveRec = True
        gSetMousePointer grdRot, grdRot, vbDefault
    Else
        mSaveRec = True
    End If
    Exit Function

End Function
'*******************************************************
'*                                                     *
'*      Procedure Name:mSaveRecChg                      *
'*                                                     *
'*             Created:5/14/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Determine if record altered and*
'*                      requires updating              *
'*                                                     *
'*******************************************************
Private Function mSaveRecChg(ilAsk As Integer) As Integer
'
'   iAsk = True
'   iRet = mSaveRecChg(iAsk)
'   Where:
'       iAsk (I)- True = Ask if changed records should be updated;
'                 False= Update record if required without asking user
'       iRet (O)- True if updated or added, False if not updated or added
'
    Dim ilRes As Integer
    Dim slMess As String
    Dim ilAltered As Integer
    Dim hlRlf As Integer
    Dim lmLock1RecCode As Integer

    ' JD 08-11-23 added a lock to save copy.
    'Record Locks
    On Error GoTo Err1
    hlRlf = CBtrvTable(TWOHANDLES)
    ilRes = btrOpen(hlRlf, "", sgDBPath & "Rlf.Btr", BTRV_OPEN_NORMAL, BTRV_OPEN_NONSHARE, BTRV_LOCK_NONE)
    
    lmLock1RecCode = gCreateLockRec(hlRlf, "Y", "S", 1, False, "")
    If lmLock1RecCode = 0 Then
        mSaveRecChg = False
        ilRes = MsgBox("Unable to save at this time. Try again in 10 seconds as another user is currently saving.", vbOKOnly + vbInformation, "Block")
        GoTo Finally
    End If
    
    ilAltered = gAnyFieldChgd(tmCtrls(), TESTALLCTRLS)
    If (imFLValue <> imInitNextFinal) Or (Not imRotHeaderChgOnly) Then
        ilAltered = YES
    End If
    If mTestFields(TESTALLCTRLS, ALLMANBLANK + NOMSG) = NO Then
        If ilAltered = YES Then
            If Not mTestRotGrid() Then
                mSaveRecChg = False
                GoTo Finally
            End If
            If ilAsk Then
                If imRotIndex > 0 Then
                    slMess = "Save Changes for " & smSave(1) ' & cbcInv.List(imCIFCODEINDEX)
                Else
                    slMess = "Add " & smSave(1)
                End If
                ilRes = MsgBox(slMess, vbYesNoCancel + vbQuestion, "Update")
                If ilRes = vbCancel Then
                    mSaveRecChg = False
                    pbcRot_Paint
                    GoTo Finally
                End If
                If ilRes = vbYes Then
                    'ilRes = mSaveRec()
                    ilRes = mAllSaveRec()
                    mSaveRecChg = ilRes
                    GoTo Finally
                End If
                If ilRes = vbNo Then
                    'cbcInv.ListIndex = 0
                End If
            Else
                'ilRes = mSaveRec()
                ilRes = mAllSaveRec()
                mSaveRecChg = ilRes
                GoTo Finally
            End If
        End If
    End If
    mSaveRecChg = True
    
Finally:
    If lmLock1RecCode <> 0 Then
        ilRes = gDeleteLockRec_ByType(hlRlf, "Y", 1)
    End If
    ilRes = btrClose(hlRlf)
    btrDestroy hlRlf
    Exit Function
    
Err1:
    mSaveRecChg = False
    If lmLock1RecCode <> 0 Then
        GoTo Finally
    End If
End Function
'*******************************************************
'*                                                     *
'*      Procedure Name:mSetChg                         *
'*                                                     *
'*             Created:5/12/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Determine if value for a       *
'*                      control is different from the  *
'*                      record                         *
'*                                                     *
'*******************************************************
Private Sub mSetChg(ilBoxNo As Integer)
'
'   mSetChg ilBoxNo
'   Where:
'       ilBoxNo (I)- Number of the Control whose value should be checked
'
    Dim slStr As String
    Dim slLiveCopy As String
    If ilBoxNo < imLBCtrls Or ilBoxNo > UBound(tmCtrls) Then
'        mSetCommands
        Exit Sub
    End If

    Select Case ilBoxNo 'Branch on box type (control)
        Case CNTRINDEX
            gSetChgFlag smOrigCntr, lbcCntr, tmCtrls(ilBoxNo)
        Case LENINDEX
            gSetChgFlag Trim$(str$(tmCrf.iLen)), lbcLen, tmCtrls(ilBoxNo)
        Case LIVECOPYINDEX
            If imSave(12) = 0 Then
                slStr = "LC"
            ElseIf imSave(12) = 1 Then
                slStr = "RC"
            ElseIf imSave(12) = 2 Then
                slStr = "LP"
            ElseIf imSave(12) = 3 Then
                slStr = "RP"
            ElseIf imSave(12) = 4 Then
                slStr = "PC"
            ElseIf imSave(12) = 5 Then
                slStr = "PP"
            Else
                slStr = ""
            End If
            If tmCrf.sLiveCopy = "L" Then
                slLiveCopy = "LC"
            ElseIf tmCrf.sLiveCopy = "M" Then
                slLiveCopy = "LP"
            ElseIf tmCrf.sLiveCopy = "S" Then
                slLiveCopy = "RP"
            ElseIf tmCrf.sLiveCopy = "P" Then
                slLiveCopy = "PC"
            ElseIf tmCrf.sLiveCopy = "Q" Then
                slLiveCopy = "PP"
            ElseIf tmCrf.sLiveCopy = "R" Then
                slLiveCopy = "RC"
            Else
                slLiveCopy = ""
            End If
            gSetChgFlagStr slLiveCopy, slStr, tmCtrls(ilBoxNo)
        Case VEHICLEINDEX 'Vehicle
            If smOrigVehicle = smSeveral Then
                If lbcVehicle.SelCount <> UBound(tmCrfVefCode) Then
                    tmCtrls(ilBoxNo).iChg = True
                End If
            Else
                gSetChgFlag smOrigVehicle, lbcVehicle, tmCtrls(ilBoxNo)
            End If
        Case MGASSIGNINDEX
            If lbcMGCopyAssign.ListIndex = 0 Then
                slStr = "O"
            ElseIf lbcMGCopyAssign.ListIndex = 1 Then
                slStr = "S"
            ElseIf lbcMGCopyAssign.ListIndex = 2 Then
                slStr = "B"
            Else
                slStr = lbcMGCopyAssign.List(lbcMGCopyAssign.ListIndex)
            End If
            gSetChgFlagStr Trim$(tmCrf.sMGCopyAssign), slStr, tmCtrls(ilBoxNo)
        Case ZONEINDEX
            gSetChgFlag smOrigZone, lbcZones, tmCtrls(ilBoxNo)
        Case SDATEINDEX
            gSetChgFlagStr smOrigSDate, smSave(3), tmCtrls(ilBoxNo)
        Case EDATEINDEX
            gSetChgFlagStr smOrigEDate, smSave(4), tmCtrls(ilBoxNo)
        Case STIMEINDEX
            If imGameVehicle Then
                tmCtrls(ilBoxNo).iChg = True
            Else
                'gSetChgFlagStr smOrigSTime, smSave(5), tmCtrls(ilBoxNo)
                'If smOrigSTime <> "" Then
                '    slStr = smOrigSTime
                'Else
                '    slStr = "12a"
                'End If
                If smOrigSTime <> "" Then
                    If (gTimeToLong(smOrigSTime, False) <> gTimeToLong(smSave(5), False)) Then
                        tmCtrls(ilBoxNo).iChg = True
                    End If
                Else
                    tmCtrls(ilBoxNo).iChg = True
                End If
            End If
        Case ETIMEINDEX
            If imGameVehicle Then
                tmCtrls(ilBoxNo).iChg = True
            Else
                'gSetChgFlagStr smOrigETime, smSave(6), tmCtrls(ilBoxNo)
                'If smOrigETime <> "" Then
                '    slStr = smOrigETime
                'Else
                '    slStr = "12a"
                'End If
                If smOrigETime <> "" Then
                    If gTimeToLong(smOrigETime, True) <> gTimeToLong(smSave(6), True) Then
                        tmCtrls(ilBoxNo).iChg = True
                    End If
                Else
                    tmCtrls(ilBoxNo).iChg = True
                End If
            End If
        Case MONINDEX To SUNINDEX
            If imGameVehicle Then
                tmCtrls(ilBoxNo).iChg = True
            Else
                If imSave(2 + ilBoxNo - MONINDEX) = 0 Then
                    slStr = "N"
                ElseIf imSave(2 + ilBoxNo - MONINDEX) = 1 Then
                    slStr = "Y"
                Else
                    slStr = ""
                End If
                gSetChgFlagStr Trim$(tmCrf.sDay(ilBoxNo - MONINDEX)), slStr, tmCtrls(ilBoxNo)
            End If
        Case AVAILINDEX
            If imSave(10) = 0 Then
                slStr = "N"
            ElseIf imSave(10) = 1 Then
                slStr = "I"
            ElseIf imSave(10) = 2 Then
                slStr = "O"
            Else
                slStr = ""
            End If
            gSetChgFlagStr Trim$(tmCrf.sInOut), slStr, tmCtrls(ilBoxNo)
        Case AVAILINDEX + 1
            If imSave(10) = 0 Then
                slStr = "0"
                gSetChgFlagStr Trim$(str$(tmCrf.ianfCode)), slStr, tmCtrls(ilBoxNo)
            Else
                gSetChgFlag smOrigAvail, lbcAvail, tmCtrls(ilBoxNo)
            End If
        Case TYPEINDEX
            gSetChgFlag smOrigType, lbcType, tmCtrls(ilBoxNo)
        Case SHTTITLEINDEX   'Short Title
            'If tgSpf.sUseProdSptScr = "P" Then
            '    gSetChgFlagStr smInitShtTitle, smShtTitle, tmCtrls(ilBoxNo)
            'End If
        Case COMMENTINDEX
            gSetChgFlag smOrigComment, edcComment, tmCtrls(ilBoxNo)
    End Select
    mSetCommands
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mSetCommands                    *
'*                                                     *
'*             Created:6/30/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Set command buttons (enable or *
'*                      disabled)                      *
'*                                                     *
'*******************************************************
Private Sub mSetCommands()
'
'   mSetCommands
'   Where:
'
    'Update button set if all mandatory fields have data and any field altered
    Dim ilAltered As Integer
    Dim ilValue As Integer
    Dim slStr As String
    Dim blInst As Boolean
    Dim llRow As Long

    ilAltered = gAnyFieldChgd(tmCtrls(), TESTALLCTRLS)
    If (imFLValue <> imInitNextFinal) Or (Not imRotHeaderChgOnly) Then
        ilAltered = True
    End If
    blInst = False
    If grdRot.Visible Then
        cmcUndo.Caption = "&Undo"
        For llRow = grdRot.FixedRows To grdRot.rows - 1 Step 1
            If grdRot.TextMatrix(llRow, COPYINDEX) <> "" Then
                cmcUndo.Caption = "C&lear"
            End If
            If grdRot.TextMatrix(llRow, REGIONNAMEINDEX) <> "" Then
                If grdRot.TextMatrix(llRow, COPYINDEX) <> "" Then
                    blInst = True
                    Exit For
                End If
            End If
        Next llRow
    Else
        cmcUndo.Caption = "&Undo"
        If (lbcInst.ListCount > 1) Then
            blInst = True
        ElseIf lbcInst.ListCount = 1 Then
            If lbcInst.ItemData(0) = POOLROTATION Then
                blInst = True
            End If
        End If
    End If
    If (mTestFields(TESTALLCTRLS, ALLMANDEFINED + NOMSG) = YES) And (ilAltered = YES) And (blInst) Then
        If imUpdateAllowed Then
            cmcUpdate.Enabled = True
        Else
            cmcUpdate.Enabled = False
        End If
    Else
        cmcUpdate.Enabled = False
    End If
    If ilAltered Then
        cbcType.Enabled = False
        cbcAdvt.Enabled = False
        cmcRot.Enabled = False
        cmcUndo.Enabled = True
    Else
        cbcType.Enabled = True
        cbcAdvt.Enabled = True
        cmcRot.Enabled = True
        cmcUndo.Enabled = False
    End If
    If (imTypeIndex >= 0) And (imAdvtIndex >= 0) Then
        lbcInv.Enabled = True
        pbcSTab.Enabled = True
        pbcTab.Enabled = True
        plcRot.Enabled = True
        pbcRot.Enabled = True
        cmcRot.Enabled = True
        lbcInst.Enabled = True
        lbcRot.Enabled = True
        ilValue = Asc(tgSpf.sUsingFeatures2)  'Option Fields in Orders/Proposals
        If (((ilValue And REGIONALCOPY) = REGIONALCOPY) Or ((ilValue And SPLITCOPY) = SPLITCOPY)) And ((tgUrf(0).sRegionCopy = "V") Or (tgUrf(0).sRegionCopy = "I")) Then
            cmcRegion.Enabled = True
        Else
            cmcRegion.Enabled = False
        End If
        If ((Asc(tgSpf.sUsingFeatures2) And SPLITCOPY) = SPLITCOPY) And ((tgUrf(0).sRegionCopy = "V") Or (tgUrf(0).sRegionCopy = "I")) Then
            If (imSave(1) <= 0) Or (Trim$(smSave(3)) = "") Or (Trim$(smSave(4)) = "") Then
                cbcBlackout.Enabled = False
                lacBlackout.Visible = False
                cbcBlackout.Visible = False
            Else
                slStr = UCase$(Trim$(lbcZones.List(imSave(1))))
                If (slStr = "[Generic]") Or (slStr = "EST") Or (slStr = "CST") Or (slStr = "MST") Or (slStr = "PST") Then
                    cbcBlackout.Enabled = False
                    lacBlackout.Visible = False
                    cbcBlackout.Visible = False
                Else
                    '2/23/10:  Remove test disallowing Blackout with ISCI X-Digital export.
                    '          I don't know why the limit was put in place.
                    '          Code exist in Affiliate X-Digital export to handle the blackout
                    'If (Asc(tgSpf.sUsingFeatures7) And XDIGITALISCIEXPORT) = XDIGITALISCIEXPORT Then
                    '    cbcBlackout.Enabled = False
                    '    lacBlackout.Visible = False
                    '    cbcBlackout.Visible = False
                    'Else
                        cbcBlackout.Enabled = True
                        lacBlackout.Visible = True
                        cbcBlackout.Visible = True
                    'End If
                End If
            End If
        Else
            cbcBlackout.Enabled = False
            lacBlackout.Visible = False
            cbcBlackout.Visible = False
        End If
    Else
        lbcInv.Enabled = False
        pbcSTab.Enabled = False
        pbcTab.Enabled = False
        plcRot.Enabled = False
        pbcRot.Enabled = False
        cmcRot.Enabled = False
        lbcInst.Enabled = False
        lbcRot.Enabled = False
        cmcRegion.Enabled = False
        cbcBlackout.Enabled = False
        lacBlackout.Visible = False
        cbcBlackout.Visible = False
    End If
    If grdRot.Visible Then
        cmcClear.Enabled = False
        cmcRatio.Enabled = False
    Else
        If (lbcInst.ListCount > 1) And (imUpdateAllowed) Then
            cmcClear.Enabled = True
        Else
            cmcClear.Enabled = False
        End If
        If (lbcInst.ListCount > 2) And (imUpdateAllowed) Then
            cmcRatio.Enabled = True
        Else
            cmcRatio.Enabled = False
        End If
    End If
    'Later- allow any unassigned rotation to be removed or any assigned rotation in the future
    'Currently only rotation in future can be erased
    If (imAllowErase) And (imRotIndex > 0) Then
        cmcErase.Enabled = True
    ElseIf (lbcRot.ListIndex < 0) And (lbcRot.ListCount > 0) Then
        cmcErase.Enabled = True
    ElseIf (lbcRot.ListIndex < 0) And (cbcAdvt.ListIndex >= 0) And (cbcAdvt.ListCount > 0) Then
        cmcErase.Enabled = True
    ElseIf (lbcRot.ListIndex < 0) And (imAdvtIndex >= 0) And (cbcAdvt.ListCount > 0) Then
        cmcErase.Enabled = True
    Else
        cmcErase.Enabled = False
    End If
    If (imAdvtIndex >= 0) Then
        cmcNewInv.Enabled = True
    Else
        cmcNewInv.Enabled = False
    End If
    If imBlackoutAdfCode = POOLROTATION Then
        cmcInv.Visible = False
        pbcInvStatus.Visible = False
    Else
        cmcInv.Visible = True
        pbcInvStatus.Visible = True
    End If
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mSetFLPointer                   *
'*                                                     *
'*             Created:6/30/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Set Final Log Pointer          *
'*                                                     *
'*******************************************************
Private Sub mSetFLPointer()
    Dim flTop As Single
    Dim flMax As Single
    Dim ilListSize As Integer

    If grdRot.Visible Then
        pbcFL.Visible = False
        Exit Sub
    End If
    If imFLValue <= 0 Then
        pbcFL.Visible = False
        Exit Sub
    End If
    flTop = (imFLValue - lbcInst.TopIndex - 1) * fgListHtArial825
    ilListSize = lbcInst.height \ fgListHtArial825
    If lbcInst.ListCount - 1 < ilListSize Then
        flMax = (lbcInst.ListCount - lbcInst.TopIndex - 2) * fgListHtArial825
    Else
        If lbcInst.ListCount - lbcInst.TopIndex - 1 < ilListSize Then
            flMax = (lbcInst.ListCount - lbcInst.TopIndex - 2) * fgListHtArial825
        Else
            flMax = (ilListSize - 1) * fgListHtArial825
        End If
    End If
    If (flTop < 0) Or (flTop > flMax) Then
        pbcFL.Visible = False
    Else
        pbcFL.Visible = True
        pbcFL.Top = plcFL.Top + flTop + 45
    End If
    mSetCommands
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mSetFocus                       *
'*                                                     *
'*             Created:5/13/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Set focus to specified control *
'*                                                     *
'*******************************************************
Private Sub mSetFocus(ilBoxNo As Integer)
'
'   mSetFocus ilBoxNo
'   Where:
'       ilBoxNo (I)- Number of the Control to be enabled
'
    If (ilBoxNo < imLBCtrls) Or (ilBoxNo > UBound(tmCtrls)) Then
        Exit Sub
    End If

    Select Case ilBoxNo 'Branch on box type (control)
        Case CNTRINDEX
            edcDropDown.SetFocus
        Case LENINDEX
            edcDropDown.SetFocus
        Case LIVECOPYINDEX
            pbcYN.SetFocus
        Case VEHICLEINDEX 'Vehicle
            edcDropDown.SetFocus
        Case MGASSIGNINDEX
            edcDropDown.SetFocus
        Case ZONEINDEX
            edcDropDown.SetFocus
        Case SDATEINDEX
            edcDropDown.SetFocus
        Case EDATEINDEX
            edcDropDown.SetFocus
        Case STIMEINDEX
            edcDropDown.SetFocus
        Case ETIMEINDEX
            edcDropDown.SetFocus
        Case MONINDEX To SUNINDEX
            pbcDay.SetFocus
        Case AVAILINDEX
            pbcAvType.SetFocus
        Case AVAILINDEX + 1
            edcDropDown.SetFocus
        Case TYPEINDEX
            edcDropDown.SetFocus
        Case SHTTITLEINDEX   'Short Title
            edcDropDown.Visible = True
            cmcDropDown.Visible = True
            edcDropDown.SetFocus
        Case COMMENTINDEX
            edcComment.SetFocus
    End Select
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mSetShow                        *
'*                                                     *
'*             Created:5/14/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Format user input for a control*
'*                      to be displayed on the form    *
'*                                                     *
'*******************************************************
Private Sub mSetShow(ilBoxNo As Integer)
'
'   mSetShow ilBoxNo
'   Where:
'       ilBoxNo (I)- Number of the Control whose value should be saved
'
    Dim ilLoop As Integer   'For loop control parameter
    Dim slStr As String
    Dim ilRet As Integer    'Return call status
    Dim slCode As String    'code number
    Dim slNameCode As String
    Dim ilAllYes As Integer
    Dim slName As String
    Dim ilRes As Integer
    Dim slShtTitle As String
    Dim llChfCode As Long
    Dim ilDay As Integer
    Dim llDate As Long
    Dim slChgSave As String

    If (ilBoxNo < imLBCtrls) Or (ilBoxNo > UBound(tmCtrls)) Then
        Exit Sub
    End If

    Select Case ilBoxNo 'Branch on box type (control)
        Case CNTRINDEX
            'Moved from edcDropDown_Change because focus was jumping to comment field (10/5/02)
            ''Test if instruction and contract product match- if no ask if OK
            If lbcCntr.ListIndex >= 0 Then
                If smSave(1) <> lbcCntr.List(lbcCntr.ListIndex) Then
                    If ((Asc(tgSpf.sUsingFeatures10) And VCREATIVEEXPORT) = VCREATIVEEXPORT) Then
                        'Force re-pop inventory
                        imSave(9) = -1
                    End If
                    imSave(12) = -1
                    gSetShow pbcRot, "", tmCtrls(LIVECOPYINDEX)
                    imVehPopReq = True
                    smSave(2) = ""
                    imCurrentAdvtIndex = -1
                    slNameCode = tmCopyCntrCode(lbcCntr.ListIndex).sKey    'lbcCntrCode.List(lbcCntr.ListIndex)
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    If tmChf.lCode <> Val(slCode) Then
                        'tmChfSrchKey.lCode = Val(slCode)
                        'ilRet = btrGetEqual(hmChf, tmChf, imChfRecLen, tmChfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                        llChfCode = Val(slCode)
                        ilRet = gObtainChfClf(hmCHF, hmClf, llChfCode, False, tmChf, tgClfCopy())
                        mLenPop
                    End If
                    If tmChf.sInvGp = "A" Then  'All Spots
                        For ilLoop = 0 To lbcInst.ListCount - 2 Step 1
                            slName = lbcInst.List(ilLoop)
                            gFindMatch slName, 0, lbcExpandActive
                            If ((gLastFound(lbcExpandActive) > 0) And (tgSpf.sUseCartNo <> "B")) Or ((gLastFound(lbcExpandActive) > 1) And (tgSpf.sUseCartNo = "B")) Then
                                If tgSpf.sUseCartNo <> "B" Then
                                    slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 1).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
                                Else
                                    slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 2).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
                                End If
                                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                                tmCifSrchKey.lCode = Val(slCode)
                                ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                                If (ilRet = BTRV_ERR_NONE) And (tmCif.lcpfCode > 0) Then
                                    tmCpfSrchKey.lCode = tmCif.lcpfCode
                                    ilRet = btrGetEqual(hmCpf, tmCpf, imCpfRecLen, tmCpfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                                    If (ilRet = BTRV_ERR_NONE) And (Trim$(tmCpf.sName) <> "") Then
                                        If tgSpf.sUseProdSptScr = "P" Then  'Short Title
                                            slShtTitle = ""
                                            If (tmChf.lSifCode > 0) Then
                                                tmSifSrchKey0.lCode = tmChf.lSifCode
                                                ilRet = btrGetEqual(hmSif, tmSif, imSifRecLen, tmSifSrchKey0, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                                                If ilRet = BTRV_ERR_NONE Then
                                                    slShtTitle = Trim$(tmSif.sName)
                                                End If
                                            End If
                                            If StrComp(Trim$(slShtTitle), Trim$(tmCpf.sName), 1) <> 0 Then
                                                ilRes = MsgBox("Short Title Names Don't Match. Copy: " & Trim$(tmCpf.sName) & " Contract: " & tmChf.sProduct, vbOKCancel + vbExclamation, "Product Conflict")
                                                If ilRes = vbCancel Then
                                                    mClearDrag
                                                    Exit Sub
                                                End If
                                            End If
                                        Else
                                            If StrComp(Trim$(tmChf.sProduct), Trim$(tmCpf.sName), 1) <> 0 Then
                                                ilRes = MsgBox("Product Names Don't Match. Copy: " & Trim$(tmCpf.sName) & " Contract: " & tmChf.sProduct & ", Clear Instruction", vbYesNo + vbQuestion, "Product Conflict")
                                                If ilRes = vbYes Then
                                                    cmcClear_Click
                                                End If
                                                Exit For
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        Next ilLoop
                    End If
                End If
            End If
            lbcCntr.Visible = False
            edcDropDown.Visible = False
            cmcDropDown.Visible = False
            If lbcCntr.ListIndex < 0 Then
                smSave(1) = ""
            Else
                smSave(1) = lbcCntr.List(lbcCntr.ListIndex)
            End If
            gSetShow pbcRot, smSave(1), tmCtrls(ilBoxNo)
        Case LENINDEX
            lbcLen.Visible = False
            edcDropDown.Visible = False
            cmcDropDown.Visible = False
            If imSave(9) <> lbcLen.ListIndex Then
                cmcClear_Click
                imVehPopReq = True
                smSave(2) = ""
                imSave(9) = lbcLen.ListIndex
                imSave(12) = -1
                gSetShow pbcRot, "", tmCtrls(LIVECOPYINDEX)
                smActiveCodeTag = ""
                lbcActive.Clear
                smPurgeCodeTag = ""
                lbcPurge.Clear
                smHistoryCodeTag = ""
                lbcHistory.Clear
                mInvPop
            End If
            If lbcLen.ListIndex < 0 Then
                slStr = ""
            Else
                slStr = lbcLen.List(lbcLen.ListIndex)
            End If
            gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
        Case LIVECOPYINDEX
            pbcYN.Visible = False  'Set visibility
            Select Case imSave(12)
                Case 0  'No
                    slStr = "LC"
                Case 1  'Yes
                    slStr = "RC"
                Case 2  'Yes
                    slStr = "LP"
                Case 3  'Yes
                    slStr = "RP"
                Case 4  'Yes
                    slStr = "PC"
                Case 5  'Yes
                    slStr = "PP"
                Case Else
                    slStr = ""
            End Select
            gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
            If imSvLive <> imSave(12) Then
                cmcClear_Click
                imVehPopReq = True
                smSave(2) = ""
                smActiveCodeTag = ""
                lbcActive.Clear
                smPurgeCodeTag = ""
                lbcPurge.Clear
                smHistoryCodeTag = ""
                lbcHistory.Clear
                mInvPop
            End If
        Case VEHICLEINDEX 'Vehicle
            lbcVehicle.Visible = False
            edcDropDown.Visible = False
            cmcDropDown.Visible = False
            If lbcVehicle.ListIndex < 0 Then
                smSave(2) = ""
            Else
                If edcDropDown.Text = "[All]" Then
                    For ilLoop = 0 To lbcVehicle.ListCount - 1 Step 1
                        lbcVehicle.Selected(ilLoop) = False
                    Next ilLoop
                    For ilLoop = 1 To lbcVehicle.ListCount - 1 Step 1  'lbcVehicleCode.ListCount - 1 Step 1
                        slStr = lbcVehicle.List(ilLoop)
                        If (InStr(1, slStr, "A:", vbTextCompare) <= 0) And (InStr(1, slStr, "H:", vbTextCompare) <= 0) Then
                            lbcVehicle.Selected(ilLoop) = True
                            edcDropDown.Text = smSeveral
                        End If
                    Next ilLoop
                End If
                If (Trim$(edcDropDown.Text) <> smSeveral) Then
                    If smOrigVehicle <> lbcVehicle.List(lbcVehicle.ListIndex) Then
                        If smSave(2) <> lbcVehicle.List(lbcVehicle.ListIndex) Then
                            'Blank dates, times and days
                            'smSave(3) = ""
                            'gSetShow pbcRot, "", tmCtrls(SDATEINDEX)
                            'smSave(4) = ""
                            'gSetShow pbcRot, "", tmCtrls(EDATEINDEX)
                            If smSave(5) <> "12M" Then
                                gSetShow pbcRot, "", tmCtrls(STIMEINDEX)
                                smSave(5) = ""
                            End If
                            If smSave(6) <> "12M" Then
                                gSetShow pbcRot, "", tmCtrls(ETIMEINDEX)
                                smSave(6) = ""
                            End If
                            ilAllYes = True
                            For ilLoop = 2 To 8 Step 1
                                If imSave(ilLoop) <> 1 Then
                                    ilAllYes = False
                                    Exit For
                                End If
                            Next ilLoop
                            If Not ilAllYes Then
                                For ilLoop = 2 To 8 Step 1
                                    imSave(ilLoop) = -1
                                    gSetShow pbcRot, "", tmCtrls(MONINDEX + ilLoop - 2)
                                Next ilLoop
                            End If
                            smSave(2) = lbcVehicle.List(lbcVehicle.ListIndex)
                            gSetShow pbcRot, smSave(2), tmCtrls(ilBoxNo)
                            mVehOptIndex    'Set zone
                            pbcRot.Cls
                            pbcRot_Paint
                            lbcTeam.Clear
                            lbcGameNo.Clear
                        End If
                    End If
                    smSave(2) = lbcVehicle.List(lbcVehicle.ListIndex)
                Else
                    If (Trim$(smSave(2)) <> smSeveral) Then
                        'Blank dates, times and days
                        'smSave(3) = ""
                        'gSetShow pbcRot, "", tmCtrls(SDATEINDEX)
                        'smSave(4) = ""
                        'gSetShow pbcRot, "", tmCtrls(EDATEINDEX)
                        If smSave(5) <> "12M" Then
                            gSetShow pbcRot, "", tmCtrls(STIMEINDEX)
                            smSave(5) = ""
                        End If
                        If smSave(6) <> "12M" Then
                            gSetShow pbcRot, "", tmCtrls(ETIMEINDEX)
                            smSave(6) = ""
                        End If
                        ilAllYes = True
                        For ilLoop = 2 To 8 Step 1
                            If imSave(ilLoop) <> 1 Then
                                ilAllYes = False
                                Exit For
                            End If
                        Next ilLoop
                        If Not ilAllYes Then
                            For ilLoop = 2 To 8 Step 1
                                imSave(ilLoop) = -1
                                gSetShow pbcRot, "", tmCtrls(MONINDEX + ilLoop - 2)
                            Next ilLoop
                        End If
                        smSave(2) = smSeveral
                        gSetShow pbcRot, smSave(2), tmCtrls(ilBoxNo)
                        mVehOptIndex    'Set zone
                        pbcRot.Cls
                        pbcRot_Paint
                    End If
                    smSave(2) = smSeveral
                End If
            End If
            mSetIfGameVehicle
            gSetShow pbcRot, smSave(2), tmCtrls(ilBoxNo)
            mRGVehPop
        Case MGASSIGNINDEX
            'mVehOptIndex
            lbcMGCopyAssign.Visible = False
            edcDropDown.Visible = False
            cmcDropDown.Visible = False
            imSave(13) = lbcMGCopyAssign.ListIndex
            If lbcMGCopyAssign.ListIndex < 0 Then
                slStr = ""
            ElseIf lbcMGCopyAssign.ListIndex = 0 Then
                slStr = "O"
            ElseIf lbcMGCopyAssign.ListIndex = 1 Then
                slStr = "S"
            ElseIf lbcMGCopyAssign.ListIndex = 2 Then
                slStr = "B"
            Else
                slStr = lbcMGCopyAssign.List(lbcMGCopyAssign.ListIndex)
            End If
            gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
        Case ZONEINDEX
            'mVehOptIndex
            lbcZones.Visible = False
            edcDropDown.Visible = False
            cmcDropDown.Visible = False
            ''1/17/14 TTP: 6599
            '11/16/17: Fixed 6599 fix. Remove day defined test
            'If (imSave(1) <> lbcZones.ListIndex) And (imSave(2) <> -1) Then
            If (imSave(1) <> lbcZones.ListIndex) Then
                If imBlackoutAdfCode > 0 Or imBlackoutAdfCode = POOLROTATION Then
                    lbcInst.Clear
                    lbcInst.AddItem " "
                    pbcLbcInst.Cls
                    imBlackoutIndex = -1
                    imBlackoutAdfCode = 0
                    smActiveCodeTag = ""
                    lbcActive.Clear
                    smPurgeCodeTag = ""
                    lbcPurge.Clear
                    smHistoryCodeTag = ""
                    lbcHistory.Clear
                    mInvPop
                End If
            End If
            mSetRGCtrl
            imSave(1) = lbcZones.ListIndex
            If lbcZones.ListIndex < 0 Then
                slStr = ""
            'ElseIf lbcZones.ListIndex = 0 Then
            '    slStr = "All"
            Else
                slStr = lbcZones.List(lbcZones.ListIndex)
            End If
            gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
            '5882 no longer needed
'            If (Trim$(smSave(3)) <> "") And (Trim$(smSave(4)) <> "") Then
'                mSetIDCDefaults
'            End If
            If grdRot.Visible Then
                grdRot.Redraw = True
                If (grdRot.TextMatrix(grdRot.FixedRows, RGVEHICLEINDEX) = "") And (grdRot.TextMatrix(grdRot.FixedRows + 1, RGVEHICLEINDEX) = "") Then
                    If (grdRot.TextMatrix(grdRot.FixedRows, COPYINDEX) = "") And (grdRot.TextMatrix(grdRot.FixedRows + 1, COPYINDEX) = "") Then
                        gSetMousePointer grdRot, grdRot, vbHourglass
                        lmGnfCode = 0
                        smGridName = "Current Working"
                        bmRetainGridCopy = True
                        bmInCmcGrid = True
                        mGridRestore
                        bmInCmcGrid = False
                        gSetMousePointer grdRot, grdRot, vbDefault
                    End If
                End If
            End If
        Case SDATEINDEX
            plcCalendar.Visible = False
            edcDropDown.Visible = False
            cmcDropDown.Visible = False
            slStr = edcDropDown.Text
            If gDateValue(smSvRotStartDate) <> gDateValue(edcDropDown.Text) Then
                imDateChanged = True
                If (smSvRotEndDate <> "") And ((imBlackoutAdfCode > 0) Or (imBlackoutAdfCode = POOLROTATION)) Then
                    mSetBlackoutInv
                    'Screen.MousePointer = vbDefault
                    gSetMousePointer grdRot, grdRot, vbDefault
                End If
            End If
            smSave(3) = edcDropDown.Text
            gSetShow pbcRot, smSave(3), tmCtrls(ilBoxNo)
            '5882 no longer needed
'            If (Trim$(smSave(3)) <> "") And (Trim$(smSave(4)) <> "") Then
'                mSetIDCDefaults
'            End If
            If (Trim$(smSave(3)) <> "") And (Trim$(smSave(4)) <> "") And imDateChanged Then
                For ilDay = 0 To 6 Step 1
                    imSave(2 + ilDay) = 0
                    slStr = "N"
                    gSetShow pbcRot, slStr, tmCtrls(MONINDEX + ilDay)
                Next ilDay
                For llDate = gDateValue(smSave(3)) To gDateValue(smSave(4)) Step 1
                    ilDay = gWeekDayLong(llDate)
                    If imSvSave(2 + ilDay) <> -1 Then
                        imSave(2 + ilDay) = imSvSave(2 + ilDay)
                    Else
                        imSave(2 + ilDay) = 1
                    End If
                    slStr = "N"
                    If imSave(2 + ilDay) = 1 Then
                        slStr = "Y"
                    End If
                    gSetShow pbcRot, slStr, tmCtrls(MONINDEX + ilDay)
                Next llDate
                For ilDay = 0 To 6 Step 1
                    If imSvSave(2 + ilDay) <> imSave(2 + ilDay) Then
                        mSetChg MONINDEX + ilDay
                    End If
                Next ilDay
                pbcRot.Cls
                pbcRot_Paint
            End If
        Case EDATEINDEX
            plcCalendar.Visible = False
            edcDropDown.Visible = False
            cmcDropDown.Visible = False
            If gDateValue(smSvRotEndDate) <> gDateValue(edcDropDown.Text) Then
                imDateChanged = True
                If (smSave(3) <> "") And ((imBlackoutAdfCode > 0) Or (imBlackoutAdfCode = POOLROTATION)) Then
                    '11/9/18: clear list only if date expanded
                    If gDateValue(edcDropDown.Text) > gDateValue(smSvRotEndDate) Then
                        mSetBlackoutInv
                        'Screen.MousePointer = vbDefault
                        gSetMousePointer grdRot, grdRot, vbDefault
                    End If
                End If
            End If
            smSave(4) = edcDropDown.Text
            gSetShow pbcRot, smSave(4), tmCtrls(ilBoxNo)
            '5882 no longer needed
'            If (Trim$(smSave(3)) <> "") And (Trim$(smSave(4)) <> "") Then
'                mSetIDCDefaults
'            End If
            'ttp 6219
            If (Trim$(smSave(3)) <> "") And (Trim$(smSave(4)) <> "") And imDateChanged Then
                For ilDay = 0 To 6 Step 1
                    imSave(2 + ilDay) = 0
                    slStr = "N"
                    gSetShow pbcRot, slStr, tmCtrls(MONINDEX + ilDay)
                Next ilDay
                For llDate = gDateValue(smSave(3)) To gDateValue(smSave(4)) Step 1
                    ilDay = gWeekDayLong(llDate)
                    If imSvSave(2 + ilDay) <> -1 Then
                        imSave(2 + ilDay) = imSvSave(2 + ilDay)
                    Else
                        imSave(2 + ilDay) = 1
                    End If
                    slStr = "N"
                    If imSave(2 + ilDay) = 1 Then
                        slStr = "Y"
                    End If
                    gSetShow pbcRot, slStr, tmCtrls(MONINDEX + ilDay)
                Next llDate
                For ilDay = 0 To 6 Step 1
                    If imSvSave(2 + ilDay) <> imSave(2 + ilDay) Then
                        mSetChg MONINDEX + ilDay
                    End If
                Next ilDay
                pbcRot.Cls
                pbcRot_Paint
            End If
        Case STIMEINDEX
            If imGameVehicle Then
                mAirGameShow
            Else
                plcTme.Visible = False
                edcDropDown.Visible = False
                cmcDropDown.Visible = False
                smSave(5) = edcDropDown.Text
                gSetShow pbcRot, smSave(5), tmCtrls(ilBoxNo)
                '5882 no longer needed
               ' mShowIDCMsg
            End If
        Case ETIMEINDEX
            plcTme.Visible = False
            edcDropDown.Visible = False
            cmcDropDown.Visible = False
            smSave(6) = edcDropDown.Text
            gSetShow pbcRot, smSave(6), tmCtrls(ilBoxNo)
            '5882 no longer needed
            'mShowIDCMsg
        Case MONINDEX To SUNINDEX
            If imGameVehicle Then
                mAirGameShow
            Else
                pbcDay.Visible = False
                Select Case imSave(2 + ilBoxNo - MONINDEX)
                    Case 0  'No
                        slStr = "N"
                    Case 1  'Yes
                        slStr = "Y"
                    Case Else
                        slStr = ""
                End Select
                gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
                '5882 no longer needed
               ' mShowIDCMsg
            End If
        Case AVAILINDEX
            pbcAvType.Visible = False  'Set visibility
            slChgSave = smSave(7)
            Select Case imSave(10)
                Case 0  'All avails
                    slStr = "All avails"
                    smSave(7) = ""
                Case 1  'Book into selected avail
                    slStr = smSave(7)
                Case 2  'Exclused selected avail
                    slStr = "" & smSave(7)    'Alt+0216 or 0248
                Case Else
                    slStr = ""
            End Select
            gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
            gSetShow pbcRot, slStr, tmCtrls(ilBoxNo + 1)
            If slChgSave <> smSave(7) Then
                pbcRot.Cls
                pbcRot_Paint
            End If
        Case AVAILINDEX + 1
            lbcAvail.Visible = False
            edcDropDown.Visible = False
            cmcDropDown.Visible = False
            If lbcAvail.ListIndex < 0 Then
                slStr = ""
            Else
                slStr = lbcAvail.List(lbcAvail.ListIndex)
            End If
            slChgSave = smSave(7)
            smSave(7) = slStr
            Select Case imSave(10)
                Case 0  'All avails
                    slStr = "All avails"
                    smSave(7) = ""
                Case 1  'Book into selected avail
                    slStr = smSave(7)
                Case 2  'Exclused selected avail
                    slStr = "" & smSave(7)    'alt + 0216 or 0248
                Case Else
                    slStr = ""
            End Select
            gSetShow pbcRot, slStr, tmCtrls(ilBoxNo - 1)
            gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
            If slChgSave <> smSave(7) Then
                pbcRot.Cls
                pbcRot_Paint
            End If
        Case TYPEINDEX
            lbcType.Visible = False
            edcDropDown.Visible = False
            cmcDropDown.Visible = False
            imSave(11) = lbcType.ListIndex
            If lbcType.ListIndex < 0 Then
                slStr = ""
            Else
                'slStr = lbcType.List(lbcType.ListIndex)
                Select Case imTypeIndex 'imSave(11)
                    Case 0
                        slStr = "C S"
                    Case 1
                        If ((Asc(tgSpf.sUsingFeatures6) And BBCLOSEST) = BBCLOSEST) Then
                            slStr = "BB"
                        Else
                            slStr = "OBB"
                        End If
                    Case 2
                        slStr = "CBB"
                    Case 3
                        slStr = "ABB"
                End Select
            End If
            gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
        Case SHTTITLEINDEX   'Short Title
            lbcShtTitle.Visible = False
            edcDropDown.Visible = False
            cmcDropDown.Visible = False
'            smProduct = edcDropDown.Text
            If (Trim$(smShtTitle) = "") Or (Trim$(smShtTitle) = "[None]") Then
                slStr = " "
            Else
                slStr = "Y"
            End If
            gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
        Case COMMENTINDEX
            edcComment.Visible = False  'Set visibility
            cmcMoveComment.Visible = False
            smComment = Trim$(edcComment.Text)
            If smComment <> "" Then
                slStr = "C"
            Else
                slStr = ""
            End If
            gSetShow pbcRot, slStr, tmCtrls(ilBoxNo)
    End Select
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mShowInvInfo                    *
'*                                                     *
'*             Created:5/14/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Show inventory information-    *
'*                      right mouse                    *
'*                                                     *
'*******************************************************
Private Sub mShowInvInfo()
    Dim slDate As String
    Dim ilRet As Integer
    Dim ilLoop As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim slName As String
    Dim ilLACIndex As Integer
    Dim ilIncIndex As Integer
    Dim ilFound As Integer
    Dim ilButtonIndex As Integer
    Dim ilPass As Integer
    Dim tlVef As VEF
    For ilLoop = 0 To 16 Step 1
        lacRotInfo(ilLoop).Caption = ""
    Next ilLoop
    ilButtonIndex = imButtonIndex
    If (imButtonIndex <= 0) Or (imButtonIndex >= lbcInv.ListCount) Then
        imButtonIndex = 0
        plcRotInfo.Visible = False
        edcToolTip.Visible = False
        Exit Sub
    End If
    If imInvStatus = 0 Then
        If tgSpf.sUseCartNo <> "B" Then
            slNameCode = tmCopyNameCode(ilButtonIndex - 1).sKey    'lbcInvCode.List(ilButtonIndex - 1)
        Else
            slNameCode = tmCopyNameCode(ilButtonIndex - 2).sKey    'lbcInvCode.List(ilButtonIndex - 1)
        End If
    Else
        slNameCode = tmCopyNameCode(ilButtonIndex).sKey    'lbcInvCode.List(ilButtonIndex - 1)
    End If
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    tmCifSrchKey.lCode = Val(slCode)
    ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    If ilRet <> BTRV_ERR_NONE Then
        plcRotInfo.Visible = False
        edcToolTip.Visible = False
        Exit Sub
    End If
    ilLACIndex = 0
    If tmCif.lcpfCode > 0 Then
        tmCpfSrchKey.lCode = tmCif.lcpfCode
        ilRet = btrGetEqual(hmCpf, tmCpf, imCpfRecLen, tmCpfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        If ilRet = BTRV_ERR_NONE Then
            lacRotInfo(ilLACIndex).Caption = "Product: #" & Trim$(tmCpf.sName) & "  Creative Title: " & Trim$(tmCpf.sCreative)
            ilLACIndex = ilLACIndex + 1
        End If
    End If
    gUnpackDate tmCif.iDateEntrd(0), tmCif.iDateEntrd(1), slDate
    lacRotInfo(ilLACIndex).Caption = "Entered Date: " & slDate
    gUnpackDate tmCif.iRotStartDate(0), tmCif.iRotStartDate(1), slDate
    If slDate <> "" Then
        lacRotInfo(ilLACIndex).Caption = lacRotInfo(ilLACIndex).Caption & "  Rotation Date: " & slDate
        gUnpackDate tmCif.iRotEndDate(0), tmCif.iRotEndDate(1), slDate
        lacRotInfo(ilLACIndex).Caption = lacRotInfo(ilLACIndex).Caption & " - " & slDate
    Else
        lacRotInfo(ilLACIndex).Caption = lacRotInfo(ilLACIndex).Caption & "  Rotation Date: Not Assigned"
    End If
    ilLACIndex = ilLACIndex + 1
    For ilPass = 0 To 1 Step 1
        ilIncIndex = 0
        tmCyfSrchKey.lCifCode = tmCif.lCode
        tmCyfSrchKey.iVefCode = 0
        tmCyfSrchKey.sSource = " "
        tmCyfSrchKey.sTimeZone = ""
        tmCyfSrchKey.lRafCode = 0
        ilRet = btrGetGreaterOrEqual(hmCyf, tmCyf, imCyfRecLen, tmCyfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)
        Do While (ilRet = BTRV_ERR_NONE) And (tmCyf.lCifCode = tmCif.lCode)
            If ((tmCyf.sSource <> "S") And (tmCyf.sSource <> "K") And (ilPass = 0)) Or ((tmCyf.sSource = "S") And (ilPass = 1)) Or ((tmCyf.sSource = "K") And (ilPass = 1)) Then
                ilFound = False
                For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1  'lbcVehicleCode.ListCount - 1 Step 1
                    slNameCode = tgCVehicle(ilLoop).sKey    'lbcVehicleCode.List(ilLoop)
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    If Val(slCode) = tmCyf.iVefCode Then
                        ilFound = True
                        'ilRet = gParseItem(slNameCode, 1, "\", slName)
                        slName = lbcVehicle.List(ilLoop)
                        ilRet = BTRV_ERR_NONE
                        Exit For
                    End If
                Next ilLoop
                If Not ilFound Then
                    tmVefSrchKey.iCode = tmCyf.iVefCode
                    ilRet = btrGetEqual(hmVef, tlVef, imVefRecLen, tmVefSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                    slName = Trim$(tlVef.sName)
                End If
                If ilRet = BTRV_ERR_NONE Then
                    gUnpackDate tmCyf.iFeedDate(0), tmCyf.iFeedDate(1), slDate
                    If (tmCyf.sSource <> "S") And (tmCyf.sSource <> "K") Then
                        If ilIncIndex = 0 Then
                            If Trim$(tmCyf.sTimeZone) <> "" Then
                                lacRotInfo(ilLACIndex).Caption = "Feed: " & slDate & " " & Trim$(tmCyf.sTimeZone) & " for " & Trim$(slName)
                            Else
                                lacRotInfo(ilLACIndex).Caption = "Feed: " & slDate & " for " & Trim$(slName)
                            End If
                            ilIncIndex = 1
                        Else
                            lacRotInfo(ilLACIndex).Caption = Left$(lacRotInfo(ilLACIndex).Caption, 30)
                            If Trim$(tmCyf.sTimeZone) <> "" Then
                                lacRotInfo(ilLACIndex).Caption = Left$(lacRotInfo(ilLACIndex).Caption & "  Feed: " & slDate & " " & Trim$(tmCyf.sTimeZone) & " for " & Trim$(slName), 60)
                            Else
                                lacRotInfo(ilLACIndex).Caption = Left$(lacRotInfo(ilLACIndex).Caption & "  Feed: " & slDate & " for " & Trim$(slName), 60)
                            End If
                            ilIncIndex = 0
                            ilLACIndex = ilLACIndex + 1
                            If ilLACIndex >= 17 Then
                                Exit Do
                            End If
                        End If
                    Else
                        If ilIncIndex = 0 Then
                            If tmCyf.sSource = "S" Then
                                lacRotInfo(ilLACIndex).Caption = "StarGuide: " & slDate & " for " & Trim$(slName)
                            Else
                                lacRotInfo(ilLACIndex).Caption = "KenCast: " & slDate & " for " & Trim$(slName)
                            End If
                            ilIncIndex = 1
                        Else
                            lacRotInfo(ilLACIndex).Caption = Left$(lacRotInfo(ilLACIndex).Caption, 30)
                            If tmCyf.sSource = "S" Then
                                lacRotInfo(ilLACIndex).Caption = Left$(lacRotInfo(ilLACIndex).Caption & "  StarGuide: " & slDate & " for " & Trim$(slName), 60)
                            Else
                                lacRotInfo(ilLACIndex).Caption = Left$(lacRotInfo(ilLACIndex).Caption & "  KenCast: " & slDate & " for " & Trim$(slName), 60)
                            End If
                            ilIncIndex = 0
                            ilLACIndex = ilLACIndex + 1
                            If ilLACIndex >= 17 Then
                                Exit Do
                            End If
                        End If
                    End If
                End If
            End If
            ilRet = btrGetNext(hmCyf, tmCyf, imCyfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
        If ilIncIndex = 1 Then
            ilLACIndex = ilLACIndex + 1
        End If
        If ilLACIndex >= 17 Then
            Exit For
        End If
        If (tgSpf.sGUseAffFeed <> "Y") Then
            Exit For
        End If
    Next ilPass
    plcRotInfo.Width = Copy.Width - plcInv.Left - plcInv.Width - 210
    plcRotInfo.Move plcInv.Left + plcInv.Width + 30, plcInst.Top, plcRotInfo.Width, lacRotInfo(ilLACIndex - 1).Top + lacRotInfo(ilLACIndex - 1).height + lacRotInfo(0).Top
    For ilLoop = 0 To ilLACIndex - 1 Step 1
        lacRotInfo(ilLoop).Left = 60    '105
        lacRotInfo(ilLoop).Width = plcRotInfo.Width - 90    '120
        Do While pbcForFontSize.TextWidth(lacRotInfo(ilLoop).Caption) > lacRotInfo(ilLoop).Width
            lacRotInfo(ilLoop).Caption = Left$(lacRotInfo(ilLoop).Caption, Len(lacRotInfo(ilLoop).Caption) - 1)
        Loop
        lacRotInfo(ilLoop).Visible = True
    Next ilLoop
    For ilLoop = ilLACIndex To 16 Step 1
        lacRotInfo(ilLoop).Visible = False
    Next ilLoop
    DoEvents
    If (imButtonIndex <= 0) Or (imButtonIndex >= lbcInv.ListCount) Then
        imButtonIndex = 0
        plcRotInfo.Visible = False
        edcToolTip.Visible = False
        Exit Sub
    End If
    plcRotInfo.Visible = True
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mShowRotInfo                    *
'*                                                     *
'*             Created:5/14/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Show rotation information-     *
'*                      right mouse                    *
'*                                                     *
'*******************************************************
Private Sub mShowRotInfo()
    Dim slDate As String
    Dim slTime As String
    Dim ilRet As Integer
    Dim ilLoop As Integer
    Dim ilButtonIndex As Integer
    Dim slShtTitle As String
    Dim llSifCode As Long
    Dim ilFound As Integer
    Dim ilMaxRow As Integer
    Dim ilValue As Integer

    For ilLoop = 0 To 16 Step 1
        lacRotInfo(ilLoop).Caption = ""
    Next ilLoop
    ilButtonIndex = imButtonIndex
    If (imButtonIndex <= 0) Or (imButtonIndex >= lbcRot.ListCount) Then
        imButtonIndex = 0
        plcRotInfo.Visible = False
        edcToolTip.Visible = False
        Exit Sub
    End If

    ilRet = mReadRec(ilButtonIndex, True, SETFORREADONLY)
    
    mShowToolTip
    
    tmUrfSrchKey.iCode = tmCrf.iUrfCode
    ilRet = btrGetEqual(hmUrf, tmUrf, imUrfRecLen, tmUrfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    If ilRet = BTRV_ERR_NONE Then
        tmUrf.sRept = gDecryptField(tmUrf.sRept)
    Else
        tmUrf.sRept = ""
    End If
    tmChfSrchKey.lCode = tmCrf.lChfCode
    ilRet = btrGetEqual(hmCHF, tmChf, imCHFRecLen, tmChfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    If (ilRet <> BTRV_ERR_NONE) Then
        lacRotInfo(0).Caption = "Rotation: #" & str$(tmCrf.iRotNo) & "  by " & Trim$(tmUrf.sRept)
    Else
        If tgSpf.sUseProdSptScr = "P" Then
            If (tmChf.lSifCode > 0) Then
                'slRecCode = Trim$(Str$(tmChf.lSifCode))
                slShtTitle = ""
                llSifCode = tmChf.lSifCode
                If tmChf.lVefCode < 0 Then
                    ilFound = False
                    tmVsfSrchKey.lCode = -tmChf.lVefCode
                    ilRet = btrGetEqual(hmVsf, tmVsf, imVsfRecLen, tmVsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                    Do While ilRet = BTRV_ERR_NONE
                        For ilLoop = LBound(tmVsf.iFSCode) To UBound(tmVsf.iFSCode) Step 1
                            If tmVsf.iFSCode(ilLoop) > 0 Then
                                If tmVsf.iFSCode(ilLoop) = tmCrf.iVefCode Then
                                    ilFound = True
                                    'slRecCode = Trim$(Str$(tmVsf.lFSComm(ilLoop)))
                                    If tmVsf.lFSComm(ilLoop) > 0 Then
                                        llSifCode = tmVsf.lFSComm(ilLoop)
                                    End If
                                    Exit For
                                End If
                            End If
                        Next ilLoop
                        If ilFound Then
                            Exit Do
                        End If
                        If tmVsf.lLkVsfCode <= 0 Then
                            Exit Do
                        End If
                        tmVsfSrchKey.lCode = tmVsf.lLkVsfCode
                        ilRet = btrGetEqual(hmVsf, tmVsf, imVsfRecLen, tmVsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                    Loop
                End If
                If llSifCode > 0 Then
                    tmSifSrchKey0.lCode = llSifCode
                    ilRet = btrGetEqual(hmSif, tmSif, imSifRecLen, tmSifSrchKey0, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                    If ilRet = BTRV_ERR_NONE Then
                        slShtTitle = Trim$(tmSif.sName)
                    End If
                End If
                'For ilLoop = 0 To UBound(tmShtTitleCode) - 1 Step 1 'lbcShtTitleCode.ListCount - 1 Step 1
                '    slNameCode = tmShtTitleCode(ilLoop).sKey   'lbcShtTitleCode.List(ilLoop)
                '    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                '    'On Error GoTo mMoveRecToCtrlErr
                '    'gCPErrorMsg ilRet, "mMoveRecToCtrl (gParseItem field 2)", Copy
                '    'On Error GoTo 0
                '    If slRecCode = slCode Then
                '        slShtTitle = lbcShtTitle.List(ilLoop + 1)
                '        Exit For
                '    End If
                'Next ilLoop
                If Len(slShtTitle) > 0 Then
                    lacRotInfo(0).Caption = "Rotation: #" & str$(tmCrf.iRotNo) & " Short Title: " & Trim$(slShtTitle) & "  by " & Trim$(tmUrf.sRept)
                Else
                    If Len(tmChf.sProduct) > 0 Then
                        lacRotInfo(0).Caption = "Rotation: #" & str$(tmCrf.iRotNo) & " Product: " & Trim$(tmChf.sProduct) & "  by " & Trim$(tmUrf.sRept)
                    Else
                        lacRotInfo(0).Caption = "Rotation: #" & str$(tmCrf.iRotNo) & "  by " & Trim$(tmUrf.sRept)
                    End If
                End If
            Else
                If Len(tmChf.sProduct) > 0 Then
                    lacRotInfo(0).Caption = "Rotation: #" & str$(tmCrf.iRotNo) & " Product: " & Trim$(tmChf.sProduct) & "  by " & Trim$(tmUrf.sRept)
                Else
                    lacRotInfo(0).Caption = "Rotation: #" & str$(tmCrf.iRotNo) & "  by " & Trim$(tmUrf.sRept)
                End If
            End If
        Else
            If Len(tmChf.sProduct) > 0 Then
                lacRotInfo(0).Caption = "Rotation: #" & str$(tmCrf.iRotNo) & " Product: " & Trim$(tmChf.sProduct) & "  by " & Trim$(tmUrf.sRept)
            Else
                lacRotInfo(0).Caption = "Rotation: #" & str$(tmCrf.iRotNo) & "  by " & Trim$(tmUrf.sRept)
            End If
        End If
    End If
    gUnpackDate tmCrf.iEntryDate(0), tmCrf.iEntryDate(1), slDate
    lacRotInfo(1).Caption = "Entered Date: " & slDate
    gUnpackDate tmCrf.iVersionDate(0), tmCrf.iVersionDate(1), slDate
    If slDate <> "" Then
        lacRotInfo(1).Caption = lacRotInfo(1).Caption & "  Revised on: " & slDate & "  Modified" & str$(tmCrf.iNoTimesMod) & " Times"
    End If
    gUnpackDate tmCrf.iEarliestDateAssg(0), tmCrf.iEarliestDateAssg(1), slDate
    If slDate = "" Then
        slDate = "-"
    End If
    lacRotInfo(2).Caption = "Date Range Assigned to:  Earliest " & slDate
    gUnpackDate tmCrf.iLatestDateAssg(0), tmCrf.iLatestDateAssg(1), slDate
    If slDate = "" Then
        slDate = "-"
    End If
    lacRotInfo(2).Caption = lacRotInfo(2).Caption & "  Latest " & slDate
    gUnpackDate tmCrf.iDateAssgDone(0), tmCrf.iDateAssgDone(1), slDate
    If slDate = "" Then
        slDate = "-"
        lacRotInfo(3).Caption = "Last Assignment Done:  Date " & slDate & "  Time -"
    Else
        gUnpackTime tmCrf.iTimeAssgDone(0), tmCrf.iTimeAssgDone(1), "A", "1", slTime
        lacRotInfo(3).Caption = "Last assignment Done:  Date " & slDate & "  Time " & slTime
    End If
    'If tmCrf.sFeedStatus = "R" Then
    '    lacRotInfo(4).Caption = "Bulk Feed:  Ready to Send"
    'ElseIf tmCrf.sFeedStatus = "P" Then
    '    lacRotInfo(4).Caption = "Bulk Feed:  Suppress "
    'ElseIf (tmCrf.sFeedStatus = "S") Or (tmCrf.sFeedStatus = "X") Then
    '    gUnpackDate tmCrf.iFeedDate(0), tmCrf.iFeedDate(1), slDate
    '    lacRotInfo(4).Caption = "Bulk Feed:  Sent " & slDate
    'Else
    '    lacRotInfo(4).Caption = ""
    'End If
    'ilMaxRow = 4
    'If (tgSpf.sGUseAffFeed = "Y") Then
    '    If (Left$(tmCrf.sZone, 1) = "R") And (tmCrf.lRafCode > 0) Then
    '        ilMaxRow = 5
    '        tmRafSrchKey.lCode = tmCrf.lRafCode
    '        ilRet = btrGetEqual(hmRaf, tmRaf, imRafRecLen, tmRafSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    '        If ilRet <> BTRV_ERR_NONE Then
    '            tmRaf.sName = ""
    '        End If
    '        If tmCrf.sAffFdStatus = "R" Then
    '            lacRotInfo(ilMaxRow).Caption = Trim$(tmRaf.sName) & " Station Feed:  Ready to Send"
    '        ElseIf tmCrf.sAffFdStatus = "P" Then
    '            lacRotInfo(ilMaxRow).Caption = Trim$(tmRaf.sName) & " Station Feed:  Suppress "
    '        ElseIf (tmCrf.sAffFdStatus = "S") Or (tmCrf.sAffFdStatus = "X") Then
    '            gUnpackDate tmCrf.iAffFdDate(0), tmCrf.iAffFdDate(1), slDate
    '            lacRotInfo(ilMaxRow).Caption = Trim$(tmRaf.sName) & " Station Feed: Sent " & slDate
    '        Else
    '            lacRotInfo(ilMaxRow).Caption = Trim$(tmRaf.sName)
    '        End If
    '    Else
    '        If (tmCrf.sAffFdStatus = "S") Or (tmCrf.sAffFdStatus = "X") Then
    '            gUnpackDate tmCrf.iAffFdDate(0), tmCrf.iAffFdDate(1), slDate
    '            lacRotInfo(ilMaxRow).Caption = "Station Feed: Sent " & slDate
    '        End If
    '    End If
    'End If
    ilMaxRow = 4
    lacRotInfo(4).Caption = ""
    lacRotInfo(5).Caption = ""
    lacRotInfo(6).Caption = ""
    If tmCrf.sFeedStatus = "R" Then
        lacRotInfo(ilMaxRow).Caption = "Bulk Feed:  Ready to Send"
        ilMaxRow = ilMaxRow + 1
    ElseIf tmCrf.sFeedStatus = "P" Then
        lacRotInfo(ilMaxRow).Caption = "Bulk Feed:  Suppress "
        ilMaxRow = ilMaxRow + 1
    ElseIf (tmCrf.sFeedStatus = "S") Or (tmCrf.sFeedStatus = "X") Then
        gUnpackDate tmCrf.iFeedDate(0), tmCrf.iFeedDate(1), slDate
        lacRotInfo(ilMaxRow).Caption = "Bulk Feed:  Sent " & slDate
        ilMaxRow = ilMaxRow + 1
    Else
        lacRotInfo(ilMaxRow).Caption = ""
    End If
    ilValue = Asc(tgSpf.sUsingFeatures2)  'Option Fields in Orders/Proposals
    If (tgSpf.sGUseAffFeed = "Y") And ((ilValue And REGIONALCOPY) = REGIONALCOPY) Then
        If (Left$(tmCrf.sZone, 1) = "R") And (tmCrf.lRafCode > 0) Then
            tmRafSrchKey.lCode = tmCrf.lRafCode
            ilRet = btrGetEqual(hmRaf, tmRaf, imRafRecLen, tmRafSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            If ilRet <> BTRV_ERR_NONE Then
                tmRaf.sName = ""
            End If
            If tmCrf.sAffFdStatus = "R" Then
                lacRotInfo(ilMaxRow).Caption = Trim$(tmRaf.sName) & " Station Feed-StarGuide:  Ready to Send"
            ElseIf tmCrf.sAffFdStatus = "P" Then
                lacRotInfo(ilMaxRow).Caption = Trim$(tmRaf.sName) & " Station Feed-StarGuide:  Suppress "
            ElseIf (tmCrf.sAffFdStatus = "S") Or (tmCrf.sAffFdStatus = "X") Then
                gUnpackDate tmCrf.iAffFdDate(0), tmCrf.iAffFdDate(1), slDate
                lacRotInfo(ilMaxRow).Caption = Trim$(tmRaf.sName) & " Station Feed-StarGuide: Sent " & slDate
            Else
                lacRotInfo(ilMaxRow).Caption = Trim$(tmRaf.sName)
            End If
        Else
            If (tmCrf.sAffFdStatus = "S") Or (tmCrf.sAffFdStatus = "X") Then
                gUnpackDate tmCrf.iAffFdDate(0), tmCrf.iAffFdDate(1), slDate
                lacRotInfo(ilMaxRow).Caption = "Station Feed-StarGuide: Sent " & slDate
            End If
        End If
        If (tmCrf.sAffFdStatus = "S") Or (tmCrf.sAffFdStatus = "X") Then
            gUnpackDate tmCrf.iAffTranDate(0), tmCrf.iAffTranDate(1), slDate
            If (slDate <> "") Then
                If gValidDate(slDate) Then
                    If lacRotInfo(ilMaxRow).Caption = "" Then
                        lacRotInfo(ilMaxRow).Caption = "Transmitted: " & slDate
                    Else
                        lacRotInfo(ilMaxRow).Caption = lacRotInfo(ilMaxRow).Caption & " Transmitted: " & slDate
                    End If
                End If
            End If
        End If
        ilMaxRow = ilMaxRow + 1
        If (Left$(tmCrf.sZone, 1) = "R") And (tmCrf.lRafCode > 0) Then
            tmRafSrchKey.lCode = tmCrf.lRafCode
            ilRet = btrGetEqual(hmRaf, tmRaf, imRafRecLen, tmRafSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            If ilRet <> BTRV_ERR_NONE Then
                tmRaf.sName = ""
            End If
            If tmCrf.sKCFdStatus = "R" Then
                lacRotInfo(ilMaxRow).Caption = Trim$(tmRaf.sName) & " Station Feed-KenCast:  Ready to Send"
            ElseIf tmCrf.sKCFdStatus = "P" Then
                lacRotInfo(ilMaxRow).Caption = Trim$(tmRaf.sName) & " Station Feed-KenCast:  Suppress "
            ElseIf (tmCrf.sKCFdStatus = "S") Or (tmCrf.sKCFdStatus = "X") Then
                gUnpackDate tmCrf.iKCFdDate(0), tmCrf.iKCFdDate(1), slDate
                lacRotInfo(ilMaxRow).Caption = Trim$(tmRaf.sName) & " Station Feed-KenCast: Sent " & slDate
            Else
                lacRotInfo(ilMaxRow).Caption = Trim$(tmRaf.sName)
            End If
        Else
            If (tmCrf.sKCFdStatus = "S") Or (tmCrf.sKCFdStatus = "X") Then
                gUnpackDate tmCrf.iKCFdDate(0), tmCrf.iKCFdDate(1), slDate
                lacRotInfo(ilMaxRow).Caption = "Station Feed-KenCast: Sent " & slDate
            End If
        End If
        If (tmCrf.sKCFdStatus = "S") Or (tmCrf.sKCFdStatus = "X") Then
            gUnpackDate tmCrf.iKCTranDate(0), tmCrf.iKCTranDate(1), slDate
            If (slDate <> "") Then
                If gValidDate(slDate) Then
                    If lacRotInfo(ilMaxRow).Caption = "" Then
                        lacRotInfo(ilMaxRow).Caption = "Transmitted: " & slDate
                    Else
                        lacRotInfo(ilMaxRow).Caption = lacRotInfo(ilMaxRow).Caption & " Transmitted: " & slDate
                    End If
                End If
            End If
        End If
    ElseIf ((ilValue And SPLITCOPY) = SPLITCOPY) Then
        If (Left$(tmCrf.sZone, 1) = "R") And (tmCrf.lRafCode > 0) Then
            tmRafSrchKey.lCode = tmCrf.lRafCode
            ilRet = btrGetEqual(hmRaf, tmRaf, imRafRecLen, tmRafSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            If ilRet <> BTRV_ERR_NONE Then
                tmRaf.sName = ""
            End If
            lacRotInfo(ilMaxRow).Caption = "Region Name: " & Trim$(tmRaf.sName)
            ilMaxRow = ilMaxRow + 1
        End If
    End If
    'plcRotInfo.Left = lbcRot.Left + lbcRot.Width \ 2 - plcRotInfo.Width \ 2
    'plcRotInfo.Top = lbcRot.Top + lbcRot.Height + 60
    'plcRotInfo.Height = 1230
    plcRotInfo.Width = 7980
    plcRotInfo.Move lbcRot.Left + lbcRot.Width \ 2 - plcRotInfo.Width \ 2, lbcRot.Top + lbcRot.height + 60, plcRotInfo.Width, lacRotInfo(ilMaxRow).Top + lacRotInfo(ilMaxRow).height + lacRotInfo(0).Top
    For ilLoop = 0 To ilMaxRow Step 1
        lacRotInfo(ilLoop).Left = 105
        lacRotInfo(ilLoop).Width = plcRotInfo.Width - 120
        lacRotInfo(ilLoop).Visible = True
    Next ilLoop
    For ilLoop = ilMaxRow + 1 To 16 Step 1
        lacRotInfo(ilLoop).Visible = False
    Next ilLoop
    DoEvents
    If (imButtonIndex <= 0) Or (imButtonIndex >= lbcRot.ListCount) Then
        imButtonIndex = 0
        plcRotInfo.Visible = False
        edcToolTip.Visible = False
        Exit Sub
    End If
    plcRotInfo.Visible = True
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mShtTitleBranch                 *
'*                                                     *
'*             Created:6/3/93        By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Set up communication to        *
'*                      advertiser Short title and     *
'*                      process communication back from*
'*                      advertiser short title         *
'*                                                     *
'*                                                     *
'*  General flow: pbc--Tab calls this function which   *
'*                initiates a task as a MODAL form.    *
'*                This form and the control loss focus *
'*                When the called task terminates two  *
'*                events are generated (Form activated;*
'*                GotFocus to pbc-Tab).  Also, control *
'*                is sent back to this function (the   *
'*                GotFocus event is initiated after    *
'*                this function finishes processing)   *
'*                                                     *
'*******************************************************
Private Function mShtTitleBranch() As Integer
'
'   ilRet = mShtTitleBranch()
'   Where:
'       ilRet (O)- True = Stay on control
'                  False = go to next control
'
    Dim ilRet As Integer
    Dim slStr As String
    Dim ilParse As Integer
    Dim ilUpdateAllowed As Integer
    Dim slNameCode As String
'    If imSelectedIndex = 0 Then 'New selected
'        imDoubleClickName = False
'        mShtTitleBranch = False
'        Exit Function
'    End If
    If (Not imDoubleClickName) And (edcDropDown.Text <> "[New]") Then
        imDoubleClickName = False
        mShtTitleBranch = False
        Exit Function
    End If
    'Unload IconTraf
    'If Not gWinRoom(igNoExeWinRes(ADVTPRODEXE)) Then
    '    imDoubleClickName = False
    '    mShtTitleBranch = True
    '    mEnableBox imBoxNo
    '    Exit Function
    'End If
    'Screen.MousePointer = vbHourGlass  'Wait
    igAdvtProdCallSource = CALLSOURCECOPY
    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 1, "\", sgAdvtProdName)
    If edcDropDown.Text = "[New]" Then
        sgAdvtProdName = sgAdvtProdName & "\" & " "
    Else
        sgAdvtProdName = sgAdvtProdName & "\" & Trim$(edcDropDown.Text)
    End If
    ilUpdateAllowed = imUpdateAllowed
    'igChildDone = False 'edcLinkDestDoneMsg.Text = ""
    'edcLinkSrceDoneMsg.Text = ""
    'If (Not igStdAloneMode) And (imShowHelpMsg) Then
        If igTestSystem Then
            slStr = "Copy^Test\" & sgUserName & "\" & Trim$(str$(igAdvtProdCallSource)) & "\" & sgAdvtProdName
        Else
            slStr = "Copy^Prod\" & sgUserName & "\" & Trim$(str$(igAdvtProdCallSource)) & "\" & sgAdvtProdName
        End If
    'Else
    '    If igTestSystem Then
    '        slStr = "Copy^Test^NOHELP\" & sgUserName & "\" & Trim$(Str$(igAdvtProdCallSource)) & "\" & sgAdvtProdName
    '    Else
    '        slStr = "Copy^Prod^NOHELP\" & sgUserName & "\" & Trim$(Str$(igAdvtProdCallSource)) & "\" & sgAdvtProdName
    '    End If
    'End If
    'lgShellRet = Shell(sgExePath & "ShtTitle.Exe " & slStr, 1)
    'Copy.Enabled = False
    ''Screen.MousePointer = vbDefault  'Wait
    'Do While Not igChildDone
    '    DoEvents
    'Loop
    sgCommandStr = slStr
    ShtTitle.Show vbModal
    slStr = sgDoneMsg
    ilParse = gParseItem(slStr, 1, "\", sgAdvtProdName)
    igAdvtProdCallSource = Val(sgAdvtProdName)
    ilParse = gParseItem(slStr, 2, "\", sgAdvtProdName)
    'Copy.Enabled = True
    'edcLinkSrceDoneMsg.Text = "Ok"
    'For ilLoop = 0 To 10
    '    DoEvents
    'Next ilLoop
    'Screen.MousePointer = vbDefault    'Default
    imDoubleClickName = False
    mShtTitleBranch = True
    imUpdateAllowed = ilUpdateAllowed
    'If imUpdateAllowed = False Then
    '    mSendHelpMsg "BF"
    'Else
    '    mSendHelpMsg "BT"
    'End If
    gShowBranner imUpdateAllowed
    If igAdvtProdCallSource = CALLDONE Then  'Done
        igAdvtProdCallSource = CALLNONE
'        gSetMenuState True
        lbcShtTitle.Clear
        'lbcShtTitleCode.Tag = ""
        smShtTitleCodeTag = ""
        mShtTitlePop
        If imTerminate Then
            mShtTitleBranch = False
            Exit Function
        End If
        gFindMatch sgAdvtProdName, 1, lbcShtTitle
        If gLastFound(lbcShtTitle) > 0 Then
            imChgMode = True
            lbcShtTitle.ListIndex = gLastFound(lbcShtTitle)
            edcDropDown.Text = lbcShtTitle.List(lbcShtTitle.ListIndex)
            imChgMode = False
            mShtTitleBranch = False
            mSetChg SHTTITLEINDEX
        Else
            imChgMode = True
            lbcShtTitle.ListIndex = -1
            edcDropDown.Text = sgAdvtProdName
            imChgMode = False
            mSetChg SHTTITLEINDEX
            edcDropDown.SetFocus
            sgAdvtProdName = ""
            Exit Function
        End If
        sgAdvtProdName = ""
    End If
    If igAdvtProdCallSource = CALLCANCELLED Then  'Cancelled
'        gSetMenuState True
        igAdvtProdCallSource = CALLNONE
        sgAdvtProdName = ""
        mEnableBox imBoxNo
        Exit Function
    End If
    If igAdvtProdCallSource = CALLTERMINATED Then
'        gSetMenuState True
        igAdvtProdCallSource = CALLNONE
        sgAdvtProdName = ""
        mEnableBox imBoxNo
        Exit Function
    End If
    Exit Function

    On Error GoTo 0
    imTerminate = True
    Exit Function
End Function
'*******************************************************
'*                                                     *
'*      Procedure Name:mShtTitlePop                    *
'*                                                     *
'*             Created:7/19/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Populate advertiser short title*
'*                      list box if required           *
'*                                                     *
'*******************************************************
Private Sub mShtTitlePop()
'
'   mShtTitlePop
'   Where:
'       ilAdvtCode (I)- Adsvertiser code value
'
    Dim ilRet As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim slName As String
    Dim ilIndex As Integer
    Dim ilAdfCode As Integer
    'If tgSpf.sUseProdSptScr <> "P" Then
        lbcShtTitle.Clear
        'lbcShtTitleCode.Clear
        ReDim tmShtTitleCode(0 To 0) As SORTCODE
        Exit Sub
    'End If
    If (cbcType.ListIndex = 0) Or ((cbcType.ListIndex <= 2) And (tgSpf.sUsingBBs = "Y")) Then
        If imAdvtIndex < 0 Then
            Exit Sub
        End If
        slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
        ilRet = gParseItem(slNameCode, 2, "\", slCode)
        ilAdfCode = Val(slCode)   '
    Else
        lbcShtTitle.Clear
        Exit Sub
    End If
    ilIndex = lbcShtTitle.ListIndex
    If ilIndex > 0 Then
        slName = lbcShtTitle.List(ilIndex)
    End If
    'Repopulate if required- if sales source changed by another user while in this screen
    'ilRet = gPopAdvtProdBox(Copy, ilAdfCode, lbcShtTitle, lbcShtTitleCode)
    ilRet = gPopShortTitleBox(Copy, ilAdfCode, lbcShtTitle, tmShtTitleCode(), smShtTitleCodeTag)
    If ilRet <> CP_MSG_NOPOPREQ Then
        On Error GoTo mShtTitlePopErr
        gCPErrorMsg ilRet, "mShtTitlePop (gIMoveListBox)", Copy
        On Error GoTo 0
        lbcShtTitle.AddItem "[None]", 0  'Force as first item on list
'            lbcShtTitle.AddItem "[New]", 0  'Force as first item on list
        imChgMode = True
        If ilIndex > 0 Then
            gFindMatch slName, 1, lbcShtTitle
            If gLastFound(lbcShtTitle) > 0 Then
                lbcShtTitle.ListIndex = gLastFound(lbcShtTitle)
            Else
                lbcShtTitle.ListIndex = -1
            End If
        Else
            lbcShtTitle.ListIndex = ilIndex
        End If
        imChgMode = False
    End If
    Exit Sub
mShtTitlePopErr:
    On Error GoTo 0
    imTerminate = True
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mTerminate                      *
'*                                                     *
'*             Created:7/19/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: terminate form                 *
'*                                                     *
'*******************************************************
Private Sub mTerminate(Optional blDone As Boolean = False)
'
'   mTerminate
'   Where:
'
    Dim ilRet As Integer
    Dim ilValue As Integer
       
    On Error Resume Next
    
    If (Asc(tgSpf.sUsingFeatures10) And VCREATIVEEXPORT) = VCREATIVEEXPORT And blDone Then
        ilRet = gGetvCreative(hmCif, imCifRecLen, hmMcf, hmCpf)
    End If
    

    imTerminate = False
    Screen.MousePointer = vbDefault
    gSetMousePointer grdRot, grdRot, vbDefault
    'Unload IconTraf
    igManUnload = YES
    Unload Copy
    igManUnload = NO
    
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mTestFields                     *
'*                                                     *
'*             Created:4/21/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments:Test fields for mandatory and   *
'*                     blanks                          *
'*                                                     *
'*******************************************************
Private Function mTestFields(ilCtrlNo As Integer, ilState As Integer) As Integer
'******************************************************************************************
'* Note: VBC id'd the following unreferenced items and handled them as described:         *
'*                                                                                        *
'* Local Variables (Removed)                                                              *
'*  slDate                        ilValue                                                 *
'******************************************************************************************

'
'   iState = ALLBLANK+NOMSG   'Blank
'   iTest = TESTALLCTRLS
'   iRet = mTestFields(iTest, iState)
'   Where:
'       iTest (I)- Test all controls or control number specified
'       iState (I)- Test one of the following:
'                  ALLBLANK=All fields blank
'                  ALLMANBLANK=All mandatory
'                    field blank
'                  ALLMANDEFINED=All mandatory
'                    fields have data
'                  Plus
'                  NOMSG=No error message shown
'                  SHOWMSG=show error message
'       iRet (O)- True if all mandatory fields blank, False if not all blank
'
'
    Dim ilRes As Integer    'Result of MsgBox
    Dim slStr As String
    Dim ilLoop As Integer
    Dim ilAnyDay As Integer
    Dim llDate As Long
    Dim ilFound As Integer
    Dim llStartDate As Long
    Dim llEndDate As Long
    Dim ilReq As Integer

    If (ilCtrlNo = CNTRINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
        If gFieldDefinedCtrl(lbcCntr, "", "Contract # must be specified", tmCtrls(CNTRINDEX).iReq, ilState) = NO Then
            If ilState = (ALLMANDEFINED + SHOWMSG) Then
                imBoxNo = CNTRINDEX
            End If
            mTestFields = NO
            Exit Function
        End If
    End If
    If (ilCtrlNo = LENINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
        If gFieldDefinedCtrl(lbcLen, "", "Length must be specified", tmCtrls(LENINDEX).iReq, ilState) = NO Then
            If ilState = (ALLMANDEFINED + SHOWMSG) Then
                imBoxNo = LENINDEX
            End If
            mTestFields = NO
            Exit Function
        End If
    End If
    If ((Asc(tgSpf.sUsingFeatures) And LIVECOPY) = LIVECOPY) Or ((Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) = PROMOCOPY) Then 'Using Live Copy
        If (ilCtrlNo = LIVECOPYINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
            Select Case imSave(12)
                Case 0
                    slStr = "LC"
                Case 1
                    slStr = "RC"
                Case 2
                    slStr = "LP"
                Case 3
                    slStr = "RP"
                Case 4
                    slStr = "PC"
                Case 5
                    slStr = "PP"
                Case Else
                    slStr = ""
            End Select
            ilReq = True
            If gFieldDefinedStr(slStr, "", "Recorded/Live Copy must be specified", ilReq, ilState) = NO Then
                If ilState = (ALLMANDEFINED + SHOWMSG) Then
                    imBoxNo = LIVECOPYINDEX
                End If
                mTestFields = NO
                Exit Function
            End If
        End If
    End If
    If (ilCtrlNo = VEHICLEINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
        If (Trim$(smSave(2)) <> "[All]") And (Trim$(smSave(2)) <> smSeveral) Then
            If gFieldDefinedCtrl(lbcVehicle, "", "Vehicle must be specified", tmCtrls(VEHICLEINDEX).iReq, ilState) = NO Then
                If ilState = (ALLMANDEFINED + SHOWMSG) Then
                    imBoxNo = VEHICLEINDEX
                End If
                mTestFields = NO
                Exit Function
            End If
            'Check that valid vehicle selected
            If (ilCtrlNo = TESTALLCTRLS) And (ilState = (ALLMANDEFINED + SHOWMSG)) Then
                mVehPop
                gFindMatch smSave(2), 0, lbcVehicle
                If gLastFound(lbcVehicle) < 0 Then
                    ilRes = MsgBox("Incorrect Vehicle specified", vbOKOnly + vbExclamation, "Incomplete")
                    imBoxNo = VEHICLEINDEX
                    mTestFields = NO
                    Exit Function
                Else
                    imChgMode = True
                    lbcVehicle.ListIndex = gLastFound(lbcVehicle)
                    lbcVehicle.Selected(lbcVehicle.ListIndex) = True
                    imChgMode = False
                End If
            End If
        End If
    End If
    If (ilCtrlNo = MGASSIGNINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
        If gFieldDefinedCtrl(lbcMGCopyAssign, "", "MG and Outside Assign by", tmCtrls(MGASSIGNINDEX).iReq, ilState) = NO Then
            If ilState = (ALLMANDEFINED + SHOWMSG) Then
                imBoxNo = MGASSIGNINDEX
            End If
            mTestFields = NO
            Exit Function
        End If
        'Check that valid zone selected
        If (ilCtrlNo = TESTALLCTRLS) And (ilState = (ALLMANDEFINED + SHOWMSG)) Then
            If imSave(13) >= lbcMGCopyAssign.ListCount Then
                ilRes = MsgBox("Incorrect MG and Outside Assign by specified", vbOKOnly + vbExclamation, "Incomplete")
                imBoxNo = MGASSIGNINDEX
                mTestFields = NO
                Exit Function
            End If
        End If
    End If
    If (ilCtrlNo = ZONEINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
        If gFieldDefinedCtrl(lbcZones, "", "Zone must be specified", tmCtrls(ZONEINDEX).iReq, ilState) = NO Then
            If ilState = (ALLMANDEFINED + SHOWMSG) Then
                imBoxNo = ZONEINDEX
            End If
            mTestFields = NO
            Exit Function
        End If
        'Check that valid zone selected
        If (ilCtrlNo = TESTALLCTRLS) And (ilState = (ALLMANDEFINED + SHOWMSG)) Then
            If imSave(1) >= lbcZones.ListCount Then
                ilRes = MsgBox("Incorrect Zone specified", vbOKOnly + vbExclamation, "Incomplete")
                imBoxNo = ZONEINDEX
                mTestFields = NO
                Exit Function
            End If
        End If
    End If
    If (ilCtrlNo = SDATEINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
        slStr = smSave(3)
        If gFieldDefinedStr(slStr, "", "Start date must be specified", tmCtrls(SDATEINDEX).iReq, ilState) = NO Then
            If ilState = (ALLMANDEFINED + SHOWMSG) Then
                imBoxNo = SDATEINDEX
            End If
            mTestFields = NO
            Exit Function
        End If
        If Not gValidDate(slStr) Then
            slStr = ""
            If gFieldDefinedStr(slStr, "", "Start date is invalid", tmCtrls(SDATEINDEX).iReq, ilState) = NO Then
                If ilState = (ALLMANDEFINED + SHOWMSG) Then
                    imBoxNo = SDATEINDEX
                End If
                mTestFields = NO
                Exit Function
            End If
        End If
    End If
    If (ilCtrlNo = EDATEINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
        slStr = smSave(4)
        If gFieldDefinedStr(slStr, "", "End date must be specified", tmCtrls(EDATEINDEX).iReq, ilState) = NO Then
            If ilState = (ALLMANDEFINED + SHOWMSG) Then
                imBoxNo = EDATEINDEX
            End If
            mTestFields = NO
            Exit Function
        End If
        If Not gValidDate(slStr) Then
            slStr = ""
            If gFieldDefinedStr(slStr, "", "End date is invalid", tmCtrls(EDATEINDEX).iReq, ilState) = NO Then
                If ilState = (ALLMANDEFINED + SHOWMSG) Then
                    imBoxNo = SDATEINDEX
                End If
                mTestFields = NO
                Exit Function
            End If
        End If
    End If
    If (ilCtrlNo = TESTALLCTRLS) And (ilState = (ALLMANDEFINED + SHOWMSG)) Then
        If gDateValue(smSave(4)) < gDateValue(smSave(3)) Then
            ilRes = MsgBox("End Date must be after Start Date", vbOKOnly + vbExclamation, "Incomplete")
            imBoxNo = EDATEINDEX
            mTestFields = NO
            Exit Function
        End If
'12/2/05: Moved to mSaveRec
'        slDate = Format$(gNow(), "m/d/yy")
'        If gDateValue(smSave(3)) <= gDateValue(slDate) Then
'            If imAskQuestions Then
'                ilRes = MsgBox("Rotation specified starting prior to today's date  " & slDate, vbOkCancel + vbExclamation, "Question")
'                If ilRes = vbCancel Then
'                    imBoxNo = SDATEINDEX
'                    mTestFields = NO
'                    Exit Function
'                End If
'            End If
'        End If
    End If
    If (imGameVehicle) And ((rbcAirTimeCopyBy(1).Value) Or (rbcAirTimeCopyBy(2).Value)) Then
        If (ilCtrlNo = TESTALLCTRLS) Then
            If rbcAirTimeCopyBy(1).Value Then
                If lbcGameNo.SelCount <= 0 Then
                    If (tmCtrls(STIMEINDEX).iReq) And (ilState And SHOWMSG) = SHOWMSG Then
                        ilRes = MsgBox("Events must be Selected", vbOKOnly + vbExclamation, "Incomplete")
                        imBoxNo = STIMEINDEX
                    End If
                    mTestFields = NO
                    Exit Function
                End If
            Else
                If lbcTeam.SelCount <= 0 Then
                    If (tmCtrls(STIMEINDEX).iReq) And (ilState And SHOWMSG) = SHOWMSG Then
                        ilRes = MsgBox("Teams must be Selected", vbOKOnly + vbExclamation, "Incomplete")
                        imBoxNo = STIMEINDEX
                    End If
                    mTestFields = NO
                    Exit Function
                End If
            End If
        End If
    Else
        If (ilCtrlNo = STIMEINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
            slStr = smSave(5)
            If gFieldDefinedStr(slStr, "", "Start time must be specified", tmCtrls(STIMEINDEX).iReq, ilState) = NO Then
                If ilState = (ALLMANDEFINED + SHOWMSG) Then
                    imBoxNo = STIMEINDEX
                End If
                mTestFields = NO
                Exit Function
            End If
            If Not gValidTime(slStr) Then
                slStr = ""
                If gFieldDefinedStr(slStr, "", "Start time is invalid", tmCtrls(STIMEINDEX).iReq, ilState) = NO Then
                    If ilState = (ALLMANDEFINED + SHOWMSG) Then
                        imBoxNo = STIMEINDEX
                    End If
                    mTestFields = NO
                    Exit Function
                End If
            End If
        End If
        If (ilCtrlNo = ETIMEINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
            slStr = smSave(6)
            If gFieldDefinedStr(slStr, "", "End time must be specified", tmCtrls(ETIMEINDEX).iReq, ilState) = NO Then
                If ilState = (ALLMANDEFINED + SHOWMSG) Then
                    imBoxNo = ETIMEINDEX
                End If
                mTestFields = NO
                Exit Function
            End If
            If Not gValidTime(slStr) Then
                slStr = ""
                If gFieldDefinedStr(slStr, "", "End time is invalid", tmCtrls(ETIMEINDEX).iReq, ilState) = NO Then
                    If ilState = (ALLMANDEFINED + SHOWMSG) Then
                        imBoxNo = STIMEINDEX
                    End If
                    mTestFields = NO
                    Exit Function
                End If
            End If
        End If
        For ilLoop = 0 To 6 Step 1
            If (ilCtrlNo = MONINDEX + ilLoop) Or (ilCtrlNo = TESTALLCTRLS) Then
                Select Case imSave(2 + ilLoop)
                    Case 0
                        slStr = "No"
                    Case 1
                        slStr = "Yes"
                    Case Else
                        slStr = ""
                End Select
                If gFieldDefinedStr(slStr, "", "Day must be specified", tmCtrls(MONINDEX + ilLoop).iReq, ilState) = NO Then
                    If ilState = (ALLMANDEFINED + SHOWMSG) Then
                        imBoxNo = MONINDEX + ilLoop
                    End If
                    mTestFields = NO
                    Exit Function
                End If
            End If
        Next ilLoop
        If (ilCtrlNo = TESTALLCTRLS) And (ilState = (ALLMANDEFINED + SHOWMSG)) Then
            If gValidDate(smSave(3)) And gValidDate(smSave(4)) Then
                If gDateValue(smSave(3)) + 6 > gDateValue(smSave(4)) Then
                    'For ilLoop = 0 To 6 Step 1
                    '    ilValidDay(ilLoop) = False
                    'Next ilLoop
                    'llStartDate = gDateValue(smSave(3))
                    'llEndDate = gDateValue(smSave(4))
                    'If llEndDate > llStartDate + 6 Then
                    '    llEndDate = llStartDate + 6
                    'End If
                    'For llDate = llStartDate To llEndDate Step 1
                    '    ilValidDay(gWeekDayLong(llDate)) = True
                    'Next llDate
                    'For ilLoop = 0 To 6 Step 1
                    '    If Not ilValidDay(ilLoop) Then
                    '        If imSave(2 + ilLoop) = 1 Then
                    '            ilRes = MsgBox("Invalid day selected", vbOkOnly + vbExclamation, "Incomplete")
                    '            imBoxNo = MONINDEX + ilLoop
                    '            mTestFields = NO
                    '            Exit Function
                    '        End If
                    '    End If
                    'Next ilLoop
                    ilAnyDay = False
                    For ilLoop = 0 To 6 Step 1
                        If imSave(2 + ilLoop) = 1 Then
                            ilAnyDay = True
                            Exit For
                        End If
                    Next ilLoop
                    If Not ilAnyDay Then
                        ilRes = MsgBox("No day selected", vbOKOnly + vbExclamation, "Incomplete")
                        imBoxNo = MONINDEX
                        mTestFields = NO
                        Exit Function
                    End If
                End If
                ilAnyDay = False
                llStartDate = gDateValue(smSave(3))
                llEndDate = gDateValue(smSave(4))
                If llEndDate > llStartDate + 6 Then
                    llEndDate = llStartDate + 6
                End If
                For llDate = llStartDate To llEndDate Step 1
                    If imSave(2 + gWeekDayLong(llDate)) = 1 Then
                        ilAnyDay = True
                        Exit For
                    End If
                Next llDate
                If Not ilAnyDay Then
                    ilRes = MsgBox("No valid day selected", vbOKOnly + vbExclamation, "Incomplete")
                    imBoxNo = MONINDEX
                    mTestFields = NO
                    Exit Function
                End If
            End If
        End If
    End If
    If (ilCtrlNo = TESTALLCTRLS) And (ilState = (ALLMANDEFINED + SHOWMSG)) Then
        'Test if legal length
        mAllowedLens
        ilFound = False
        For ilLoop = 0 To UBound(imAllowedLens) - 1 Step 1
            If imAllowedLens(ilLoop) = lbcLen.List(lbcLen.ListIndex) Then
                ilFound = True
                Exit For
            End If
        Next ilLoop
        If Not ilFound Then
            ilRes = MsgBox("Length specified not defined for Contract", vbOKOnly + vbExclamation, "Incomplete")
            imBoxNo = LENINDEX
            mTestFields = NO
            Exit Function
        End If
    End If
    If (ilCtrlNo = AVAILINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
        Select Case imSave(10)
            Case 0
                slStr = "All avails"
            Case 1
                slStr = "Book into"
            Case 2
                slStr = "Exclude"
            Case Else
                slStr = ""
        End Select
        If gFieldDefinedStr(slStr, "", "Avail type must be specified", tmCtrls(AVAILINDEX).iReq, ilState) = NO Then
            If ilState = (ALLMANDEFINED + SHOWMSG) Then
                imBoxNo = AVAILINDEX
            End If
            mTestFields = NO
            Exit Function
        End If
    End If
    If (imSave(10) = 1) Or (imSave(10) = 2) Then
        tmCtrls(AVAILINDEX + 1).iReq = True
    Else
        tmCtrls(AVAILINDEX + 1).iReq = False
    End If
    If (ilCtrlNo = AVAILINDEX + 1) Or (ilCtrlNo = TESTALLCTRLS) Then
        If gFieldDefinedCtrl(lbcAvail, "", "Avail must be specified", tmCtrls(AVAILINDEX + 1).iReq, ilState) = NO Then
            If ilState = (ALLMANDEFINED + SHOWMSG) Then
                imBoxNo = AVAILINDEX + 1
            End If
            mTestFields = NO
            Exit Function
        End If
    End If
    If (ilCtrlNo = TYPEINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
        If gFieldDefinedCtrl(lbcType, "", "Type must be specified", tmCtrls(TYPEINDEX).iReq, ilState) = NO Then
            If ilState = (ALLMANDEFINED + SHOWMSG) Then
                imBoxNo = TYPEINDEX
            End If
            mTestFields = NO
            Exit Function
        End If
    End If
    'If tgSpf.sUseProdSptScr = "P" Then
    '    If (ilCtrlNo = SHTTITLEINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
    '        If gFieldDefinedStr(smShtTitle, "", "Short Title must be specified", tmCtrls(SHTTITLEINDEX).iReq, ilState) = NO Then
    '            If ilState = (ALLMANDEFINED + SHOWMSG) Then
    '                imBoxNo = SHTTITLEINDEX
    '            End If
    '            mTestFields = NO
    '            Exit Function
    '        End If
    '    End If
    'End If
    If (ilCtrlNo = COMMENTINDEX) Or (ilCtrlNo = TESTALLCTRLS) Then
        If gFieldDefinedStr(smComment, "", "Comment must be specified", tmCtrls(COMMENTINDEX).iReq, ilState) = NO Then
            If ilState = (ALLMANDEFINED + SHOWMSG) Then
                imBoxNo = COMMENTINDEX
            End If
            mTestFields = NO
            Exit Function
        End If
    End If
    mTestFields = YES
End Function
'*******************************************************
'*                                                     *
'*      Procedure Name:mTestForPurge                   *
'*                                                     *
'*             Created:4/21/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments:Test that no instruction is     *
'*                     purged                          *
'*                                                     *
'*******************************************************
Private Function mTestForPurge() As Integer
'
'   iRet = mTestForPurged()
'   Where:
'       iRet (O)- True if Purged inventory is part of instructions, False if no purged inventory
'
'
    Dim ilLoop As Integer
    Dim slName As String
    If Not imCheckInv Then
        mTestForPurge = False
        Exit Function
    End If
    For ilLoop = 0 To lbcInst.ListCount - 2 Step 1  '-1 for blank line
        slName = lbcInst.List(ilLoop)
        If InStr(slName, "(Purged)") > 0 Then
            mTestForPurge = True
            Exit Function
        End If
        If InStr(slName, "(History)") > 0 Then
            mTestForPurge = True
            Exit Function
        End If
    Next ilLoop
    mTestForPurge = False
    Exit Function
End Function
'*******************************************************
'*                                                     *
'*      Procedure Name:mTestInvDates                   *
'*                                                     *
'*             Created:4/21/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments:Test that dates don't overlap   *
'*                     with duplicated inventory       *
'*                                                     *
'*******************************************************
Private Function mTestInvDates() As Integer
'
'   iRet = mTestInvDates()
'   Where:
'       iRet (O)- True if Dates Ok, False if dates overlap
'
'
    Dim ilRet As Integer
    Dim ilLoop As Integer
    Dim slName As String
    Dim slNameCode As String
    Dim slCode As String
    Dim ilStartDate0 As Integer
    Dim ilStartDate1 As Integer
    Dim ilEndDate0 As Integer
    Dim ilEndDate1 As Integer
    Dim ilRtStartDate0 As Integer
    Dim ilRtStartDate1 As Integer
    Dim ilRtEndDate0 As Integer
    Dim ilRtEndDate1 As Integer
    Dim ilCif As Integer
    Dim ilCrf As Integer
    Dim ilFound As Integer
    Dim tlCrf As CRF
    Dim tlCnf As CNF
    Dim tlCif As CIF
    If tgSpf.sUseCartNo = "N" Then
        mTestInvDates = True
        Exit Function
    End If
    '12/5/08:  Used to speed up save,
    'The test of lmCifChecked was added prior to this test.  Leave it in so that if the same instruction
    'is repeated, it will be bypassed
    If Not imCheckInv Then
        mTestInvDates = True
        Exit Function
    End If
    If imRotIndex <= 0 Then
        'Set values so rotation overlap test works
        tmCrf.lCode = 0
        Select Case imSave(11)
            Case 0
                tmCrf.sRotType = "A"
            Case 1
                tmCrf.sRotType = "O"
            Case 2
                tmCrf.sRotType = "C"
        End Select
        tmCrf.iEtfCode = 0
        tmCrf.iEnfCode = 0
        slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
        ilRet = gParseItem(slNameCode, 2, "\", slCode)
        tmCrf.iAdfCode = Val(slCode)   '
    End If
    gPackDate smSave(3), ilRtStartDate0, ilRtStartDate1
    gPackDate smSave(4), ilRtEndDate0, ilRtEndDate1
    For ilLoop = 0 To lbcInst.ListCount - 2 Step 1
        slName = lbcInst.List(ilLoop)
        gFindMatch slName, 0, lbcExpandActive
        If ((gLastFound(lbcExpandActive) > 0) And (tgSpf.sUseCartNo <> "B")) Or ((gLastFound(lbcExpandActive) > 1) And (tgSpf.sUseCartNo = "B")) Then
            If tgSpf.sUseCartNo <> "B" Then
                slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 1).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
            Else
                slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 2).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
            End If
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            ilFound = False
            For ilCif = 0 To UBound(lmCifChecked) - 1 Step 1
                If Val(slCode) = lmCifChecked(ilCif) Then
                    ilFound = True
                    Exit For
                End If
            Next ilCif
            If Not ilFound Then
                lmCifChecked(UBound(lmCifChecked)) = Val(slCode)
                ReDim Preserve lmCifChecked(0 To UBound(lmCifChecked) + 1) As Long
                tmCifSrchKey.lCode = Val(slCode)
                ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                If (ilRet = BTRV_ERR_NONE) And (tmCif.iMcfCode <> 0) Then
                    'For this to be correct- the new rotation start/end dates nust be determined as
                    'in the update logic
                    ilStartDate0 = ilRtStartDate0
                    ilStartDate1 = ilRtStartDate1
                    ilEndDate0 = ilRtEndDate0
                    ilEndDate1 = ilRtEndDate1
                    '8/14/12: Speed-up setting of copy inventory rotation dates
                    'tmCrfSrchKey1.sRotType = tmCrf.sRotType
                    'tmCrfSrchKey1.iEtfCode = tmCrf.iEtfCode
                    'tmCrfSrchKey1.iEnfCode = tmCrf.iEnfCode
                    'tmCrfSrchKey1.iAdfCode = tmCrf.iAdfCode
                    'tmCrfSrchKey1.lChfCode = 0
                    'tmCrfSrchKey1.lFsfCode = 0
                    'tmCrfSrchKey1.iVefCode = 0
                    'tmCrfSrchKey1.iRotNo = 32000
                    'ilRet = btrGetGreaterOrEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
                    'Do While (ilRet = BTRV_ERR_NONE) And (tlCrf.sRotType = tmCrf.sRotType) And (tlCrf.iEtfCode = tmCrf.iEtfCode) And (tlCrf.iEnfCode = tmCrf.iEnfCode) And (tlCrf.iAdfCode = tmCrf.iAdfCode)
                    '    'Loop thru all instructions
                    '    If (tmCrf.lCode <> tlCrf.lCode) And (tlCrf.sState <> "D") Then
                    '        tmCnfSrchKey.lCrfCode = tlCrf.lCode
                    '        tmCnfSrchKey.iInstrNo = 0
                    '        ilRet = btrGetGreaterOrEqual(hmCnf, tlCnf, imCnfRecLen, tmCnfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
                    '        Do While (ilRet = BTRV_ERR_NONE) And (tlCnf.lCrfCode = tlCrf.lCode)
                    '            If tlCnf.lCifCode > 0 Then
                    '                If tlCnf.lCifCode = tmCif.lCode Then
                    '                    tmCifSrchKey.lCode = tlCnf.lCifCode
                    '                    ilRet = btrGetEqual(hmCif, tlCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)   'Get first record as starting point of extend operation
                    '                    If (ilRet = BTRV_ERR_NONE) And (tlCif.iMcfCode <> 0) Then
                    '                        If (ilStartDate0 = 0) And (ilStartDate1 = 0) Then
                    '                            ilStartDate0 = tlCrf.iStartDate(0)
                    '                            ilStartDate1 = tlCrf.iStartDate(1)
                    '                        Else
                    '                            If (tlCrf.iStartDate(1) < ilStartDate1) Or ((tlCrf.iStartDate(1) = ilStartDate1) And (tlCrf.iStartDate(0) < ilStartDate0)) Then
                    '                                ilStartDate0 = tlCrf.iStartDate(0)
                    '                                ilStartDate1 = tlCrf.iStartDate(1)
                    '                            End If
                    '                        End If
                    '                        If (ilEndDate0 = 0) And (ilEndDate1 = 0) Then
                    '                            ilEndDate0 = tlCrf.iEndDate(0)
                    '                            ilEndDate1 = tlCrf.iEndDate(1)
                    '                        Else
                    '                            If (ilEndDate1 < tlCrf.iEndDate(1)) Or ((ilEndDate1 = tlCrf.iEndDate(1)) And (ilEndDate0 < tlCrf.iEndDate(0))) Then
                    '                                ilEndDate0 = tlCrf.iEndDate(0)
                    '                                ilEndDate1 = tlCrf.iEndDate(1)
                    '                            End If
                    '                        End If
                    '                    End If
                    '                    Exit Do
                    '                End If
                    '            Else
                    '            End If
                    '            ilRet = btrGetNext(hmCnf, tlCnf, imCnfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
                    '        Loop
                    '    End If
                    '    ilRet = btrGetNext(hmCrf, tlCrf, imCrfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
                    'Loop

                    tmCufSrchKey1.lCifCode = tmCif.lCode
                    ilRet = btrGetEqual(hmCuf, tmCuf, imCufRecLen, tmCufSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)   'Get first record as starting point of extend operation
                    Do While (ilRet = BTRV_ERR_NONE) And (tmCuf.lCifCode = tmCif.lCode)
                        For ilCrf = 0 To UBound(tmCuf.lCrfCode) Step 1
                            If tmCuf.lCrfCode(ilCrf) > 0 Then
                                If tmCrf.lCode <> tmCuf.lCrfCode(ilCrf) Then
                                    If (ilStartDate0 = 0) And (ilStartDate1 = 0) Then
                                        ilStartDate0 = tmCuf.iRotStartDate(0, ilCrf)
                                        ilStartDate1 = tmCuf.iRotStartDate(1, ilCrf)
                                    Else
                                        If (tmCuf.iRotStartDate(1, ilCrf) < ilStartDate1) Or ((tmCuf.iRotStartDate(1, ilCrf) = ilStartDate1) And (tmCuf.iRotStartDate(0, ilCrf) < ilStartDate0)) Then
                                            ilStartDate0 = tmCuf.iRotStartDate(0, ilCrf)
                                            ilStartDate1 = tmCuf.iRotStartDate(1, ilCrf)
                                        End If
                                    End If
                                    If (ilEndDate0 = 0) And (ilEndDate1 = 0) Then
                                        ilEndDate0 = tmCuf.iRotEndDate(0, ilCrf)
                                        ilEndDate1 = tmCuf.iRotEndDate(1, ilCrf)
                                    Else
                                        If (ilEndDate1 < tmCuf.iRotEndDate(1, ilCrf)) Or ((ilEndDate1 = tmCuf.iRotEndDate(1, ilCrf)) And (ilEndDate0 < tmCuf.iRotEndDate(0, ilCrf))) Then
                                            ilEndDate0 = tmCuf.iRotEndDate(0, ilCrf)
                                            ilEndDate1 = tmCuf.iRotEndDate(1, ilCrf)
                                        End If
                                    End If
                                End If
                            End If
                        Next ilCrf
                        ilRet = btrGetNext(hmCuf, tmCuf, imCufRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
                    Loop



                    ''If (tmCif.iRotStartDate(0) = 0) And (tmCif.iRotStartDate(1) = 0) Then
                    ''    ilStartDate0 = ilRtStartDate0
                    ''    ilStartDate1 = ilRtStartDate1
                    ''Else
                    ''    If (ilRtStartDate1 < tmCif.iRotStartDate(1)) Or ((ilRtStartDate1 = tmCif.iRotStartDate(1)) And (ilRtStartDate0 < tmCif.iRotStartDate(0))) Then
                    ''        ilStartDate0 = ilRtStartDate0
                    ''        ilStartDate1 = ilRtStartDate1
                    ''    Else
                    ''        ilStartDate0 = tmCif.iRotStartDate(0)
                    ''        ilStartDate1 = tmCif.iRotStartDate(1)
                    ''    End If
                    ''End If
                    ''If (tmCif.iRotEndDate(0) = 0) And (tmCif.iRotEndDate(1) = 0) Then
                    ''    ilEndDate0 = ilRtEndDate0
                    ''    ilEndDate1 = ilRtEndDate1
                    ''Else
                    ''    If (tmCif.iRotEndDate(1) < ilRtEndDate1) Or ((tmCif.iRotEndDate(1) = ilRtEndDate1) And (tmCif.iRotEndDate(0) < ilRtEndDate0)) Then
                    ''        ilEndDate0 = ilRtEndDate0
                    ''        ilEndDate1 = ilRtEndDate1
                    ''    Else
                    ''        ilEndDate0 = tmCif.iRotEndDate(0)
                    ''        ilEndDate1 = tmCif.iRotEndDate(1)
                    ''    End If
                    ''End If
                    If tmCif.iMcfCode <> 0 Then
                        tmCifSrchKey1.iMcfCode = tmCif.iMcfCode
                        tmCifSrchKey1.sName = tmCif.sName
                        tmCifSrchKey1.sCut = tmCif.sCut
                        ilRet = btrGetGreaterOrEqual(hmCif, tlCif, imCifRecLen, tmCifSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
                        Do While (ilRet = BTRV_ERR_NONE) And (tlCif.iMcfCode = tmCif.iMcfCode) And (tlCif.sName = tmCif.sName) And (tlCif.sCut = tmCif.sCut)
                            If (tlCif.lCode <> tmCif.lCode) Then
                                'Left this as Y instead of P because I believe that Purge type carts should be checked
                                'It has been this way since we switched from a Yes/No to P/A/H
                                If tmCif.sPurged <> "Y" Then
                                    If (tlCif.iRotStartDate(0) <> 0) Or (tlCif.iRotStartDate(1) <> 0) Then
                                        If (tlCif.iRotEndDate(1) < ilStartDate1) Or ((tlCif.iRotEndDate(1) = ilStartDate1) And (tlCif.iRotEndDate(0) < ilStartDate0)) Then
                                        Else
                                            'If (ilEndDate1 < tlCif.iRotStartDate(1)) Or ((ilEndDate1 = tlCif.iRotStartDate(1)) And (ilEndDate0 < tlCif.iRotStartDate(0))) Then
                                            'Else
                                                mTestInvDates = False
                                                Exit Function
                                            'End If
                                        End If
                                    End If
                                End If
                            End If
                            ilRet = btrGetNext(hmCif, tlCif, imCifRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
                        Loop
                    End If
                End If
            End If
        End If
    Next ilLoop
    mTestInvDates = True
    Exit Function
End Function
'*******************************************************
'*                                                     *
'*      Procedure Name:mUnassignSpots                  *
'*                                                     *
'*             Created:4/21/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments:Remove copy assignment from     *
'*                     specified date                  *
'*                                                     *
'*******************************************************
Private Function mUnassignSpots(ilFromErase As Integer, llInStartDate As Long, llInEndDate As Long, tlCrf As CRF, ilRet As Integer) As Integer
    'Dim ilRet As Integer
    Dim ilCRet As Integer
    Dim llDate As Long
    Dim llSdfRecPos As Long
    Dim slPtType As String
    Dim llCopyCode As Long
    Dim llTzfRecPos As Long
    Dim ilLoop As Integer
    Dim llStartDate As Long
    Dim llEndDate As Long
    Dim slEndDate As String
    Dim llHiddenLLD As Long
    Dim ilVef As Integer
    Dim ilVpf As Integer
    'Dim ilSdf As Integer
    Dim llSdf As Long
    Dim ilClf As Integer
    Dim ilChk As Integer
    Dim ilFound As Integer
    Dim llLastLogDate As Long
    Dim llNowDate As Long
    Dim slLogDate As String
    Dim ilExtLen As Integer
    Dim llNoRec As Long
    Dim llRecPos As Long
    Dim ilOffSet As Integer
    Dim tlCharTypeBuff As POPCHARTYPE   'Type field record
    Dim tlLTypeBuff As POPLCODE   'Type field record
    Dim tlVef As VEF
    ReDim ilVefCode(0 To 0) As Integer
    ReDim ilTestVefCode(0 To 0) As Integer
    Dim ilTest As Integer
    Dim blMsgAsked As Boolean
    Dim ilCrfVefCode As Integer
    Dim blResetStartDate As Boolean
    '7/13/18: Used for alert date range and to determine if alert required
    Dim llEarliestDateUnassigned As Long
    Dim llLatestDateUnassigned As Long
    
    ilCrfVefCode = tlCrf.iVefCode
    mBuildUnassignVef tlCrf, ilTestVefCode()
    blMsgAsked = False
    blResetStartDate = False
    
    imEraseStopped = False
    '9/13/16: Check all vehicles defined within the rotation
    For ilTest = 0 To UBound(ilTestVefCode) - 1 Step 1
    
        tlCrf.iVefCode = ilTestVefCode(ilTest)
        
        llStartDate = llInStartDate
        llEndDate = llInEndDate
    
    'For ilVef = LBound(tgMVef) To UBound(tgMVef) - 1 Step 1
    '    If tgMVef(ilVef).iCode = tlCrf.iVefCode Then
        ilVef = gBinarySearchVef(tlCrf.iVefCode)
        If ilVef <> -1 Then
            'For ilVpf = 0 To UBound(tgVpf) Step 1
            '    If tgVpf(ilVpf).iVefKCode = tlCrf.iVefCode Then
                ilVpf = gBinarySearchVpfPlus(tlCrf.iVefCode)
                If ilVpf <> -1 Then
                    gUnpackDateLong tgVpf(ilVpf).iLLD(0), tgVpf(ilVpf).iLLD(1), llDate
                    If llStartDate < llDate Then
                        '1/15/09:  Added test if from erase
                        If ilFromErase Then
                            If Not blMsgAsked Then
                                ilRet = MsgBox("Unassign copy on " & Trim$(tgMVef(ilVef).sName) & " after " & Format$(gNow(), "m/d/yy") & ", Continue", vbYesNo + vbQuestion + vbDefaultButton2, "Unassign")
                                If ilRet = vbNo Then
                                    mUnassignSpots = False
                                    imEraseStopped = True
                                    Exit Function
                                End If
                            End If
                        Else
                            '9/22/05:  Remove message and only allow
                            If Not blMsgAsked Then
                                ilRet = MsgBox("Unassign copy on " & Trim$(tgMVef(ilVef).sName) & " prior to Last Log Date " & Format$(llDate, "m/d/yy"), vbYesNo + vbQuestion + vbDefaultButton2, "Unassign")
                                If ilRet = vbNo Then
                                    blResetStartDate = True
                                    llStartDate = llDate + 1
                                    If (llStartDate > llEndDate) And (llEndDate <> 0) Then
                                        mUnassignSpots = True
                                        Exit Function
                                    End If
                                End If
                            Else
                                If blResetStartDate Then
                                    llStartDate = llDate + 1
                                End If
                            End If
                        End If
                        blMsgAsked = True
                    End If
            '        Exit For
                End If
    '        Next ilVpf
    '        Exit For
        End If
    'Next ilVef
    'Remove assign instruction from Sdf
    'Build array of vehicles to check
        If ilVef <> -1 Then
            If tgMVef(ilVef).sType = "P" Then
                llHiddenLLD = 0
                ilRet = gObtainChfClf(hmCHF, hmClf, tlCrf.lChfCode, False, tmChf, tgClfCopy())
                For ilLoop = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
                    If tgClfCopy(ilLoop).ClfRec.iVefCode = tlCrf.iVefCode Then
                        If (tgClfCopy(ilLoop).ClfRec.sType = "O") Or (tgClfCopy(ilLoop).ClfRec.sType = "A") Or (tgClfCopy(ilLoop).ClfRec.sType = "E") Then
                            For ilClf = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
                                If tgClfCopy(ilLoop).ClfRec.iLine = tgClfCopy(ilClf).ClfRec.iPkLineNo Then
                                    ilFound = False
                                    For ilChk = 0 To UBound(ilVefCode) - 1 Step 1
                                        If ilVefCode(ilChk) = tgClfCopy(ilClf).ClfRec.iVefCode Then
                                            ilFound = True
                                            Exit For
                                        End If
                                    Next ilChk
                                    If Not ilFound Then
                                        ilVpf = gBinarySearchVpfPlus(tlCrf.iVefCode)
                                        If ilVpf <> -1 Then
                                            gUnpackDateLong tgVpf(ilVpf).iLLD(0), tgVpf(ilVpf).iLLD(1), llDate
                                            If (llHiddenLLD = 0) Or (llDate < llHiddenLLD) Then
                                                llHiddenLLD = llDate
                                            End If
                                        End If
                                        ilVefCode(UBound(ilVefCode)) = tgClfCopy(ilClf).ClfRec.iVefCode
                                        ReDim Preserve ilVefCode(0 To UBound(ilVefCode) + 1) As Integer
                                    End If
                                End If
                            Next ilClf
                        End If
                    End If
                Next ilLoop
                If llStartDate < llHiddenLLD Then
                    If ilFromErase Then
                        If Not blMsgAsked Then
                            ilRet = MsgBox("Unassign copy on " & Trim$(tgMVef(ilVef).sName) & " after " & Format$(gNow(), "m/d/yy") & ", Continue", vbYesNo + vbQuestion + vbDefaultButton2, "Unassign")
                            If ilRet = vbNo Then
                                mUnassignSpots = False
                                imEraseStopped = True
                                Exit Function
                            End If
                        End If
                    Else
                        If Not blMsgAsked Then
                            ilRet = MsgBox("Unassign copy on " & Trim$(tgMVef(ilVef).sName) & " prior to Last Log Date " & Format$(llHiddenLLD, "m/d/yy"), vbYesNo + vbQuestion + vbDefaultButton2, "Unassign")
                            If ilRet = vbNo Then
                                blResetStartDate = True
                                llStartDate = llHiddenLLD + 1
                                If (llStartDate > llEndDate) And (llEndDate <> 0) Then
                                    mUnassignSpots = True
                                    Exit Function
                                End If
                            End If
                        Else
                            If blResetStartDate Then
                                llStartDate = llHiddenLLD + 1
                            End If
                        End If
                    End If
                    blMsgAsked = True
                End If
            Else
                'ReDim ilVefCode(0 To 1) As Integer
                'ilVefCode(0) = tlCrf.iVefCode
                ilVefCode(UBound(ilVefCode)) = tlCrf.iVefCode
                ReDim Preserve ilVefCode(0 To UBound(ilVefCode) + 1) As Integer
            End If
        Else
            'ReDim ilVefCode(0 To 1) As Integer
            'ilVefCode(0) = tlCrf.iVefCode
            ilVefCode(UBound(ilVefCode)) = tlCrf.iVefCode
            ReDim Preserve ilVefCode(0 To UBound(ilVefCode) + 1) As Integer
        End If
        
    Next ilTest
    tlCrf.iVefCode = ilCrfVefCode
    
    If tlCrf.sMGCopyAssign <> "O" Then
        ilExtLen = Len(tmSmf)
        llNoRec = gExtNoRec(ilExtLen) 'btrRecords(hlSdf) 'Obtain number of records
        btrExtClear hmSmf   'Clear any previous extend operation
        tmSmfSrchKey.lChfCode = tlCrf.lChfCode
        tmSmfSrchKey.iLineNo = 0
        tmSmfSrchKey.iMissedDate(0) = 0
        tmSmfSrchKey.iMissedDate(1) = 0
        ilRet = btrGetGreaterOrEqual(hmSmf, tmSmf, imSmfRecLen, tmSmfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
        If ilRet <> BTRV_ERR_END_OF_FILE Then
            Call btrExtSetBounds(hmSmf, llNoRec, -1, "UC", "SMF", "") 'Set extract limits (all records)
            If lgMtfNoRecs > 0 Then
                tlLTypeBuff.lCode = tlCrf.lChfCode
                ilOffSet = gFieldOffset("Smf", "SmfChfCode")
                ilRet = btrExtAddLogicConst(hmSmf, BTRV_KT_INT, ilOffSet, 4, BTRV_EXT_EQUAL, BTRV_EXT_LAST_TERM, tlLTypeBuff, 4)
            Else
                tlLTypeBuff.lCode = tlCrf.lChfCode
                ilOffSet = gFieldOffset("Smf", "SmfChfCode")
                ilRet = btrExtAddLogicConst(hmSmf, BTRV_KT_INT, ilOffSet, 4, BTRV_EXT_EQUAL, BTRV_EXT_AND, tlLTypeBuff, 4)

                '2-10-05 need to find those outsides/fills moved outside its sched vehicle
                tlCharTypeBuff.sType = "M"    'Extract all matching records
                ilOffSet = gFieldOffset("Smf", "SmfMGSource")
                ilRet = btrExtAddLogicConst(hmSmf, BTRV_KT_STRING, ilOffSet, 1, BTRV_EXT_EQUAL, BTRV_EXT_OR, tlCharTypeBuff, 1)

                tlCharTypeBuff.sType = "A"    'Extract all matching records
                ilOffSet = gFieldOffset("Smf", "SmfMGSource")
                ilRet = btrExtAddLogicConst(hmSmf, BTRV_KT_STRING, ilOffSet, 1, BTRV_EXT_EQUAL, BTRV_EXT_LAST_TERM, tlCharTypeBuff, 1)
            End If
            ilRet = btrExtAddField(hmSmf, 0, ilExtLen)  'Extract Name
            If ilRet = BTRV_ERR_NONE Then
                ilRet = btrExtGetNext(hmSmf, tmSmf, ilExtLen, llRecPos)
                If (ilRet <> BTRV_ERR_END_OF_FILE) And (ilRet <> BTRV_ERR_FILTER_LIMIT) Then
                    If (ilRet <> BTRV_ERR_NONE) And (ilRet <> BTRV_ERR_REJECT_COUNT) Then
                    Else
                        ilExtLen = Len(tmSmf)
                        'ilRet = btrExtGetFirst(hlSdf, tlSdfExt, ilExtLen, llRecPos)
                        Do While ilRet = BTRV_ERR_REJECT_COUNT
                            ilRet = btrExtGetNext(hmSmf, tmSmf, ilExtLen, llRecPos)
                        Loop
                        Do While ilRet = BTRV_ERR_NONE
                            tmSdfSrchKey3.lCode = tmSmf.lSdfCode
                            ilRet = btrGetEqual(hmSdf, tmSdf, imSdfRecLen, tmSdfSrchKey3, INDEXKEY3, BTRV_LOCK_NONE, SETFORREADONLY)   'Get first record as starting point of extend operation
                            If (ilRet = BTRV_ERR_NONE) Then
                                If (Left$(tlCrf.sZone, 1) = "R") And (tlCrf.lRafCode > 0) Then
                                    ilFound = False
                                    For ilChk = 0 To UBound(ilVefCode) - 1 Step 1
                                        If ilVefCode(ilChk) = tmSdf.iVefCode Then
                                            ilFound = True
                                            Exit For
                                        End If
                                    Next ilChk
                                    If Not ilFound Then
                                        ilVefCode(UBound(ilVefCode)) = tmSdf.iVefCode
                                        ReDim Preserve ilVefCode(0 To UBound(ilVefCode) + 1) As Integer
                                    End If
                                '12/30/11: Add test to remove preliminary copy (sdfRotNo = 0)
                                'ElseIf (tmSdf.iRotNo = tlCrf.iRotNo) Then
                                ElseIf (tmSdf.iRotNo = tlCrf.iRotNo) Or ((tmSdf.iRotNo = 0) And (tmSdf.lCopyCode > 0) And ((tmSdf.sPtType = "1") Or (tmSdf.sPtType = "3"))) Then
                                    ilFound = False
                                    For ilChk = 0 To UBound(ilVefCode) - 1 Step 1
                                        If ilVefCode(ilChk) = tmSdf.iVefCode Then
                                            ilFound = True
                                            Exit For
                                        End If
                                    Next ilChk
                                    If Not ilFound Then
                                        ilVefCode(UBound(ilVefCode)) = tmSdf.iVefCode
                                        ReDim Preserve ilVefCode(0 To UBound(ilVefCode) + 1) As Integer
                                    End If
                                End If
                            End If
                            ilRet = btrExtGetNext(hmSmf, tmSmf, ilExtLen, llRecPos)
                            Do While ilRet = BTRV_ERR_REJECT_COUNT
                                ilRet = btrExtGetNext(hmSmf, tmSmf, ilExtLen, llRecPos)
                            Loop
                        Loop
                    End If
                End If
            End If
        End If
    End If
    If llStartDate <= 0 Then
        llStartDate = gDateValue(Format$(gNow(), "m/d/yy")) + 1
    End If
    For ilChk = 0 To UBound(ilVefCode) - 1 Step 1
        '7/13/18: Used for alert date range and to determine if alert required
        llEarliestDateUnassigned = -1
        llLatestDateUnassigned = -1
        
        tmSdfSrchKey0.iVefCode = ilVefCode(ilChk)   'tlCrf.iVefCode
        tmSdfSrchKey0.lChfCode = tlCrf.lChfCode
        tmSdfSrchKey0.iLineNo = 0
        tmSdfSrchKey0.lFsfCode = 0
        tmSdfSrchKey0.iDate(0) = 0
        tmSdfSrchKey0.iDate(1) = 0
        tmSdfSrchKey0.sSchStatus = " "
        tmSdfSrchKey0.iTime(0) = 0
        tmSdfSrchKey0.iTime(1) = 0
        ilRet = btrGetGreaterOrEqual(hmSdf, tmSdf, imSdfRecLen, tmSdfSrchKey0, INDEXKEY0, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
        'Do While (ilRet = BTRV_ERR_NONE) And (tmSdf.iVefCode = tlCrf.iVefCode) And (tmSdf.lChfCode = tlCrf.lChfCode)
        Do While (ilRet = BTRV_ERR_NONE) And (tmSdf.iVefCode = ilVefCode(ilChk)) And (tmSdf.lChfCode = tlCrf.lChfCode)
            'If (tmSdf.sSchStatus = "S") Or (tmSdf.sSchStatus = "G") Or (tmSdf.sSchStatus = "O") Then
            '2/2/09:  Add the case of region assigned prior to generic
            If (tmSdf.sPtType <> "0") Or ((Left$(tlCrf.sZone, 1) = "R") And (tlCrf.lRafCode > 0)) Then
                gUnpackDateLong tmSdf.iDate(0), tmSdf.iDate(1), llDate
                If (llDate >= llStartDate) Then
                    If (llEndDate = 0) Or (llDate <= llEndDate) Then
                        If (Left$(tlCrf.sZone, 1) = "R") And (tlCrf.lRafCode > 0) Then
                            ReDim lmRsfCode(0 To 0) As Long
                            '7/15/14
                            tmRsfSrchKey3.lSdfCode = tmSdf.lCode
                            tmRsfSrchKey3.lRafCode = tlCrf.lRafCode
                            ilRet = btrGetEqual(hmRsf, tmRsf, imRsfRecLen, tmRsfSrchKey3, INDEXKEY3, BTRV_LOCK_NONE, SETFORREADONLY)
                            Do While (ilRet = BTRV_ERR_NONE) And (tmRsf.lSdfCode = tmSdf.lCode) And (tmRsf.lRafCode = tlCrf.lRafCode)
                                'If (tmRsf.lRafCode = tlCrf.lRafCode) And (tmRsf.iRotNo = tlCrf.iRotNo) Then
                                If (tmRsf.iRotNo = tlCrf.iRotNo) Then
                                    lmRsfCode(UBound(lmRsfCode)) = tmRsf.lCode
                                    ReDim Preserve lmRsfCode(0 To UBound(lmRsfCode) + 1) As Long
                                End If
                                ilRet = btrGetNext(hmRsf, tmRsf, imRsfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
                            Loop
                            ilLoop = 0
                            Do While ilLoop <= UBound(lmRsfCode) - 1
                                tmRsfSrchKey.lCode = lmRsfCode(ilLoop)
                                ilRet = btrGetEqual(hmRsf, tmRsf, imRsfRecLen, tmRsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
                                If ilRet <> BTRV_ERR_NONE Then
                                    Exit Do
                                End If
                                ilRet = btrDelete(hmRsf)
                                If ilRet <> BTRV_ERR_CONFLICT Then
                                    ilLoop = ilLoop + 1
                                End If
                            Loop
                            '7/13/18: Used for alert date range and to determine if alert required
                            If UBound(lmRsfCode) > LBound(lmRsfCode) Then
                                mSetUnassignedDate llDate, llEarliestDateUnassigned, llLatestDateUnassigned
                            End If
                        Else
                            '12/30/11: Add test to remove preliminary copy (sdfRotNo = 0)
                            'If tmSdf.iRotNo = tlCrf.iRotNo Then
                            If (tmSdf.iRotNo = tlCrf.iRotNo) Or ((tmSdf.iRotNo = 0) And (tmSdf.lCopyCode > 0) And ((tmSdf.sPtType = "1") Or (tmSdf.sPtType = "3"))) Then
                                slPtType = tmSdf.sPtType
                                llCopyCode = tmSdf.lCopyCode
                                ilRet = btrGetPosition(hmSdf, llSdfRecPos)
                                Do
                                    'tmRec = tmSdf
                                    'ilRet = gGetByKeyForUpdate("SDF", hmSdf, tmRec)
                                    'tmSdf = tmRec
                                    'If ilRet <> BTRV_ERR_NONE Then
                                    '    mUnassignSpots = False
                                    '    ilRet = MsgBox("Erase Not Completed, Try Later", vbOkOnly + vbExclamation, "Erase")
                                    '    Exit Function
                                    'End If
                                    tmSdf.iRotNo = 0
                                    tmSdf.sPtType = "0"
                                    tmSdf.lCopyCode = 0
                                    ilRet = btrUpdate(hmSdf, tmSdf, imSdfRecLen)
                                    If ilRet = BTRV_ERR_CONFLICT Then
                                        ilCRet = btrGetDirect(hmSdf, tmSdf, imSdfRecLen, llSdfRecPos, INDEXKEY0, BTRV_LOCK_NONE)
                                        'If (tmSdf.sSchStatus <> "S") And (tmSdf.sSchStatus <> "G") And (tmSdf.sSchStatus <> "O") Then
                                        '    Exit Do
                                        'End If
                                    End If
                                Loop While ilRet = BTRV_ERR_CONFLICT
                                If ilRet <> BTRV_ERR_NONE Then
                                    mUnassignSpots = False
                                    ilCRet = MsgBox("Erase Not Completed, Try Later", vbOKOnly + vbExclamation, "Erase")
                                    Exit Function
                                End If
                                '7/13/18: Used for alert date range and to determine if alert required
                                mSetUnassignedDate llDate, llEarliestDateUnassigned, llLatestDateUnassigned
                                
                                If slPtType = "3" Then
                                    tmTzfSrchKey.lCode = llCopyCode
                                    ilRet = btrGetEqual(hmTzf, tmTzf, imTzfRecLen, tmTzfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)   'Get first record as starting point of extend operation
                                    If ilRet = BTRV_ERR_NONE Then
                                        ilRet = btrGetPosition(hmTzf, llTzfRecPos)
                                        Do
                                            ilRet = btrDelete(hmTzf)
                                            If ilRet = BTRV_ERR_CONFLICT Then
                                                ilCRet = btrGetDirect(hmTzf, tmTzf, imTzfRecLen, llTzfRecPos, INDEXKEY0, BTRV_LOCK_NONE)
                                                If ilCRet <> BTRV_ERR_NONE Then
                                                    ilRet = ilCRet
                                                    mUnassignSpots = False
                                                    ilCRet = MsgBox("Erase Not Completed, Try Later", vbOKOnly + vbExclamation, "Erase")
                                                    Exit Function
                                                End If
                                                'tmRec = tmTzf
                                                'ilCRet = gGetByKeyForUpdate("TZF", hmTzf, tmRec)
                                                'tmTzf = tmRec
                                                'If ilCRet <> BTRV_ERR_NONE Then
                                                '    ilRet = ilCRet
                                                '    mUnassignSpots = False
                                                '    ilCRet = MsgBox("Erase Not Completed, Try Later", vbOkOnly + vbExclamation, "Erase")
                                                '    Exit Function
                                                'End If
                                            End If
                                        Loop While ilRet = BTRV_ERR_CONFLICT
                                    End If
                                    If ilRet <> BTRV_ERR_NONE Then
                                        mUnassignSpots = False
                                        ilCRet = MsgBox("Erase Not Completed, Try Later", vbOKOnly + vbExclamation, "Erase")
                                        Exit Function
                                    End If
                                End If
                            End If
                        End If
                    Else
                        Exit Do
                    End If
                End If
            End If
            ilRet = btrGetNext(hmSdf, tmSdf, imSdfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
        'If rotation for airing vehicle, then remove rsf for blackouts and logs
        ReDim tgCopySdfExtSort(0 To 0) As SDFEXTSORT
        'ReDim tgCopySdfExt(1 To 1) As SDFEXT
        ReDim tgCopySdfExt(0 To 0) As SDFEXT
        tmVefSrchKey.iCode = ilVefCode(ilChk)   'tlCrf.iVefCode
        ilRet = btrGetEqual(hmVef, tlVef, imVefRecLen, tmVefSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        If tlVef.sType = "A" Then
            'ilRet = gObtainCntrSpot(-1, False, tlCrf.lChfCode, -1, "S", Format$(llStartDate, "m/d/yy"), Format$(llEndDate, "m/d/yy"), tgCopySdfExtSort(), tgCopySdfExt(), 0, False)
            If llEndDate = 0 Then
                slEndDate = ""
            Else
                slEndDate = Format$(llEndDate, "m/d/yy")
            End If
            ilRet = gObtainCntrSpot(-1, False, tlCrf.lChfCode, -1, "S", Format$(llStartDate, "m/d/yy"), slEndDate, tgCopySdfExtSort(), tgCopySdfExt(), 0, False)
            'For ilSdf = LBound(tgCopySdfExt) To UBound(tgCopySdfExt) - 1 Step 1
            '    ilRet = btrGetDirect(hmSdf, tmSdf, imSdfRecLen, tgCopySdfExt(ilSdf).lRecPos, INDEXKEY0, BTRV_LOCK_NONE)
            For llSdf = LBound(tgCopySdfExt) To UBound(tgCopySdfExt) - 1 Step 1
                ilRet = btrGetDirect(hmSdf, tmSdf, imSdfRecLen, tgCopySdfExt(llSdf).lRecPos, INDEXKEY0, BTRV_LOCK_NONE)
                If ilRet = BTRV_ERR_NONE Then
                    ReDim lmRsfCode(0 To 0) As Long
                    tmRsfSrchKey1.lCode = tmSdf.lCode
                    ilRet = btrGetEqual(hmRsf, tmRsf, imRsfRecLen, tmRsfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)
                    Do While (ilRet = BTRV_ERR_NONE) And (tmRsf.lSdfCode = tmSdf.lCode)
                        'B=Blackout; A=Airing without region
                        If (tmRsf.lRafCode = 0) And (tmRsf.iRotNo = tlCrf.iRotNo) And ((tmRsf.sType = "B") Or (tmRsf.sType = "A")) Then
                            lmRsfCode(UBound(lmRsfCode)) = tmRsf.lCode
                            ReDim Preserve lmRsfCode(0 To UBound(lmRsfCode) + 1) As Long
                        '3/18/14: Region copy assigned to airing vehicle
                        ElseIf (tmRsf.lRafCode <> 0) And (tmRsf.lRafCode = tlCrf.lRafCode) And (tmRsf.iRotNo = tlCrf.iRotNo) And (tmRsf.sType = "R") Then
                            lmRsfCode(UBound(lmRsfCode)) = tmRsf.lCode
                            ReDim Preserve lmRsfCode(0 To UBound(lmRsfCode) + 1) As Long
                        End If
                        ilRet = btrGetNext(hmRsf, tmRsf, imRsfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
                    Loop
                    ilLoop = 0
                    Do While ilLoop <= UBound(lmRsfCode) - 1
                        tmRsfSrchKey.lCode = lmRsfCode(ilLoop)
                        ilRet = btrGetEqual(hmRsf, tmRsf, imRsfRecLen, tmRsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
                        If ilRet <> BTRV_ERR_NONE Then
                            Exit Do
                        End If
                        ilRet = btrDelete(hmRsf)
                        If ilRet <> BTRV_ERR_CONFLICT Then
                            ilLoop = ilLoop + 1
                        End If
                    Loop
                    '7/13/18: Used for alert date range and to determine if alert required
                    If UBound(lmRsfCode) > LBound(lmRsfCode) Then
                        gUnpackDateLong tmSdf.iDate(0), tmSdf.iDate(1), llDate
                        mSetUnassignedDate llDate, llEarliestDateUnassigned, llLatestDateUnassigned
                    End If
                End If
            'Next ilSdf
            Next llSdf
        End If
        'ilVpf = gBinarySearchVpfPlus(ilVefCode(ilChk))
        'If ilVpf > 0 Then
        '    If (tgVpf(ilVpf).iLLD(0) <> 0) Or (tgVpf(ilVpf).iLLD(1) <> 0) Then
        '        gUnpackDateLong tgVpf(ilVpf).iLLD(0), tgVpf(ilVpf).iLLD(1), llLastLogDate
        '    Else
        '        llLastLogDate = -1
        '    End If
        '    If llInEndDate = 0 Then
        '        llEndDate = llLastLogDate
        '    Else
        '        llEndDate = llInEndDate
        '    End If
        '    llNowDate = gDateValue(Format$(gNow(), "m/d/yy"))
        '    If (llEndDate <> -1) And (llStartDate <= llLastLogDate) And (llLastLogDate <> -1) Then
        '        For llDate = llStartDate To llEndDate Step 7
        '            If (llDate > llNowDate) And (llDate <= llLastLogDate) Then
        '                slLogDate = Format$(llDate, "m/d/yy")
        '                'ilRet = gAlertAdd("L", "C", 0, tmSdf.iVefCode, slLogDate)
        '                ilRet = gAlertAdd("L", "C", 0, ilVefCode(ilChk), slLogDate)
        '            End If
        '        Next llDate
        '    End If
        'End If
        If llEarliestDateUnassigned <> -1 Then
            mSetAlerts ilVefCode(ilChk), llEarliestDateUnassigned, llLatestDateUnassigned, tlCrf.lCvfCode, tlCrf.lChfCode
        End If
        llEndDate = llInEndDate
    Next ilChk
    mUnassignSpots = True
End Function
'*******************************************************
'*                                                     *
'*      Procedure Name:mVehOptIndex                    *
'*                                                     *
'*             Created:7/21/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Obtain vehicle option index    *
'*                                                     *
'*******************************************************
Private Sub mVehOptIndex()
    Dim ilRet As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim ilCode As Integer
    Dim ilLoop As Integer
    Dim slZone As String
    Dim slDate As String
    Dim ilVef As Integer
    imVpfIndex = -1
    If (smSave(2) = "") Or (smSave(2) = "[None]") Then
        Exit Sub
    End If
    gFindMatch smSave(2), 0, lbcVehicle
    If (gLastFound(lbcVehicle) < 0) Or (Trim$(smSave(2)) = "[All]") Or (Trim$(smSave(2)) = smSeveral) Then
        'If lbcZones.ListCount = 1 Then
        '    Exit Sub
        'End If
        If imSave(1) >= 0 Then
            slZone = lbcZones.List(imSave(1))
        Else
            slZone = ""
        End If
        lbcZones.Clear
        lbcZones.AddItem "[Generic]", 0
        mAddRegion
        If slZone = "[Generic]" Then
            imChgMode = True
            If lbcZones.List(0) = "[Generic]" Then
                lbcZones.ListIndex = 0
            Else
                lbcZones.ListIndex = 1
            End If
            imSave(1) = lbcZones.ListIndex
            imChgMode = False
        ElseIf slZone = "[Grid]" Then
            imChgMode = True
            lbcZones.ListIndex = 0
            imSave(1) = lbcZones.ListIndex
            imChgMode = False
        Else
            imChgMode = True
            gFindMatch slZone, 0, lbcZones
            If gLastFound(lbcZones) >= 0 Then
                lbcZones.ListIndex = gLastFound(lbcZones)
            Else
                'lbcZones.ListIndex = -1
                If imSave(1) >= 0 Then
                    lbcZones.AddItem slZone
                    gFindMatch slZone, 0, lbcZones
                    If gLastFound(lbcZones) >= 0 Then
                        lbcZones.ListIndex = gLastFound(lbcZones)
                    Else
                        lbcZones.ListIndex = -1
                    End If
                Else
                    lbcZones.ListIndex = -1
                End If
            End If
            imSave(1) = lbcZones.ListIndex
            imChgMode = False
        End If
        mSetRGCtrl
        Exit Sub
    End If
    slNameCode = tgCVehicle(gLastFound(lbcVehicle) - imAllVehAdj).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    If ilRet <> CP_MSG_NONE Then
        smMonDefStartDate = Format$(gNow(), "m/d/yy")
        smDefStartDate = Format$(gDateValue(smMonDefStartDate) + 1, "m/d/yy")
        'If lbcZones.ListCount = 1 Then
        '    Exit Sub
        'End If
        If imSave(1) >= 0 Then
            slZone = lbcZones.List(imSave(1))
        Else
            slZone = ""
        End If
        lbcZones.Clear
        lbcZones.AddItem "[Generic]", 0
        mAddRegion
        If slZone = "[Generic]" Then
            imChgMode = True
            If lbcZones.List(0) = "[Generic]" Then
                lbcZones.ListIndex = 0
            Else
                lbcZones.ListIndex = 1
            End If
            imSave(1) = lbcZones.ListIndex
            imChgMode = False
        ElseIf slZone = "[Grid]" Then
            imChgMode = True
            lbcZones.ListIndex = 0
            imSave(1) = lbcZones.ListIndex
            imChgMode = False
        Else
            imChgMode = True
            gFindMatch slZone, 0, lbcZones
            If gLastFound(lbcZones) >= 0 Then
                lbcZones.ListIndex = gLastFound(lbcZones)
            Else
                'lbcZones.ListIndex = -1
                If imSave(1) >= 0 Then
                    lbcZones.AddItem slZone
                    gFindMatch slZone, 0, lbcZones
                    If gLastFound(lbcZones) >= 0 Then
                        lbcZones.ListIndex = gLastFound(lbcZones)
                    Else
                        lbcZones.ListIndex = -1
                    End If
                Else
                    lbcZones.ListIndex = -1
                End If
            End If
            imSave(1) = lbcZones.ListIndex
            imChgMode = False
        End If
        mSetRGCtrl
        Exit Sub
    End If
    ilCode = CInt(slCode)
    If (ilCode = imVefCode) And (imVpfIndex >= 0) Then
        Exit Sub
    End If
    imVefCode = ilCode
    'For ilVef = LBound(tgMVef) To UBound(tgMVef) - 1 Step 1
    '    If tgMVef(ilVef).iCode = ilCode Then
        ilVef = gBinarySearchVef(ilCode)
        If ilVef <> -1 Then
            If tgMVef(ilVef).sType = "P" Then
                smMonDefStartDate = Format$(gNow(), "m/d/yy")
                smDefStartDate = Format$(gDateValue(smMonDefStartDate) + 1, "m/d/yy")
                'If lbcZones.ListCount = 1 Then
                '    Exit Sub
                'End If
                If imSave(1) >= 0 Then
                    slZone = lbcZones.List(imSave(1))
                Else
                    slZone = ""
                End If
                lbcZones.Clear
                lbcZones.AddItem "[Generic]", 0
                mAddRegion
                If slZone = "[Generic]" Then
                    imChgMode = True
                    If lbcZones.List(0) = "[Generic]" Then
                        lbcZones.ListIndex = 0
                    Else
                        lbcZones.ListIndex = 1
                    End If
                    imSave(1) = lbcZones.ListIndex
                    imChgMode = False
                ElseIf slZone = "[Grid]" Then
                    imChgMode = True
                    lbcZones.ListIndex = 0
                    imSave(1) = lbcZones.ListIndex
                    imChgMode = False
                Else
                    imChgMode = True
                    gFindMatch slZone, 0, lbcZones
                    If gLastFound(lbcZones) >= 0 Then
                        lbcZones.ListIndex = gLastFound(lbcZones)
                    Else
                        'lbcZones.ListIndex = -1
                        If imSave(1) >= 0 Then
                            lbcZones.AddItem slZone
                            gFindMatch slZone, 0, lbcZones
                            If gLastFound(lbcZones) >= 0 Then
                                lbcZones.ListIndex = gLastFound(lbcZones)
                            Else
                                lbcZones.ListIndex = -1
                            End If
                        Else
                            lbcZones.ListIndex = -1
                        End If
                    End If
                    imSave(1) = lbcZones.ListIndex
                    imChgMode = False
                End If
                mSetRGCtrl
                Exit Sub
            End If
    '        Exit For
        End If
    'Next ilVef
    imVpfIndex = gVpfFind(Copy, ilCode)
    'Add zones
    If imSave(1) >= 0 Then
        slZone = lbcZones.List(imSave(1))
    Else
        slZone = ""
    End If
    lbcZones.Clear
    For ilLoop = LBound(tgVpf(imVpfIndex).sGZone) To UBound(tgVpf(imVpfIndex).sGZone) Step 1
       If Trim$(tgVpf(imVpfIndex).sGZone(ilLoop)) <> "" Then
          lbcZones.AddItem Trim$(tgVpf(imVpfIndex).sGZone(ilLoop))
       End If
    Next ilLoop
    lbcZones.AddItem "[Generic]", 0
    mAddRegion
    If (slZone <> "") And (lbcZones.ListCount > 1) Then
        imChgMode = True
        gFindMatch slZone, 0, lbcZones
        If gLastFound(lbcZones) >= 0 Then
            lbcZones.ListIndex = gLastFound(lbcZones)
        Else
            'lbcZones.ListIndex = -1
            If imSave(1) >= 0 Then
                lbcZones.AddItem slZone
                gFindMatch slZone, 0, lbcZones
                If gLastFound(lbcZones) >= 0 Then
                    lbcZones.ListIndex = gLastFound(lbcZones)
                Else
                    lbcZones.ListIndex = -1
                End If
            Else
                lbcZones.ListIndex = -1
            End If
        End If
        imSave(1) = lbcZones.ListIndex
        imChgMode = False
    Else
        If slZone <> "" Then
            imChgMode = True
            lbcZones.ListIndex = 0  'All Zones
            imSave(1) = 0
            imChgMode = False
        Else
            imChgMode = True
            lbcZones.ListIndex = -1
            imSave(1) = -1
            imChgMode = False
        End If
    End If
    mSetRGCtrl
    smMonDefStartDate = Format$(gNow(), "m/d/yy")
    smDefStartDate = Format$(gDateValue(smMonDefStartDate) + 1, "m/d/yy")
    If (tgVpf(imVpfIndex).iLLD(0) <> 0) Or (tgVpf(imVpfIndex).iLLD(1) <> 0) Then
        gUnpackDate tgVpf(imVpfIndex).iLLD(0), tgVpf(imVpfIndex).iLLD(1), slDate
        If (tgVpf(imVpfIndex).sMoveLLD = "Y") And (gDateValue(smMonDefStartDate) < gDateValue(slDate)) Then
            smMonDefStartDate = gObtainNextMonday(smMonDefStartDate)
        Else
            smMonDefStartDate = gObtainNextMonday(smMonDefStartDate)
            If gDateValue(slDate) > gDateValue(smMonDefStartDate) Then
                smMonDefStartDate = gObtainNextMonday(slDate)
            End If
        End If
        If (tgVpf(imVpfIndex).sMoveLLD <> "Y") Or (gDateValue(smDefStartDate) >= gDateValue(slDate)) Then
            smDefStartDate = Format$(gDateValue(slDate) + 1, "m/d/yy")
        End If
    Else
        smMonDefStartDate = gObtainNextMonday(smMonDefStartDate)
    End If
    Exit Sub
End Sub
'*******************************************************
'*                                                     *
'*      Procedure Name:mVehPop                         *
'*                                                     *
'*             Created:5/13/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Populate the selection combo   *
'*                      box                            *
'*                                                     *
'*******************************************************
Private Sub mVehPop()
'******************************************************************************************
'* Note: VBC id'd the following unreferenced items and handled them as described:         *
'*                                                                                        *
'* Local Variables (Removed)                                                              *
'*  llFilter                      ilValue                                                 *
'*                                                                                        *
'* Local Labels (Marked)                                                                  *
'*  mVehPopErr                                                                            *
'******************************************************************************************

    Dim ilRet As Integer
    Dim ilLoop As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim slName As String
    Dim llChfCode As Long
    Dim ilCntrSelected As Integer
    Dim ilFound As Integer
    Dim tlVsf As VSF        'Virtual Vehicle
    Dim ilLoop1 As Integer
    Dim ilExtLen As Integer
    Dim llNoRec As Long
    Dim llRecPos As Long
    Dim ilOffSet As Integer
    Dim slFormat As String
    Dim slPrefix As String
    Dim ilClf As Integer
    Dim ilLen As Integer
    Dim ilAddVeh As Integer
    Dim tlCharTypeBuff As POPCHARTYPE   'Type field record
    Dim tlLTypeBuff As POPLCODE   'Type field record
    Dim ilShowAll As Integer
    Dim llClfStartDate As Long
    Dim llClfEndDate As Long

    If imInAllSaveRec = True Then
        Exit Sub
    End If
    gSetMousePointer grdRot, grdRot, vbHourglass
    'Populate with vehicles defined for a contract if selected
    'If not selected- then populate all selling and conventional vehicles
    If smSave(1) <> "" Then
        gFindMatch smSave(1), 0, lbcCntr
        If gLastFound(lbcCntr) >= 0 Then
            slNameCode = tmCopyCntrCode(gLastFound(lbcCntr)).sKey    'lbcCntrCode.List(gLastFound(lbcCntr))
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            llChfCode = Val(slCode)
            ilCntrSelected = True
        Else
            ilCntrSelected = False
        End If
    Else
        ilCntrSelected = False
    End If
    lbcVehicle.Clear
    If imSave(9) < 0 Then
        If Not imRetailHourGlass Then
            gSetMousePointer grdRot, grdRot, vbDefault
        End If
        Exit Sub
    End If
    'If (ckcIncludeMG.Value = vbUnchecked) Then
        If ((Asc(tgSpf.sUsingFeatures) And LIVECOPY) = LIVECOPY) Or ((Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) = PROMOCOPY) Then 'Using Live Copy
            If imSave(12) < 0 Then
                If Not imRetailHourGlass Then
                    gSetMousePointer grdRot, grdRot, vbDefault
                End If
                Exit Sub
            End If
        Else
            If imSave(12) < 0 Then
                imSave(12) = 1
            End If
        End If
    'End If
    edcHdLnComment.Text = ""
    ReDim tgCVehicle(0 To 0) As SORTCODE
    If ilCntrSelected Then
        'lbcVehicleCode.Clear
        'lbcVehicleCode.Tag = ""
        sgCVehicleTag = ""
        'If (tgSpf.sCPkOrdered = "Y") Or (tgSpf.sCPkAired = "Y") Then
'            ilRet = gObtainChfClf(hmChf, hmClf, llChfCode, False, tmChf, tgClfCopy())
            For ilLoop = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
                ilAddVeh = False
                '6/30/10:  Don't include hidden lines
                'If (tgClfCopy(ilLoop).ClfRec.sDelete <> "Y") Then
                '7/12/10:  Bypass CBSlines
                gUnpackDateLong tgClfCopy(ilLoop).ClfRec.iStartDate(0), tgClfCopy(ilLoop).ClfRec.iStartDate(1), llClfStartDate
                gUnpackDateLong tgClfCopy(ilLoop).ClfRec.iEndDate(0), tgClfCopy(ilLoop).ClfRec.iEndDate(1), llClfEndDate
                If (tgClfCopy(ilLoop).ClfRec.sDelete <> "Y") And (tgClfCopy(ilLoop).ClfRec.sHideCBS <> "Y") And (llClfEndDate >= llClfStartDate) Then
                    If imSave(9) >= 0 Then
                        ilLen = Val(lbcLen.List(imSave(9)))
                        If imTypeIndex = 0 Then
                            If tgClfCopy(ilLoop).ClfRec.iLen = ilLen Then
                                ilAddVeh = True
                            End If
                        ElseIf imTypeIndex = 1 Then
                            If tgClfCopy(ilLoop).ClfRec.iBBOpenLen = ilLen Then
                                ilAddVeh = True
                            End If
                        ElseIf imTypeIndex = 2 Then
                            If tgClfCopy(ilLoop).ClfRec.iBBCloseLen = ilLen Then
                                ilAddVeh = True
                            End If
                        End If
                    End If
                    If ilAddVeh Then
                        If (imSave(12) = 0) Then
                            If tgClfCopy(ilLoop).ClfRec.sLiveCopy <> "L" Then
                                ilAddVeh = False
                            End If
                        ElseIf (imSave(12) = 2) Then
                            If tgClfCopy(ilLoop).ClfRec.sLiveCopy <> "M" Then
                                ilAddVeh = False
                            End If
                        ElseIf (imSave(12) = 3) Then
                            If tgClfCopy(ilLoop).ClfRec.sLiveCopy <> "S" Then
                                ilAddVeh = False
                            End If
                        ElseIf (imSave(12) = 4) Then
                            If tgClfCopy(ilLoop).ClfRec.sLiveCopy <> "P" Then
                                ilAddVeh = False
                            End If
                        ElseIf (imSave(12) = 5) Then
                            If tgClfCopy(ilLoop).ClfRec.sLiveCopy <> "Q" Then
                                ilAddVeh = False
                            End If
                        Else
                            If (tgClfCopy(ilLoop).ClfRec.sLiveCopy = "L") Or (tgClfCopy(ilLoop).ClfRec.sLiveCopy = "M") Or (tgClfCopy(ilLoop).ClfRec.sLiveCopy = "S") Or (tgClfCopy(ilLoop).ClfRec.sLiveCopy = "P") Or (tgClfCopy(ilLoop).ClfRec.sLiveCopy = "Q") Then
                                ilAddVeh = False
                            End If
                        End If
                    End If
                End If
                If ilAddVeh Then
                    If tgClfCopy(ilLoop).ClfRec.sType <> "H" Then   'Bypass Hidden lines
                        If (imSave(12) <> 0) And (imSave(12) <> 2) Then
                            If (tgClfCopy(ilLoop).ClfRec.sType <> "O") And (tgClfCopy(ilLoop).ClfRec.sType <> "A") And (tgClfCopy(ilLoop).ClfRec.sType <> "E") Then
                                mAddVehToLbc tgClfCopy(ilLoop).ClfRec.iVefCode, "1"
                            Else
                                '8/16/19: Allowing package so that copy will show on invoices for packages
                                ''Bypass package vehicles in vCreative
                                'If (Asc(tgSpf.sUsingFeatures10) And VCREATIVEEXPORT) <> VCREATIVEEXPORT Then
                                    mAddVehToLbc tgClfCopy(ilLoop).ClfRec.iVefCode, "0"
                                'End If
                            End If
                        Else
                            ''If Live Copy, don't include Package lines
                            '2/8/12: Allow copy to be defined with Package Lines
                            'If (tgClfCopy(ilLoop).ClfRec.sType <> "O") And (tgClfCopy(ilLoop).ClfRec.sType <> "A") And (tgClfCopy(ilLoop).ClfRec.sType <> "E") Then
                            If (tgClfCopy(ilLoop).ClfRec.sType <> "O") And (tgClfCopy(ilLoop).ClfRec.sType <> "A") And (tgClfCopy(ilLoop).ClfRec.sType <> "E") Then
                                mAddVehToLbc tgClfCopy(ilLoop).ClfRec.iVefCode, "1"
                            Else
                                '8/16/19: Allowing package so that copy will show on invoices for packages
                                ''Bypass package vehicles in vCreative
                                'If (Asc(tgSpf.sUsingFeatures10) And VCREATIVEEXPORT) <> VCREATIVEEXPORT Then
                                    mAddVehToLbc tgClfCopy(ilLoop).ClfRec.iVefCode, "0"
                                'End If
                            End If
                            'End If
                        End If
                    Else
                        mAddVehToLbc tgClfCopy(ilLoop).ClfRec.iVefCode, "2"
                    End If
                    If tmVef.sType = "V" Then
                        tmVsfSrchKey.lCode = tmVef.lVsfCode
                        ilRet = btrGetEqual(hmVsf, tlVsf, imVsfRecLen, tmVsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                        For ilLoop1 = LBound(tlVsf.iFSCode) To UBound(tlVsf.iFSCode) Step 1
                            If tlVsf.iFSCode(ilLoop1) > 0 Then
                                mAddVehToLbc tlVsf.iFSCode(ilLoop1), "1"
                            End If
                        Next ilLoop1
                    Else
                        mAirVehPop
                    End If
                End If
            Next ilLoop
            mBuildHdLnComment
        'Else
        '    'Obtain vehicles of all lines for the contract
        '    tmChfSrchKey.lCode = llChfCode
        '    ilRet = btrGetEqual(hmChf, tmChf, imChfRecLen, tmChfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        '    If tmChf.lVefCode > 0 Then
        '        mAddVehToLbc CInt(tmChf.lVefCode), False
        '        If tmVef.sType = "V" Then
         '           tmVsfSrchKey.lCode = tmVef.lVsfCode
        '            ilRet = btrGetEqual(hmVsf, tlVsf, imVsfRecLen, tmVsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        '            For ilLoop1 = LBound(tlVsf.iFSCode) To UBound(tlVsf.iFSCode) Step 1
        '                If tlVsf.iFSCode(ilLoop1) > 0 Then
        '                    mAddVehToLbc tlVsf.iFSCode(ilLoop1)
        '                End If
        '            Next ilLoop1
        '        End If
        '    Else
        '        tmVsfSrchKey.lCode = -tmChf.lVefCode
        '        ilRet = btrGetEqual(hmVsf, tmVsf, imVsfRecLen, tmVsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        '        Do While ilRet = BTRV_ERR_NONE
        '            For ilLoop = LBound(tmVsf.iFSCode) To UBound(tmVsf.iFSCode) Step 1
        '                If tmVsf.iFSCode(ilLoop) > 0 Then
        '                    mAddVehToLbc tmVsf.iFSCode(ilLoop)
        '                    If tmVef.sType = "V" Then
        '                        tmVsfSrchKey.lCode = tmVef.lVsfCode
        '                        ilRet = btrGetEqual(hmVsf, tlVsf, imVsfRecLen, tmVsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        '                        For ilLoop1 = LBound(tlVsf.iFSCode) To UBound(tlVsf.iFSCode) Step 1
        '                            If tlVsf.iFSCode(ilLoop1) > 0 Then
        '                                mAddVehToLbc tlVsf.iFSCode(ilLoop1)
        '                            End If
        '                        Next ilLoop1
        '                    End If
        '                End If
        '            Next ilLoop
        '            If tmVsf.lLkVsfCode <= 0 Then
        '                Exit Do
         '           End If
        '            tmVsfSrchKey.lCode = tmVsf.lLkVsfCode
        '            ilRet = btrGetEqual(hmVsf, tmVsf, imVsfRecLen, tmVsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        '        Loop
        '    End If
        'End If
        'Check for "Any Vehicle Spots" to other vehicles
        'Get any vehicle spots
        If (ckcIncludeMG.Value = vbChecked) And (imSave(9) >= 0) Then
            ilLen = Val(lbcLen.List(imSave(9)))
            ilExtLen = Len(tmSmf)
            llNoRec = gExtNoRec(ilExtLen) 'btrRecords(hlSdf) 'Obtain number of records
            btrExtClear hmSmf   'Clear any previous extend operation
            tmSmfSrchKey.lChfCode = llChfCode
            tmSmfSrchKey.iLineNo = 0
            tmSmfSrchKey.iMissedDate(0) = 0
            tmSmfSrchKey.iMissedDate(1) = 0
            ilRet = btrGetGreaterOrEqual(hmSmf, tmSmf, imSmfRecLen, tmSmfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
            If ilRet <> BTRV_ERR_END_OF_FILE Then
                Call btrExtSetBounds(hmSmf, llNoRec, -1, "UC", "SMF", "") 'Set extract limits (all records)
                If lgMtfNoRecs > 0 Then
                    tlLTypeBuff.lCode = llChfCode
                    ilOffSet = gFieldOffset("Smf", "SmfChfCode")
                    ilRet = btrExtAddLogicConst(hmSmf, BTRV_KT_INT, ilOffSet, 4, BTRV_EXT_EQUAL, BTRV_EXT_LAST_TERM, tlLTypeBuff, 4)
                Else
                    tlLTypeBuff.lCode = llChfCode
                    ilOffSet = gFieldOffset("Smf", "SmfChfCode")
                    ilRet = btrExtAddLogicConst(hmSmf, BTRV_KT_INT, ilOffSet, 4, BTRV_EXT_EQUAL, BTRV_EXT_AND, tlLTypeBuff, 4)

                    '2-10-05 need to find those outsides/fills moved outside its sched vehicle
                    tlCharTypeBuff.sType = "M"    'Extract all matching records
                    ilOffSet = gFieldOffset("Smf", "SmfMGSource")
                    ilRet = btrExtAddLogicConst(hmSmf, BTRV_KT_STRING, ilOffSet, 1, BTRV_EXT_EQUAL, BTRV_EXT_OR, tlCharTypeBuff, 1)

                    tlCharTypeBuff.sType = "A"    'Extract all matching records
                    ilOffSet = gFieldOffset("Smf", "SmfMGSource")
                    ilRet = btrExtAddLogicConst(hmSmf, BTRV_KT_STRING, ilOffSet, 1, BTRV_EXT_EQUAL, BTRV_EXT_LAST_TERM, tlCharTypeBuff, 1)
                End If
                ilRet = btrExtAddField(hmSmf, 0, ilExtLen)  'Extract Name
                If ilRet = BTRV_ERR_NONE Then
                    ilRet = btrExtGetNext(hmSmf, tmSmf, ilExtLen, llRecPos)
                    If (ilRet <> BTRV_ERR_END_OF_FILE) And (ilRet <> BTRV_ERR_FILTER_LIMIT) Then
                        If (ilRet <> BTRV_ERR_NONE) And (ilRet <> BTRV_ERR_REJECT_COUNT) Then
                        Else
                            ilExtLen = Len(tmSmf)
                            'ilRet = btrExtGetFirst(hlSdf, tlSdfExt, ilExtLen, llRecPos)
                            Do While ilRet = BTRV_ERR_REJECT_COUNT
                                ilRet = btrExtGetNext(hmSmf, tmSmf, ilExtLen, llRecPos)
                            Loop
                            Do While ilRet = BTRV_ERR_NONE
                                tmSdfSrchKey3.lCode = tmSmf.lSdfCode
                                ilRet = btrGetEqual(hmSdf, tmSdf, imSdfRecLen, tmSdfSrchKey3, INDEXKEY3, BTRV_LOCK_NONE, SETFORREADONLY)   'Get first record as starting point of extend operation
                                If ilRet = BTRV_ERR_NONE Then
                                    'Exclude Sold vehicles
                                    ilAddVeh = True
                                    For ilClf = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
                                        '5/9/12:  Bypass CBSlines
                                        'If tgClfCopy(ilClf).ClfRec.sDelete <> "Y" Then
                                        gUnpackDateLong tgClfCopy(ilClf).ClfRec.iStartDate(0), tgClfCopy(ilClf).ClfRec.iStartDate(1), llClfStartDate
                                        gUnpackDateLong tgClfCopy(ilClf).ClfRec.iEndDate(0), tgClfCopy(ilClf).ClfRec.iEndDate(1), llClfEndDate
                                        If (tgClfCopy(ilClf).ClfRec.sDelete <> "Y") And (tgClfCopy(ilClf).ClfRec.sHideCBS <> "Y") And (llClfEndDate >= llClfStartDate) Then
                                            If (tgClfCopy(ilClf).ClfRec.iVefCode = tmSdf.iVefCode) Then
                                                'If (imSave(12) = 1) Then
                                                '    If tgClfCopy(ilClf).ClfRec.sLiveCopy = "L" Then
                                                '        If imTypeIndex = 0 Then
                                                '            If tgClfCopy(ilClf).ClfRec.iLen = ilLen Then
                                                '                ilAddVeh = False
                                                '            End If
                                                '        ElseIf imTypeIndex = 1 Then
                                                '            If tgClfCopy(ilClf).ClfRec.iBBOpenLen = ilLen Then
                                                '                ilAddVeh = False
                                                '            End If
                                                '        ElseIf imTypeIndex = 2 Then
                                                '            If tgClfCopy(ilClf).ClfRec.iBBCloseLen = ilLen Then
                                                '                ilAddVeh = False
                                                '            End If
                                                '        End If
                                                '    End If
                                                'Else
                                                '    If tgClfCopy(ilClf).ClfRec.sLiveCopy <> "L" Then
                                                        If imTypeIndex = 0 Then
                                                            If tgClfCopy(ilClf).ClfRec.iLen = ilLen Then
                                                                ilAddVeh = False
                                                            End If
                                                        ElseIf imTypeIndex = 1 Then
                                                            If tgClfCopy(ilClf).ClfRec.iBBOpenLen = ilLen Then
                                                                ilAddVeh = False
                                                            End If
                                                        ElseIf imTypeIndex = 2 Then
                                                            If tgClfCopy(ilClf).ClfRec.iBBCloseLen = ilLen Then
                                                                ilAddVeh = False
                                                            End If
                                                        End If
                                                    'End If
                                                'End If
                                                If Not ilAddVeh Then
                                                    Exit For
                                                End If
                                            End If
                                        End If
                                    Next ilClf
                                    'Check length
                                    If ilAddVeh Then
                                        ilAddVeh = False
                                        If (imSave(9) >= 0) Then
                                            For ilClf = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
                                                '5/9/12:  Bypass CBSlines
                                                'If tgClfCopy(ilClf).ClfRec.sDelete <> "Y" Then
                                                gUnpackDateLong tgClfCopy(ilClf).ClfRec.iStartDate(0), tgClfCopy(ilClf).ClfRec.iStartDate(1), llClfStartDate
                                                gUnpackDateLong tgClfCopy(ilClf).ClfRec.iEndDate(0), tgClfCopy(ilClf).ClfRec.iEndDate(1), llClfEndDate
                                                If (tgClfCopy(ilClf).ClfRec.sDelete <> "Y") And (tgClfCopy(ilClf).ClfRec.sHideCBS <> "Y") And (llClfEndDate >= llClfStartDate) Then
                                                    If tgClfCopy(ilClf).ClfRec.iLine = tmSdf.iLineNo Then
                                                        If imTypeIndex = 0 Then
                                                            If tgClfCopy(ilClf).ClfRec.iLen = ilLen Then
                                                                ilAddVeh = True
                                                            End If
                                                        ElseIf imTypeIndex = 1 Then
                                                            If tgClfCopy(ilClf).ClfRec.iBBOpenLen = ilLen Then
                                                                ilAddVeh = True
                                                            End If
                                                        ElseIf imTypeIndex = 2 Then
                                                            If tgClfCopy(ilClf).ClfRec.iBBCloseLen = ilLen Then
                                                                ilAddVeh = True
                                                            End If
                                                        End If
                                                        If ilAddVeh Then
                                                            If (imSave(12) = 0) Then
                                                                If tgClfCopy(ilClf).ClfRec.sLiveCopy <> "L" Then
                                                                    ilAddVeh = False
                                                                End If
                                                            ElseIf (imSave(12) = 2) Then
                                                                If tgClfCopy(ilClf).ClfRec.sLiveCopy <> "M" Then
                                                                    ilAddVeh = False
                                                                End If
                                                            ElseIf (imSave(12) = 3) Then
                                                                If tgClfCopy(ilClf).ClfRec.sLiveCopy <> "S" Then
                                                                    ilAddVeh = False
                                                                End If
                                                            ElseIf (imSave(12) = 4) Then
                                                                If tgClfCopy(ilClf).ClfRec.sLiveCopy <> "P" Then
                                                                    ilAddVeh = False
                                                                End If
                                                            ElseIf (imSave(12) = 5) Then
                                                                If tgClfCopy(ilClf).ClfRec.sLiveCopy <> "Q" Then
                                                                    ilAddVeh = False
                                                                End If
                                                            Else
                                                                If (tgClfCopy(ilClf).ClfRec.sLiveCopy = "L") Or (tgClfCopy(ilClf).ClfRec.sLiveCopy = "M") Or (tgClfCopy(ilClf).ClfRec.sLiveCopy = "S") Or (tgClfCopy(ilClf).ClfRec.sLiveCopy = "P") Or (tgClfCopy(ilClf).ClfRec.sLiveCopy = "Q") Then
                                                                    ilAddVeh = False
                                                                End If
                                                            End If
                                                        End If
                                                        Exit For
                                                    End If
                                                End If
                                            Next ilClf
                                        End If
                                    End If
                                    If ilAddVeh Then
                                        ilFound = False
                                        For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1  'lbcVehicleCode.ListCount - 1 Step 1
                                            slNameCode = tgCVehicle(ilLoop).sKey    'lbcVehicleCode.List(ilLoop)
                                            ilRet = gParseItem(slNameCode, 2, "\", slCode)
                                            If Val(slCode) = tmSdf.iVefCode Then
                                                'If Left$(slNameCode, 1) <> "3" Then
                                                '    For ilClf = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
                                                '        If tgClfCopy(ilClf).ClfRec.iVefCode = tmSdf.iVefCode Then
                                                '            If tgClfCopy(ilClf).ClfRec.iLen = tmSdf.iLen Then
                                                '                ilFound = True
                                                '                Exit For
                                                '            End If
                                                '        End If
                                                '    Next ilClf
                                                'Else
                                                '    ilFound = True
                                                '    Exit For
                                                'End If
                                                ilFound = True
                                                Exit For
                                            End If
                                        Next ilLoop
                                        If Not ilFound Then
                                            'mAddVehToLbc tmSdf.iVefCode, "2"
                                            mAddVehToLbc tmSdf.iVefCode, "3"
                                            mAirVehPop
                                        End If
                                    End If
                                End If
                                ilRet = btrExtGetNext(hmSmf, tmSmf, ilExtLen, llRecPos)
                                Do While ilRet = BTRV_ERR_REJECT_COUNT
                                    ilRet = btrExtGetNext(hmSmf, tmSmf, ilExtLen, llRecPos)
                                Loop
                            Loop
                        End If
                    End If
                End If
            End If
        End If
        ilShowAll = False
        For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1  'lbcVehicleCode.ListCount - 1 Step 1
            slNameCode = tgCVehicle(ilLoop).sKey    'lbcVehicleCode.List(ilLoop)
            slPrefix = ""
            If Left$(slNameCode, 1) = "2" Then
                slPrefix = "H:"
            'ElseIf Left$(slNameCode, 1) = "2" Then
            '    slPrefix = "MG:"
            ElseIf Left$(slNameCode, 1) = "4" Then
                slPrefix = "A:"
            ElseIf Left$(slNameCode, 1) = "3" Then
                slPrefix = "MG:"
                ilShowAll = True
            ElseIf Left$(slNameCode, 1) = "1" Then
                ilShowAll = True    'Conventional/Sports
            Else
                ilShowAll = True    'Package
            End If
            ilRet = gParseItem(slNameCode, 1, "\", slName)
            ilRet = gParseItem(slName, 4, "|", slFormat)
            ilRet = gParseItem(slName, 3, "|", slName)
            If Trim$(slFormat) <> "" Then
                lbcVehicle.AddItem slPrefix & Trim$(slName) & "/" & Trim$(slFormat)
            Else
                lbcVehicle.AddItem slPrefix & Trim$(slName)
            End If
        Next ilLoop
        If lbcVehicle.ListCount > 0 Then
            If ilShowAll Then
                lbcVehicle.AddItem "[All]", 0
                imAllVehAdj = 1
            Else
                imAllVehAdj = 0
            End If
        Else
            lbcVehicle.AddItem "[None]", 0
            imAllVehAdj = 1
        End If
    Else
        'llFilter = VEHCONV_WO_FEED + VEHCONV_W_FEED + VEHSELLING + VEHVIRTUAL + ACTIVEVEH ' Selling and conventional vehicles
        ''ilRet = gPopUserVehicleBox(Copy, ilFilter, lbcVehicle, lbcVehicleCode)
        'ilRet = gPopUserVehicleBox(Copy, llFilter, lbcVehicle, tgCVehicle(), sgCVehicleTag)
        'If ilRet <> CP_MSG_NOPOPREQ Then
        '    On Error GoTo mVehPopErr
        '    gCPErrorMsg ilRet, "mVehPop (gPopUserVehicleBox: Vehicle)", Copy
        '    On Error GoTo 0
        'End If
        lbcVehicle.Clear
        imAllVehAdj = 0
    End If
    If Not imRetailHourGlass Then
        gSetMousePointer grdRot, grdRot, vbDefault
    End If
    imVehPopReq = False
    Exit Sub
mVehPopErr: 'VBC NR
    gSetMousePointer grdRot, grdRot, vbDefault
    On Error GoTo 0
    imTerminate = True
    Exit Sub
End Sub

Private Sub pbcAGSTab_GotFocus()
    If imAGDirection = 0 Then
        If rbcAirTimeCopyBy(0).Value Then
            edcTimeDay(0).SetFocus
        ElseIf rbcAirTimeCopyBy(1).Value Then
            mGameTeamPop
            lbcGameNo.SetFocus
        ElseIf rbcAirTimeCopyBy(2).Value Then
            mGameTeamPop
            lbcTeam.SetFocus
        Else
            rbcAirTimeCopyBy(0).SetFocus
        End If
        imAGDirection = -1
    Else
        imBoxNo = STIMEINDEX
        pbcSTab.SetFocus
    End If
End Sub

Private Sub pbcAGTab_GotFocus()
    If imAGDirection = 1 Then
        If rbcAirTimeCopyBy(0).Value Then
            edcTimeDay(0).SetFocus
        ElseIf rbcAirTimeCopyBy(1).Value Then
            mGameTeamPop
            lbcGameNo.SetFocus
        ElseIf rbcAirTimeCopyBy(2).Value Then
            mGameTeamPop
            lbcTeam.SetFocus
        Else
            rbcAirTimeCopyBy(0).SetFocus
        End If
        imAGDirection = -1
    Else
        imBoxNo = SUNINDEX
        pbcTab.SetFocus
    End If
End Sub

Private Sub pbcAvType_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub
Private Sub pbcAvType_KeyPress(KeyAscii As Integer)
    If (KeyAscii = Asc("A")) Or (KeyAscii = Asc("a")) Then
        imSave(10) = 0
        pbcAvType_Paint
    ElseIf KeyAscii = Asc("B") Or (KeyAscii = Asc("b")) Then
        imSave(10) = 1
        pbcAvType_Paint
    ElseIf KeyAscii = Asc("E") Or (KeyAscii = Asc("e")) Then
        imSave(10) = 2
        pbcAvType_Paint
    End If
    If KeyAscii = Asc(" ") Then
        If imSave(10) = 0 Then
            imSave(10) = 1
            pbcAvType_Paint
        ElseIf imSave(10) = 1 Then
            imSave(10) = 2
            pbcAvType_Paint
        ElseIf imSave(10) = 2 Then
            imSave(10) = 0
            pbcAvType_Paint
        End If
    End If
    mSetChg imBoxNo
End Sub
Private Sub pbcAvType_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If imSave(10) = 0 Then
        imSave(10) = 1
    ElseIf imSave(10) = 1 Then
        imSave(10) = 2
    Else
        imSave(10) = 0
    End If
    mSetChg imBoxNo
    pbcAvType_Paint
End Sub
Private Sub pbcAvType_Paint()
    pbcAvType.Cls
    pbcAvType.CurrentX = fgBoxInsetX
    pbcAvType.CurrentY = 0 'fgBoxInsetY
    If imSave(10) = 0 Then
        pbcAvType.Print "All avails"
    ElseIf imSave(10) = 1 Then
        pbcAvType.Print "Book into"
    ElseIf imSave(10) = 2 Then
        pbcAvType.Print "Exclude"
    End If
End Sub
Private Sub pbcCalendar_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim llDate As Long
    Dim ilWkDay As Integer
    Dim ilRowNo As Integer
    Dim slDay As String
    ilRowNo = 0
    llDate = lmCalStartDate
    Do
        ilWkDay = gWeekDayLong(llDate)
        slDay = Trim$(str$(Day(llDate)))
        If (X >= tmCDCtrls(ilWkDay + 1).fBoxX) And (X <= (tmCDCtrls(ilWkDay + 1).fBoxX + tmCDCtrls(ilWkDay + 1).fBoxW)) Then
            If (Y >= tmCDCtrls(ilWkDay + 1).fBoxY + ilRowNo * (tmCDCtrls(ilWkDay + 1).fBoxH + 15)) And (Y <= tmCDCtrls(ilWkDay + 1).fBoxY + ilRowNo * (tmCDCtrls(ilWkDay + 1).fBoxH + 15) + tmCDCtrls(ilWkDay + 1).fBoxH) Then
                edcDropDown.Text = Format$(llDate, "m/d/yy")
                edcDropDown.SelStart = 0
                edcDropDown.SelLength = Len(edcDropDown.Text)
                imBypassFocus = True
                edcDropDown.SetFocus
                Exit Sub
            End If
        End If
        If ilWkDay = 6 Then
            ilRowNo = ilRowNo + 1
        End If
        llDate = llDate + 1
    Loop Until llDate > lmCalEndDate
    edcDropDown.SetFocus
End Sub
Private Sub pbcCalendar_Paint()
    Dim slStr As String
    slStr = Trim$(str$(imCalMonth)) & "/15/" & Trim$(str$(imCalYear))
    lacCalName.Caption = gMonthYearFormat(slStr)
    gPaintCalendar imCalMonth, imCalYear, imCalType, pbcCalendar, tmCDCtrls(), lmCalStartDate, lmCalEndDate
    mBoxCalDate
End Sub

Private Sub pbcCGSTab_GotFocus()
    Dim ilPrev As Integer

    If GetFocus() <> pbcCGSTab.HWnd Then
        Exit Sub
    End If
    If imCGCtrlVisible Then
        mCGSetShow
        Do
            ilPrev = False
            If grdCopy.Col = REPEATINDEX Then
                If Not bmExitCG Then
                    If grdCopy.Row > grdCopy.FixedRows Then
                        lmCGTopRow = -1
                        grdCopy.Row = grdCopy.Row - 1
                        If Not grdCopy.RowIsVisible(grdCopy.Row) Then
                            grdCopy.TopRow = grdCopy.TopRow - 1
                        End If
                        grdCopy.Col = REPEATINDEX
                        mCGEnableBox
                    Else
                        cmcCancel.SetFocus
                    End If
                Else
                    cmcCancel.SetFocus
                End If
            Else
                cmcCancel.SetFocus
            End If
        Loop While ilPrev
    Else
        lmTopRow = -1
        grdCopy.TopRow = grdCopy.FixedRows
        grdCopy.Col = REPEATINDEX
        grdCopy.Row = grdCopy.FixedRows
        mCGEnableBox
    End If
End Sub

Private Sub pbcCGTab_GotFocus()
    Dim llRow As Long
    Dim ilNext As Integer
    Dim llEnableRow As Long

    If GetFocus() <> pbcCGTab.HWnd Then
        Exit Sub
    End If
    If imCGCtrlVisible Then
        llEnableRow = lmCGEnableRow
        mCGSetShow
        Do
            ilNext = False
            If grdCopy.Col = REPEATINDEX Then
                If Not bmExitCG Then
                    llRow = grdCopy.rows
                    Do
                        llRow = llRow - 1
                    Loop While ((grdCopy.TextMatrix(llRow, CARTINDEX) = "") And (tgSpf.sUseCartNo = "Y")) Or ((grdCopy.TextMatrix(llRow, ISCIINDEX) = "") And (tgSpf.sUseCartNo = "N")) Or ((grdCopy.TextMatrix(llRow, CARTINDEX) = "") And (grdCopy.TextMatrix(llRow, ISCIINDEX) = "") And (tgSpf.sUseCartNo = "B"))
                    llRow = llRow + 1
                    If (grdCopy.Row + 1 < llRow) Then
                        lmCGTopRow = -1
                        grdCopy.Row = grdCopy.Row + 1
                        If Not grdCopy.RowIsVisible(grdCopy.Row) Then ' Or (grdCopy.Row - (grdCopy.TopRow - grdCopy.FixedRows) >= imInitNoRows) Then
                            imCGIgnoreScroll = True
                            grdCopy.TopRow = grdCopy.TopRow + 1
                        End If
                        grdCopy.Col = REPEATINDEX
                        mCGEnableBox
                    Else
                        pbcRGTab.SetFocus
                    End If
                Else
                    pbcRGTab.SetFocus
                End If
            Else
                pbcRGTab.SetFocus
            End If
        Loop While ilNext
    Else
        lmCGTopRow = -1
        grdCopy.TopRow = grdCopy.FixedRows
        grdCopy.Col = REPEATINDEX
        grdCopy.Row = grdCopy.FixedRows
        mCGEnableBox
    End If
End Sub

Private Sub pbcClickFocus_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub pbcClickFocus_GotFocus()
    imButtonIndex = 0
    edcToolTip.Visible = False
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    'tmcClick.Enabled = False
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub
Private Sub pbcClickFocus_KeyUp(KeyCode As Integer, Shift As Integer)
    If KeyCode = KEYF1 Then    'Functio key 1= Help
        'Traffic!cdcSetup.HelpFile = sgHelpPath & "traffic.hlp"
        'Traffic!cdcSetup.HelpCommand = cdlHelpIndex
        'Traffic!cdcSetup.Action = 6
    End If
End Sub
Private Sub pbcDay_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub
Private Sub pbcDay_KeyPress(KeyAscii As Integer)
    Dim ilIndex As Integer

    ilIndex = 2 + imBoxNo - MONINDEX
    If (KeyAscii = Asc("Y")) Or (KeyAscii = Asc("y")) Then
        imSave(ilIndex) = 1
        pbcDay_Paint
    ElseIf KeyAscii = Asc("N") Or (KeyAscii = Asc("n")) Then
        imSave(ilIndex) = 0
        pbcDay_Paint
    End If
    If KeyAscii = Asc(" ") Then
        If imSave(ilIndex) = 0 Then
            imSave(ilIndex) = 1
            pbcDay_Paint
        ElseIf imSave(ilIndex) = 1 Then
            imSave(ilIndex) = 0
            pbcDay_Paint
        End If
    End If
    mSetChg imBoxNo
End Sub
Private Sub pbcDay_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim ilIndex As Integer

    ilIndex = 2 + imBoxNo - MONINDEX
    If imSave(ilIndex) = 0 Then
        imSave(ilIndex) = 1
    Else
        imSave(ilIndex) = 0
    End If
    pbcDay_Paint
    mSetChg imBoxNo
End Sub
Private Sub pbcDay_Paint()
    Dim ilIndex As Integer

    ilIndex = 2 + imBoxNo - MONINDEX
    pbcDay.Cls
    pbcDay.CurrentX = fgBoxInsetX
    pbcDay.CurrentY = 0 'fgBoxInsetY
    If imSave(ilIndex) = 0 Then
        pbcDay.Print "N"
    Else
        pbcDay.Print "Y"
    End If
End Sub


Private Sub pbcFL_Click()
    If (tgSaf(0).sSyncCopyInRot = "Y") And (tmCrf.lCvfCode > 0) And (tmCrf.lCode > 0) And (cmcUpdate.Enabled = False) Then
        lgSetNextCvfCode = tmCrf.lCvfCode
        igFLValue = imFLValue
        CopyNextSet.Show vbModal
        imFLValue = igFLValue
        imInitNextFinal = imFLValue
        mSetFLPointer
    End If
End Sub

Private Sub pbcInvStatus_KeyPress(KeyAscii As Integer)

     
    If (KeyAscii = Asc("A")) Or (KeyAscii = Asc("a")) Then
        If imInvStatus <> 0 Then
            imInvStatus = 0
            bmInvStatusChange = True
            txtISCI_Filter_Main = ""
            pbcInvStatus_Paint
            mResetInvPop
        End If
        GoTo ex
    End If
    If (KeyAscii = Asc("P")) Or (KeyAscii = Asc("p")) Then
        If imInvStatus <> 1 Then
            imInvStatus = 1
            bmInvStatusChange = True
            txtISCI_Filter_Main = ""
            pbcInvStatus_Paint
            mResetInvPop
        End If
        GoTo ex
    End If
    If (KeyAscii = Asc("H")) Or (KeyAscii = Asc("h")) Then
        If imInvStatus <> 2 Then
            imInvStatus = 2
            bmInvStatusChange = True
            txtISCI_Filter_Main = ""
            pbcInvStatus_Paint
            mResetInvPop
        End If
        GoTo ex
    End If
    If KeyAscii = Asc(" ") Then
        If imInvStatus = 0 Then
            imInvStatus = 1
        ElseIf imInvStatus = 1 Then
            imInvStatus = 2
        Else
            imInvStatus = 0
        End If
        bmInvStatusChange = True
        txtISCI_Filter_Main = ""
        pbcInvStatus_Paint
        mResetInvPop
    End If
    
ex:
    bmInvStatusChange = False

End Sub

Private Sub pbcInvStatus_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If imInvStatus = 0 Then
        imInvStatus = 1
    ElseIf imInvStatus = 1 Then
        imInvStatus = 2
    Else
        imInvStatus = 0
    End If
    bmInvStatusChange = True
    txtISCI_Filter_Main = ""
    bmInvStatusChange = False
    pbcInvStatus_Paint
    mResetInvPop
End Sub
Private Sub pbcInvStatus_Paint()
    pbcInvStatus.Cls
    pbcInvStatus.CurrentX = fgBoxInsetX
    pbcInvStatus.CurrentY = -15 'fgBoxInsetY
    If imInvStatus = 0 Then
        pbcInvStatus.Print "Active"
    ElseIf imInvStatus = 1 Then
        pbcInvStatus.Print "Purged"
    ElseIf imInvStatus = 2 Then
        pbcInvStatus.Print "History"
    End If
End Sub

Private Sub pbcLbcInst_Paint()
    Dim ilLoop As Integer
    Dim slStr As String
    Dim llWidth As Long
    Dim ilInstEnd As Integer
    Dim ilField As Integer
    Dim slFields(0 To 2) As String
    Dim llFgColor As Long
    Dim ilFieldIndex As Integer
    
    ilInstEnd = lbcInst.TopIndex + lbcInst.height \ fgListHtArial825
    If ilInstEnd > lbcInst.ListCount Then
        ilInstEnd = lbcInst.ListCount
    End If
    If lbcInst.ListCount <= lbcInst.height \ fgListHtArial825 Then
        llWidth = lbcInst.Width - 30
    Else
        llWidth = lbcInst.Width - igScrollBarWidth - 30
    End If
    pbcLbcInst.Width = llWidth
    pbcLbcInst.Cls
    llFgColor = pbcLbcInst.ForeColor
    For ilLoop = lbcInst.TopIndex To ilInstEnd - 1 Step 1
        pbcLbcInst.ForeColor = llFgColor
        If lbcInst.MultiSelect = 0 Then
            If lbcInst.ListIndex = ilLoop Then
                gPaintArea pbcLbcInst, CSng(0), CSng((ilLoop - lbcInst.TopIndex) * fgListHtArial825), CSng(pbcLbcInst.Width), CSng(fgListHtArial825) - 15, vbHighlight 'WHITE
                pbcLbcInst.ForeColor = vbWhite
            End If
        Else
            If lbcInst.Selected(ilLoop) Then
                gPaintArea pbcLbcInst, CSng(0), CSng((ilLoop - lbcInst.TopIndex) * fgListHtArial825), CSng(pbcLbcInst.Width), CSng(fgListHtArial825) - 15, vbHighlight 'WHITE
                pbcLbcInst.ForeColor = vbWhite
            End If
        End If
        If lbcInst.ItemData(ilLoop) = 1 Then
            pbcLbcInst.ForeColor = vbRed
        End If
        slStr = lbcInst.List(ilLoop)
        gParseItemFields slStr, "~", slFields()
        ilFieldIndex = 0
        For ilField = LBONE To UBound(lmListField) - 1 Step 1
            pbcLbcInst.CurrentX = lmListField(ilField)
            pbcLbcInst.CurrentY = (ilLoop - lbcInst.TopIndex) * fgListHtArial825 + 15
            slStr = slFields(ilFieldIndex)
'            gAdjShowLen pbcLbcInst, slStr, lmListField(ilField + 1) - lmListField(ilField)
            If ilField = LBONE + 1 Then
                If slFields(ilFieldIndex) <> "" Then
                    gAdjShowLen pbcLbcInst, slStr, lmListField(ilField + 1) - lmListField(ilField)
                End If
            Else
                gAdjShowLen pbcLbcInst, slStr, lmListField(ilField + 1) - lmListField(ilField)
            End If
            pbcLbcInst.Print slStr
            ilFieldIndex = ilFieldIndex + 1
        Next ilField
        pbcLbcInst.ForeColor = llFgColor
    Next ilLoop

End Sub

Private Sub pbcLbcInv_Paint()
    Dim ilLoop As Integer
    Dim slStr As String
    Dim ilInvEnd As Integer
    Dim ilField As Integer
    Dim llWidth As Long
    Dim slFields(0 To 2) As String
    Dim llFgColor As Long
    Dim ilFieldIndex As Integer
    Dim i As Integer
    
    ilInvEnd = lbcInv.TopIndex + lbcInv.height \ fgListHtArial825
    If ilInvEnd > lbcInv.ListCount Then
        ilInvEnd = lbcInv.ListCount
    End If
    
    If lbcInv.ListCount <= lbcInv.height \ fgListHtArial825 Then
        llWidth = lbcInv.Width - 30
    Else
        llWidth = lbcInv.Width - igScrollBarWidth - 30
    End If
    pbcLbcInv.Width = llWidth
    
    pbcLbcInv.Cls
    llFgColor = pbcLbcInv.ForeColor
    For ilLoop = lbcInv.TopIndex To ilInvEnd - 1 Step 1
        pbcLbcInv.ForeColor = llFgColor
        If lbcInv.MultiSelect = 0 Then
            If lbcInv.ListIndex = ilLoop Then
                gPaintArea pbcLbcInv, CSng(0), CSng((ilLoop - lbcInv.TopIndex) * fgListHtArial825), CSng(pbcLbcInv.Width), CSng(fgListHtArial825) - 15, vbHighlight 'WHITE
                pbcLbcInv.ForeColor = vbWhite
            End If
        Else
            If lbcInv.Selected(ilLoop) Then
                gPaintArea pbcLbcInv, CSng(0), CSng((ilLoop - lbcInv.TopIndex) * fgListHtArial825), CSng(pbcLbcInv.Width), CSng(fgListHtArial825) - 15, vbHighlight 'WHITE
                pbcLbcInv.ForeColor = vbWhite
            End If
        End If
        
        ' TTP 10816 JJB 2023-08-21
        
        For i = 0 To lbcActive.ListCount - 1
            If smInvFColor(i) = lbcInv.List(ilLoop) Then
                pbcLbcInv.ForeColor = vbRed
                Exit For
            End If
        Next i
        
'        If lbcInv.ItemData(ilLoop) = 1 Then
'            pbcLbcInv.ForeColor = vbRed
'        End If
        
         ' TTP 10816 JJB 2023-08-21 END
         
        slStr = lbcInv.List(ilLoop)
        gParseItemFields slStr, "~", slFields()
        ilFieldIndex = 0
        For ilField = LBONE To UBound(lmListField) - 1 Step 1
            pbcLbcInv.CurrentX = lmListField(ilField)
            pbcLbcInv.CurrentY = (ilLoop - lbcInv.TopIndex) * fgListHtArial825 + 15
            slStr = slFields(ilFieldIndex)
            If (StrComp(slStr, "[New]", vbTextCompare) <> 0) And (StrComp(slStr, "[New-Cart]", vbTextCompare) <> 0) And (StrComp(slStr, "[New-ISCI]", vbTextCompare) <> 0) Then
'                gAdjShowLen pbcLbcInv, slStr, lmListField(ilField + 1) - lmListField(ilField)
                If ilField = LBONE + 1 Then
                    If slFields(ilFieldIndex) <> "" Then
                        gAdjShowLen pbcLbcInv, slStr, lmListField(ilField + 1) - lmListField(ilField)
                    End If
                Else
                    gAdjShowLen pbcLbcInv, slStr, lmListField(ilField + 1) - lmListField(ilField)
                End If
            End If
            pbcLbcInv.Print slStr
            ilFieldIndex = ilFieldIndex + 1
        Next ilField
        pbcLbcInv.ForeColor = llFgColor
    Next ilLoop
    mPopCG
End Sub

Private Sub pbcLbcRot_Paint()
    Dim ilLoop As Integer
    Dim slStr As String
    Dim ilRotEnd As Integer
    Dim ilField As Integer
    Dim slFields(0 To 17) As String
    Dim llFgColor As Long
    Dim llWidth As Long
    Dim ilFieldIndex As Integer

    ilRotEnd = lbcRot.TopIndex + lbcRot.height \ fgListHtArial825
    If ilRotEnd > lbcRot.ListCount Then
        ilRotEnd = lbcRot.ListCount
    End If
    If lbcRot.ListCount <= lbcRot.height \ fgListHtArial825 Then
        llWidth = lbcRot.Width - 30
    Else
        llWidth = lbcRot.Width - igScrollBarWidth - 30
    End If
    pbcLbcRot.Width = llWidth
    pbcLbcRot.Cls
    llFgColor = pbcLbcRot.ForeColor
    For ilLoop = lbcRot.TopIndex To ilRotEnd - 1 Step 1
        pbcLbcRot.ForeColor = llFgColor
        If lbcRot.MultiSelect = 0 Then
            If lbcRot.ListIndex = ilLoop Then
                gPaintArea pbcLbcRot, CSng(0), CSng((ilLoop - lbcRot.TopIndex) * fgListHtArial825), CSng(pbcLbcRot.Width), CSng(fgListHtArial825) - 15, vbHighlight 'WHITE
                pbcLbcRot.ForeColor = vbWhite
            End If
        Else
            If lbcRot.Selected(ilLoop) Then
                gPaintArea pbcLbcRot, CSng(0), CSng((ilLoop - lbcRot.TopIndex) * fgListHtArial825), CSng(pbcLbcRot.Width), CSng(fgListHtArial825) - 15, vbHighlight 'WHITE
                pbcLbcRot.ForeColor = vbWhite
            End If
        End If
        slStr = lbcRot.List(ilLoop)
        gParseItemFields slStr, "|", slFields()
        ilFieldIndex = 0
        For ilField = 1 To 18 Step 1
            pbcLbcRot.CurrentX = lmListFieldRot(ilField)
            pbcLbcRot.CurrentY = (ilLoop - lbcRot.TopIndex) * fgListHtArial825 + 15
            slStr = slFields(ilFieldIndex)
            gAdjShowLen pbcLbcRot, slStr, lmListFieldRot(ilField + 1) - lmListFieldRot(ilField)
            pbcLbcRot.Print slStr
            ilFieldIndex = ilFieldIndex + 1
        Next ilField
        pbcLbcRot.ForeColor = llFgColor
    Next ilLoop

End Sub

Private Sub pbcRGInclExcl_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub

Private Sub pbcRGInclExcl_KeyPress(KeyAscii As Integer)
    If KeyAscii = Asc("I") Or (KeyAscii = Asc("i")) Then
        smRGInclExcl = "Include"
        pbcRGInclExcl_Paint
    ElseIf KeyAscii = Asc("E") Or (KeyAscii = Asc("e")) Then
        smRGInclExcl = "Exclude"
        pbcRGInclExcl_Paint
    ElseIf KeyAscii = Asc("N") Or (KeyAscii = Asc("n")) Then
        smRGInclExcl = "None"
        pbcRGInclExcl_Paint
    End If
    If KeyAscii = Asc(" ") Then
        If smRGInclExcl = "Include" Then
            smRGInclExcl = "Exclude"
            pbcRGInclExcl_Paint
        ElseIf smRGInclExcl = "Exclude" Then
            smRGInclExcl = "None"
            pbcRGInclExcl_Paint
        ElseIf smRGInclExcl = "None" Then
            smRGInclExcl = "Include"
            pbcRGInclExcl_Paint
        End If
    End If
End Sub

Private Sub pbcRGInclExcl_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If smRGInclExcl = "Include" Then
        smRGInclExcl = "Exclude"
    ElseIf smRGInclExcl = "Exclude" Then
        smRGInclExcl = "None"
    ElseIf smRGInclExcl = "None" Then
        smRGInclExcl = "Include"
    End If
    pbcRGInclExcl_Paint
End Sub

Private Sub pbcRGInclExcl_Paint()
    pbcRGInclExcl.Cls
    pbcRGInclExcl.CurrentX = fgBoxInsetX
    pbcRGInclExcl.CurrentY = 0 'fgBoxInsetY
    pbcRGInclExcl.Print smRGInclExcl
End Sub

Private Sub pbcRGSTab_GotFocus()
    Dim ilPrev As Integer

    If GetFocus() <> pbcRGSTab.HWnd Then
        Exit Sub
    End If
    If imFromArrow Then
        imFromArrow = False
        mRGEnableBox
        Exit Sub
    End If
    If imRGCtrlVisible Then
        mRGSetShow
        Do
            ilPrev = False
            'If grdRot.Col = REGIONNAMEINDEX Then
            If grdRot.Col = RGVEHICLEINDEX Then
                If grdRot.Row > grdRot.FixedRows Then
                    lmTopRow = -1
                    grdRot.Row = grdRot.Row - 1
                    If Not grdRot.RowIsVisible(grdRot.Row) Then
                        grdRot.TopRow = grdRot.TopRow - 1
                    End If
                    'grdRot.Col = COPYINDEX
                    grdRot.Col = RGCOMMENTINDEX
                    mRGEnableBox
                Else
                    cmcCancel.SetFocus
                End If
            ElseIf grdRot.Col = ADVTINDEX Then
                If grdRot.TextMatrix(grdRot.Row, INCLEXCLINDEX) <> "Include" And grdRot.TextMatrix(grdRot.Row, INCLEXCLINDEX) <> "Exclude" Then
                    ilPrev = True
                    grdRot.Col = grdRot.Col - 1
                Else
                    grdRot.Col = grdRot.Col - 1
                    If mRGColOk() Then
                        mRGEnableBox
                    Else
                        ilPrev = True
                    End If
                End If
            ElseIf grdRot.Col = INCLEXCLINDEX Then
                If grdRot.TextMatrix(grdRot.Row, CATEGORYINDEX) = "[None]" Or grdRot.TextMatrix(grdRot.Row, CATEGORYINDEX) = "" Then
                    ilPrev = True
                    grdRot.Col = grdRot.Col - 1
                Else
                    grdRot.Col = grdRot.Col - 1
                    If mRGColOk() Then
                        mRGEnableBox
                    Else
                        ilPrev = True
                    End If
                End If
            Else
                grdRot.Col = grdRot.Col - 1
                If mRGColOk() Then
                    mRGEnableBox
                Else
                    ilPrev = True
                End If
            End If
        Loop While ilPrev
    Else
        lmTopRow = -1
        grdRot.TopRow = grdRot.FixedRows
        grdRot.Col = REGIONNAMEINDEX
        grdRot.Row = grdRot.FixedRows
        If mRGColOk() Then
            mRGEnableBox
        Else
            cmcCancel.SetFocus
        End If
    End If
End Sub

Private Sub pbcRGTab_GotFocus()
    Dim llRow As Long
    Dim ilCol As Integer
    Dim ilNext As Integer
    Dim llEnableRow As Long
    Dim slNameCode As String
    Dim slCode As String
    Dim ilRet As Integer

    If GetFocus() <> pbcRGTab.HWnd Then
        Exit Sub
    End If
    If imRGCtrlVisible Then
        If grdRot.Col = REGIONNAMEINDEX Then
            If (imAdvtIndex >= 0) And (lbcRGRegion.ListIndex >= 1) Then
                slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
                ilRet = gParseItem(slNameCode, 1, "\", sgAdvtName)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                igAdfCode = Val(slCode)   '
                igSplitType = 0         'Split copy flag
                If lbcRGRegion.ListIndex = 1 Then
                    lgSplitModelCodeRaf = 0
                Else
                    lgSplitModelCodeRaf = lbcRGRegion.ItemData(lbcRGRegion.ListIndex)
                End If
                igIncludeDormantSplits = False
                RegionModel.Show vbModal
                If (igSplitModelReturn <> 1) Or (lgSplitModelCodeRaf <= 0) Then
                    edcRGDropdown.SetFocus
                    Exit Sub
                End If
                If lbcRGRegion.ListIndex = 1 Then   'Model
                    llEnableRow = lmRGEnableRow
                    mRGSetShow
                    grdRot.Row = llEnableRow
                    grdRot.Col = REGIONNAMEINDEX
                    mRGEnableBox
                    Exit Sub
                End If
            End If
        End If
        llEnableRow = lmRGEnableRow
        mRGSetShow
        Do
            ilNext = False
            If grdRot.Col = COPYINDEX Then
                If grdRot.Row + 1 >= grdRot.rows Then
                    grdRot.AddItem ""
                    grdRot.rowHeight(grdRot.Row + 1) = fgFlexGridRowH
                End If
                If (grdRot.TextMatrix(llEnableRow + 1, COPYINDEX) = "") Then
                    For ilCol = RGVEHICLEINDEX To RGCOMMENTINDEX Step 1
                        If grdRot.TextMatrix(llEnableRow + 1, ilCol) <> "" Then
                            'Go to Copy
                            If Not grdRot.RowIsVisible(llEnableRow + 1) Then ' Or (grdRot.Row - (grdRot.TopRow - grdRot.FixedRows) >= imInitNoRows) Then
                                imIgnoreScroll = True
                                grdRot.TopRow = grdRot.TopRow + 1
                            End If
                            grdRot.Col = COPYINDEX
                            grdRot.Row = llEnableRow + 1
                            If mRGColOk() Then
                                mRGEnableBox
                                Exit Sub
                            End If
                        End If
                    Next ilCol
                End If
            End If
            If grdRot.Col = RGCOMMENTINDEX Then
                llRow = grdRot.rows
                Do
                    llRow = llRow - 1
                Loop While grdRot.TextMatrix(llRow, REGIONNAMEINDEX) = ""
                llRow = llRow + 1
                If (grdRot.Row + 1 < llRow) Then
                    lmTopRow = -1
                    grdRot.Row = grdRot.Row + 1
                    If Not grdRot.RowIsVisible(grdRot.Row) Then ' Or (grdRot.Row - (grdRot.TopRow - grdRot.FixedRows) >= imInitNoRows) Then
                        imIgnoreScroll = True
                        grdRot.TopRow = grdRot.TopRow + 1
                    End If
                    'to end up on if press tab when on arrow
                    grdRot.Col = REGIONNAMEINDEX
                    '3/25/13: Jim- always go to arrow
                    ''grdRot.TextMatrix(grdRot.Row, CODEINDEX) = 0
                    'If Trim$(grdRot.TextMatrix(grdRot.Row, REGIONNAMEINDEX)) <> "" Then
                    '    If mRGColOk() Then
                    '        mRGEnableBox
                    '    Else
                    '        cmcCancel.SetFocus
                    '    End If
                    'Else
                        imFromArrow = True
                        pbcArrow.Move grdRot.Left - pbcArrow.Width - 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + (grdRot.rowHeight(grdRot.Row) - pbcArrow.height) / 2
                        pbcArrow.Visible = True
                        pbcArrow.SetFocus
                    'End If
                Else
                    If (Trim$(grdRot.TextMatrix(llEnableRow, REGIONNAMEINDEX)) <> "") Then
                        lmTopRow = -1
                        If grdRot.Row + 1 >= grdRot.rows Then
                            grdRot.AddItem ""
                            grdRot.rowHeight(grdRot.Row + 1) = fgFlexGridRowH
                        End If
                        grdRot.Row = grdRot.Row + 1
                        If (Not grdRot.RowIsVisible(grdRot.Row)) Then   'Or (grdRot.Row - (grdRot.TopRow - grdRot.FixedRows) >= imInitNoRows) Then
                            imIgnoreScroll = True
                            grdRot.TopRow = grdRot.TopRow + 1
                        End If
                        grdRot.Col = REGIONNAMEINDEX
                        'mEnableBox
                        imFromArrow = True
                        pbcArrow.Move grdRot.Left - pbcArrow.Width - 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + (grdRot.rowHeight(grdRot.Row) - pbcArrow.height) / 2
                        pbcArrow.Visible = True
                        pbcArrow.SetFocus
                    ElseIf Trim$(grdRot.TextMatrix(llEnableRow, COPYINDEX)) <> "" Then
                        grdRot.Col = REGIONNAMEINDEX
                        'mEnableBox
                        imFromArrow = True
                        pbcArrow.Move grdRot.Left - pbcArrow.Width - 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + (grdRot.rowHeight(grdRot.Row) - pbcArrow.height) / 2
                        pbcArrow.Visible = True
                        pbcArrow.SetFocus
                    Else
                        pbcClickFocus.SetFocus
                    End If
                End If
            ElseIf grdRot.Col = CATEGORYINDEX Then
                If grdRot.TextMatrix(grdRot.Row, CATEGORYINDEX) = "[None]" Or grdRot.TextMatrix(grdRot.Row, CATEGORYINDEX) = "" Then
                    ilNext = True
                    grdRot.Col = grdRot.Col + 1
                Else
                    grdRot.Col = grdRot.Col + 1
                    If mRGColOk() Then
                        mRGEnableBox
                    Else
                        ilNext = True
                    End If
                End If
            ElseIf grdRot.Col = INCLEXCLINDEX Then
                If grdRot.TextMatrix(grdRot.Row, INCLEXCLINDEX) = "None" Or grdRot.TextMatrix(grdRot.Row, INCLEXCLINDEX) = "" Then
                    ilNext = True
                    grdRot.Col = grdRot.Col + 1
                Else
                    grdRot.Col = grdRot.Col + 1
                    If mRGColOk() Then
                        mRGEnableBox
                    Else
                        ilNext = True
                    End If
                End If
            Else
                If grdRot.Col >= RGCOMMENTINDEX Then
                    ilNext = False
                    pbcClickFocus.SetFocus
                Else
                    grdRot.Col = grdRot.Col + 1
                    If mRGColOk() Then
                        mRGEnableBox
                    Else
                        ilNext = True
                    End If
                End If
            End If
        Loop While ilNext
    Else
        lmTopRow = -1
        grdRot.TopRow = grdRot.FixedRows
        grdRot.Col = COPYINDEX
        grdRot.Row = grdRot.FixedRows
        If mRGColOk() Then
            lmRGEnableRow = grdRot.FixedRows
            mPopCG
            lmRGEnableRow = -1
            mRGEnableBox
        Else
            cmcCancel.SetFocus
        End If
    End If
End Sub

Private Sub pbcRot_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub pbcRot_GotFocus()
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    mCGSetShow
    mRGSetShow
    mSetShow imBoxNo
    imBoxNo = -1
End Sub
Private Sub pbcRot_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim ilBox As Integer
    Dim ilValue As Integer
    '5882 no longer needed
   ' Dim ilRegionTest As Integer

    For ilBox = imLBCtrls To UBound(tmCtrls) Step 1
        If (X >= tmCtrls(ilBox).fBoxX) And (X <= tmCtrls(ilBox).fBoxX + tmCtrls(ilBox).fBoxW) And (tmCtrls(ilBox).fBoxX > 0) Then
            If (Y >= tmCtrls(ilBox).fBoxY) And (Y <= tmCtrls(ilBox).fBoxY + tmCtrls(ilBox).fBoxH) Then
                If (ilBox > CNTRINDEX) And (lbcCntr.ListIndex < 0) Then
                    mSetFocus imBoxNo
                    Beep
                    Exit Sub
                End If
                If (ilBox > LENINDEX) Then
                    If imBoxNo = LENINDEX Then
                        If (lbcLen.ListIndex <= 0) Then
                            mSetFocus imBoxNo
                            Beep
                            Exit Sub
                        End If
                    Else
                        If imSave(9) < 0 Then
                            mSetFocus imBoxNo
                            Beep
                            Exit Sub
                        End If
                    End If
                End If
                'Remove MG Column:
                ilValue = Asc(tgSpf.sMOFCopyAssign)  'Option Fields in Orders/Proposals
                If (ilValue And MGRULESINCOPY) <> MGRULESINCOPY Then 'Define MG rules within Copy
                    If (ilBox = MGASSIGNINDEX) Then
                        mSetFocus imBoxNo
                        Beep
                        Exit Sub
                    End If
                End If
                If ((Asc(tgSpf.sUsingFeatures) And LIVECOPY) <> LIVECOPY) And ((Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) <> PROMOCOPY) Then 'Using Live Copy
                    If ilBox = LIVECOPYINDEX Then
                        mSetFocus imBoxNo
                        Beep
                        Exit Sub
                    End If
                Else
                    If ilBox > LIVECOPYINDEX Then
                        If imSave(12) < 0 Then
                            mSetFocus imBoxNo
                            Beep
                            Exit Sub
                        End If
                    End If
                End If
                If (ilBox > VEHICLEINDEX) And (lbcVehicle.SelCount <= 0) Then
                    mSetFocus imBoxNo
                    Beep
                    Exit Sub
                ElseIf ilBox > VEHICLEINDEX Then
                    If ilBox = VEHICLEINDEX Then
                        If lbcVehicle.Selected(0) Then
                            If lbcVehicle.List(0) = "[None]" Then
                                mSetFocus imBoxNo
                                Beep
                                Exit Sub
                            End If
                        End If
                    Else
                        If (smSave(2) = "") Or (smSave(2) = "[None]") Then
                            mSetFocus imBoxNo
                            Beep
                            Exit Sub
                        End If
                    End If
                End If
                '5882 no longer needed
'                ilRegionTest = mIsRegionRotAndRestricted()
'                If ilRegionTest = 1 Then
'                    'If ((ilBox >= STIMEINDEX) And (ilBox <= ETIMEINDEX)) Or (ilBox = AVAILINDEX) Then
'                    If (ilBox = AVAILINDEX) Then
'                        mSetFocus imBoxNo
'                        Beep
'                        Exit Sub
'                    End If
'                End If
'                If ilRegionTest = 2 Then
'                    'If ((ilBox >= STIMEINDEX) And (ilBox <= AVAILINDEX)) Then
'                    If ((ilBox >= MONINDEX) And (ilBox <= AVAILINDEX)) Then
'                        mSetFocus imBoxNo
'                        Beep
'                        Exit Sub
'                    End If
'                End If
                If pbcAirGame.Visible Then
                    If (ilBox >= STIMEINDEX) And (ilBox <= SUNINDEX) Then
                        Beep
                        Exit Sub
                    End If
                End If
                mSetShow imBoxNo
                If imGameVehicle Then
                    If (ilBox >= STIMEINDEX) And (ilBox <= SUNINDEX) Then
                        ilBox = STIMEINDEX
                    End If
                End If
                imBoxNo = ilBox
                mEnableBox ilBox
                Exit Sub
            End If
        End If
    Next ilBox
End Sub
Private Sub pbcRot_Paint()
    Dim ilBox As Integer
    Dim slFont As String

    mPaintRot
    For ilBox = imLBCtrls To UBound(tmCtrls) Step 1
        If (ilBox = EDATEINDEX) Or (ilBox = AVAILINDEX) Then ' Or (ilBox = AVAILINDEX + 1) Then
            gPaintArea pbcRot, tmCtrls(ilBox).fBoxX, tmCtrls(ilBox).fBoxY, tmCtrls(ilBox).fBoxW - 30, tmCtrls(ilBox).fBoxH - 15, WHITE
        End If
        If ((ilBox = AVAILINDEX) Or (ilBox = AVAILINDEX + 1)) And (Left$(tmCtrls(ilBox).sShow, 1) = "") Then
            pbcRot.CurrentX = tmCtrls(ilBox).fBoxX + fgBoxInsetX
            pbcRot.CurrentY = tmCtrls(ilBox).fBoxY '- 30'+ fgBoxInsetY
            slFont = pbcRot.FontName
            pbcRot.FontName = lbcAvail.FontName '"MS Sans Serif"
            pbcRot.FontBold = False
            pbcRot.Print Left$(tmCtrls(ilBox).sShow, 1)
            pbcRot.FontName = slFont
            pbcRot.FontBold = True
            pbcRot.CurrentX = tmCtrls(ilBox).fBoxX + fgBoxInsetX + pbcRot.TextWidth(" ")
            pbcRot.CurrentY = tmCtrls(ilBox).fBoxY - 30 '-30 + fgBoxInsetY
            pbcRot.Print right$(tmCtrls(ilBox).sShow, Len(tmCtrls(ilBox).sShow) - 1)
        Else
            pbcRot.CurrentX = tmCtrls(ilBox).fBoxX + fgBoxInsetX
            pbcRot.CurrentY = tmCtrls(ilBox).fBoxY - 30 '- 30'+ fgBoxInsetY
            pbcRot.Print Trim$(tmCtrls(ilBox).sShow)
        End If
    Next ilBox
End Sub
Private Sub pbcSTab_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub pbcSTab_GotFocus()
    Dim ilBox As Integer
    Dim ilFound As Integer
    Dim slStr As String
    Dim ilValue As Integer
    Dim ilRegionTest As Integer

    If GetFocus() <> pbcSTab.HWnd Then
        Exit Sub
    End If
    If pbcAirGame.Visible Then
        Exit Sub
    End If
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    If imBoxNo = AVAILINDEX + 1 Then
        If mAvailsBranch() Then
            Exit Sub
        End If
    End If
    If imBoxNo = SHTTITLEINDEX Then
        If mShtTitleBranch() Then
            Exit Sub
        End If
    End If
    If (imBoxNo >= imLBCtrls) And (imBoxNo <= UBound(tmCtrls)) Then
        If mTestFields(imBoxNo, ALLMANDEFINED + NOMSG) = NO Then
            Beep
            mEnableBox imBoxNo
            Exit Sub
        End If
    End If
    imTabDirection = -1  'Set-right to left
    ilBox = imBoxNo
    Do
        ilFound = True
        Select Case ilBox
            Case -1 'Tab from control prior to form area
                imTabDirection = 0  'Set-Left to right
                ilBox = CNTRINDEX
            Case VEHICLEINDEX
                If ((Asc(tgSpf.sUsingFeatures) And LIVECOPY) <> LIVECOPY) And ((Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) <> PROMOCOPY) Then 'Using Live Copy
                    ilBox = LENINDEX
                Else
                    ilBox = LIVECOPYINDEX
                End If
            Case ZONEINDEX
                'Remove MG Column:
                ilValue = Asc(tgSpf.sMOFCopyAssign)  'Option Fields in Orders/Proposals
                If (ilValue And MGRULESINCOPY) <> MGRULESINCOPY Then 'Define MG rules within Copy
                    ilBox = VEHICLEINDEX   'MGASSIGNINDEX
                Else
                    ilBox = MGASSIGNINDEX
                End If
            Case SDATEINDEX
                slStr = edcDropDown.Text
                If slStr <> "" Then
                    If Not gValidDate(slStr) Then
                        Beep
                        edcDropDown.SetFocus
                        Exit Sub
                    End If
                Else
                    Beep
                    edcDropDown.SetFocus
                    Exit Sub
                End If
                ilBox = ilBox - 1
            Case EDATEINDEX
                slStr = edcDropDown.Text
                If slStr <> "" Then
                    If Not gValidDate(slStr) Then
                        Beep
                        edcDropDown.SetFocus
                        Exit Sub
                    End If
                Else
                    Beep
                    edcDropDown.SetFocus
                    Exit Sub
                End If
                ilBox = ilBox - 1
            Case STIMEINDEX
                slStr = edcDropDown.Text
                If Not gValidTime(slStr) Then
                    Beep
                    edcDropDown.SetFocus
                    Exit Sub
                End If
                ilBox = ilBox - 1
            Case ETIMEINDEX
                slStr = edcDropDown.Text
                If Not gValidTime(slStr) Then
                    Beep
                    edcDropDown.SetFocus
                    Exit Sub
                End If
                ilBox = ilBox - 1
            Case AVAILINDEX
                ilBox = ilBox - 1
                imAGDirection = 1
            Case TYPEINDEX
                '5882 no longer needed
'                ilRegionTest = mIsRegionRotAndRestricted()
'                If ilRegionTest = 0 Then
                    If imSave(10) = 0 Then
                        ilBox = AVAILINDEX
                    Else
                        ilBox = AVAILINDEX + 1
                    End If
'                Else
'                    'ilBox = EDATEINDEX
'                    ilBox = ETIMEINDEX
'                End If
            Case COMMENTINDEX
                'If tgSpf.sUseProdSptScr = "P" Then
                '    ilBox = SHTTITLEINDEX
                'Else
                    ilBox = TYPEINDEX
                'End If
            Case Else
                ilBox = ilBox - 1
        End Select
    Loop While Not ilFound
    mSetShow imBoxNo
    imBoxNo = ilBox
    mEnableBox ilBox
End Sub
Private Sub pbcTab_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub pbcTab_GotFocus()
    Dim ilBox As Integer
    Dim ilFound As Integer
    Dim slStr As String
    Dim ilValue As Integer
    Dim ilRegionTest As Integer

    If GetFocus() <> pbcTab.HWnd Then
        Exit Sub
    End If
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    If imBoxNo = AVAILINDEX + 1 Then
        If mAvailsBranch() Then
            Exit Sub
        End If
    End If
    If imBoxNo = SHTTITLEINDEX Then
        If mShtTitleBranch() Then
            Exit Sub
        End If
    End If
    If (imBoxNo >= imLBCtrls) And (imBoxNo <= UBound(tmCtrls)) Then
        If (Not imGameVehicle) Or (imBoxNo <> SUNINDEX) Then
            If mTestFields(imBoxNo, ALLMANDEFINED + NOMSG) = NO Then
                Beep
                mEnableBox imBoxNo
                Exit Sub
            End If
        End If
    End If
    imTabDirection = 0  'Set-Left to Right
    ilBox = imBoxNo
    Do
        ilFound = True
        Select Case ilBox
            Case -1 'Tab from control prior to form area
                imTabDirection = -1  'Set-Right to Left
                ilBox = CNTRINDEX   'COMMENTINDEX
            Case LENINDEX
                If ((Asc(tgSpf.sUsingFeatures) And LIVECOPY) <> LIVECOPY) And ((Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) <> PROMOCOPY) Then 'Using Live Copy
                    ilBox = VEHICLEINDEX
                Else
                    ilBox = LIVECOPYINDEX
                End If
            Case VEHICLEINDEX
                If lbcVehicle.SelCount <= 0 Then
                    If lbcVehicle.ListCount > 0 Then
                        Beep
                        edcDropDown.SetFocus
                        Exit Sub
                    Else
                        Beep
                        cmcCancel.SetFocus
                        Exit Sub
                    End If
                End If
                If lbcVehicle.Selected(0) Then
                    If lbcVehicle.List(0) = "[None]" Then
                        Beep
                        cmcCancel.SetFocus
                        Exit Sub
                    End If
                End If
                'Remove MG Column:
                ilValue = Asc(tgSpf.sMOFCopyAssign)  'Option Fields in Orders/Proposals
                If (ilValue And MGRULESINCOPY) <> MGRULESINCOPY Then 'Define MG rules within Copy
                    ilBox = ZONEINDEX   'MGASSIGNINDEX
                Else
                    ilBox = MGASSIGNINDEX
                End If
            Case SDATEINDEX
                slStr = edcDropDown.Text
                If slStr <> "" Then
                    If Not gValidDate(slStr) Then
                        Beep
                        edcDropDown.SetFocus
                        Exit Sub
                    End If
                Else
                    Beep
                    edcDropDown.SetFocus
                    Exit Sub
                End If
                ilBox = ilBox + 1
            Case EDATEINDEX
                slStr = edcDropDown.Text
                If slStr <> "" Then
                    If Not gValidDate(slStr) Then
                        Beep
                        edcDropDown.SetFocus
                        Exit Sub
                    End If
                Else
                    Beep
                    edcDropDown.SetFocus
                    Exit Sub
                End If
                'ilRegionTest = mIsRegionRotAndRestricted()
                ''ilBox = ilBox + 1
                'If ilRegionTest = 0 Then
                '    ilBox = ilBox + 1
                'Else
                '    'Add Date test
                '    If ilRegionTest = 1 Then
                '        ilBox = MONINDEX
                '    Else
                '        ilBox = TYPEINDEX
                '    End If
                'End If
                ilBox = ilBox + 1
                imAGDirection = 0
            Case STIMEINDEX
                slStr = edcDropDown.Text
                If Not gValidTime(slStr) Then
                    Beep
                    edcDropDown.SetFocus
                    Exit Sub
                End If
                ilBox = ilBox + 1
            Case ETIMEINDEX
                slStr = edcDropDown.Text
                If Not gValidTime(slStr) Then
                    Beep
                    edcDropDown.SetFocus
                    Exit Sub
                End If
                '5882 no longer needed  back to old way
                ilBox = ilBox + 1
'                ilRegionTest = mIsRegionRotAndRestricted()
'                If ilRegionTest = 0 Then
'                    ilBox = ilBox + 1
'                Else
'                    'Add Date test
'                    If ilRegionTest = 1 Then
'                        ilBox = MONINDEX
'                    Else
'                        ilBox = TYPEINDEX
'                    End If
'                End If
            Case SUNINDEX
                '5882 no longer needed  back to old way
'                ilRegionTest = mIsRegionRotAndRestricted()
'                If ilRegionTest = 0 Then
                    ilBox = ilBox + 1
'                Else
'                    ilBox = TYPEINDEX
'                End If
            Case AVAILINDEX
                If imSave(10) = 0 Then
                    ilBox = TYPEINDEX
                Else
                    ilBox = AVAILINDEX + 1
                End If
            Case TYPEINDEX
                'If tgSpf.sUseProdSptScr = "P" Then
                '    ilBox = SHTTITLEINDEX
                'Else
                    ilBox = COMMENTINDEX
                'End If
            Case COMMENTINDEX
                mSetShow imBoxNo
                If grdRot.Visible Then
                    pbcRGTab.SetFocus
                Else
                    cmcDone.SetFocus
                End If
                Exit Sub
            Case Else
                ilBox = ilBox + 1
        End Select
    Loop While Not ilFound
    mSetShow imBoxNo
    imBoxNo = ilBox
    mEnableBox ilBox
End Sub
Private Sub pbcTme_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim ilRowNo As Integer
    Dim ilColNo As Integer
    Dim flX As Single
    Dim flY As Single
    Dim ilMaxCol As Integer
    imcTmeInv.Visible = False
    flY = fgPadMinY
    For ilRowNo = 1 To 5 Step 1
        If (Y >= flY) And (Y <= flY + fgPadDeltaY) Then
            flX = fgPadMinX
            If ilRowNo = 4 Then
                ilMaxCol = 2
            Else
                ilMaxCol = 3
            End If
            For ilColNo = 1 To ilMaxCol Step 1
                If (X >= flX) And (X <= flX + fgPadDeltaX) Then
                    imcTmeInv.Move flX, flY
                    imcTmeInv.Visible = True
                    imcTmeOutline.Move flX - 15, flY - 15
                    imcTmeOutline.Visible = True
                    Exit Sub
                End If
                flX = flX + fgPadDeltaX
            Next ilColNo
        End If
        flY = flY + fgPadDeltaY
    Next ilRowNo
End Sub
Private Sub pbcTme_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim ilRowNo As Integer
    Dim ilColNo As Integer
    Dim flX As Single
    Dim flY As Single
    Dim slKey As String
    Dim ilMaxCol As Integer
    imcTmeInv.Visible = False
    flY = fgPadMinY
    For ilRowNo = 1 To 5 Step 1
        If (Y >= flY) And (Y <= flY + fgPadDeltaY) Then
            flX = fgPadMinX
            If ilRowNo = 4 Then
                ilMaxCol = 2
            Else
                ilMaxCol = 3
            End If
            For ilColNo = 1 To ilMaxCol Step 1
                If (X >= flX) And (X <= flX + fgPadDeltaX) Then
                    imcTmeInv.Move flX, flY
                    imcTmeOutline.Move flX - 15, flY - 15
                    imcTmeOutline.Visible = True
                    Select Case ilRowNo
                        Case 1
                            Select Case ilColNo
                                Case 1
                                    slKey = "7"
                                Case 2
                                    slKey = "8"
                                Case 3
                                    slKey = "9"
                            End Select
                        Case 2
                            Select Case ilColNo
                                Case 1
                                    slKey = "4"
                                Case 2
                                    slKey = "5"
                                Case 3
                                    slKey = "6"
                            End Select
                        Case 3
                            Select Case ilColNo
                                Case 1
                                    slKey = "1"
                                Case 2
                                    slKey = "2"
                                Case 3
                                    slKey = "3"
                            End Select
                        Case 4
                            Select Case ilColNo
                                Case 1
                                    slKey = "0"
                                Case 2
                                    slKey = "00"
                            End Select
                        Case 5
                            Select Case ilColNo
                                Case 1
                                    slKey = ":"
                                Case 2
                                    slKey = "AM"
                                Case 3
                                    slKey = "PM"
                            End Select
                    End Select
                    If imTimeDayBoxNo = 0 Then
                        imBypassFocus = True    'Don't change select text
                        edcTimeDay(0).SetFocus
                        gSendKeys edcTimeDay(0), slKey
                    ElseIf imTimeDayBoxNo = 1 Then
                        imBypassFocus = True    'Don't change select text
                        edcTimeDay(1).SetFocus
                        gSendKeys edcTimeDay(1), slKey
                    Else
                        Select Case imBoxNo
                            Case STIMEINDEX
                                imBypassFocus = True    'Don't change select text
                                edcDropDown.SetFocus
                                'SendKeys slKey
                                gSendKeys edcDropDown, slKey
                            Case ETIMEINDEX
                                imBypassFocus = True    'Don't change select text
                                edcDropDown.SetFocus
                                'SendKeys slKey
                                gSendKeys edcDropDown, slKey
                        End Select
                    End If
                    Exit Sub
                End If
                flX = flX + fgPadDeltaX
            Next ilColNo
        End If
        flY = flY + fgPadDeltaY
    Next ilRowNo
End Sub


Private Sub pbcYN_GotFocus()
    gCtrlGotFocus ActiveControl
End Sub

Private Sub pbcYN_KeyPress(KeyAscii As Integer)
    Dim ilCount As Integer
    
    'If (KeyAscii = Asc("Y")) Or (KeyAscii = Asc("y")) Then
    '    imSave(12) = 1
    '    pbcYN_Paint
    'ElseIf KeyAscii = Asc("N") Or (KeyAscii = Asc("n")) Then
    '    imSave(12) = 0
    '    pbcYN_Paint
    'End If
    'If KeyAscii = Asc(" ") Then
    '    If imSave(12) = 0 Then
    '        imSave(12) = 1
    '        pbcYN_Paint
    '    ElseIf imSave(12) = 1 Then
    '        imSave(12) = 0
    '        pbcYN_Paint
    '    End If
    'End If
    If (KeyAscii = Asc("L")) Or (KeyAscii = Asc("l")) Then
        If (Asc(tgSpf.sUsingFeatures) And LIVECOPY) = LIVECOPY Then
            If (Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) = PROMOCOPY Then
                If (imSave(12) = 0) And (tgSaf(0).sExcludeAudioTypeM <> "Y") And bmAllowedAudioTypes(2) Then
                    imSave(12) = 2
                Else
                    If (tgSaf(0).sExcludeAudioTypeL <> "Y") And bmAllowedAudioTypes(0) Then
                        imSave(12) = 0
                    Else
                        imSave(12) = 1
                    End If
                End If
            Else
                If (tgSaf(0).sExcludeAudioTypeL <> "Y") And bmAllowedAudioTypes(0) Then
                    imSave(12) = 0
                Else
                    imSave(12) = 1
                End If
            End If
            pbcYN_Paint
        End If
    ElseIf KeyAscii = Asc("R") Or (KeyAscii = Asc("r")) Then
        If (Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) = PROMOCOPY Then
            If (imSave(12) = 1) And (tgSaf(0).sExcludeAudioTypeS <> "Y") And bmAllowedAudioTypes(3) Then
                imSave(12) = 3
            Else
                imSave(12) = 1
            End If
        Else
            imSave(12) = 1
        End If
        pbcYN_Paint
    ElseIf KeyAscii = Asc("P") Or (KeyAscii = Asc("p")) Then
        If (Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) = PROMOCOPY Then
            If (imSave(12) = 4) And (tgSaf(0).sExcludeAudioTypeQ <> "Y") And bmAllowedAudioTypes(5) Then
                imSave(12) = 5
            Else
                If (tgSaf(0).sExcludeAudioTypeP <> "Y") And bmAllowedAudioTypes(4) Then
                    imSave(12) = 4
                Else
                    imSave(12) = 1
                End If
            End If
        Else
            If (tgSaf(0).sExcludeAudioTypeP <> "Y") And bmAllowedAudioTypes(4) Then
                imSave(12) = 4
            Else
                imSave(12) = 1
            End If
        End If
        pbcYN_Paint
    End If
    If KeyAscii = Asc(" ") Then
        If (Asc(tgSpf.sUsingFeatures) And LIVECOPY) = LIVECOPY Then
            If (Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) = PROMOCOPY Then
                'If imSave(12) = 0 Then
                '    imSave(12) = 1
                'ElseIf imSave(12) = 1 Then
                '    imSave(12) = 2
                'ElseIf imSave(12) = 2 Then
                '    imSave(12) = 3
                'ElseIf imSave(12) = 3 Then
                '    imSave(12) = 4
                'ElseIf imSave(12) = 4 Then
                '    imSave(12) = 5
                'Else
                '    imSave(12) = 0
                'End If
                ilCount = 0
                Do
                    If imSave(12) = 0 Then
                        imSave(12) = 1
                        If (tgSaf(0).sExcludeAudioTypeR <> "Y") And bmAllowedAudioTypes(1) Then Exit Do
                    ElseIf imSave(12) = 1 Then
                        imSave(12) = 2
                        If (tgSaf(0).sExcludeAudioTypeM <> "Y") And bmAllowedAudioTypes(2) Then Exit Do
                    ElseIf imSave(12) = 2 Then
                        imSave(12) = 3
                        If (tgSaf(0).sExcludeAudioTypeS <> "Y") And bmAllowedAudioTypes(3) Then Exit Do
                    ElseIf imSave(12) = 3 Then
                        imSave(12) = 4
                        If (tgSaf(0).sExcludeAudioTypeP <> "Y") And bmAllowedAudioTypes(4) Then Exit Do
                    ElseIf imSave(12) = 4 Then
                        imSave(12) = 5
                        If (tgSaf(0).sExcludeAudioTypeQ <> "Y") And bmAllowedAudioTypes(5) Then Exit Do
                    Else
                        imSave(12) = 0
                        If (tgSaf(0).sExcludeAudioTypeL <> "Y") And bmAllowedAudioTypes(0) Then Exit Do
                    End If
                    ilCount = ilCount + 1
                    If ilCount > 6 Then
                        imSave(12) = 1
                        Exit Do
                    End If
                Loop
            Else
                'If imSave(12) = 0 Then
                '    imSave(12) = 1
                'ElseIf imSave(12) = 1 Then
                '    imSave(12) = 4
                'Else
                '    imSave(12) = 0
                'End If
                ilCount = 0
                Do
                    If imSave(12) = 0 Then
                        imSave(12) = 1
                        If (tgSaf(0).sExcludeAudioTypeR <> "Y") And bmAllowedAudioTypes(1) Then Exit Do
                    ElseIf imSave(12) = 1 Then
                        imSave(12) = 4
                        If (tgSaf(0).sExcludeAudioTypeP <> "Y") And bmAllowedAudioTypes(4) Then Exit Do
                    Else
                        imSave(12) = 0
                        If (tgSaf(0).sExcludeAudioTypeL <> "Y") And bmAllowedAudioTypes(0) Then Exit Do
                    End If
                    ilCount = ilCount + 1
                    If ilCount > 3 Then
                        imSave(12) = 1
                        Exit Do
                    End If
                Loop
                
            End If
        Else
            If (Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) = PROMOCOPY Then
                If (imSave(12) = 1) And (tgSaf(0).sExcludeAudioTypeS <> "Y") And bmAllowedAudioTypes(3) Then
                    imSave(12) = 3
                Else
                    imSave(12) = 1
                End If
            Else
                imSave(12) = 1
            End If
        End If
        pbcYN_Paint
    End If
    mSetChg imBoxNo
End Sub

Private Sub pbcYN_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim ilCount As Integer
    
    'If imSave(12) = 0 Then
    '    imSave(12) = 1
    'Else
    '    imSave(12) = 0
    'End If
    If (Asc(tgSpf.sUsingFeatures) And LIVECOPY) = LIVECOPY Then
        If (Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) = PROMOCOPY Then
            'If imSave(12) = 0 Then
            '    imSave(12) = 1
            'ElseIf imSave(12) = 1 Then
            '    imSave(12) = 2
            'ElseIf imSave(12) = 2 Then
            '    imSave(12) = 3
            'ElseIf imSave(12) = 3 Then
            '    imSave(12) = 4
            'ElseIf imSave(12) = 4 Then
            '    imSave(12) = 5
            'Else
            '    imSave(12) = 0
            'End If
            ilCount = 0
            Do
                If imSave(12) = 0 Then
                    imSave(12) = 1
                    If (tgSaf(0).sExcludeAudioTypeR <> "Y") And bmAllowedAudioTypes(1) Then Exit Do
                ElseIf imSave(12) = 1 Then
                    imSave(12) = 2
                    If (tgSaf(0).sExcludeAudioTypeM <> "Y") And bmAllowedAudioTypes(2) Then Exit Do
                ElseIf imSave(12) = 2 Then
                    imSave(12) = 3
                    If (tgSaf(0).sExcludeAudioTypeS <> "Y") And bmAllowedAudioTypes(3) Then Exit Do
                ElseIf imSave(12) = 3 Then
                    imSave(12) = 4
                    If (tgSaf(0).sExcludeAudioTypeP <> "Y") And bmAllowedAudioTypes(4) Then Exit Do
                ElseIf imSave(12) = 4 Then
                    imSave(12) = 5
                    If (tgSaf(0).sExcludeAudioTypeQ <> "Y") And bmAllowedAudioTypes(5) Then Exit Do
                Else
                    imSave(12) = 0
                    If (tgSaf(0).sExcludeAudioTypeL <> "Y") And bmAllowedAudioTypes(0) Then Exit Do
                End If
                ilCount = ilCount + 1
                If ilCount > 6 Then
                    imSave(12) = 1
                    Exit Do
                End If
            Loop
        Else
            'If imSave(12) = 0 Then
            '    imSave(12) = 1
            'ElseIf imSave(12) = 1 Then
            '    imSave(12) = 4
            'Else
            '    imSave(12) = 0
            'End If
            ilCount = 0
            Do
                If imSave(12) = 0 Then
                    imSave(12) = 1
                    If (tgSaf(0).sExcludeAudioTypeR <> "Y") And bmAllowedAudioTypes(1) Then Exit Do
                ElseIf imSave(12) = 1 Then
                    imSave(12) = 4
                    If (tgSaf(0).sExcludeAudioTypeP <> "Y") And bmAllowedAudioTypes(4) Then Exit Do
                Else
                    imSave(12) = 0
                    If (tgSaf(0).sExcludeAudioTypeL <> "Y") And bmAllowedAudioTypes(0) Then Exit Do
                End If
                ilCount = ilCount + 1
                If ilCount > 3 Then
                    imSave(12) = 1
                    Exit Do
                End If
            Loop
            
        End If
    Else
        If (Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) = PROMOCOPY Then
            If (imSave(12) = 1) And (tgSaf(0).sExcludeAudioTypeS <> "Y") And bmAllowedAudioTypes(3) Then
                imSave(12) = 3
            Else
                imSave(12) = 1
            End If
        Else
            imSave(12) = 1
        End If
    End If
    pbcYN_Paint
    mSetChg imBoxNo
End Sub

Private Sub pbcYN_Paint()
    pbcYN.Cls
    pbcYN.CurrentX = fgBoxInsetX
    pbcYN.CurrentY = 0 'fgBoxInsetY
    If imSave(12) = 0 Then
        pbcYN.Print "LC"
    ElseIf imSave(12) = 2 Then
        pbcYN.Print "LP"
    ElseIf imSave(12) = 3 Then
        pbcYN.Print "RP"
    ElseIf imSave(12) = 4 Then
        pbcYN.Print "PC"
    ElseIf imSave(12) = 5 Then
        pbcYN.Print "PP"
    Else
        pbcYN.Print "RC"
    End If
End Sub

Private Sub plcCopy_Click()
    pbcClickFocus.SetFocus
End Sub
Private Sub plcCopy_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub plcInst_Click()
    pbcClickFocus.SetFocus
End Sub
Private Sub plcInst_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub plcInv_Click()
    pbcClickFocus.SetFocus
End Sub
Private Sub plcInv_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub

Private Sub plcInv_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    imButtonIndex = 0
    edcToolTip.Visible = False
End Sub

Private Sub plcRot_Click()
    pbcClickFocus.SetFocus
End Sub
Private Sub plcRot_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub plcScreen_Click()
    pbcClickFocus.SetFocus
End Sub
Private Sub plcScreen_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub plcShow_DragDrop(Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub

Private Sub plcShow_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    imButtonIndex = 0
    edcToolTip.Visible = False
End Sub

Private Sub rbcAirTimeCopyBy_Click(Index As Integer)
    If rbcAirTimeCopyBy(Index).Value Then
        frcTimeDay.Visible = False
        frcGameNo.Visible = False
        frcTeam.Visible = False
        If Index = 0 Then
            pbcAirGame.height = frcTimeDay.Top + frcTimeDay.height + 180
            frcTimeDay.Visible = True
        ElseIf Index = 1 Then
            pbcAirGame.height = frcGameNo.Top + frcGameNo.height + 180
            mGameTeamPop
            frcGameNo.Visible = True
        Else
            pbcAirGame.height = frcTeam.Top + frcTeam.height + 180
            mGameTeamPop
            frcTeam.Visible = True
        End If
        gSetMousePointer grdRot, grdRot, vbDefault
    End If
End Sub

Private Sub rbcShow_Click(Index As Integer)
    'Code added because Value removed as parameter
    Dim Value As Integer
    Value = rbcShow(Index).Value
    'End of coded added
    Dim ilCount As Integer
    Dim ilLoop As Integer
    Dim slName As String
    Dim slNameCode As String
    Dim slCode As String
    Dim ilRet As Integer
    Dim ilIndex As Integer
    Dim ilFound As Integer
    If rbcShow(Index).Value Then
        'If Index = 0 Then
        '    lbcInv.TabPos(1) = 15
        '    lbcInst.TabPos(1) = 15
        'Else
        '    lbcInv.TabPos(1) = 25
        '    lbcInst.TabPos(1) = 25
        'End If
        If Index = 0 Then   'len, Cart then ISCI
            'lmListField(1) = 5 * igAlignCharWidth 'igAvgCharWidth * 5
            'lmListField(2) = 12 * igAlignCharWidth 'igAvgCharWidth * 12
            'lmListField(3) = 34 * igAlignCharWidth 'igAvgCharWidth * 34
            lmListField(1) = 15
            lmListField(2) = 5 * fmAdjFactorW * igAlignCharWidth 'igAvgCharWidth * 5
            lmListField(3) = 15 * fmAdjFactorW * igAlignCharWidth 'igAvgCharWidth * 12
            lmListField(4) = 34 * fmAdjFactorW * igAlignCharWidth 'igAvgCharWidth * 34
        Else    'len, ISCI, then cart
            'lmListField(1) = 5 * igAlignCharWidth 'igAvgCharWidth * 5
            'lmListField(2) = 24 * igAlignCharWidth 'igAvgCharWidth * 24
            'lmListField(3) = 34 * igAlignCharWidth 'igAvgCharWidth * 34
            lmListField(1) = 15
            lmListField(2) = 5 * fmAdjFactorW * igAlignCharWidth 'igAvgCharWidth * 5
            lmListField(3) = 24 * fmAdjFactorW * igAlignCharWidth 'igAvgCharWidth * 12
            lmListField(4) = 34 * fmAdjFactorW * igAlignCharWidth 'igAvgCharWidth * 34
        End If
        ilCount = lbcInst.ListCount - 1 '-1 for blank line
        If ilCount > 0 Then
            ReDim lmMatchCode(0 To ilCount - 1) As Long
            For ilLoop = 0 To ilCount - 1 Step 1
                slName = lbcInst.List(ilLoop)
                gFindMatch slName, 0, lbcExpandActive
                If ((gLastFound(lbcExpandActive) > 0) And (tgSpf.sUseCartNo <> "B")) Or ((gLastFound(lbcExpandActive) > 1) And (tgSpf.sUseCartNo = "B")) Then
                    If tgSpf.sUseCartNo <> "B" Then
                        slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 1).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
                    Else
                        slNameCode = tgActiveCode(gLastFound(lbcExpandActive) - 2).sKey 'lbcActiveCode.List(gLastFound(lbcActive) - 1)
                    End If
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    lmMatchCode(ilLoop) = Val(slCode)
                Else
                    slName = lbcInst.List(ilLoop)
                    gFindMatch slName, 0, lbcExpandPurge
                    If gLastFound(lbcExpandPurge) > 0 Then
                        slNameCode = tmPurgeCode(gLastFound(lbcExpandPurge)).sKey    'lbcPurgeCode.List(gLastFound(lbcPurge))
                        ilRet = gParseItem(slNameCode, 2, "\", slCode)
                        lmMatchCode(ilLoop) = Val(slCode)
                    Else
                        slName = lbcInst.List(ilLoop)
                        gFindMatch slName, 0, lbcExpandHistory
                        If gLastFound(lbcExpandHistory) > 0 Then
                            slNameCode = tmHistoryCode(gLastFound(lbcExpandHistory)).sKey  'lbcHistoryCode.List(gLastFound(lbcHistory))
                            ilRet = gParseItem(slNameCode, 2, "\", slCode)
                            lmMatchCode(ilLoop) = Val(slCode)
                        Else
                            lmMatchCode(ilLoop) = -1
                        End If
                    End If
                End If
            Next ilLoop
        End If
        smActiveCodeTag = ""
        lbcActive.Clear
        smPurgeCodeTag = ""
        lbcPurge.Clear
        smHistoryCodeTag = ""
        lbcHistory.Clear
        mInvPop
        If imBlackoutAdfCode = POOLROTATION Then
            Exit Sub
        End If
        lbcInst.Clear
        If ilCount > 0 Then
            For ilLoop = 0 To ilCount - 1 Step 1
                ilFound = False
                For ilIndex = 0 To UBound(tgActiveCode) Step 1   'lbcActiveCode.ListCount Step 1
                    slNameCode = tgActiveCode(ilIndex).sKey 'lbcActiveCode.List(ilIndex)
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    If Val(slCode) = lmMatchCode(ilLoop) Then
                        If tgSpf.sUseCartNo <> "B" Then
                            lbcInst.AddItem lbcActive.List(ilIndex + 1)
                        Else
                            lbcInst.AddItem lbcActive.List(ilIndex + 2)
                        End If
                        ilFound = True
                        Exit For
                    End If
                Next ilIndex
                If Not ilFound Then
                    For ilIndex = 0 To UBound(tmPurgeCode) Step 1 'lbcPurgeCode.ListCount Step 1
                        slNameCode = tmPurgeCode(ilIndex).sKey   'lbcPurgeCode.List(ilIndex)
                        ilRet = gParseItem(slNameCode, 2, "\", slCode)
                        If Val(slCode) = lmMatchCode(ilLoop) Then
                            lbcInst.AddItem lbcPurge.List(ilIndex)
                            ilFound = True
                            Exit For
                        End If
                    Next ilIndex
                End If
                If Not ilFound Then
                    For ilIndex = 0 To UBound(tmHistoryCode) Step 1 'lbcHistoryCode.ListCount Step 1
                        slNameCode = tmHistoryCode(ilIndex).sKey   'lbcHistoryCode.List(ilIndex)
                        ilRet = gParseItem(slNameCode, 2, "\", slCode)
                        If Val(slCode) = lmMatchCode(ilLoop) Then
                            lbcInst.AddItem lbcHistory.List(ilIndex)
                            ilFound = True
                            Exit For
                        End If
                    Next ilIndex
                End If
            Next ilLoop
        End If
        lbcInst.AddItem " "
    End If
    pbcLbcInst_Paint
    
    If Trim(txtISCI_Filter_Main.Text) <> "" Then mChangeFilter_Main
    
End Sub
Private Sub rbcShow_DragDrop(Index As Integer, Source As Control, X As Single, Y As Single)
    mClearDrag
End Sub
Private Sub rbcShow_GotFocus(Index As Integer)
    'lbcRot.Visible = False
    lbcRot.height = gListBoxHeight(lbcRot.ListCount, 1)
    lbcRot.Top = plcRot.Top + 30
    lbcRot.Visible = True 'Not lbcRot.Visible
    pbcLbcRot.Move lbcRot.Left + 15, lbcRot.Top + 15, pbcLbcRot.Width, lbcRot.height - 30
    pbcLbcRot.Visible = True
    pbcLbcRot.ZOrder vbSendToBack
    lbcRot.ZOrder vbSendToBack
    If tmcClick.Enabled Then
        pbcClickFocus.SetFocus
        Exit Sub
    End If
    mSetShow imBoxNo
    imBoxNo = -1
End Sub

Private Sub rbcSortGameBy_Click(Index As Integer)
    If rbcSortGameBy(Index).Value Then
        imDateChanged = True
        mGameTeamPop
    End If
End Sub

Private Sub tmcClick_Timer()
    tmcClick.Enabled = False
    If imSelectDelay = 0 Then
        imSelectDelay = False
        mCbcAdvtChange
    ElseIf imSelectDelay = 1 Then
        imSelectDelay = False
        mCbcBlackoutChange
    Else
        Select Case imBoxNo
            Case AVAILINDEX + 1
                imLbcArrowSetting = False
                gProcessLbcClick lbcAvail, edcDropDown, imChgMode, imLbcArrowSetting
            Case SHTTITLEINDEX
                imLbcArrowSetting = False
                gProcessLbcClick lbcShtTitle, edcDropDown, imChgMode, imLbcArrowSetting
        End Select
    End If
End Sub
Private Sub tmcDrag_Timer()
    Dim ilListIndex As Integer
    Dim llRg As Long
    Dim llRet As Long
    Dim slNameCode As String
    Dim slCode As String
    Dim ilRet As Integer
    Dim ilLen As Integer
    Select Case imDragType
        Case 0  'Start Drag
            imDragType = -1
            tmcDrag.Enabled = False
            If imDragButton <> 1 Then
                Exit Sub
            End If
            Select Case imDragSrce
                Case DRAGINV
                    ilListIndex = fmDragY \ fgListHtArial825 + lbcInv.TopIndex
                    If (((ilListIndex > 0) And (tgSpf.sUseCartNo <> "B")) Or ((ilListIndex > 1) And (tgSpf.sUseCartNo = "B"))) And (ilListIndex <= lbcInv.ListCount - 1) Then
                        lbcInv.ListIndex = ilListIndex
                        'Test length- must equal rotation length
                        If tgSpf.sUseCartNo <> "B" Then
                            slNameCode = tmCopyNameCode(ilListIndex - 1).sKey  'lbcInvCode.List(ilListIndex - 1)
                        Else
                            slNameCode = tmCopyNameCode(ilListIndex - 2).sKey  'lbcInvCode.List(ilListIndex - 1)
                        End If
                        ilRet = gParseItem(slNameCode, 2, "\", slCode)
                        tmCifSrchKey.lCode = Val(slCode)
                        ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                        If ilRet <> BTRV_ERR_NONE Then
                            Exit Sub
                        End If
                        If imSave(9) >= 0 Then
                            ilLen = lbcLen.List(imSave(9))
                            If tmCif.iLen > ilLen Then
                                Exit Sub
                            End If
                            'When combo instructions created- allow less then
                            If tmCif.iLen < ilLen Then
                                Exit Sub
                            End If
                        End If
                        lbcInv.DragIcon = IconTraf!imcIconDrag.DragIcon
                        imDragIndexSrce = ilListIndex
                        'lacL1Frame.DragIcon = IconTraf!imcIconMove.DragIcon
                        If lbcInst.ListCount > 1 Then
                            llRg = CLng(lbcInst.ListCount - 2) * &H10000 Or 0
                            llRet = SendMessageByNum(lbcInst.HWnd, LB_SELITEMRANGE, False, llRg)
                        End If
                        lbcInv.Drag vbBeginDrag
                    Else
                        lbcInv.ListIndex = -1
                    End If
                Case DRAGINST
                    ilListIndex = fmDragY \ fgListHtArial825 + lbcInst.TopIndex
                    If (ilListIndex <= lbcInst.ListCount - 2) Then
                        If lbcInst.ListCount > 1 Then
                            llRg = CLng(lbcInst.ListCount - 2) * &H10000 Or 0
                            llRet = SendMessageByNum(lbcInst.HWnd, LB_SELITEMRANGE, False, llRg)
                        End If
                        lbcInst.ListIndex = ilListIndex
                        lbcInst.DragIcon = IconTraf!imcIconDrag.DragIcon
                        imDragIndexSrce = ilListIndex
                        'lacL1Frame.DragIcon = IconTraf!imcIconMove.DragIcon
                        lbcInst.Drag vbBeginDrag
                        imcTrash.Visible = True
                        imcTrash.Enabled = True
                    Else
                        lbcInst.ListIndex = -1
                    End If
            End Select
        Case 1  'scroll up
        Case 2  'Scroll down
    End Select
End Sub
Private Sub tmcScroll_Timer()
    If imDragSrce = -1 Then
        tmcScroll.Enabled = False
        Exit Sub
    End If
    If imDragScroll = DRAGINST Then
        If imScrollDir = 0 Then 'Page up
           If lbcInst.TopIndex > 0 Then
              lbcInst.TopIndex = lbcInst.TopIndex - 1
           End If
        Else    'Page down
           If lbcInst.TopIndex < lbcInst.ListCount - imNoRowLbc Then
              lbcInst.TopIndex = lbcInst.TopIndex + 1
           End If
        End If
    End If
End Sub
Private Sub plcScreen_Paint()
    plcScreen.CurrentX = 0
    plcScreen.CurrentY = 0
    plcScreen.Print "Copy"
End Sub
Private Sub plcInst_Paint()
    plcInst.CurrentX = 0
    plcInst.CurrentY = 0
    plcInst.Print "Rotation Instructions"
End Sub
Private Sub plcInv_Paint()
    plcInv.CurrentX = 0
    plcInv.CurrentY = 0
    plcInv.Print "Inventory"
End Sub
Private Sub plcShow_Paint()
    plcShow.CurrentX = 0
    plcShow.CurrentY = 0
    plcShow.Print "Sort by"
End Sub


Private Sub mReplaceSpaces(lbcLocal As Control, tlSortCode() As SORTCODE, ilAdjList As Integer)
    Dim ilLoop As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim ilRet As Integer
    Dim ilFirstPos As Integer
    Dim ilLastPos As Integer
    Dim ilPos As Integer
    Dim slName As String

    For ilLoop = 0 To UBound(tlSortCode) - 1 Step 1 'lbcLocalCode.ListCount - 1 Step 1
        slNameCode = Trim$(tlSortCode(ilLoop).sKey)  'lbcLocalCode.List(ilLoop)
        'Replace delimiter ~ with blank
        ilPos = InStr(slNameCode, "~")
        Do While ilPos > 0
            Mid$(slNameCode, ilPos, 1) = " "
            ilPos = InStr(slNameCode, "~")
        Loop
        ilRet = gParseItem(slNameCode, 2, "\", slCode)
        tmCifSrchKey.lCode = Val(slCode)
        ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        If ilRet <> BTRV_ERR_NONE Then
            tmCif.iMcfCode = -1
        End If
        ilFirstPos = InStr(slNameCode, " ")
        ilLastPos = 0
        If tmCif.iMcfCode <> 0 Then
            ilPos = ilFirstPos + 1
            ilPos = InStr(ilPos, slNameCode, " ")
            If rbcShow(0).Value Then
                ilLastPos = ilPos
            Else
                Do While ilPos > 0
                    ilLastPos = ilPos
                    ilPos = ilPos + 1
                    '1/16/14 TTP: 6601
                    'ilPos = InStr(ilPos, slNameCode, " ")
                    If InStr(ilPos, slNameCode, " ") <= 0 Then
                        Exit Do
                    End If
                    If InStr(ilPos, slNameCode, " ") < InStr(ilPos, slNameCode, "\") Then
                        ilPos = InStr(ilPos, slNameCode, " ")
                    Else
                        Exit Do
                    End If
                Loop
            End If
        ElseIf tmCif.iMcfCode = 0 Then
            slNameCode = Left(slNameCode, ilFirstPos) & " " & Mid(slNameCode, ilFirstPos + 1)
            ilLastPos = ilFirstPos + 1
        End If
        If ilFirstPos > 0 Then
            Mid$(slNameCode, ilFirstPos, 1) = "~"
        End If
        If ilLastPos > 0 Then
            Mid$(slNameCode, ilLastPos, 1) = "~"
        End If
        'lbcLocalCode.List(ilLoop) = slNameCode
        tlSortCode(ilLoop).sKey = slNameCode
    Next ilLoop
    For ilLoop = 0 To lbcLocal.ListCount - 1 Step 1
        If (ilLoop >= ilAdjList) Or (ilAdjList = 0) Then
            slNameCode = Trim$(tlSortCode(ilLoop - ilAdjList).sKey) 'lbcLocalCode.List(ilLoop)
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            tmCifSrchKey.lCode = Val(slCode)
            ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            If ilRet <> BTRV_ERR_NONE Then
                tmCif.iMcfCode = -1
            End If
        End If
        slName = lbcLocal.List(ilLoop)
        ilPos = InStr(slName, "~")
        Do While ilPos > 0
            Mid$(slName, ilPos, 1) = " "
            ilPos = InStr(slName, "~")
        Loop
        ilFirstPos = InStr(slName, " ")
        ilLastPos = 0
        If tmCif.iMcfCode <> 0 Then
            ilPos = ilFirstPos + 1
            ilPos = InStr(ilPos, slName, " ")
            If rbcShow(0).Value Then
                ilLastPos = ilPos
            Else
                Do While ilPos > 0
                    ilLastPos = ilPos
                    ilPos = ilPos + 1
                    ilPos = InStr(ilPos, slName, " ")
                Loop
            End If
        ElseIf tmCif.iMcfCode = 0 Then
            slName = Left(slName, ilFirstPos) & " " & Mid(slName, ilFirstPos + 1)
            ilLastPos = ilFirstPos + 1
        End If
        If ilFirstPos > 0 Then
            Mid$(slName, ilFirstPos, 1) = "~"
        End If
        If ilLastPos > 0 Then
            Mid$(slName, ilLastPos, 1) = "~"
        End If
        lbcLocal.List(ilLoop) = slName
    Next ilLoop
End Sub

Private Sub mBuildHdLnComment()
    Dim ilLoop As Integer
    Dim ilRet As Integer
    Dim ilVef As Integer
    Dim slName As String
    Dim slStr As String
    Dim slStr1 As String

    slStr = ""
    If tmChf.lCxfCode > 0 Then
        imCxfRecLen = Len(tmCxf)
        tmCxfSrchKey.lCode = tmChf.lCxfCode
        ilRet = btrGetEqual(hmCxf, tmCxf, imCxfRecLen, tmCxfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)   'Get last current record to obtain date
        If ilRet = BTRV_ERR_NONE Then
            If tmCxf.sShSpot = "Y" Then
                'If tmCxf.iStrLen > 0 Then
                '    slStr = Trim$(Left$(tmCxf.sComment, tmCxf.iStrLen))
                'End If
                slStr = gStripChr0(tmCxf.sComment)
            End If
        End If
    End If
    If tmChf.lCxfInt > 0 Then
        imCxfRecLen = Len(tmCxf)
        tmCxfSrchKey.lCode = tmChf.lCxfInt
        ilRet = btrGetEqual(hmCxf, tmCxf, imCxfRecLen, tmCxfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)   'Get last current record to obtain date
        If ilRet = BTRV_ERR_NONE Then
            If tmCxf.sShSpot = "Y" Then
                slStr1 = gStripChr0(tmCxf.sComment)
                'If tmCxf.iStrLen > 0 Then
                If slStr1 <> "" Then
                    If slStr = "" Then
                        slStr = slStr1  'Trim$(Left$(tmCxf.sComment, tmCxf.iStrLen))
                    Else
                        slStr = slStr & sgCR & sgLF & slStr1    'Trim$(Left$(tmCxf.sComment, tmCxf.iStrLen))
                    End If
                End If
            End If
        End If
    End If
    For ilLoop = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
        If (tgClfCopy(ilLoop).ClfRec.lCxfCode > 0) Then
            imCxfRecLen = Len(tmCxf)
            tmCxfSrchKey.lCode = tgClfCopy(ilLoop).ClfRec.lCxfCode
            ilRet = btrGetEqual(hmCxf, tmCxf, imCxfRecLen, tmCxfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)   'Get last current record to obtain date
            If ilRet = BTRV_ERR_NONE Then
                If tmCxf.sShSpot = "Y" Then
                    slStr1 = gStripChr0(tmCxf.sComment)
                    'If tmCxf.iStrLen > 0 Then
                    If slStr1 <> "" Then
                        slName = "Line #" & str$(tgClfCopy(ilLoop).ClfRec.iLine)
                        ilVef = gBinarySearchVef(tgClfCopy(ilLoop).ClfRec.iVefCode)
                        If ilVef <> -1 Then
                            slName = slName & "-" & Trim$(tgMVef(ilVef).sName)
                        End If
                        If slStr <> "" Then
                            slStr = slStr & sgCR & sgLF & slName & ": " & slStr1    'Trim$(Left$(tmCxf.sComment, tmCxf.iStrLen))
                        Else
                            slStr = slName & ": " & slStr1  'Trim$(Left$(tmCxf.sComment, tmCxf.iStrLen))
                        End If
                    End If
                End If
            End If
        End If
    Next ilLoop
    edcHdLnComment.Text = slStr
End Sub

Private Sub tmcTerminate_Timer()
    tmcTerminate.Enabled = False
    cmcCancel_Click
End Sub

'*******************************************************
'*                                                     *
'*      Procedure Name:mDetermineIfMod                 *
'*                                                     *
'*             Created:5/13/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Determine if rotation          *
'*                      overlaps Dates, Days and Times *
'*                      of other rotations.  If so,    *
'*                      treat as a Modification        *
'*                                                     *
Private Function mDetermineModNo(slTestType As String) As Integer
    Dim ilRet As Integer
    Dim ilDay As Integer
    Dim llStartDate As Long
    Dim llEndDate As Long
    Dim llStartTime As Long
    Dim llEndTime As Long
    Dim llTStartDate As Long
    Dim llTEndDate As Long
    Dim llTStartTime As Long
    Dim llTEndTime As Long
    Dim ilSDayIndex As Integer
    Dim ilEDayIndex As Integer
    Dim ilSameDay As Integer
    Dim ilValue As Integer
    Dim tlCrf As CRF

    mDetermineModNo = 0
    gUnpackDateLong tmCrf.iStartDate(0), tmCrf.iStartDate(1), llStartDate
    gUnpackDateLong tmCrf.iEndDate(0), tmCrf.iEndDate(1), llEndDate
    gUnpackTimeLong tmCrf.iStartTime(0), tmCrf.iStartTime(1), False, llStartTime
    gUnpackTimeLong tmCrf.iEndTime(0), tmCrf.iEndTime(1), True, llEndTime
    tmCrfSrchKey1.sRotType = tmCrf.sRotType
    tmCrfSrchKey1.iEtfCode = tmCrf.iEtfCode
    tmCrfSrchKey1.iEnfCode = tmCrf.iEnfCode
    tmCrfSrchKey1.iAdfCode = tmCrf.iAdfCode
    tmCrfSrchKey1.lChfCode = tmCrf.lChfCode
    tmCrfSrchKey1.lFsfCode = 0
    tmCrfSrchKey1.iVefCode = tmCrf.iVefCode
    tmCrfSrchKey1.iRotNo = 32000
    ilRet = btrGetGreaterOrEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
    Do While (ilRet = BTRV_ERR_NONE) And (tlCrf.sRotType = tmCrf.sRotType) And (tlCrf.iEtfCode = tmCrf.iEtfCode) And (tlCrf.iEnfCode = tmCrf.iEnfCode) And (tlCrf.iAdfCode = tmCrf.iAdfCode) And (tlCrf.lChfCode = tmCrf.lChfCode) And (tlCrf.iVefCode = tmCrf.iVefCode)
        If (tmCrf.lCode <> tlCrf.lCode) And (tlCrf.iRotNo < tmCrf.iRotNo) And (tlCrf.iLen = tmCrf.iLen) And (tlCrf.sInOut = tmCrf.sInOut) And (tlCrf.ianfCode = tmCrf.ianfCode) And (tlCrf.sZone = tmCrf.sZone) And (tlCrf.lRafCode = tmCrf.lRafCode) Then
            ilSameDay = False
            ilSDayIndex = 0
            ilEDayIndex = 6
            If llEndDate - llStartDate < 6 Then
                ilSDayIndex = gWeekDayLong(llStartDate)
                ilEDayIndex = gWeekDayLong(llEndDate)
                If ilEDayIndex < ilSDayIndex Then
                    For ilDay = ilSDayIndex To 6 Step 1
                        If (tlCrf.sDay(ilDay) = "Y") And (tmCrf.sDay(ilDay) = "Y") Then
                            ilSameDay = True
                            Exit For
                        End If
                    Next ilDay
                    For ilDay = 0 To ilEDayIndex Step 1
                        If (tlCrf.sDay(ilDay) = "Y") And (tmCrf.sDay(ilDay) = "Y") Then
                            ilSameDay = True
                            Exit For
                        End If
                    Next ilDay
                Else
                    For ilDay = ilSDayIndex To ilEDayIndex Step 1
                        If (tlCrf.sDay(ilDay) = "Y") And (tmCrf.sDay(ilDay) = "Y") Then
                            ilSameDay = True
                            Exit For
                        End If
                    Next ilDay
                End If
            Else
                For ilDay = ilSDayIndex To ilEDayIndex Step 1
                    If (tlCrf.sDay(ilDay) = "Y") And (tmCrf.sDay(ilDay) = "Y") Then
                        ilSameDay = True
                        Exit For
                    End If
                Next ilDay
            End If
            If ilSameDay Then
                gUnpackDateLong tlCrf.iStartDate(0), tlCrf.iStartDate(1), llTStartDate
                gUnpackDateLong tlCrf.iEndDate(0), tlCrf.iEndDate(1), llTEndDate
                gUnpackTimeLong tlCrf.iStartTime(0), tlCrf.iStartTime(1), False, llTStartTime
                gUnpackTimeLong tlCrf.iEndTime(0), tlCrf.iEndTime(1), True, llTEndTime
                If (llTEndTime >= llStartTime) And (llTStartTime <= llEndTime) Then
                    If (llTEndDate >= llStartDate) And (llTStartDate <= llEndDate) Then
                        ilValue = Asc(tgSpf.sUsingFeatures2)  'Option Fields in Orders/Proposals
                        If (tgSpf.sGUseAffFeed = "Y") And ((ilValue And REGIONALCOPY) = REGIONALCOPY) Then
                            If slTestType <> "KC" Then
                                If (tmCrf.sAffFdStatus = "S") Then
                                    mDetermineModNo = tlCrf.iNoTimesMod + 1
                                Else
                                    If tlCrf.iNoTimesMod > 0 Then
                                        mDetermineModNo = tlCrf.iNoTimesMod + 1
                                    End If
                                End If
                            End If
                                If (tmCrf.sKCFdStatus = "S") Then
                                    mDetermineModNo = tlCrf.iKCNoTimesMod + 1
                                Else
                                    If tlCrf.iKCNoTimesMod > 0 Then
                                        mDetermineModNo = tlCrf.iKCNoTimesMod + 1
                                    End If
                                End If
                            Exit Function
                        Else
                            mDetermineModNo = tlCrf.iNoTimesMod + 1
                            Exit Function
                        End If
                    End If
                End If
            End If
        End If
        ilRet = btrGetNext(hmCrf, tlCrf, imCrfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
    'It does not supersede any, If previously sent, then increment count
    If tmCrf.lCode > 0 Then
        If slTestType <> "KC" Then
            If tmCrf.sAffFdStatus = "S" Then
                mDetermineModNo = tmCrf.iNoTimesMod + 1
            End If
        Else
            If (tmCrf.sKCFdStatus = "S") Then
                mDetermineModNo = tmCrf.iKCNoTimesMod + 1
            End If
        End If
    End If
End Function


Private Function mTestIfRegionAllowed(ilFromAll As Integer, Optional ilInVefCode As Integer = -1) As Integer
    Dim ilVefCode As Integer
    Dim ilRet As Integer
    Dim slNameCode As String
    Dim slName As String
    Dim ilLoop As Integer
    Dim slZone As String
    Dim slCode As String
    Dim ilRegionAllowed As Integer
    Dim ilVpf As Integer
    Dim ilVef As Integer

    ilRegionAllowed = True
    '4/21/15: This should not be necessary but for safety it has been added
    If imSave(1) = -1 Then
        mTestIfRegionAllowed = False
        Exit Function
    End If
    ilVef = -1
    '4/21/15: Test if vehicle code passed, if so use it
    If ilInVefCode = -1 Then
        gFindMatch smSave(2), 0, lbcVehicle
        If gLastFound(lbcVehicle) >= 0 Then
            slNameCode = tgCVehicle(gLastFound(lbcVehicle) - imAllVehAdj).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            ilVefCode = Val(slCode)
        Else
            ilVefCode = 0
        End If
    Else
        ilVefCode = ilInVefCode
    End If
    If (Asc(tgSpf.sUsingFeatures2) And SPLITCOPY) = SPLITCOPY Then
        If imSave(1) = 0 Then
            slZone = ""
        Else
            slZone = lbcZones.List(imSave(1))
            For ilLoop = LBound(tmRegionCode) To UBound(tmRegionCode) - 1 Step 1
                slNameCode = tmRegionCode(ilLoop).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
                ilRet = gParseItem(slNameCode, 1, "\", slName)
                If StrComp(slZone, slName, 1) = 0 Then
                    slZone = "R"
                    Exit For
                End If
            Next ilLoop
        End If
        If slZone = "R" Then
            '6/19/07:  Jim:  Allow defineition for Conventional, Airing and Game.  Always set on fro Packages and Selling
            'ilVpf = gBinarySearchVpf(ilVefCode)
            'If ilVpf <> -1 Then
            '    If tgVpf(ilVpf).sAllowSplitCopy <> "Y" Then
            '        ilRegionAllowed = False
            '    End If
            'Else
            '    ilRegionAllowed = False
            'End If
            ilVef = gBinarySearchVef(ilVefCode)
            If ilVef <> -1 Then
                '5/11/11: Allow selling vehicles to be defined as No
                'If (tgMVef(ilVef).sType = "C") Or (tgMVef(ilVef).sType = "A") Or (tgMVef(ilVef).sType = "G") Then
                If (tgMVef(ilVef).sType = "C") Or (tgMVef(ilVef).sType = "A") Or (tgMVef(ilVef).sType = "G") Or (tgMVef(ilVef).sType = "S") Then
                    ilVpf = gBinarySearchVpf(ilVefCode)
                    If ilVpf <> -1 Then
                        If tgVpf(ilVpf).sAllowSplitCopy <> "Y" Then
                            ilRegionAllowed = False
                        End If
                    Else
                        ilRegionAllowed = False
                    End If
                'ElseIf (tgMVef(ilVef).sType = "S") Or (tgMVef(ilVef).sType = "P") Then
                ElseIf (tgMVef(ilVef).sType = "P") Then
                    ilRegionAllowed = True
                Else
                    ilRegionAllowed = False
                End If
            Else
                ilRegionAllowed = False
            End If
        End If
    End If
    If (Not ilFromAll) And (Not ilRegionAllowed) Then
        If ilVef = -1 Then
            ilRet = MsgBox("Rotation will not be Saved as Vehicle not allowed Split Copy", vbOKOnly + vbExclamation, "Error")
        Else
            ilRet = MsgBox("Rotation will not be Saved as " & Trim$(tgMVef(ilVef).sName) & " not allowed Split Copy", vbOKOnly + vbExclamation, "Error")
        End If
    End If
    mTestIfRegionAllowed = ilRegionAllowed
End Function

Private Sub mPaintRot()
    Dim llColor As Long
    Dim slFontName As String
    Dim flFontSize As Single
    Dim ilLoop As Integer

    llColor = pbcRot.ForeColor
    slFontName = pbcRot.FontName
    flFontSize = pbcRot.FontSize
    pbcRot.ForeColor = BLUE
    pbcRot.FontBold = False
    pbcRot.FontSize = 7
    pbcRot.FontName = "Arial"
    pbcRot.FontSize = 7  'Font size done twice as indicated in FontSize property area in manual
    For ilLoop = imLBCtrls To UBound(tmCtrls) Step 1

        If tmCtrls(ilLoop).fBoxX > 0 Then
            If (ilLoop = SDATEINDEX) Or (ilLoop = EDATEINDEX) Then
                If ilLoop = SDATEINDEX Then
                    pbcRot.Line (tmCtrls(ilLoop).fBoxX - 15, 15)-Step(tmCtrls(ilLoop).fBoxW + tmCtrls(ilLoop + 1).fBoxW + 30, tmCtrls(ilLoop).fBoxH + 45), , B
                    pbcRot.Line (tmCtrls(ilLoop).fBoxX - 15, tmCtrls(1).fBoxY - 15)-Step(tmCtrls(ilLoop).fBoxW + tmCtrls(ilLoop + 1).fBoxW + 30, tmCtrls(ilLoop).fBoxH + 15), , B
                End If
            ElseIf (ilLoop = STIMEINDEX) Or (ilLoop = ETIMEINDEX) Then
                If ilLoop = STIMEINDEX Then
                    pbcRot.Line (tmCtrls(ilLoop).fBoxX - 15, 15)-Step(tmCtrls(ilLoop).fBoxW + tmCtrls(ilLoop + 1).fBoxW + 30, tmCtrls(ilLoop).fBoxH + 45), , B
                    pbcRot.Line (tmCtrls(ilLoop).fBoxX - 15, tmCtrls(1).fBoxY - 15)-Step(tmCtrls(ilLoop).fBoxW + tmCtrls(ilLoop + 1).fBoxW + 30, tmCtrls(ilLoop).fBoxH + 15), , B
                End If
            ElseIf (ilLoop >= MONINDEX) And (ilLoop <= SUNINDEX) Then
                If ilLoop = MONINDEX Then
                    pbcRot.Line (tmCtrls(ilLoop).fBoxX - 15, 15)-Step(tmCtrls(AVAILINDEX).fBoxX - tmCtrls(ilLoop).fBoxX, tmCtrls(ilLoop).fBoxH + 45), , B
                End If
                pbcRot.Line (tmCtrls(ilLoop).fBoxX - 15, tmCtrls(1).fBoxY - 15)-Step(tmCtrls(ilLoop).fBoxW + 15, tmCtrls(ilLoop).fBoxH + 15), , B
            ElseIf (ilLoop = AVAILINDEX) Or (ilLoop = AVAILINDEX + 1) Then
                If ilLoop = AVAILINDEX Then
                    pbcRot.Line (tmCtrls(ilLoop).fBoxX - 15, 15)-Step(tmCtrls(ilLoop).fBoxW + tmCtrls(ilLoop + 1).fBoxW + 30, tmCtrls(ilLoop).fBoxH + 45), , B
                    pbcRot.Line (tmCtrls(ilLoop).fBoxX - 15, tmCtrls(1).fBoxY - 15)-Step(tmCtrls(ilLoop).fBoxW + tmCtrls(ilLoop + 1).fBoxW + 30, tmCtrls(ilLoop).fBoxH + 15), , B
                End If
            ElseIf ilLoop = CNTRINDEX Then
                pbcRot.Line (tmCtrls(ilLoop).fBoxX - 30, 15)-Step(tmCtrls(ilLoop).fBoxW + 30, tmCtrls(ilLoop).fBoxH + 45), , B
                pbcRot.Line (tmCtrls(ilLoop).fBoxX - 30, tmCtrls(1).fBoxY - 15)-Step(tmCtrls(ilLoop).fBoxW + 30, tmCtrls(ilLoop).fBoxH + 15), , B
            Else
                pbcRot.Line (tmCtrls(ilLoop).fBoxX - 15, 15)-Step(tmCtrls(ilLoop).fBoxW + 15, tmCtrls(ilLoop).fBoxH + 45), , B
                pbcRot.Line (tmCtrls(ilLoop).fBoxX - 15, tmCtrls(1).fBoxY - 15)-Step(tmCtrls(ilLoop).fBoxW + 15, tmCtrls(ilLoop).fBoxH + 15), , B
            End If
            pbcRot.CurrentX = tmCtrls(ilLoop).fBoxX + 15  'fgBoxInsetX
            pbcRot.CurrentY = 30
            Select Case ilLoop
                Case CNTRINDEX
                    pbcRot.Print "Contract #"
                Case LENINDEX
                    pbcRot.Print "Len"
                Case LIVECOPYINDEX
                    pbcRot.Print "R/L"
                Case VEHICLEINDEX
                    pbcRot.Print "Vehicle"
                Case MGASSIGNINDEX
                    pbcRot.Print "M"
                Case ZONEINDEX
                    If Screen.height / Screen.TwipsPerPixelY <= 600 Then
                        pbcRot.Print "R"
                    Else
                        pbcRot.Print "Region"
                    End If
                Case SDATEINDEX
                    pbcRot.Print "Date: Start & End"
                Case STIMEINDEX
                    pbcRot.Print "Time: Start & End"
                Case MONINDEX
                    pbcRot.Print "Mo"
                Case MONINDEX + 1
                    pbcRot.Print "Tu"
                Case MONINDEX + 2
                    pbcRot.Print "We"
                Case MONINDEX + 3
                    pbcRot.Print "Th"
                Case MONINDEX + 4
                    pbcRot.Print "Fr"
                Case MONINDEX + 5
                    pbcRot.Print "Sa"
                Case MONINDEX + 6
                    pbcRot.Print "Su"
                Case AVAILINDEX
                    pbcRot.Print "Avail"
                Case TYPEINDEX
                    pbcRot.Print "Type"
                Case COMMENTINDEX
                    pbcRot.Print "C"
            End Select
        End If
    Next ilLoop
    pbcRot.FontSize = flFontSize
    pbcRot.FontName = slFontName
    pbcRot.FontSize = flFontSize
    pbcRot.ForeColor = llColor
    pbcRot.FontBold = True
End Sub


Private Sub mCbcBlackoutChange()
    Dim ilAdfCode As Integer

    Dim ilLoopCount As Integer
    If imChgMode = False Then
        imChgMode = True
        ilLoopCount = 0
        Do
            If ilLoopCount > 0 Then
                If cbcBlackout.ListIndex >= 0 Then
                    cbcBlackout.Text = cbcBlackout.List(cbcBlackout.ListIndex)
                End If
            End If
            ilLoopCount = ilLoopCount + 1
            If cbcBlackout.Text <> "" Then
                gManLookAhead cbcBlackout, imBSMode, imComboBoxIndexAdvt
            End If
            imBlackoutIndex = cbcBlackout.ListIndex
            gSetMousePointer grdRot, grdRot, vbHourglass
            If cbcBlackout.ListIndex >= 0 Then
                ilAdfCode = cbcBlackout.ItemData(cbcBlackout.ListIndex)
                If ilAdfCode <> imBlackoutAdfCode Then
                    imBlackoutAdfCode = ilAdfCode
                    mSetBlackoutInv
                End If
            End If
        Loop While imBlackoutIndex <> cbcBlackout.ListIndex
        gSetMousePointer grdRot, grdRot, vbDefault
        mSetCommands
        imChgMode = False
    End If

End Sub

Private Sub mAdvtBlackoutPop()
    Dim ilRet As Integer    'Return status
    Dim ilFound As Integer
    Dim ilAdf As Integer
    Dim ilLoop As Integer
    Dim ilExtLen As Integer
    Dim llNoRec As Long
    Dim llRecPos As Long
    Dim ilOffSet As Integer
    Dim slStartDate As String
    Dim slEndDate As String
    Dim llStartDate As Long
    Dim llEndDate As Long
    Dim tlDateTypeBuff As POPDATETYPE   'Type field record
    Dim tlCharTypeBuff As POPCHARTYPE   'Type field record
    ReDim ilAdfCode(0 To 0) As Integer
    Dim slSQLQuery As String
    
    gSetMousePointer grdRot, grdRot, vbHourglass
    cbcBlackout.Clear
    lbcRGAdvt.Clear
    imBlackoutIndex = -1
    imBlackoutAdfCode = 0

    slStartDate = smSave(3)
    llStartDate = gDateValue(slStartDate)
    slStartDate = Format$(slStartDate, "m/d/yy") 'insure year is on date

    slEndDate = smSave(4)
    llEndDate = gDateValue(slEndDate)
    slEndDate = Format$(slEndDate, "m/d/yy") 'insure year is on date

    btrExtClear hmCif   'Clear any previous extend operation
    ilExtLen = Len(tmCif)  'Extract operation record size

    ilRet = btrGetFirst(hmCif, tmCif, imCifRecLen, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)   'Get first record as starting point of extend operation
    If ilRet <> BTRV_ERR_END_OF_FILE Then
        llNoRec = gExtNoRec(ilExtLen)               'Obtain number of records
        Call btrExtSetBounds(hmCif, llNoRec, -1, "UC", "Cif", "") '"EG") 'Set extract limits (all records)

        gPackDate slStartDate, tlDateTypeBuff.iDate0, tlDateTypeBuff.iDate1
        ilOffSet = gFieldOffset("Cif", "CIFROTSTARTDATE")
        ilRet = btrExtAddLogicConst(hmCif, BTRV_KT_DATE, ilOffSet, 4, BTRV_EXT_LTE, BTRV_EXT_AND, tlDateTypeBuff, 4)

        gPackDate slEndDate, tlDateTypeBuff.iDate0, tlDateTypeBuff.iDate1
        ilOffSet = gFieldOffset("Cif", "CIFROTENDDATE")
        ilRet = btrExtAddLogicConst(hmCif, BTRV_KT_DATE, ilOffSet, 4, BTRV_EXT_GTE, BTRV_EXT_AND, tlDateTypeBuff, 4)
        tlCharTypeBuff.sType = "A"          'get only active inventory items
        ilOffSet = gFieldOffset("Cif", "CifPurged")
        ilRet = btrExtAddLogicConst(hmCif, BTRV_KT_STRING, ilOffSet, 1, BTRV_EXT_EQUAL, BTRV_EXT_LAST_TERM, tlCharTypeBuff, 1)

        ilRet = btrExtAddField(hmCif, 0, ilExtLen) 'Extract the whole record
        On Error GoTo mAdvtBlackoutPopErr
        gBtrvErrorMsg ilRet, "mAdvtBlackoutPop (btrExtAddField):" & "Cif.Btr", Copy
        On Error GoTo 0
        ilRet = btrExtGetNext(hmCif, tmCif, ilExtLen, llRecPos)
        If (ilRet <> BTRV_ERR_END_OF_FILE) And (ilRet <> BTRV_ERR_FILTER_LIMIT) Then
            On Error GoTo mAdvtBlackoutPopErr
            gBtrvErrorMsg ilRet, "mAdvtBlackoutPop (btrExtGetNextExt):" & "Cif.Btr", Copy
            On Error GoTo 0
            ilExtLen = Len(tmCif)  'Extract operation record size
            Do While ilRet = BTRV_ERR_REJECT_COUNT
                ilRet = btrExtGetNext(hmCif, tmCif, ilExtLen, llRecPos)
            Loop
            Do While ilRet = BTRV_ERR_NONE
                ilFound = False
                For ilLoop = 0 To UBound(ilAdfCode) - 1 Step 1
                    If tmCif.iAdfCode = ilAdfCode(ilLoop) Then
                        ilFound = True
                        Exit For
                    End If
                Next ilLoop
                If Not ilFound Then
                    ilAdfCode(UBound(ilAdfCode)) = tmCif.iAdfCode
                    ReDim Preserve ilAdfCode(0 To UBound(ilAdfCode) + 1) As Integer
                End If
                ilRet = btrExtGetNext(hmCif, tmCif, ilExtLen, llRecPos)
                Do While ilRet = BTRV_ERR_REJECT_COUNT
                    ilRet = btrExtGetNext(hmCif, tmCif, ilExtLen, llRecPos)
                Loop
            Loop
        End If
    End If

    For ilLoop = LBound(ilAdfCode) To UBound(ilAdfCode) - 1
        ilAdf = gBinarySearchAdf(ilAdfCode(ilLoop))
        If ilAdf <> -1 Then
            cbcBlackout.AddItem Trim$(tgCommAdf(ilAdf).sName)
            cbcBlackout.ItemData(cbcBlackout.NewIndex) = tgCommAdf(ilAdf).iCode
            lbcRGAdvt.AddItem Trim$(tgCommAdf(ilAdf).sName)
            lbcRGAdvt.ItemData(lbcRGAdvt.NewIndex) = tgCommAdf(ilAdf).iCode
        End If
    Next ilLoop
    
    slSQLQuery = "Select Count(1) as BkoutCount from Adf_Advertisers"
    slSQLQuery = slSQLQuery & " Where "
    slSQLQuery = slSQLQuery & " (adfBkoutPoolStatus = 'A'"
    slSQLQuery = slSQLQuery & " Or adfBkoutPoolStatus = 'U'" & ")"
    Set rst_adf = gSQLSelectCall(slSQLQuery)
    If Not rst_adf.EOF Then
        If rst_adf!BkoutCount > 0 Then
            cbcBlackout.AddItem "[Pool]", 0
            cbcBlackout.ItemData(cbcBlackout.NewIndex) = POOLROTATION
            lbcRGAdvt.AddItem "[Pool]", 0
            lbcRGAdvt.ItemData(lbcRGAdvt.NewIndex) = POOLROTATION
        End If
    End If
    
    cbcBlackout.AddItem "[None]", 0
    cbcBlackout.ItemData(cbcBlackout.NewIndex) = 0
    lbcRGAdvt.AddItem "[None]", 0
    lbcRGAdvt.ItemData(lbcRGAdvt.NewIndex) = 0
    Erase ilAdfCode
    gSetMousePointer grdRot, grdRot, vbDefault
    Exit Sub
mAdvtBlackoutPopErr:
    gSetMousePointer grdRot, grdRot, vbDefault
    On Error GoTo 0
    MsgBox "mAdvtBlackoutPop error", vbCritical + vbOKOnly, "Cif I/O Error"
    Exit Sub
End Sub

Private Sub mDetermineInvDates(tlCrf As CRF)
'******************************************************************************************
'* Note: VBC id'd the following unreferenced items and handled them as described:         *
'*                                                                                        *
'* Local Variables (Removed)                                                              *
'*  ilFound                                                                               *
'******************************************************************************************

    Dim ilRet As Integer
    Dim ilCif As Integer
    Dim llDate As Long
    Dim tlCnf As CNF

    'gUnpackDateLong tlCrf.iEndDate(0), tlCrf.iEndDate(1), llDate
    'If llDate < lmNowDate Then
    '    Exit Sub
    'End If
    'If tlCrf.iBkoutInstAdfCode > 0 Then
    '    Exit Sub
    'End If
    If tlCrf.sState = "D" Then
        Exit Sub
    End If
    tmCnfSrchKey.lCrfCode = tlCrf.lCode
    tmCnfSrchKey.iInstrNo = 0
    ilRet = btrGetGreaterOrEqual(hmCnf, tlCnf, imCnfRecLen, tmCnfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
    Do While (ilRet = BTRV_ERR_NONE) And (tlCnf.lCrfCode = tlCrf.lCode)
        If tlCnf.lCifCode > 0 Then
            For ilCif = 0 To UBound(tmSetInvRotDate) - 1 Step 1
                If tmSetInvRotDate(ilCif).lCifCode = tlCnf.lCifCode Then
                    If tmSetInvRotDate(ilCif).lStartDate = 0 Then
                        gUnpackDateLong tlCrf.iStartDate(0), tlCrf.iStartDate(1), tmSetInvRotDate(ilCif).lStartDate
                    Else
                        gUnpackDateLong tlCrf.iStartDate(0), tlCrf.iStartDate(1), llDate
                        If llDate < tmSetInvRotDate(ilCif).lStartDate Then
                            tmSetInvRotDate(ilCif).lStartDate = llDate
                        End If
                    End If
                    If tmSetInvRotDate(ilCif).lEndDate = 0 Then
                        gUnpackDateLong tlCrf.iEndDate(0), tlCrf.iEndDate(1), tmSetInvRotDate(ilCif).lEndDate
                    Else
                        gUnpackDateLong tlCrf.iEndDate(0), tlCrf.iEndDate(1), llDate
                        If llDate > tmSetInvRotDate(ilCif).lEndDate Then
                            tmSetInvRotDate(ilCif).lEndDate = llDate
                        End If
                    End If
                    Exit For
                End If
            Next ilCif
        End If
        ilRet = btrGetNext(hmCnf, tlCnf, imCnfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
End Sub
Private Sub mCheckAndSetInvDates()
'******************************************************************************************
'* Note: VBC id'd the following unreferenced items and handled them as described:         *
'*                                                                                        *
'* Local Variables (Removed)                                                              *
'*  ilRet                         tlCrf                                                   *
'******************************************************************************************

    Dim llDate As Long

    gUnpackDateLong tmCrf.iEndDate(0), tmCrf.iEndDate(1), llDate
    If llDate < lmNowDate Then
        Exit Sub
    End If
    If (tmCrf.iBkoutInstAdfCode > 0) Or (tmCrf.iBkoutInstAdfCode = POOLROTATION) Then
        Exit Sub
    End If
    mDetermineInvDates tmCrf
    ''2/20/09:  Check if inventory used within any blackout, expand date if required
    'tmCrfSrchKey3.sRotType = tmCrf.sRotType
    'tmCrfSrchKey3.iBkoutInstAdfCode = tmCrf.iAdfCode
    'gPackDateLong lmNowDate, tmCrfSrchKey3.iEndDate(0), tmCrfSrchKey3.iEndDate(1)
    'ilRet = btrGetGreaterOrEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey3, INDEXKEY3, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
    'Do While (ilRet = BTRV_ERR_NONE) And (tlCrf.sRotType = tmCrf.sRotType) And (tlCrf.iBkoutInstAdfCode = tmCrf.iAdfCode)
    '    mDetermineInvDates tlCrf
    '    ilRet = btrGetNext(hmCrf, tlCrf, imCrfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    'Loop
End Sub
Private Sub mSetInvDates()
    Dim ilRet As Integer
    Dim ilCif As Integer

    For ilCif = 0 To UBound(tmSetInvRotDate) - 1 Step 1
        Do
            tmCifSrchKey.lCode = tmSetInvRotDate(ilCif).lCifCode
            ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
            If ilRet = BTRV_ERR_NONE Then
                gPackDateLong tmSetInvRotDate(ilCif).lStartDate, tmCif.iRotStartDate(0), tmCif.iRotStartDate(1)
                gPackDateLong tmSetInvRotDate(ilCif).lEndDate, tmCif.iRotEndDate(0), tmCif.iRotEndDate(1)
                ilRet = btrUpdate(hmCif, tmCif, imCifRecLen)
            End If
        Loop While ilRet = BTRV_ERR_CONFLICT
    Next ilCif
End Sub

Private Sub mGetLastRotNo()
    Dim ilRet As Integer
    Dim tlCrf As CRF

    imLastUsedRotNo = 0
    tmCrfSrchKey1.sRotType = tmCrf.sRotType
    tmCrfSrchKey1.iEtfCode = tmCrf.iEtfCode
    tmCrfSrchKey1.iEnfCode = tmCrf.iEnfCode
    tmCrfSrchKey1.iAdfCode = tmCrf.iAdfCode
    tmCrfSrchKey1.lChfCode = tmCrf.lChfCode
    tmCrfSrchKey1.lFsfCode = tmCrf.lFsfCode
    tmCrfSrchKey1.iVefCode = 0
    tmCrfSrchKey1.iRotNo = 32000
    ilRet = btrGetGreaterOrEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
    Do While (ilRet = BTRV_ERR_NONE) And (tlCrf.sRotType = tmCrf.sRotType) And (tlCrf.iEtfCode = tmCrf.iEtfCode) And (tlCrf.iEnfCode = tmCrf.iEnfCode) And (tlCrf.iAdfCode = tmCrf.iAdfCode) And (tlCrf.lChfCode = tmCrf.lChfCode) And (tlCrf.lFsfCode = tmCrf.lFsfCode)
        If tlCrf.iRotNo > imLastUsedRotNo Then
            imLastUsedRotNo = tlCrf.iRotNo
        End If
        ilRet = btrGetNext(hmCrf, tlCrf, imCrfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
End Sub

Private Sub mObtainRegions()
    Dim slNameCode As String
    Dim slCode As String
    Dim ilRet As Integer
    Dim ilAdfCode As Integer

    ReDim tmRegionCode(0 To 0) As SORTCODE
    If imTypeIndex < 0 Then
        Exit Sub
    End If
    If imAdvtIndex < 0 Then
        Exit Sub
    End If
    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    If ilRet <> CP_MSG_NONE Then
        Exit Sub
    End If
    ilAdfCode = Val(slCode)   'Change mode

    smRegionCodeTag = ""
    If (Asc(tgSpf.sUsingFeatures2) And REGIONALCOPY) = REGIONALCOPY Then
        ilRet = gObtainRegion(ilAdfCode, "R", True, tmRegionCode(), smRegionCodeTag)
    Else
        ilRet = gObtainRegion(ilAdfCode, "C", True, tmRegionCode(), smRegionCodeTag)
    End If
End Sub

Private Sub mSetBlackoutInv()
    gSetMousePointer grdRot, grdRot, vbHourglass
    lbcInv.Clear
    lbcInst.Clear
    lbcInst.AddItem " "
    smActiveCodeTag = ""
    lbcActive.Clear
    smPurgeCodeTag = ""
    lbcPurge.Clear
    smHistoryCodeTag = ""
    lbcHistory.Clear
    pbcLbcInst.Cls
    gSetMousePointer grdRot, grdRot, vbHourglass
    mInvPop
    gSetMousePointer grdRot, grdRot, vbHourglass
End Sub

Private Sub mSetIfGameVehicle()
    Dim slNameCode As String
    Dim slCode As String
    Dim ilRet As Integer
    Dim ilVef As Integer

    imGameVehicle = False
    If (Trim$(smSave(2)) = "") Or (Trim$(smSave(2)) = "[None]") Or (Trim$(smSave(2)) = "[All]") Or (Trim$(smSave(2)) = smSeveral) Then
        Exit Sub
    End If
    gFindMatch smSave(2), 0, lbcVehicle
    If gLastFound(lbcVehicle) >= 0 Then
        slNameCode = tgCVehicle(gLastFound(lbcVehicle) - imAllVehAdj).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
        ilRet = gParseItem(slNameCode, 2, "\", slCode)
        imVefCode = Val(slCode)
        ilVef = gBinarySearchVef(imVefCode)
        If ilVef <> -1 Then
            If tgMVef(ilVef).sType = "G" Then
                imGameVehicle = True
            End If
        End If
    End If
End Sub

Private Sub mAirGameShow()
    Dim ilLoop As Integer
    Dim slStr As String
    
    plcTme.Visible = False
    If rbcAirTimeCopyBy(0).Value Then
        smSave(5) = edcTimeDay(0).Text
        smSave(6) = edcTimeDay(1).Text
        For ilLoop = MONINDEX To SUNINDEX Step 1
            If ckcTimeDay(ilLoop - MONINDEX).Value Then
                imSave(2 + ilLoop - MONINDEX) = 1
            Else
                imSave(2 + ilLoop - MONINDEX) = 0
            End If
        Next ilLoop
    ElseIf rbcAirTimeCopyBy(1).Value Then
        smSave(5) = "By Event"
        smSave(6) = ""
        For ilLoop = MONINDEX To SUNINDEX Step 1
            imSave(2 + ilLoop - MONINDEX) = -1
        Next ilLoop
    ElseIf rbcAirTimeCopyBy(2).Value Then
        smSave(5) = "By Team"
        smSave(6) = ""
        For ilLoop = MONINDEX To SUNINDEX Step 1
            imSave(2 + ilLoop - MONINDEX) = -1
        Next ilLoop
    Else
        smSave(5) = ""
        smSave(6) = ""
        For ilLoop = MONINDEX To SUNINDEX Step 1
            imSave(2 + ilLoop - MONINDEX) = -1
        Next ilLoop
    End If
    gSetShow pbcRot, smSave(5), tmCtrls(STIMEINDEX)
    gSetShow pbcRot, smSave(6), tmCtrls(ETIMEINDEX)
    For ilLoop = MONINDEX To SUNINDEX Step 1
        Select Case imSave(2 + ilLoop - MONINDEX)
            Case 0  'No
                slStr = "N"
            Case 1  'Yes
                slStr = "Y"
            Case Else
                slStr = ""
        End Select
        gSetShow pbcRot, slStr, tmCtrls(ilLoop)
    Next ilLoop
    imTimeDayBoxNo = -1
    plcTme.Visible = False
    pbcAirGame.Visible = False
    pbcRot.Cls
    pbcRot_Paint
End Sub

Private Sub mTeamPop()
    Dim ilRet As Integer
    Dim ilLoop As Integer
    
    ilRet = gObtainMnfForType("Z", smTeamTag, tmTeam())
    'Moved to mGameTeamPop
    'For ilLoop = LBound(tmTeam) To UBound(tmTeam) - 1 Step 1
    '    lbcTeam.AddItem Trim$(tmTeam(ilLoop).sName)
    '    lbcTeam.ItemData(lbcTeam.NewIndex) = tmTeam(ilLoop).iCode
    'Next ilLoop
    Exit Sub
End Sub

Public Sub mGameTeamPop()
    Dim ilRet As Integer
    Dim ilGsf As Integer
    Dim slStr As String
    
    Dim llStartDate As Long
    Dim llEndDate As Long
    Dim ilIndex As Integer
    Dim ilFound As Integer
    
    Dim ilUpper As Integer
    Dim ilGame As Integer
    Dim ilTeam As Integer
    Dim slSortGameNo As String
    Dim slSortDate As String
    Dim llSortTime As Long
    Dim slSortTime As String
    Dim tlGhf As GHF        'GHF record image
    Dim tlGhfSrchKey1 As GHFKEY1    'GHF key record image
    Dim ilGhfRecLen As Integer        'GHF record length
    Dim ilLcfRecLen As Integer
    Dim tlLcf As LCF               'LCF record image-current
    Dim tlLcfSrchKey1 As LCFKEY1     'LCF key record image
    Dim tlGsf As GSF        'GSF record image
    Dim tlGsfSrchKey1 As GSFKEY1    'GSF key record image
    Dim ilGsfRecLen As Integer        'GSF record length
    Dim llSeasonStart As Long
    Dim llSeasonEnd As Long
    ReDim ilGameSelected(0 To 0) As Integer
    ReDim ilTeamMnfCode(0 To 0) As Integer

    If (lbcGameNo.ListCount > 0) And (imDateChanged = False) And (imGameVefCode = imVefCode) Then
        Exit Sub
    End If

    'Retain current selection
    gSetMousePointer grdRot, grdRot, vbHourglass
    If rbcAirTimeCopyBy(1).Value Then
        For ilIndex = 0 To lbcGameNo.ListCount - 1 Step 1
            If lbcGameNo.Selected(ilIndex) Then
                ilGameSelected(UBound(ilGameSelected)) = lbcGameNo.ItemData(ilIndex)
                ReDim Preserve ilGameSelected(0 To UBound(ilGameSelected) + 1) As Integer
            End If
        Next ilIndex
    ElseIf rbcAirTimeCopyBy(2).Value Then
        For ilIndex = 0 To lbcTeam.ListCount - 1 Step 1
            If lbcTeam.Selected(ilIndex) Then
                ilTeamMnfCode(UBound(ilTeamMnfCode)) = lbcTeam.ItemData(ilIndex)
                ReDim Preserve ilTeamMnfCode(0 To UBound(ilTeamMnfCode) + 1) As Integer
            End If
        Next ilIndex
    End If

    ReDim tmGsfInfo(0 To 0) As GSFINFO
    ilGhfRecLen = Len(tlGhf)
    ilGsfRecLen = Len(tlGsf)
    ilLcfRecLen = Len(tlLcf)

    If smSave(3) <> "" Then
        llStartDate = gDateValue(gAdjYear(smSave(3)))
    Else
        llStartDate = 0
    End If
    If smSave(4) <> "" Then
        llEndDate = gDateValue(gAdjYear(smSave(4)))
    Else
        llEndDate = 9999999
    End If

    lbcGameNo.Clear
    lbcTeam.Clear
    'ilRet = gGetGameDates(hmLcf, hmGhf, hmGsf, imVefCode, tmTeam(), tmGsfInfo())
    
    ilFound = False
    tlGhfSrchKey1.iVefCode = imVefCode
    ilRet = btrGetEqual(hmGhf, tlGhf, ilGhfRecLen, tlGhfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)   'Get current record
    Do While (ilRet = BTRV_ERR_NONE) And (tlGhf.iVefCode = imVefCode)
        gUnpackDateLong tlGhf.iSeasonStartDate(0), tlGhf.iSeasonStartDate(1), llSeasonStart
        gUnpackDateLong tlGhf.iSeasonEndDate(0), tlGhf.iSeasonEndDate(1), llSeasonEnd
        If (llSeasonEnd >= llStartDate) And (llSeasonStart <= llEndDate) Then
            ilFound = True
            Exit Do
        End If
        ilRet = btrGetNext(hmGhf, tlGhf, ilGhfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
    If Not ilFound Then
        gSetMousePointer grdRot, grdRot, vbDefault
        Exit Sub
    End If
    tlLcfSrchKey1.iVefCode = imVefCode
    tlLcfSrchKey1.iType = 0
    ilRet = btrGetGreaterOrEqual(hmLcf, tlLcf, ilLcfRecLen, tlLcfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)   'Get last current record to obtain date
    Do While (ilRet = BTRV_ERR_NONE) And (tlLcf.iVefCode = imVefCode)
        ilUpper = UBound(tmGsfInfo)
        tmGsfInfo(ilUpper).iGameNo = tlLcf.iType
        gUnpackDateLong tlLcf.iLogDate(0), tlLcf.iLogDate(1), tmGsfInfo(ilUpper).lGameDate
        If (tmGsfInfo(ilUpper).lGameDate >= llStartDate) And (tmGsfInfo(ilUpper).lGameDate <= llEndDate) Then
            gUnpackDateForSort tlLcf.iLogDate(0), tlLcf.iLogDate(1), slSortDate
            gUnpackTimeLong tlLcf.iTime(0, LBound(tlLcf.lLvfCode)), tlLcf.iTime(1, LBound(tlLcf.lLvfCode)), False, llSortTime
            slSortTime = Trim$(str$(llSortTime))
            Do While Len(slSortTime) < 6
                slSortTime = "0" & slSortTime
            Loop
            slSortGameNo = Trim$(str$(tlLcf.iType))
            '6/30/12:  Allow 5 digit event #'s
            Do While Len(slSortGameNo) < 5  '3
                slSortGameNo = "0" & slSortGameNo
            Loop
            If rbcSortGameBy(0).Value Then
                tmGsfInfo(ilUpper).sKey = slSortDate & slSortTime & slSortGameNo
            Else
                tmGsfInfo(ilUpper).sKey = slSortGameNo & slSortDate & slSortTime
            End If
            'Get Names
            tlGsfSrchKey1.lghfcode = tlGhf.lCode
            tlGsfSrchKey1.iGameNo = tmGsfInfo(ilUpper).iGameNo
            ilRet = btrGetEqual(hmGsf, tlGsf, ilGsfRecLen, tlGsfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)   'Get current record
            If ilRet = BTRV_ERR_NONE Then
                For ilTeam = LBound(tmTeam) To UBound(tmTeam) - 1 Step 1 'Traffic!lbcAgency.ListCount - 1 Step 1
                    If tlGsf.iVisitMnfCode = tmTeam(ilTeam).iCode Then
                        tmGsfInfo(ilUpper).sVisitName = tmTeam(ilTeam).sName
                        If Trim$(tmTeam(ilTeam).sUnitType) <> "" Then
                            tmGsfInfo(ilUpper).sVisitName = tmTeam(ilTeam).sUnitType
                            ilFound = False
                            For ilIndex = 0 To lbcTeam.ListCount - 1 Step 1
                                If lbcTeam.ItemData(ilIndex) = tmTeam(ilTeam).iCode Then
                                    ilFound = True
                                    Exit For
                                End If
                            Next ilIndex
                            If Not ilFound Then
                                lbcTeam.AddItem Trim$(tmGsfInfo(ilUpper).sVisitName)
                                lbcTeam.ItemData(lbcTeam.NewIndex) = tmTeam(ilTeam).iCode
                            End If
                        End If
                        Exit For
                    End If
                Next ilTeam
                For ilTeam = LBound(tmTeam) To UBound(tmTeam) - 1 Step 1 'Traffic!lbcAgency.ListCount - 1 Step 1
                    If tlGsf.iHomeMnfCode = tmTeam(ilTeam).iCode Then
                        tmGsfInfo(ilUpper).sHomeName = tmTeam(ilTeam).sName
                        If Trim$(tmTeam(ilTeam).sUnitType) <> "" Then
                            tmGsfInfo(ilUpper).sHomeName = tmTeam(ilTeam).sUnitType
                            ilFound = False
                            For ilIndex = 0 To lbcTeam.ListCount - 1 Step 1
                                If lbcTeam.ItemData(ilIndex) = tmTeam(ilTeam).iCode Then
                                    ilFound = True
                                    Exit For
                                End If
                            Next ilIndex
                            If Not ilFound Then
                                lbcTeam.AddItem Trim$(tmGsfInfo(ilUpper).sHomeName)
                                lbcTeam.ItemData(lbcTeam.NewIndex) = tmTeam(ilTeam).iCode
                            End If
                        End If
                        Exit For
                    End If
                Next ilTeam
            Else
                tmGsfInfo(ilUpper).sVisitName = ""
                tmGsfInfo(ilUpper).sHomeName = ""
            End If
            tmGsfInfo(ilUpper).sGameStatus = tlGsf.sGameStatus
            tmGsfInfo(ilUpper).sLiveLogMerge = tlGsf.sLiveLogMerge
            tmGsfInfo(ilUpper).sAffPost = tlLcf.sAffPost
            ReDim Preserve tmGsfInfo(0 To ilUpper + 1) As GSFINFO
        End If
        ilRet = btrGetNext(hmLcf, tlLcf, ilLcfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
    If UBound(tmGsfInfo) - 1 > 0 Then
        ArraySortTyp fnAV(tmGsfInfo(), 0), UBound(tmGsfInfo), 0, LenB(tmGsfInfo(0)), 0, LenB(tmGsfInfo(0).sKey), 0
    End If
    
    For ilGsf = LBound(tmGsfInfo) To UBound(tmGsfInfo) - 1 Step 1
        slStr = Trim$(str$(tmGsfInfo(ilGsf).iGameNo))
        slStr = slStr & " " & Format$(tmGsfInfo(ilGsf).lGameDate, "m/d/yy")
        slStr = slStr & " " & Trim$(tmGsfInfo(ilGsf).sVisitName) & "@" & Trim$(tmGsfInfo(ilGsf).sHomeName)
        lbcGameNo.AddItem slStr
        lbcGameNo.ItemData(lbcGameNo.NewIndex) = tmGsfInfo(ilGsf).iGameNo
    Next ilGsf
    If rbcAirTimeCopyBy(1).Value Then
        For ilIndex = 0 To lbcGameNo.ListCount - 1 Step 1
            For ilGame = 0 To UBound(ilGameSelected) - 1 Step 1
                If lbcGameNo.ItemData(ilIndex) = ilGameSelected(ilGame) Then
                    lbcGameNo.Selected(ilIndex) = True
                    Exit For
                End If
            Next ilGame
        Next ilIndex
    ElseIf rbcAirTimeCopyBy(2).Value Then
        For ilIndex = 0 To lbcTeam.ListCount - 1 Step 1
            For ilTeam = 0 To UBound(ilTeamMnfCode) - 1 Step 1
                If lbcTeam.ItemData(ilIndex) = ilTeamMnfCode(ilTeam) Then
                    lbcTeam.Selected(ilIndex) = True
                    Exit For
                End If
            Next ilTeam
        Next ilIndex
    End If
    imDateChanged = False
    imGameVefCode = imVefCode
    gSetMousePointer grdRot, grdRot, vbDefault
End Sub


'Private Function mIsRegionRotAndRestricted() As Integer
'    'mIsRegionRotAndRestricted: 0=No restriction; 1=disallow time and avail name; 2=disallow time, days and avail name
'    Dim slStr As String
'    Dim ilLoop As Integer
'    Dim slNameCode As String
'    Dim slName As String
'    Dim ilRet As Integer
'
'    mIsRegionRotAndRestricted = 0
'    If ((Asc(tgSpf.sUsingFeatures9) And IDCRESTRICTION) <> IDCRESTRICTION) Then
'        Exit Function
'    End If
'    If imSave(1) > 0 Then
'        slStr = lbcZones.List(imSave(1))
'        For ilLoop = LBound(tmRegionCode) To UBound(tmRegionCode) - 1 Step 1
'            slNameCode = tmRegionCode(ilLoop).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
'            ilRet = gParseItem(slNameCode, 1, "\", slName)
'            If StrComp(slStr, slName, 1) = 0 Then
'                mIsRegionRotAndRestricted = 1
'                If (Trim$(smSave(3)) <> "") And (Trim$(smSave(4)) <> "") Then
'                    If gDateValue(smSave(3)) + 6 < gDateValue(smSave(4)) Then
'                        mIsRegionRotAndRestricted = 2
'                    End If
'                Else
'                    mIsRegionRotAndRestricted = 2
'                End If
'                Exit Function
'            End If
'        Next ilLoop
'    End If
'End Function
'
'Private Function mTestForRegionConflicts() As Integer
'    Dim slStr As String
'    Dim ilLoop As Integer
'    Dim slNameCode As String
'    Dim slName As String
'    Dim slCode As String
'    Dim ilRet As Integer
'    Dim ilCrfRet As Integer
'    Dim tlCrf As CRF
'    Dim llStartDate As Long
'    Dim llEndDate As Long
'    Dim llNowDate As Long
'
'    mTestForRegionConflicts = False
'    If mIsRegionRotAndRestricted() = 0 Then
'        Exit Function
'    End If
'    '2/22/12
'    Exit Function
'    llNowDate = gDateValue(Format(gNow(), "m/d/yy"))
'    'Test if region previously used.  If so check dates
'    slCode = ""
'    slStr = lbcZones.List(imSave(1))
'    For ilLoop = LBound(tmRegionCode) To UBound(tmRegionCode) - 1 Step 1
'        slNameCode = tmRegionCode(ilLoop).sKey  'lbcVehicleCode.List(gLastFound(lbcVehicle))
'        ilRet = gParseItem(slNameCode, 1, "\", slName)
'        If StrComp(slStr, slName, 1) = 0 Then
'            ilRet = gParseItem(slNameCode, 2, "\", slCode)
'            Exit For
'        End If
'    Next ilLoop
'    If slCode <> "" Then
'        tmIefSrchKey2.lCode = Val(slCode)
'        ilRet = btrGetEqual(hmIef, tmIef, imIefRecLen, tmIefSrchKey2, INDEXKEY2, BTRV_LOCK_NONE, SETFORREADONLY)
'        Do While (ilRet = BTRV_ERR_NONE) And (tmIef.lSplitRafCode = Val(slCode))
'            'Check crf
'            tmCrfSrchKey.lCode = tmIef.lSplitCrfCode
'            ilCrfRet = btrGetEqual(hmCrf, tlCrf, imCrfRecLen, tmCrfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
'            If ilCrfRet = BTRV_ERR_NONE Then
'                gUnpackDateLong tlCrf.iStartDate(0), tlCrf.iStartDate(1), llStartDate
'                gUnpackDateLong tlCrf.iEndDate(0), tlCrf.iEndDate(1), llEndDate
'                If llEndDate >= llNowDate Then
'                    'If (gDateValue(smSave(3)) <= llStartdate) And (gDateValue(smSave(4)) >= llEndDate) Then
'                    If (gDateValue(smSave(3)) > llStartDate) Or (gDateValue(smSave(4)) < llEndDate) Then
'                        mTestForRegionConflicts = True
'                        Exit Function
'                    End If
'                End If
'            End If
'            ilRet = btrGetNext(hmIef, tmIef, imIefRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
'        Loop
'    Else
'    End If
'End Function
'
'Private Function mUpdateOrAddIEF(tlCrf As CRF) As Integer
'    Dim ilRet As Integer
'    Dim blIEFUpdated As Boolean
'
'    mUpdateOrAddIEF = True
'    '5882 no longer needed
'    'ttp 5329. test to see if need idc, not test if using restriction
''    If ((Asc(tgSpf.sUsingFeatures9) And IDCRESTRICTION) <> IDCRESTRICTION) Then
''        Exit Function
''    End If
'    ' not(one not blank)? that is, all attIdCReceiverId's are blank, and therefore idc not being used.
'    If Not bmIsIDC Then
'        Exit Function
'    End If
'    If tlCrf.lRafCode <= 0 Then
'        Exit Function
'    End If
'    blIEFUpdated = False
'    tmIefSrchKey2.lCode = tlCrf.lRafCode
'    ilRet = btrGetEqual(hmIef, tmIef, imIefRecLen, tmIefSrchKey2, INDEXKEY2, BTRV_LOCK_NONE, SETFORREADONLY)
'    Do While (ilRet = BTRV_ERR_NONE) And (tmIef.lSplitRafCode = tlCrf.lRafCode)
'        If tmIef.lSplitCrfCode = tlCrf.lCode Then
'            If (tmIef.sExportStatus <> "N") And (tmIef.sExportStatus <> "R") Then
'                If tlCrf.sState <> "D" Then
'                    tmIef.sExportStatus = "R"
'                Else
'                    tmIef.sExportStatus = "D"
'                End If
'                ilRet = btrUpdate(hmIef, tmIef, imIefRecLen)
'            End If
'            blIEFUpdated = True
'        End If
'        ilRet = btrGetNext(hmIef, tmIef, imIefRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
'    Loop
'    If blIEFUpdated Then
'        Exit Function
'    End If
'    tmIef.lCode = 0
'    tmIef.lGenericCifCode = 0
'    tmIef.lTriggerID = 0
'    tmIef.lSplitCrfCode = tlCrf.lCode
'    tmIef.lSplitRafCode = tlCrf.lRafCode
'    tmIef.sExportStatus = "N"
'    tmIef.sUnused = ""
'    ilRet = btrInsert(hmIef, tmIef, imIefRecLen, INDEXKEY0)
'    Exit Function
'End Function
'
'Private Sub mSetIDCDefaults()
'    Dim ilDay As Integer
'    Dim slStr As String
'    Dim ilRet As Integer
'    Dim ilBoxNo As Integer
'
'    ilRet = mIsRegionRotAndRestricted()
'    If ilRet = 0 Then
'        Exit Sub
'    End If
'    ilBoxNo = imBoxNo
'    If smSave(5) = "" Then
'        smSave(5) = "12am"
'        gSetShow pbcRot, smSave(5), tmCtrls(STIMEINDEX)
'        'tmCtrls(STIMEINDEX).iChg = True
'        mSetChg STIMEINDEX
'    End If
'    If smSave(6) = "" Then
'        smSave(6) = "12am"
'        gSetShow pbcRot, smSave(6), tmCtrls(ETIMEINDEX)
'        'tmCtrls(ETIMEINDEX).iChg = True
'        mSetChg ETIMEINDEX
'    End If
'    If ilRet = 2 Then
'        For ilDay = MONINDEX To SUNINDEX Step 1
'            imSave(2 + ilDay - MONINDEX) = 1
'            slStr = "Y"
'            gSetShow pbcRot, slStr, tmCtrls(ilDay)
'            'tmCtrls(ilDay).iChg = True
'            mSetChg ilDay
'        Next ilDay
'    End If
'    slStr = "All avails"
'    imSave(10) = 0
'    smSave(7) = ""
'    gSetShow pbcRot, slStr, tmCtrls(AVAILINDEX)
'    'tmCtrls(AVAILINDEX).iChg = True
'    mSetChg AVAILINDEX
'    gSetShow pbcRot, slStr, tmCtrls(AVAILINDEX + 1)
'    'tmCtrls(AVAILINDEX + 1).iChg = True
'    mSetChg AVAILINDEX + 1
'    pbcRot.Cls
'    pbcRot_Paint
'imBoxNo = ilBoxNo
'End Sub
'
'Private Sub mShowIDCMsg()
'    Dim ilDay As Integer
'    Dim ilRet As Integer
'
'    If bmIDCMsgShown Then
'        Exit Sub
'    End If
'    ilRet = mIsRegionRotAndRestricted()
'    If ilRet = 0 Then
'        Exit Sub
'    End If
'    If Trim$(smSave(5)) <> "" Then
'        If gTimeToLong(smSave(5), False) <> gTimeToLong("12am", False) Then
'            MsgBox "IDC has severe restrictions on split copy entered for specific Times or Days.  You must first enter extra dummy audio files of some or all Generic spots, then reenter the Generic copy for this advertiser, then enter the split copy for this advertiser.  See special procedures to determine how many copies of Generic copy are required.", vbInformation, "IDC Restrictions"
'            bmIDCMsgShown = True
'            Exit Sub
'        End If
'    End If
'    If Trim$(smSave(6)) <> "" Then
'        If gTimeToLong(smSave(6), True) <> gTimeToLong("12am", True) Then
'            MsgBox "IDC has severe restrictions on split copy entered for specific Times or Days.  You must first enter extra dummy audio files of some or all Generic spots, then reenter the Generic copy for this advertiser, then enter the split copy for this advertiser.  See special procedures to determine how many copies of Generic copy are required.", vbInformation, "IDC Restrictions"
'            bmIDCMsgShown = True
'            Exit Sub
'        End If
'    End If
'    For ilDay = MONINDEX To SUNINDEX Step 1
'        If imSave(2 + ilDay - MONINDEX) = 0 Then
'            MsgBox "IDC has severe restrictions on split copy entered for specific Times or Days.  You must first enter extra dummy audio files of some or all Generic spots, then reenter the Generic copy for this advertiser, then enter the split copy for this advertiser.  See special procedures to determine how many copies of Generic copy are required.", vbInformation, "IDC Restrictions"
'            bmIDCMsgShown = True
'            Exit Sub
'        End If
'    Next ilDay
'End Sub

Private Function mBuildCifArray(tlCrf As CRF, llCifCode() As Long) As Integer
    Dim ilRet As Integer
    Dim tlCnf As CNF
    Dim blFound As Boolean
    Dim ilCif As Integer
    Dim ilCrf As Integer
    
    tmCnfSrchKey.lCrfCode = tlCrf.lCode
    tmCnfSrchKey.iInstrNo = 0
    ilRet = btrGetGreaterOrEqual(hmCnf, tlCnf, imCnfRecLen, tmCnfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
    Do While (ilRet = BTRV_ERR_NONE) And (tlCnf.lCrfCode = tlCrf.lCode)
        blFound = False
        For ilCif = 0 To UBound(llCifCode) - 1 Step 1
            If llCifCode(ilCif) = tlCnf.lCifCode Then
                blFound = True
                Exit For
            End If
        Next ilCif
        If Not blFound Then
            llCifCode(UBound(llCifCode)) = tlCnf.lCifCode
            ReDim Preserve llCifCode(0 To UBound(llCifCode) + 1) As Long
        End If
        ilRet = btrGetNext(hmCnf, tlCnf, imCnfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
    mBuildCifArray = True
End Function

Private Function mAdjustCufAndCif(slTask As String, tlCrf As CRF, llCifCode() As Long) As Integer
    'slTask(I): U=Update; R=Remove
    Dim ilRet As Integer
    Dim ilCif As Integer
    Dim ilCrf As Integer
    Dim llStartDate As Long
    Dim llEndDate As Long
    Dim llRotStartDate As Long
    Dim llRotEndDate As Long
    Dim blFound As Boolean
    Dim llFirstHoleCufCode As Long
    Dim ilFirstHoleCufIndex As Integer
    Dim ilIndex As Integer
    Dim llChgCount As Long
    Dim llTotalCount As Long
    Dim llCrf As Long
    Dim llCrfNext As Long
    
    ReDim tmCifInfo(0 To UBound(llCifCode)) As CIFINFO
    ReDim tmCrfDates(0 To 0) As CRFDATES
    tmCrfDates(0).lNext = -1
    If tlCrf.iBkoutInstAdfCode = POOLROTATION Then
        mAdjustCufAndCif = True
        Exit Function
    End If
    gUnpackDateLong tlCrf.iStartDate(0), tlCrf.iStartDate(1), llRotStartDate
    gUnpackDateLong tlCrf.iEndDate(0), tlCrf.iEndDate(1), llRotEndDate
    For ilCif = 0 To UBound(llCifCode) - 1 Step 1
        llFirstHoleCufCode = -1
        ilFirstHoleCufIndex = -1
        tmCifInfo(ilCif).lCifCode = llCifCode(ilCif)
        If tlCrf.iBkoutInstAdfCode <= 0 Then
            tmCifInfo(ilCif).iAdfCode = tlCrf.iAdfCode
        Else
            tmCifInfo(ilCif).iAdfCode = tlCrf.iBkoutInstAdfCode
        End If
        tmCifInfo(ilCif).lFirst = -1
        blFound = False
        tmCufSrchKey1.lCifCode = llCifCode(ilCif)
        ilRet = btrGetEqual(hmCuf, tmCuf, imCufRecLen, tmCufSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)   'Get first record as starting point of extend operation
        Do While (ilRet = BTRV_ERR_NONE) And (tmCuf.lCifCode = llCifCode(ilCif))
            For ilCrf = 0 To UBound(tmCuf.lCrfCode) Step 1
                If tmCuf.lCrfCode(ilCrf) > 0 Then
                    If tlCrf.lCode = tmCuf.lCrfCode(ilCrf) Then
                        blFound = True
                        If slTask = "R" Then    'Remove
                            tmCuf.lCrfCode(ilCrf) = 0
                            gPackDate "", tmCuf.iRotStartDate(0, ilCrf), tmCuf.iRotStartDate(1, ilCrf)
                            gPackDate "", tmCuf.iRotEndDate(0, ilCrf), tmCuf.iRotEndDate(1, ilCrf)
                            ilRet = btrUpdate(hmCuf, tmCuf, imCufRecLen)
                        ElseIf slTask = "U" Then
                            gUnpackDateLong tmCuf.iRotStartDate(0, ilCrf), tmCuf.iRotStartDate(1, ilCrf), llStartDate
                            gUnpackDateLong tmCuf.iRotEndDate(0, ilCrf), tmCuf.iRotEndDate(1, ilCrf), llEndDate
                            If (llRotStartDate <> llStartDate) Or (llRotEndDate <> llEndDate) Then
                                gPackDateLong llRotStartDate, tmCuf.iRotStartDate(0, ilCrf), tmCuf.iRotStartDate(1, ilCrf)
                                gPackDateLong llRotEndDate, tmCuf.iRotEndDate(0, ilCrf), tmCuf.iRotEndDate(1, ilCrf)
                                ilRet = btrUpdate(hmCuf, tmCuf, imCufRecLen)
                            End If
                        End If
                    End If
                    If tmCuf.lCrfCode(ilCrf) > 0 Then
                        llCrf = UBound(tmCrfDates)
                        llCrfNext = tmCifInfo(ilCif).lFirst
                        'tmCrfDates(llCrf).iAdfCode = tlCrf.iAdfCode
                        If tlCrf.iBkoutInstAdfCode <= 0 Then
                            tmCrfDates(llCrf).iAdfCode = tlCrf.iAdfCode
                        Else
                            tmCrfDates(llCrf).iAdfCode = tlCrf.iBkoutInstAdfCode
                        End If
                        tmCrfDates(llCrf).lCrfCode = tlCrf.lCode
                        gUnpackDateLong tmCuf.iRotStartDate(0, ilCrf), tmCuf.iRotStartDate(1, ilCrf), tmCrfDates(llCrf).lStartDate
                        gUnpackDateLong tmCuf.iRotEndDate(0, ilCrf), tmCuf.iRotEndDate(1, ilCrf), tmCrfDates(llCrf).lEndDate
                        tmCrfDates(llCrf).lNext = llCrfNext
                        tmCifInfo(ilCif).lFirst = llCrf
                        ReDim Preserve tmCrfDates(0 To llCrf + 1) As CRFDATES
                    Else
                        If llFirstHoleCufCode = -1 Then
                            '9/22/14: Fix cuf update
                            llFirstHoleCufCode = tmCuf.lCode    'llCifCode(ilCif)
                            ilFirstHoleCufIndex = ilCrf
                        End If
                    End If
                Else
                    If llFirstHoleCufCode = -1 Then
                        '9/22/14: Fix cuf update
                        llFirstHoleCufCode = tmCuf.lCode    'llCifCode(ilCif)
                        ilFirstHoleCufIndex = ilCrf
                    End If
                End If
            Next ilCrf
            'Continue building tmCrfDates
            'If blFound Then
            '    Exit Do
            'End If
            ilRet = btrGetNext(hmCuf, tmCuf, imCufRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
        If (Not blFound) And (slTask <> "R") Then 'Add
            If llFirstHoleCufCode = -1 Then
                tmCifSrchKey.lCode = llCifCode(ilCif)
                ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)   'Get first record as starting point of extend operation
                If ilRet = BTRV_ERR_NONE Then
                    tmCuf.lCode = 0
                    tmCuf.lCifCode = llCifCode(ilCif)
                    tmCuf.iAdfCode = tmCif.iAdfCode
                    tmCuf.iMcfCode = tmCif.iMcfCode
                    tmCuf.sCifName = tmCif.sName
                    For ilIndex = LBound(tmCuf.lCrfCode) To UBound(tmCuf.lCrfCode) Step 1
                        tmCuf.lCrfCode(ilIndex) = 0
                        gPackDate "", tmCuf.iRotStartDate(0, ilIndex), tmCuf.iRotStartDate(1, ilIndex)
                        gPackDate "", tmCuf.iRotEndDate(0, ilIndex), tmCuf.iRotEndDate(1, ilIndex)
                    Next ilIndex
                
                    ilCrf = LBound(tmCuf.lCrfCode)
                    tmCuf.lCrfCode(ilCrf) = tlCrf.lCode
                    tmCuf.iRotStartDate(0, ilCrf) = tlCrf.iStartDate(0)
                    tmCuf.iRotStartDate(1, ilCrf) = tlCrf.iStartDate(1)
                    tmCuf.iRotEndDate(0, ilCrf) = tlCrf.iEndDate(0)
                    tmCuf.iRotEndDate(1, ilCrf) = tlCrf.iEndDate(1)
                    ilRet = btrInsert(hmCuf, tmCuf, imCufRecLen, INDEXKEY0)
                End If
            Else
                '9/22/14: Fix cuf update
                'tmCufSrchKey1.lCifCode = llFirstHoleCufCode
                'ilRet = btrGetEqual(hmCuf, tmCuf, imCufRecLen, tmCufSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)   'Get first record as starting point of extend operation
                tmCufSrchKey.lCode = llFirstHoleCufCode
                ilRet = btrGetEqual(hmCuf, tmCuf, imCufRecLen, tmCufSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)   'Get first record as starting point of extend operation
                If ilRet = BTRV_ERR_NONE Then
                    ilCrf = ilFirstHoleCufIndex
                    tmCuf.lCrfCode(ilCrf) = tlCrf.lCode
                    tmCuf.iRotStartDate(0, ilCrf) = tlCrf.iStartDate(0)
                    tmCuf.iRotStartDate(1, ilCrf) = tlCrf.iStartDate(1)
                    tmCuf.iRotEndDate(0, ilCrf) = tlCrf.iEndDate(0)
                    tmCuf.iRotEndDate(1, ilCrf) = tlCrf.iEndDate(1)
                    ilRet = btrUpdate(hmCuf, tmCuf, imCufRecLen)
                End If
            End If
            llCrf = UBound(tmCrfDates)
            llCrfNext = tmCifInfo(ilCif).lFirst
            'tmCrfDates(llCrf).iAdfCode = tlCrf.iAdfCode
            If tlCrf.iBkoutInstAdfCode <= 0 Then
                tmCrfDates(llCrf).iAdfCode = tlCrf.iAdfCode
            Else
                tmCrfDates(llCrf).iAdfCode = tlCrf.iBkoutInstAdfCode
            End If
            tmCrfDates(llCrf).lCrfCode = tlCrf.lCode
            gUnpackDateLong tmCuf.iRotStartDate(0, ilCrf), tmCuf.iRotStartDate(1, ilCrf), tmCrfDates(llCrf).lStartDate
            gUnpackDateLong tmCuf.iRotEndDate(0, ilCrf), tmCuf.iRotEndDate(1, ilCrf), tmCrfDates(llCrf).lEndDate
            tmCrfDates(llCrf).lNext = llCrfNext
            tmCifInfo(ilCif).lFirst = llCrf
            ReDim Preserve tmCrfDates(0 To llCrf + 1) As CRFDATES
        End If
    Next ilCif
    'Reset Inventory date
    llChgCount = 0
    llTotalCount = 0
    gUpdateCifDates hmCif, tmCifInfo(), tmCrfDates(), llChgCount, llTotalCount, False
    mAdjustCufAndCif = True
End Function

Private Sub mRGLayout()
    Dim ilCol As Integer
    Dim ilRow As Integer

    For ilRow = 0 To grdRot.rows - 1 Step 1
        grdRot.rowHeight(ilRow) = fgFlexGridRowH
    Next ilRow
    For ilCol = 0 To grdRot.cols - 1 Step 1
        grdRot.ColAlignment(ilCol) = flexAlignLeftCenter
    Next ilCol
End Sub

Private Sub mRGColumnTitles()
    'Set column titles
    grdRot.TextMatrix(0, RGVEHICLEINDEX) = "Vehicles"
    grdRot.TextMatrix(0, REGIONNAMEINDEX) = "Region"
    grdRot.TextMatrix(0, CATEGORYINDEX) = "Category"
    grdRot.TextMatrix(0, SELECTIONINDEX) = "Selection"
    grdRot.TextMatrix(0, INCLEXCLINDEX) = "Incl/Excl"
    grdRot.TextMatrix(0, FORMATINDEX) = "Format"
    grdRot.TextMatrix(0, ADVTINDEX) = "Blackout"
    grdRot.TextMatrix(0, COPYINDEX) = "Copy"
    grdRot.TextMatrix(0, RGCOMMENTINDEX) = "C"
    grdRot.TextMatrix(0, RAFCODEINDEX) = "RafCode"
    grdRot.TextMatrix(0, GPFCODEINDEX) = "GpfCode"
    grdRot.TextMatrix(0, GPFCODEINDEX) = "Sort Order No"
    grdRot.TextMatrix(0, COPYTIPINDEX) = "Copy Tip"
    grdRot.TextMatrix(0, CSFCODEINDEX) = "CsfCode"
    grdRot.TextMatrix(0, STATUSINDEX) = "Model"
End Sub

Private Sub mRGColumnWidths()
    Dim llWidth As Long
    Dim llMinWidth As Long
    Dim ilCol As Integer
    Dim ilColInc As Integer
    Dim ilLoop As Integer

    grdRot.ColWidth(RAFCODEINDEX) = 0
    grdRot.ColWidth(GPFCODEINDEX) = 0
    grdRot.ColWidth(CSFCODEINDEX) = 0
    grdRot.ColWidth(COPYTIPINDEX) = 0
    grdRot.ColWidth(STATUSINDEX) = 0
    grdRot.ColWidth(RGVEHICLEINDEX) = 0.1 * grdRot.Width
    grdRot.ColWidth(REGIONNAMEINDEX) = 0.1 * grdRot.Width
    grdRot.ColWidth(CATEGORYINDEX) = 0.1 * grdRot.Width
    grdRot.ColWidth(SELECTIONINDEX) = 0.1 * grdRot.Width
    grdRot.ColWidth(INCLEXCLINDEX) = 0.1 * grdRot.Width
    grdRot.ColWidth(FORMATINDEX) = 0.1 * grdRot.Width
    grdRot.ColWidth(ADVTINDEX) = 0.1 * grdRot.Width
    grdRot.ColWidth(RGCOMMENTINDEX) = 0.015 * grdRot.Width
    
    
    grdRot.ColWidth(COPYINDEX) = grdRot.Width - GRIDSCROLLWIDTH - 15
    For ilCol = 0 To RGCOMMENTINDEX Step 1
        If ilCol <> COPYINDEX Then
            grdRot.ColWidth(COPYINDEX) = grdRot.ColWidth(COPYINDEX) - grdRot.ColWidth(ilCol)
        End If
    Next ilCol
End Sub

Private Sub mSetRGCtrl()
    Dim blGridOn As Boolean
    Dim blSet As Boolean
    blGridOn = False
    blSet = True
    If lbcZones.ListIndex >= 0 Then
        If lbcZones.List(lbcZones.ListIndex) = "[Grid]" Then
            blGridOn = True
            blSet = False
            '5/4/15
            If Not cmcGrid.Visible Then
                smRefGridName = ""
            End If
            txtISCI_Filter.Text = txtISCI_Filter_Main.Text
            mChangeFilter
            txtISCI_Filter_Main.Text = ""
        End If
    End If
    grdRot.Visible = blGridOn
    cmcGrid.Visible = blGridOn
    lacBlackout.Visible = blSet
    cbcBlackout.Visible = blSet
    plcShow.Visible = blSet
    plcInv.Visible = blSet
    plcInst.Visible = blSet
    cmcMoveTo.Visible = blSet
    pbcDnMove.Visible = blSet
    cmcMoveFrom.Visible = blSet
    pbcUpMove.Visible = blSet
    cmcFLUp.Visible = blSet
    cmcFLDn.Visible = blSet
    plcFL.Visible = blSet
    '1/17/14: 6597
    If Not blGridOn Then
        edcRGMultiSelect.Visible = False  'Set visibility
        edcRGDropdown.Visible = False  'Set visibility
        lbcRGVehicle.Visible = False
        edcRGDropdown.Visible = False  'Set visibility
        cmcRGDropdown.Visible = False
        lbcRGRegion.Visible = False
        lbcRGCategory.Visible = False
        If (imRGSelection >= 0) And (imRGSelection < lbcRGSelection.Count) Then
            lbcRGSelection(imRGSelection).Visible = False
        End If
        pbcRGInclExcl.Visible = False
        lbcRGAdvt.Visible = False
        grdCopy.Visible = False
        picISCI_Filter.Visible = False 'TTP 10728
        txtISCI_Filter.Text = ""       'TTP 10728
        edcCGDropdown.Visible = False
        lmCGEnableRow = -1
        lmCGEnableCol = -1
        imCGCtrlVisible = False
        edcGridHelp.Visible = False
        edcGridTotal.Visible = False
        pbcCGSTab.Enabled = False
        pbcCGTab.Enabled = False
        edcRGComment.Visible = False
        imcTrash.Visible = False
        imcTrash.Enabled = False
        pbcArrow.Visible = False
        lmRGEnableRow = -1
        lmRGEnableCol = -1
        imRGCtrlVisible = False
    End If
    mClearDrag
    'pbcFL.Visible = blSet
    mSetFLPointer
End Sub

'*******************************************************
'*                                                     *
'*      Procedure Name:mEnableBox                      *
'*                                                     *
'*             Created:6/28/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Enable specified control       *
'*                                                     *
'*******************************************************
Private Sub mRGEnableBox()
'
'   mEnableBox ilBoxNo
'   Where:
'       ilBoxNo (I)- Number of the Control to be enabled
'
    Dim slStr As String
    Dim ilLoop As Integer
    Dim ilPos As Integer
    Dim llRow As Long
    Dim ilRepeat As Integer
    Dim slCopy As String
    Dim llLoop As Long
    Dim llStart As Long
    Dim llCol As Long
    Dim slFields() As String
    
    If (grdRot.Row < grdRot.FixedRows) Or (grdRot.Row >= grdRot.rows) Or (grdRot.Col < grdRot.FixedCols) Or (grdRot.Col >= grdRot.cols - 1) Then
        Exit Sub
    End If
    lmRGEnableRow = grdRot.Row
    lmRGEnableCol = grdRot.Col
    pbcArrow.Visible = False
    pbcArrow.Move grdRot.Left - pbcArrow.Width - 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + (grdRot.rowHeight(grdRot.Row) - pbcArrow.height) / 2
    pbcArrow.Visible = True
    imRGCtrlVisible = True
    If grdRot.Row >= UBound(smRGComment) Then
        llStart = UBound(smRGComment)
        ReDim Preserve smRGComment(0 To grdRot.Row + 1)
        For llLoop = llStart To UBound(smRGComment) Step 1
            smRGComment(llLoop) = ""
        Next llLoop
    End If
    If grdRot.Text = "Missing" Then
        For llCol = REGIONNAMEINDEX To ADVTINDEX Step 1
            If grdRot.TextMatrix(lmRGEnableRow, llCol) = "Missing" Then
                grdRot.Col = llCol
                grdRot.CellForeColor = vbBlack
                grdRot.TextMatrix(lmRGEnableRow, llCol) = ""
            End If
        Next llCol
        grdRot.Col = lmRGEnableCol
    End If
    For llCol = REGIONNAMEINDEX To ADVTINDEX Step 1
        grdRot.Col = llCol
        If grdRot.CellForeColor = vbRed Then
            grdRot.CellForeColor = vbBlack
        End If
    Next llCol
    grdRot.Col = lmRGEnableCol
    Select Case grdRot.Col
        Case RGVEHICLEINDEX
            edcRGDropdown.Text = grdRot.Text
            edcRGDropdown.MaxLength = 40
            mSetRGVehicles lmRGEnableRow
        Case REGIONNAMEINDEX
            edcRGDropdown.MaxLength = 80
            slStr = grdRot.Text
            If slStr = "Missing" Then
                slStr = ""
            End If
            edcRGDropdown.Text = slStr
            gFindMatch slStr, 0, lbcRGRegion
            If gLastFound(lbcRGRegion) >= 0 Then
                lbcRGRegion.ListIndex = gLastFound(lbcRGRegion)
            End If
            lgSplitModelCodeRaf = -1
        Case CATEGORYINDEX
            edcRGDropdown.MaxLength = 10
            slStr = grdRot.Text
            If slStr = "Missing" Then
                slStr = ""
            End If
            If slStr = "" Then
                slStr = "[None]"
            End If
            edcRGDropdown.Text = slStr
            gFindMatch slStr, 0, lbcRGCategory
            If gLastFound(lbcRGCategory) >= 0 Then
                lbcRGCategory.ListIndex = gLastFound(lbcRGCategory)
            End If
        Case SELECTIONINDEX
            mPopRGCategory grdRot.TextMatrix(grdRot.Row, CATEGORYINDEX)
            edcRGDropdown.MaxLength = 0
            edcRGDropdown.Text = ""
            slStr = grdRot.Text
            If slStr = "Missing" Then
                slStr = ""
            End If
            'If slStr <> "" Then
            '    slFields = Split(slStr, "; ")
            '    If IsArray(slFields) Then
            '        For ilLoop = 0 To UBound(slFields) Step 1
            '            gFindMatch slFields(ilLoop), 0, lbcRGSelection(imRGSelection)
            '            If gLastFound(lbcRGSelection(imRGSelection)) >= 0 Then
            '                lbcRGSelection(imRGSelection).Selected(gLastFound(lbcRGSelection(imRGSelection))) = True
            '            End If
            '        Next ilLoop
            '    End If
            'Else
            '    If lbcRGSelection(imRGSelection).ListCount > 0 Then
            '        lbcRGSelection(imRGSelection).Selected(0) = True
            '    End If
            'End If
            mSetRGSelection slStr
        Case INCLEXCLINDEX
            slStr = grdRot.Text
            If slStr = "Missing" Then
                slStr = ""
            End If
            If slStr = "" Then
                smRGInclExcl = "None"
            Else
                smRGInclExcl = slStr
            End If
            pbcRGInclExcl_Paint
        Case FORMATINDEX
            mPopRGCategory "Format"
            edcRGDropdown.MaxLength = 0
            edcRGDropdown.Text = ""
            mPopRGCategory "Format"
            slStr = grdRot.Text
            If slStr = "Missing" Then
                slStr = ""
            End If
            'If slStr <> "" Then
            '    slFields = Split(slStr, "; ")
            '    If IsArray(slFields) Then
            '        For ilLoop = 0 To UBound(slFields) Step 1
            '            gFindMatch slFields(ilLoop), 0, lbcRGSelection(imRGSelection)
            '            If gLastFound(lbcRGSelection(imRGSelection)) >= 0 Then
            '                lbcRGSelection(imRGSelection).Selected(gLastFound(lbcRGSelection(imRGSelection))) = True
            '            End If
            '        Next ilLoop
            '    End If
            'Else
            '    lbcRGSelection(imRGSelection).Selected(0) = True
            'End If
            mSetRGSelection slStr
        Case ADVTINDEX
            If lbcRGAdvt.ListCount <= 0 Then
                mAdvtBlackoutPop
            End If
            edcRGDropdown.MaxLength = 30
            slStr = grdRot.Text
            If slStr = "Missing" Then
                slStr = ""
            End If
            If slStr = "" Then
                slStr = "[None]"
            End If
            edcRGDropdown.Text = slStr
            gFindMatch slStr, 0, lbcRGAdvt
            If gLastFound(lbcRGAdvt) >= 0 Then
                lbcRGAdvt.ListIndex = gLastFound(lbcRGAdvt)
            End If
        Case COPYINDEX
            smRGSource = "U" 'User
            imBlackoutAdfCode = 0
            slStr = grdRot.TextMatrix(grdRot.Row, ADVTINDEX)
            If slStr <> "" Then
                gFindMatch slStr, 0, lbcRGAdvt
                If gLastFound(lbcRGAdvt) >= 0 Then
                    imBlackoutAdfCode = lbcRGAdvt.ItemData(gLastFound(lbcRGAdvt))
                End If
            End If
            If (imCurrentBlackoutAdfCode <> imBlackoutAdfCode) And (imBlackoutAdfCode <> 0) Then
                'Screen.MousePointer = vbHourglass  'Wait
                gSetMousePointer grdRot, grdRot, vbHourglass
                mInvPop
                'Screen.MousePointer = vbDefault  'Wait
                gSetMousePointer grdRot, grdRot, vbDefault
            ElseIf imBlackoutAdfCode = 0 Then
                If imCurrentAdvtIndex <> imAdvtIndex Then
                    'Screen.MousePointer = vbHourglass  'Wait
                    gSetMousePointer grdRot, grdRot, vbHourglass
                    mInvPop
                    'Screen.MousePointer = vbDefault  'Wait
                    gSetMousePointer grdRot, grdRot, vbDefault
                End If
            End If
            slStr = grdRot.Text
            If slStr = "Missing" Then
                slStr = ""
            End If
            For llRow = grdCopy.FixedRows To grdCopy.rows - 1 Step 1
                grdCopy.TextMatrix(llRow, REPEATINDEX) = ""
            Next llRow
            slFields = Split(slStr, "; ")
            If IsArray(slFields) Then
                For ilLoop = 0 To UBound(slFields) Step 1
                    ilRepeat = 1
                    ilPos = InStr(1, slFields(ilLoop), "(", vbTextCompare)
                    If ilPos > 0 Then
                        slCopy = Left$(slFields(ilLoop), ilPos - 1)
                        slStr = Mid(slFields(ilLoop), ilPos + 1)
                        ilRepeat = Val(Left$(slStr, Len(slStr) - 1))
                    Else
                        slCopy = slFields(ilLoop)
                    End If
                    For llRow = grdCopy.FixedRows To grdCopy.rows - 1 Step 1
                        If (slCopy = grdCopy.TextMatrix(llRow, CARTINDEX)) Or (slCopy = grdCopy.TextMatrix(llRow, ISCIINDEX)) Then
                            grdCopy.TextMatrix(llRow, REPEATINDEX) = ilRepeat
                            Exit For
                        End If
                    Next llRow
                Next ilLoop
            End If
        Case RGCOMMENTINDEX
            edcRGComment.MaxLength = 5000
            imChgMode = True
            If Trim$(smRGComment(grdRot.Row)) = "" Then
                smRGComment(grdRot.Row) = smComment
            End If
            edcRGComment.Text = Trim$(smRGComment(grdRot.Row))
            imChgMode = False
    End Select
    mRGSetFocus
End Sub

'*******************************************************
'*                                                     *
'*      Procedure Name:mSetFocus                       *
'*                                                     *
'*             Created:6/28/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Set focus to specified control *
'*                                                     *
'*******************************************************
Private Sub mRGSetFocus()
'
'   mSetFocus ilBoxNo
'   Where:
'       ilBoxNo (I)- Number of the Control to be enabled
'
    Dim llColPos As Long
    Dim ilCol As Integer

    If (grdRot.Row < grdRot.FixedRows) Or (grdRot.Row >= grdRot.rows) Or (grdRot.Col < grdRot.FixedCols) Or (grdRot.Col >= grdRot.cols - 1) Then
        Exit Sub
    End If
    imcTrash.Visible = True
    imcTrash.Enabled = True
    imRGCtrlVisible = True
    pbcArrow.Visible = False
    pbcArrow.Move grdRot.Left - pbcArrow.Width - 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + (grdRot.rowHeight(grdRot.Row) - pbcArrow.height) / 2
    pbcArrow.Visible = True
    llColPos = 0
    For ilCol = 0 To grdRot.Col - 1 Step 1
        llColPos = llColPos + grdRot.ColWidth(ilCol)
    Next ilCol
    Select Case grdRot.Col
        Case RGVEHICLEINDEX
            edcRGDropdown.Move grdRot.Left + llColPos + 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + 30, grdRot.ColWidth(grdRot.Col) - 30, grdRot.rowHeight(grdRot.Row) - 15
            'cmcRGDropdown.Move edcRGDropdown.Left + edcRGDropdown.Width, edcRGDropdown.Top
            lbcRGVehicle.height = gListBoxHeight(lbcRGVehicle.ListCount, 10)
            If edcRGDropdown.Top + edcRGDropdown.height + lbcRGVehicle.height > cmcDone.Top Then
                lbcRGVehicle.Move edcRGDropdown.Left, edcRGDropdown.Top - lbcRGVehicle.height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            Else
                lbcRGVehicle.Move edcRGDropdown.Left, edcRGDropdown.Top + edcRGDropdown.height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            End If
            edcRGDropdown.Visible = True
            'cmcRGDropdown.Visible = True
            lbcRGVehicle.Visible = True
            edcRGDropdown.SetFocus
        Case REGIONNAMEINDEX
            edcRGDropdown.Move grdRot.Left + llColPos + 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + 30, grdRot.ColWidth(grdRot.Col) - 30, grdRot.rowHeight(grdRot.Row) - 15
            cmcRGDropdown.Move edcRGDropdown.Left + edcRGDropdown.Width, edcRGDropdown.Top
            lbcRGRegion.height = gListBoxHeight(lbcRGRegion.ListCount, 10)
            If edcRGDropdown.Top + edcRGDropdown.height + lbcRGRegion.height > cmcDone.Top Then
                lbcRGRegion.Move edcRGDropdown.Left, edcRGDropdown.Top - lbcRGRegion.height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            Else
                lbcRGRegion.Move edcRGDropdown.Left, edcRGDropdown.Top + edcRGDropdown.height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            End If
            edcRGDropdown.Visible = True
            cmcRGDropdown.Visible = True
            lbcRGRegion.Visible = True
            edcRGDropdown.SetFocus
        Case CATEGORYINDEX
            edcRGDropdown.Move grdRot.Left + llColPos + 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + 30, grdRot.ColWidth(grdRot.Col) - 30, grdRot.rowHeight(grdRot.Row) - 15
            cmcRGDropdown.Move edcRGDropdown.Left + edcRGDropdown.Width, edcRGDropdown.Top
            lbcRGCategory.height = gListBoxHeight(lbcRGCategory.ListCount, 10)
            If edcRGDropdown.Top + edcRGDropdown.height + lbcRGCategory.height > cmcDone.Top Then
                lbcRGCategory.Move edcRGDropdown.Left, edcRGDropdown.Top - lbcRGCategory.height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            Else
                lbcRGCategory.Move edcRGDropdown.Left, edcRGDropdown.Top + edcRGDropdown.height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            End If
            edcRGDropdown.Visible = True
            cmcRGDropdown.Visible = True
            lbcRGCategory.Visible = True
            edcRGDropdown.SetFocus
        Case SELECTIONINDEX
            'edcRGMultiSelect.Move grdRot.Left + llColPos + 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + 30, grdRot.ColWidth(grdRot.Col) - 30, grdRot.RowHeight(grdRot.Row) - 15
            'lbcRGSelection(imRGSelection).Height = gListBoxHeight(lbcRGSelection(imRGSelection).ListCount, 10)
            'If edcRGMultiSelect.Top + edcRGMultiSelect.Height + lbcRGSelection(imRGSelection).Height > cmcDone.Top Then
            '    lbcRGSelection(imRGSelection).Move edcRGMultiSelect.Left, edcRGMultiSelect.Top - lbcRGSelection(imRGSelection).Height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            'Else
            '    lbcRGSelection(imRGSelection).Move edcRGMultiSelect.Left, edcRGMultiSelect.Top + edcRGMultiSelect.Height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            'End If
            'edcRGMultiSelect.Visible = True
            'lbcRGSelection(imRGSelection).Visible = True
            'lbcRGSelection(imRGSelection).SetFocus
            edcRGDropdown.Move grdRot.Left + llColPos + 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + 30, grdRot.ColWidth(grdRot.Col) - 30, grdRot.rowHeight(grdRot.Row) - 15
            If lbcRGSelection(imRGSelection).ListCount > 0 Then
                lbcRGSelection(imRGSelection).height = gListBoxHeight(lbcRGSelection(imRGSelection).ListCount, 10)
            End If
            If edcRGDropdown.Top + edcRGDropdown.height + lbcRGSelection(imRGSelection).height > cmcDone.Top Then
                lbcRGSelection(imRGSelection).Move edcRGDropdown.Left, edcRGDropdown.Top - lbcRGSelection(imRGSelection).height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            Else
                lbcRGSelection(imRGSelection).Move edcRGDropdown.Left, edcRGDropdown.Top + edcRGDropdown.height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            End If
            edcRGDropdown.Visible = True
            lbcRGSelection(imRGSelection).Visible = True
            'lbcRGSelection(imRGSelection).SetFocus
            edcRGDropdown.SetFocus
        Case INCLEXCLINDEX
            pbcRGInclExcl.Move grdRot.Left + llColPos + 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + 30, grdRot.ColWidth(grdRot.Col) - 30, grdRot.rowHeight(grdRot.Row) - 15
            pbcRGInclExcl.Visible = True
            pbcRGInclExcl.SetFocus
        Case FORMATINDEX
            'edcRGMultiSelect.Move grdRot.Left + llColPos + 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + 30, grdRot.ColWidth(grdRot.Col) - 30, grdRot.RowHeight(grdRot.Row) - 15
            'lbcRGSelection(imRGSelection).Height = gListBoxHeight(lbcRGSelection(imRGSelection).ListCount, 10)
            'If edcRGMultiSelect.Top + edcRGMultiSelect.Height + lbcRGSelection(imRGSelection).Height > cmcDone.Top Then
            '    lbcRGSelection(imRGSelection).Move edcRGMultiSelect.Left, edcRGMultiSelect.Top - lbcRGSelection(imRGSelection).Height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            'Else
            '    lbcRGSelection(imRGSelection).Move edcRGMultiSelect.Left, edcRGMultiSelect.Top + edcRGMultiSelect.Height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            'End If
            'edcRGMultiSelect.Visible = True
            'lbcRGSelection(imRGSelection).Visible = True
            'lbcRGSelection(imRGSelection).SetFocus
            edcRGDropdown.Move grdRot.Left + llColPos + 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + 30, grdRot.ColWidth(grdRot.Col) - 30, grdRot.rowHeight(grdRot.Row) - 15
            lbcRGSelection(imRGSelection).height = gListBoxHeight(lbcRGSelection(imRGSelection).ListCount, 10)
            If edcRGDropdown.Top + edcRGDropdown.height + lbcRGSelection(imRGSelection).height > cmcDone.Top Then
                lbcRGSelection(imRGSelection).Move edcRGDropdown.Left, edcRGDropdown.Top - lbcRGSelection(imRGSelection).height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            Else
                lbcRGSelection(imRGSelection).Move edcRGDropdown.Left, edcRGDropdown.Top + edcRGDropdown.height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            End If
            edcRGDropdown.Visible = True
            lbcRGSelection(imRGSelection).Visible = True
            'lbcRGSelection(imRGSelection).SetFocus
            edcRGDropdown.SetFocus
        Case ADVTINDEX
            edcRGDropdown.Move grdRot.Left + llColPos + 30, grdRot.Top + grdRot.RowPos(grdRot.Row) + 30, grdRot.ColWidth(grdRot.Col) - 30, grdRot.rowHeight(grdRot.Row) - 15
            cmcRGDropdown.Move edcRGDropdown.Left + edcRGDropdown.Width, edcRGDropdown.Top
            lbcRGAdvt.height = gListBoxHeight(lbcRGAdvt.ListCount, 10)
            If edcRGDropdown.Top + edcRGDropdown.height + lbcRGRegion.height > cmcDone.Top Then
                lbcRGAdvt.Move edcRGDropdown.Left, edcRGDropdown.Top - lbcRGAdvt.height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            Else
                lbcRGAdvt.Move edcRGDropdown.Left, edcRGDropdown.Top + edcRGDropdown.height, 2 * grdRot.ColWidth(grdRot.Col) - 30
            End If
            edcRGDropdown.Visible = True
            cmcRGDropdown.Visible = True
            lbcRGAdvt.Visible = True
            edcRGDropdown.SetFocus
        Case COPYINDEX
            'TTP 10728 Begin
            If grdCopy.height + picISCI_Filter.height + edcGridHelp.height + grdRot.Top + grdRot.RowPos(grdRot.Row) + 30 > cmcDone.Top Then
                picISCI_Filter.Move grdRot.Left + grdRot.Width - picISCI_Filter.Width - GRIDSCROLLWIDTH, grdRot.Top + 30 'grdRot.RowPos(grdRot.Row) + grdRot.rowHeight(grdRot.Row) - picISCI_Filter.height - edcGridHelp.height
                grdCopy.Move grdRot.Left + grdRot.Width - grdCopy.Width - GRIDSCROLLWIDTH, picISCI_Filter.Top + picISCI_Filter.height - 10
            Else
                picISCI_Filter.Move grdRot.Left + grdRot.Width - picISCI_Filter.Width - GRIDSCROLLWIDTH, grdRot.Top + 30 'grdRot.RowPos(grdRot.Row) + 30
                grdCopy.Move grdRot.Left + grdRot.Width - grdCopy.Width - GRIDSCROLLWIDTH, picISCI_Filter.Top + picISCI_Filter.height - 10
            'TTP 10728 end
            
                'edcGridHelp.Width = grdCopy.Width
                'edcGridHelp.Left = grdCopy.Left
                'edcGridHelp.Top = grdCopy.Top + grdCopy.Height
                'edcGridHelp.Text = "To Exit, enter any Non-numeric character" & sgCR & sgLF & "! indicates that Copy Product does not match Contract Product"
                'edcGridHelp.Visible = True
                'edcGridTotal.Width = grdCopy.Width - edcGridHelp.Width - 30
                'edcGridTotal.Left = edcGridHelp.Left + edcGridHelp.Width + 15
                'edcGridTotal.Top = edcGridHelp.Top
                'edcGridTotal.Text = "Total: " & sgCR & sgLF
                'edcGridTotal.Visible = True
            End If
            grdCopy.Col = REPEATINDEX
            edcGridHelp.Width = grdCopy.CellLeft - 15
            edcGridHelp.Left = grdCopy.Left
            edcGridHelp.Top = grdCopy.Top + grdCopy.height
            edcGridHelp.Text = "To Exit, enter any Non-numeric character" & sgCR & sgLF & "! indicates that Copy Product does not match Contract Product"
            edcGridHelp.Visible = True
            edcGridTotal.Width = grdCopy.Width - edcGridHelp.Width - 240
            edcGridTotal.Left = edcGridHelp.Left + edcGridHelp.Width - 10
            edcGridTotal.Top = edcGridHelp.Top
            edcGridTotal.Visible = True
            mComputeGridCopyTotal
            grdCopy.Visible = True
            picISCI_Filter.Visible = True 'TTP 10728
            mChangeFilter
            pbcCGSTab.Enabled = True
            pbcCGTab.Enabled = True
            pbcCGSTab.SetFocus
        Case RGCOMMENTINDEX
            If edcRGComment.Top + edcRGComment.height > cmcDone.Top Then
                edcRGComment.Move grdRot.Left + grdRot.Width - edcRGComment.Width - GRIDSCROLLWIDTH, grdRot.Top + grdRot.RowPos(grdRot.Row) + grdRot.rowHeight(grdRot.Row) - edcRGComment.height
            Else
                edcRGComment.Move grdRot.Left + grdRot.Width - edcRGComment.Width - GRIDSCROLLWIDTH, grdRot.Top + grdRot.RowPos(grdRot.Row) + 30
            End If
            edcRGComment.Visible = True
            edcRGComment.SetFocus
    End Select
    mSetCommands
End Sub

'*******************************************************
'*                                                     *
'*      Procedure Name:mSetShow                        *
'*                                                     *
'*             Created:6/30/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Format user input for a control*
'*                      to be displayed on the form    *
'*                                                     *
'*******************************************************
Private Sub mRGSetShow()

'
'   mSetShow ilBoxNo
'   Where:
'       ilBoxNo (I)- Number of the Control whose value should be saved
'
    Dim slStr As String
    Dim slShow As String
    Dim ilLoop As Integer
    Dim ilRet As Integer
    Dim llSvRow As Long
    Dim ilSvCol As Integer
    Dim slTip As String
    Dim slRegionName As String
    Dim blSaveToWork As Boolean

    pbcArrow.Visible = False
    blSaveToWork = False
    If (lmRGEnableRow >= grdRot.FixedRows) And (lmRGEnableRow < grdRot.rows) Then
        'Set any field that that should only be set after user leaves the cell
        Select Case lmRGEnableCol
            Case RGVEHICLEINDEX
                edcRGMultiSelect.Visible = False  'Set visibility
                edcRGDropdown.Visible = False  'Set visibility
                lbcRGVehicle.Visible = False
                slStr = ""
                For ilLoop = 0 To lbcRGVehicle.ListCount - 1 Step 1
                    If lbcRGVehicle.Selected(ilLoop) Then
                        If slStr = "" Then
                            slStr = lbcRGVehicle.List(ilLoop)
                        Else
                            slStr = slStr & "; " & lbcRGVehicle.List(ilLoop)
                        End If
                    End If
                Next ilLoop
                If StrComp(grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol), slStr, vbTextCompare) <> 0 Then
                    imRotHeaderChgOnly = False
                    blSaveToWork = True
                End If
                grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = slStr
            Case REGIONNAMEINDEX
                edcRGDropdown.Visible = False  'Set visibility
                cmcRGDropdown.Visible = False
                lbcRGRegion.Visible = False
                slStr = edcRGDropdown.Text
                'ilSvCol = grdRot.Col
                'For ilLoop = CATEGORYINDEX To FORMATINDEX Step 1
                '    grdRot.Col = ilLoop
                '    grdRot.CellBackColor = WHITE
                '    grdRot.TextMatrix(lmRGEnableRow, ilLoop) = ""
                'Next ilLoop
                'grdRot.Col = ilSvCol
                slRegionName = grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol)
                If lbcRGRegion.ListIndex = 0 Then   'Generic
                    ilSvCol = grdRot.Col
                    llSvRow = grdRot.Row
                    grdRot.Row = lmRGEnableRow
                    For ilLoop = CATEGORYINDEX To ADVTINDEX Step 1
                        grdRot.Col = ilLoop
                        grdRot.CellBackColor = LIGHTYELLOW
                        grdRot.CellForeColor = BLACK
                        grdRot.TextMatrix(lmRGEnableRow, ilLoop) = ""
                    Next ilLoop
                    grdRot.Col = ilSvCol
                    grdRot.Row = llSvRow
                    If grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) <> "Generic" Then
                        blSaveToWork = True
                        '1/17/14: Clear cell color
                        If (imBlackoutAdfCode > 0) And (lbcRGRegion.ListIndex = 0) Then
                            imBlackoutAdfCode = 0
                            lbcRGAdvt.ListIndex = -1
                            ilSvCol = grdRot.Col
                            For ilLoop = 0 To grdRot.cols - 1 Step 1
                                grdRot.Col = ilLoop
                                If grdRot.CellBackColor <> LIGHTYELLOW Then
                                    If (lbcRGAdvt.ListIndex <= 0) Then
                                        grdRot.CellBackColor = WHITE
                                        grdRot.CellForeColor = BLACK
                                    Else
                                        grdRot.CellBackColor = BLACK
                                        grdRot.CellForeColor = WHITE
                                    End If
                                End If
                            Next ilLoop
                            grdRot.Col = ilSvCol
                        End If
                    End If
                    grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = "Generic"
                    slRegionName = grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol)
                ElseIf lbcRGRegion.ListIndex = 1 Then   'Model
                    bmBypassGridSave = True
                    ilRet = mReadRecRaf(lgSplitModelCodeRaf, True)
                    bmBypassGridSave = False
                    blSaveToWork = True
                ElseIf lbcRGRegion.ListIndex > 1 And lgSplitModelCodeRaf > 0 Then   'Region
                    If lgSplitModelCodeRaf <> lbcRGRegion.ItemData(lbcRGRegion.ListIndex) Then
                        For ilLoop = 0 To lbcRGRegion.ListCount - 1 Step 1
                            If lgSplitModelCodeRaf = lbcRGRegion.ItemData(ilLoop) Then
                                lbcRGRegion.ListIndex = ilLoop
                                Exit For
                            End If
                        Next ilLoop
                    End If
                    bmBypassGridSave = True
                    ilRet = mReadRecRaf(lbcRGRegion.ItemData(lbcRGRegion.ListIndex), False)
                    bmBypassGridSave = False
                    blSaveToWork = True
                '6/4/19: Handle case where region existed
                ElseIf lbcRGRegion.ListIndex > 1 Then    'Region
                    If lbcRGRegion.ItemData(lbcRGRegion.ListIndex) <= 0 Then
                        grdRot.TextMatrix(lmRGEnableRow, RAFCODEINDEX) = 0
                        grdRot.TextMatrix(lmRGEnableRow, STATUSINDEX) = "N"
                    End If
                    If StrComp(grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol), slStr, vbTextCompare) <> 0 Then
                        imRotHeaderChgOnly = False
                        blSaveToWork = True
                    End If
                    grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = slStr
                Else
                    grdRot.TextMatrix(lmRGEnableRow, RAFCODEINDEX) = 0
                    grdRot.TextMatrix(lmRGEnableRow, STATUSINDEX) = "N"
                    If StrComp(grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol), slStr, vbTextCompare) <> 0 Then
                        imRotHeaderChgOnly = False
                        blSaveToWork = True
                    End If
                    grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = slStr
                End If
                If (lmRGEnableRow > grdRot.FixedRows) And (slRegionName <> grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol)) Then
                    ilSvCol = grdRot.Col
                    llSvRow = grdRot.Row
                    grdRot.Row = lmRGEnableRow
                    For ilLoop = CATEGORYINDEX To FORMATINDEX Step 1
                        grdRot.Col = ilLoop
                        If (lbcRGRegion.ListIndex < 0) Then
                            If grdRot.TextMatrix(lmRGEnableRow, ADVTINDEX) = "" Then
                                grdRot.CellBackColor = WHITE
                                grdRot.CellForeColor = BLACK
                            Else
                                grdRot.CellBackColor = BLACK
                                grdRot.CellForeColor = WHITE
                            End If
                        Else
                            grdRot.CellBackColor = LIGHTYELLOW
                            grdRot.TextMatrix(lmRGEnableRow, ilLoop) = ""
                        End If
                    Next ilLoop
                    grdRot.Col = ilSvCol
                    grdRot.Row = llSvRow
                    blSaveToWork = True
                End If
            Case CATEGORYINDEX
                edcRGDropdown.Visible = False  'Set visibility
                cmcRGDropdown.Visible = False
                lbcRGCategory.Visible = False
                slStr = edcRGDropdown.Text
                If StrComp(grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol), slStr, vbTextCompare) <> 0 Then
                    imRotHeaderChgOnly = False
                    blSaveToWork = True
                End If
                If slStr = "[None]" Then
                    slStr = ""
                End If
                grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = slStr
            Case SELECTIONINDEX
                edcRGMultiSelect.Visible = False  'Set visibility
                edcRGDropdown.Visible = False  'Set visibility
                lbcRGSelection(imRGSelection).Visible = False
                slStr = ""
                For ilLoop = 0 To lbcRGSelection(imRGSelection).ListCount - 1 Step 1
                    If lbcRGSelection(imRGSelection).Selected(ilLoop) Then
                        If slStr = "" Then
                            slStr = lbcRGSelection(imRGSelection).List(ilLoop)
                        Else
                            slStr = slStr & "; " & lbcRGSelection(imRGSelection).List(ilLoop)
                        End If
                    End If
                Next ilLoop
                If StrComp(grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol), slStr, vbTextCompare) <> 0 Then
                    imRotHeaderChgOnly = False
                    blSaveToWork = True
                End If
                grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = slStr
            Case INCLEXCLINDEX
                pbcRGInclExcl.Visible = False
                If smRGInclExcl = "None" Then
                    smRGInclExcl = ""
                End If
                If grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) <> smRGInclExcl Then
                    imRotHeaderChgOnly = False
                    blSaveToWork = True
                End If
                grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = smRGInclExcl
                If smRGInclExcl = "" Then
                    imRGSelection = 1
                    For ilLoop = 0 To lbcRGSelection(imRGSelection).ListCount - 1 Step 1
                        If lbcRGSelection(imRGSelection).Selected(ilLoop) Then
                            lbcRGSelection(imRGSelection).Selected(ilLoop) = False
                        End If
                    Next ilLoop
                    grdRot.TextMatrix(lmRGEnableRow, FORMATINDEX) = ""
                End If
            Case FORMATINDEX
                edcRGMultiSelect.Visible = False  'Set visibility
                edcRGDropdown.Visible = False  'Set visibility
                lbcRGSelection(imRGSelection).Visible = False
                slStr = ""
                For ilLoop = 0 To lbcRGSelection(imRGSelection).ListCount - 1 Step 1
                    If lbcRGSelection(imRGSelection).Selected(ilLoop) Then
                        If slStr = "" Then
                            slStr = lbcRGSelection(imRGSelection).List(ilLoop)
                        Else
                            slStr = slStr & "; " & lbcRGSelection(imRGSelection).List(ilLoop)
                        End If
                    End If
                Next ilLoop
                If StrComp(grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol), slStr, vbTextCompare) <> 0 Then
                    imRotHeaderChgOnly = False
                    blSaveToWork = True
                End If
                If slStr = "[None]" Then
                    slStr = ""
                End If
                grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = slStr
            Case ADVTINDEX
                edcRGDropdown.Visible = False  'Set visibility
                cmcRGDropdown.Visible = False
                lbcRGAdvt.Visible = False
                slStr = edcRGDropdown.Text
                If StrComp(grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol), slStr, vbTextCompare) <> 0 Then
                    imRotHeaderChgOnly = False
                    imBlackoutAdfCode = 0
                    For ilLoop = 0 To lbcRGAdvt.ListCount - 1 Step 1
                        If slStr = lbcRGAdvt.List(ilLoop) Then
                            imBlackoutAdfCode = lbcRGAdvt.ItemData(ilLoop)
                            Exit For
                        End If
                    Next ilLoop
                    'Screen.MousePointer = vbHourglass  'Wait
                    gSetMousePointer grdRot, grdRot, vbHourglass
                    mInvPop
                    '5/22/13: Remove copy as advertiser changed
                    grdRot.TextMatrix(lmRGEnableRow, COPYINDEX) = ""
                    'Screen.MousePointer = vbDefault  'Wait
                    gSetMousePointer grdRot, grdRot, vbDefault
                End If
                If slStr = "[None]" Then
                    slStr = ""
                End If
                If grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) <> slStr Then
                    blSaveToWork = True
                End If
                grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = slStr
                If lmRGEnableRow > grdRot.FixedRows Then
                    ilSvCol = grdRot.Col
                    For ilLoop = 0 To grdRot.cols - 1 Step 1
                        grdRot.Col = ilLoop
                        If grdRot.CellBackColor <> LIGHTYELLOW Then
                            If (lbcRGAdvt.ListIndex <= 0) Then
                                grdRot.CellBackColor = WHITE
                                grdRot.CellForeColor = BLACK
                            Else
                                grdRot.CellBackColor = BLACK
                                grdRot.CellForeColor = WHITE
                            End If
                        End If
                    Next ilLoop
                    grdRot.Col = ilSvCol
                End If
            Case COPYINDEX
                grdCopy.Visible = False
                picISCI_Filter.Visible = False  'TTP 10728
                txtISCI_Filter.Text = ""        'TTP 10728
                edcCGDropdown.Visible = False
                edcGridHelp.Visible = False
                edcGridTotal.Visible = False
                pbcCGSTab.Enabled = False
                pbcCGTab.Enabled = False
                slStr = ""
                slTip = ""
                For ilLoop = grdCopy.FixedRows To grdCopy.rows - 1 Step 1
                    If (grdCopy.TextMatrix(ilLoop, REPEATINDEX) <> "") Then
                        If Val(grdCopy.TextMatrix(ilLoop, REPEATINDEX)) > 0 Then
                            If grdCopy.TextMatrix(ilLoop, ISCIINDEX) <> "" Then
                                slShow = grdCopy.TextMatrix(ilLoop, ISCIINDEX)
                            Else
                                slShow = grdCopy.TextMatrix(ilLoop, CARTINDEX)
                            End If
                            If Val(grdCopy.TextMatrix(ilLoop, REPEATINDEX)) > 1 Then
                                slShow = slShow & "(" & grdCopy.TextMatrix(ilLoop, REPEATINDEX) & ")"
                            End If
                            If slStr = "" Then
                                slStr = slShow
                            Else
                                slStr = slStr & "; " & slShow
                            End If
                            If grdCopy.TextMatrix(ilLoop, ISCIINDEX) <> "" Then
                                If grdCopy.TextMatrix(ilLoop, CARTINDEX) <> "" Then
                                    slShow = grdCopy.TextMatrix(ilLoop, CARTINDEX) & ":" & slShow
                                End If
                            End If
                            If slTip = "" Then
                                slTip = slShow
                            Else
                                slTip = slTip & "; " & slShow
                            End If
                        End If
                    End If
                Next ilLoop
                If grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) <> slStr Then
                    imRotHeaderChgOnly = False
                    blSaveToWork = True
                End If
                grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = slStr
                grdRot.TextMatrix(lmRGEnableRow, COPYTIPINDEX) = slTip
            Case RGCOMMENTINDEX
                If Trim$(edcRGComment.Text) <> "" Then
                    grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = "C"
                Else
                    grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = ""
                End If
                If smRGComment(lmRGEnableRow) <> Trim$(edcRGComment.Text) Then
                    imRotHeaderChgOnly = False
                    blSaveToWork = True
                End If
                smRGComment(lmRGEnableRow) = Trim$(edcRGComment.Text)
                edcRGComment.Visible = False
                smRGSource = ""
        End Select
    End If
    If lmRGEnableRow >= grdRot.FixedRows Then
        If (blSaveToWork) And (Not bmInCmcGrid) And (Not bmBypassGridSave) Then
            ilRet = mGridSaved(lmRGEnableRow, True)
        End If
    End If
    imcTrash.Visible = False
    imcTrash.Enabled = False
    pbcArrow.Visible = False
    lmRGEnableRow = -1
    lmRGEnableCol = -1
    imRGCtrlVisible = False
    mSetCommands
End Sub

Private Sub mPopFormats()
    Dim ilRet As Integer

    ilRet = gObtainFormats()
    'mPopFrom "Format"
End Sub

Private Sub mPopDMAMarkets()
    Dim ilRet As Integer

    ilRet = gObtainMarkets()
End Sub

Private Sub mPopMSAMarkets()
    Dim ilRet As Integer
    
    ilRet = gObtainMSAMarkets()
    'mPopFrom "MSA Market"
End Sub

Private Sub mPopStates()
    Dim ilRet As Integer

    ilRet = gObtainStates()
    'mPopFrom "State Name"
End Sub

Private Sub mPopTimeZones()
    Dim ilRet As Integer

    ilRet = gObtainTimeZones()
    'mPopFrom "Time Zone"
End Sub
Private Function mRGColOk() As Integer

    If Not imUpdateAllowed Then
        mRGColOk = False
    Else
        mRGColOk = True
        If grdRot.CellBackColor = LIGHTYELLOW Then
            mRGColOk = False
            Exit Function
        End If
    End If
End Function

Private Sub mClearRG()
    Dim llRow As Long
    Dim llCol As Long
    ReDim smRGComment(0 To 0)
    For llRow = grdRot.FixedRows To grdRot.rows - 1 Step 1
        grdRot.Row = llRow
        For llCol = 0 To grdRot.cols - 1 Step 1
            grdRot.TextMatrix(llRow, llCol) = ""
            grdRot.Col = llCol
            If llRow = grdRot.FixedRows Then
                If (llCol > RGVEHICLEINDEX) And (llCol < COPYINDEX) Then
                    grdRot.CellBackColor = LIGHTYELLOW
                    If llCol = REGIONNAMEINDEX Then
                        grdRot.TextMatrix(llRow, llCol) = "Generic"
                    End If
                Else
                    grdRot.CellBackColor = WHITE
                    grdRot.CellForeColor = BLACK
                End If
            Else
                grdRot.CellBackColor = WHITE
                grdRot.CellForeColor = BLACK
            End If
        Next llCol
    Next llRow
End Sub

Private Sub mPopRGCategory(slCategory As String)
'******************************************************************************************
'* Note: VBC id'd the following unreferenced items and handled them as described:         *
'*                                                                                        *
'* Local Variables (Removed)                                                              *
'*  ilOwner                       ilShtt                        slState                   *
'*  slZipCode                                                                             *
'******************************************************************************************

    Dim ilMkt As Integer
    Dim ilFmt As Integer
    Dim ilTzt As Integer
    Dim ilSnt As Integer
    Dim ilShtt As Integer
    Dim ilRet As Integer

    imRGSelection = -1
    If (StrComp(slCategory, "DMA Market", vbTextCompare) = 0) Then
        imRGSelection = 0
        If (lbcRGSelection(0).ListCount = 0) Then
            For ilMkt = LBound(tgMarkets) To UBound(tgMarkets) - 1 Step 1
                lbcRGSelection(0).AddItem Trim$(tgMarkets(ilMkt).sName)
                lbcRGSelection(0).ItemData(lbcRGSelection(0).NewIndex) = tgMarkets(ilMkt).iCode
            Next ilMkt
        End If
    ElseIf (StrComp(slCategory, "MSA Market", vbTextCompare) = 0) Then
        If (Asc(tgSpf.sUsingFeatures8) And ALLOWMSASPLITCOPY) = ALLOWMSASPLITCOPY Then
            imRGSelection = 2
            If (lbcRGSelection(2).ListCount = 0) Then
                For ilMkt = LBound(tgMSAMarkets) To UBound(tgMSAMarkets) - 1 Step 1
                    lbcRGSelection(2).AddItem Trim$(tgMSAMarkets(ilMkt).sName)
                    lbcRGSelection(2).ItemData(lbcRGSelection(2).NewIndex) = tgMSAMarkets(ilMkt).iCode
                Next ilMkt
            End If
        End If
    ElseIf (StrComp(slCategory, "State Name", vbTextCompare) = 0) Then
        imRGSelection = 3
        If (lbcRGSelection(3).ListCount = 0) Then
            For ilSnt = LBound(tgStates) To UBound(tgStates) - 1 Step 1
                lbcRGSelection(3).AddItem Trim$(tgStates(ilSnt).sPostalName) & " (" & Trim$(tgStates(ilSnt).sName) & ")"
                lbcRGSelection(3).ItemData(lbcRGSelection(3).NewIndex) = tgStates(ilSnt).iCode  'ilSnt
            Next ilSnt
        End If
    ElseIf (StrComp(slCategory, "Format", vbTextCompare) = 0) Then
        imRGSelection = 1
        If (lbcRGSelection(1).ListCount = 0) Then
            For ilFmt = LBound(tgFormats) To UBound(tgFormats) - 1 Step 1
                lbcRGSelection(1).AddItem Trim$(tgFormats(ilFmt).sName)
                lbcRGSelection(1).ItemData(lbcRGSelection(1).NewIndex) = tgFormats(ilFmt).iCode
            Next ilFmt
            lbcRGSelection(1).AddItem "[None]", 0
            lbcRGSelection(1).ItemData(lbcRGSelection(1).NewIndex) = 0
        End If
    ElseIf (StrComp(slCategory, "Time Zone", vbTextCompare) = 0) Then
        imRGSelection = 5
        If (lbcRGSelection(5).ListCount = 0) Then
            For ilTzt = LBound(tgTimeZones) To UBound(tgTimeZones) - 1 Step 1
                Select Case Left$(Trim$(tgTimeZones(ilTzt).sCSIName), 1)
                    Case "E"
                        lbcRGSelection(5).AddItem Trim$(tgTimeZones(ilTzt).sName) & " (ETZ)"
                        lbcRGSelection(5).ItemData(lbcRGSelection(5).NewIndex) = tgTimeZones(ilTzt).iCode
                    Case "C"
                        lbcRGSelection(5).AddItem Trim$(tgTimeZones(ilTzt).sName) & " (CTZ)"
                        lbcRGSelection(5).ItemData(lbcRGSelection(5).NewIndex) = tgTimeZones(ilTzt).iCode
                    Case "M"
                        lbcRGSelection(5).AddItem Trim$(tgTimeZones(ilTzt).sName) & " (MTZ)"
                        lbcRGSelection(5).ItemData(lbcRGSelection(5).NewIndex) = tgTimeZones(ilTzt).iCode
                    Case "P"
                        lbcRGSelection(5).AddItem Trim$(tgTimeZones(ilTzt).sName) & " (PTZ)"
                        lbcRGSelection(5).ItemData(lbcRGSelection(5).NewIndex) = tgTimeZones(ilTzt).iCode
                End Select
            Next ilTzt
        End If
    ElseIf (StrComp(slCategory, "Station", vbTextCompare) = 0) Then
        imRGSelection = 4
        If (lbcRGSelection(4).ListCount = 0) Then
            ilRet = gObtainStations()
            For ilShtt = LBound(tgStations) To UBound(tgStations) - 1 Step 1
                lbcRGSelection(4).AddItem Trim$(tgStations(ilShtt).sCallLetters)
                lbcRGSelection(4).ItemData(lbcRGSelection(4).NewIndex) = tgStations(ilShtt).iCode
            Next ilShtt
        End If
    End If
End Sub


Private Sub mPopCategory()
    lbcRGCategory.Clear
    '11/8/14: only allow stations
    If (Asc(tgSpf.sUsingFeatures5) And REMOTEEXPORT) = REMOTEEXPORT Then
        lbcRGCategory.AddItem "Station"
        lbcRGCategory.ItemData(lbcRGCategory.NewIndex) = 4
        lbcRGCategory.AddItem "[None]", 0
        lbcRGCategory.ItemData(lbcRGCategory.NewIndex) = -1
    Else
        lbcRGCategory.AddItem "DMA Market"
        lbcRGCategory.ItemData(lbcRGCategory.NewIndex) = 0
        'lbcRGCategory.AddItem "Format"
        'lbcRGCategory.ItemData(lbcRGCategory.NewIndex) = 1
        If (Asc(tgSpf.sUsingFeatures8) And ALLOWMSASPLITCOPY) = ALLOWMSASPLITCOPY Then
            lbcRGCategory.AddItem "MSA Market"
            lbcRGCategory.ItemData(lbcRGCategory.NewIndex) = 2
        End If
        lbcRGCategory.AddItem "State Name"
        lbcRGCategory.ItemData(lbcRGCategory.NewIndex) = 3
        lbcRGCategory.AddItem "Station"
        lbcRGCategory.ItemData(lbcRGCategory.NewIndex) = 4
        lbcRGCategory.AddItem "Time Zone"
        lbcRGCategory.ItemData(lbcRGCategory.NewIndex) = 5
        lbcRGCategory.AddItem "[None]", 0
        lbcRGCategory.ItemData(lbcRGCategory.NewIndex) = -1
    End If
End Sub

Private Sub mCGLayout()
    Dim ilCol As Integer
    Dim ilRow As Integer

    For ilRow = 0 To grdCopy.rows - 1 Step 1
        grdCopy.rowHeight(ilRow) = fgFlexGridRowH
    Next ilRow
    For ilCol = 0 To grdCopy.cols - 1 Step 1
        grdCopy.ColAlignment(ilCol) = flexAlignLeftCenter
    Next ilCol
End Sub

Private Sub mCGColumnTitles()
    'Set column titles
    grdCopy.Row = 0
    grdCopy.Col = PRODUCTINDEX
    grdCopy.CellBackColor = LIGHTBLUE
    grdCopy.TextMatrix(0, PRODUCTINDEX) = "Product"
    grdCopy.Col = CREATIVETITLEINDEX
    grdCopy.CellBackColor = LIGHTBLUE
    grdCopy.TextMatrix(0, CREATIVETITLEINDEX) = "Creative Title"
    grdCopy.Col = CREATEDDATEINDEX
    'grdCopy.CellBackColor = LIGHTBLUE
    grdCopy.TextMatrix(0, CREATEDDATEINDEX) = "Entered Date"
    grdCopy.Col = ROTATIONDATEINDEX
    'grdCopy.CellBackColor = LIGHTBLUE
    grdCopy.TextMatrix(0, ROTATIONDATEINDEX) = "Rotation Date"
    grdCopy.Col = CARTINDEX
    grdCopy.CellBackColor = LIGHTBLUE
    grdCopy.TextMatrix(0, CARTINDEX) = "Cart"
    grdCopy.Col = ISCIINDEX
    grdCopy.CellBackColor = LIGHTBLUE
    grdCopy.TextMatrix(0, ISCIINDEX) = "ISCI"
    grdCopy.Col = PRODMATCHINDEX
    grdCopy.CellBackColor = LIGHTBLUE
    grdCopy.TextMatrix(0, PRODMATCHINDEX) = "!"
    grdCopy.TextMatrix(0, REPEATINDEX) = "%/Ratio"
    grdCopy.TextMatrix(0, CIFCODEINDEX) = "CifCode"
    grdCopy.TextMatrix(0, SORTINDEX) = "Sort"
End Sub

Private Sub mCGColumnWidths()
    Dim llWidth As Long
    Dim llMinWidth As Long
    Dim ilCol As Integer
    Dim ilColInc As Integer
    Dim ilLoop As Integer

    grdRot.Row = grdRot.FixedRows
    grdRot.Col = COPYINDEX
    'grdCopy.Width = 1.5 * grdRot.CellWidth
    If Screen.Width / 15 < 4000 Then
        grdCopy.Width = Copy.Width * (CLng(4000 - Screen.Width / 15) / 4000)
    Else
        grdCopy.Width = 0.5 * Copy.Width
    End If
    lacToolTip.Width = grdRot.CellWidth
    grdCopy.ColWidth(CIFCODEINDEX) = 0
    grdCopy.ColWidth(SORTINDEX) = 0
    grdCopy.ColWidth(PRODUCTINDEX) = 0.18 * grdCopy.Width
    grdCopy.ColWidth(CREATIVETITLEINDEX) = 0.18 * grdCopy.Width
    grdCopy.ColWidth(CREATEDDATEINDEX) = 0.1 * grdCopy.Width
    grdCopy.ColWidth(ROTATIONDATEINDEX) = 0.15 * grdCopy.Width
    If tgSpf.sUseCartNo = "N" Then
        grdCopy.ColWidth(CARTINDEX) = 0
    Else
        grdCopy.ColWidth(CARTINDEX) = 0.06 * grdCopy.Width
    End If
    grdCopy.ColWidth(PRODMATCHINDEX) = 0.02 * grdCopy.Width
    grdCopy.ColWidth(REPEATINDEX) = 0.07 * grdCopy.Width
    
    
    grdCopy.ColWidth(ISCIINDEX) = grdCopy.Width - GRIDSCROLLWIDTH - 15
    
    'TTP 10728
    fraFilter.Left = grdCopy.ColWidth(PRODUCTINDEX) + _
                     grdCopy.ColWidth(CREATIVETITLEINDEX) + _
                     grdCopy.ColWidth(CREATEDDATEINDEX) + _
                     grdCopy.ColWidth(ROTATIONDATEINDEX) + _
                     grdCopy.ColWidth(CARTINDEX)
    
    For ilCol = 0 To PRODMATCHINDEX Step 1
        If ilCol <> ISCIINDEX Then
            grdCopy.ColWidth(ISCIINDEX) = grdCopy.ColWidth(ISCIINDEX) - grdCopy.ColWidth(ilCol)
        End If
    Next ilCol
    
    'TTP 10728 Begin
    picISCI_Filter.Left = grdCopy.Left
    picISCI_Filter.Width = grdCopy.Width
    fraFilter.Width = grdCopy.ColWidth(ISCIINDEX)
    txtISCI_Filter.Width = fraFilter.Width - txtISCI_Filter.Left
    'TTP 10728 End
End Sub
Private Function mCGColOk() As Integer

    If Not imUpdateAllowed Then
        mCGColOk = False
    Else
        mCGColOk = True
        If grdCopy.CellBackColor = LIGHTYELLOW Then
            mCGColOk = False
            Exit Function
        End If
    End If
End Function


'*******************************************************
'*                                                     *
'*      Procedure Name:mEnableBox                      *
'*                                                     *
'*             Created:6/28/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Enable specified control       *
'*                                                     *
'*******************************************************
Private Sub mCGEnableBox()
'
'   mEnableBox ilBoxNo
'   Where:
'       ilBoxNo (I)- Number of the Control to be enabled
'
    Dim slStr As String
    Dim ilLoop As Integer
    Dim slFields() As String
    If (grdCopy.Row < grdCopy.FixedRows) Or (grdCopy.Row >= grdCopy.rows) Or (grdCopy.Col < grdCopy.FixedCols) Or (grdCopy.Col >= grdCopy.cols - 1) Then
        Exit Sub
    End If
    lmCGEnableRow = grdCopy.Row
    lmCGEnableCol = grdCopy.Col
    imCGCtrlVisible = True
    Select Case grdCopy.Col
        Case REPEATINDEX
            bmExitCG = False
            edcCGDropdown.MaxLength = 4
            slStr = grdCopy.Text
            If slStr = "Missing" Then
                slStr = ""
            End If
            edcCGDropdown.Text = slStr
    End Select
    mCGSetFocus
End Sub

'*******************************************************
'*                                                     *
'*      Procedure Name:mSetFocus                       *
'*                                                     *
'*             Created:6/28/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Set focus to specified control *
'*                                                     *
'*******************************************************
Private Sub mCGSetFocus()
'
'   mSetFocus ilBoxNo
'   Where:
'       ilBoxNo (I)- Number of the Control to be enabled
'
    Dim llColPos As Long
    Dim ilCol As Integer

    If (grdCopy.Row < grdCopy.FixedRows) Or (grdCopy.Row >= grdCopy.rows) Or (grdCopy.Col < grdCopy.FixedCols) Or (grdCopy.Col >= grdCopy.cols - 1) Then
        Exit Sub
    End If
    imCGCtrlVisible = True
    llColPos = 0
    For ilCol = 0 To grdCopy.Col - 1 Step 1
        llColPos = llColPos + grdCopy.ColWidth(ilCol)
    Next ilCol
    Select Case grdCopy.Col
        Case REPEATINDEX
            If grdCopy.rowHeight(grdCopy.Row) <> 0 Then
                edcCGDropdown.Move grdCopy.Left + llColPos + 30, grdCopy.Top + grdCopy.RowPos(grdCopy.Row) + 30, grdCopy.ColWidth(grdCopy.Col) - 30, grdCopy.rowHeight(grdCopy.Row) - 15
            End If
                edcCGDropdown.Visible = True
                edcCGDropdown.SetFocus
    End Select
    mSetCommands
End Sub

'*******************************************************
'*                                                     *
'*      Procedure Name:mSetShow                        *
'*                                                     *
'*             Created:6/30/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Format user input for a control*
'*                      to be displayed on the form    *
'*                                                     *
'*******************************************************
Private Sub mCGSetShow()

'
'   mSetShow ilBoxNo
'   Where:
'       ilBoxNo (I)- Number of the Control whose value should be saved
'
    Dim slStr As String
    Dim ilLoop As Integer
    Dim slChar As String
    Dim slRepeat As String

    If (lmCGEnableRow >= grdCopy.FixedRows) And (lmCGEnableRow < grdCopy.rows) Then
        'Set any field that that should only be set after user leaves the cell
        Select Case lmCGEnableCol
            Case REPEATINDEX
                edcCGDropdown.Visible = False  'Set visibility
                slStr = edcCGDropdown.Text
                bmExitCG = False
                slRepeat = ""
                For ilLoop = 1 To Len(slStr) Step 1
                    slChar = Mid(slStr, ilLoop, 1)
                    If slChar Like "[0-9]" Then
                        slRepeat = slRepeat & slChar
                    Else
                        bmExitCG = True
                    End If
                Next ilLoop
                If StrComp(grdCopy.TextMatrix(lmCGEnableRow, lmCGEnableCol), slRepeat, vbTextCompare) <> 0 Then
                    imRotHeaderChgOnly = False
                End If
                grdCopy.TextMatrix(lmCGEnableRow, lmCGEnableCol) = slRepeat
                'Compute total
                mComputeGridCopyTotal
        End Select
    End If
    lmCGEnableRow = -1
    lmCGEnableCol = -1
    imCGCtrlVisible = False
End Sub

Private Sub mPopCG()
    Dim ilLoop As Integer
    Dim llRow As Long
    Dim ilCol As Integer
    Dim ilPos As Integer
    Dim ilField As Integer
    Dim ilRet As Integer
    Dim slDate As String
    Dim slStr As String
    Dim slNameCode As String
    Dim slCode As String
    Dim slFields(0 To 2) As String
    Dim ilFieldIndex As Integer
    
    grdCopy.Redraw = False
    mClearCG
        
    llRow = grdCopy.FixedRows

    For ilLoop = 0 To lbcInv.ListCount - 1 Step 1
        ilFieldIndex = 0
        slStr = lbcInv.List(ilLoop)
        gParseItemFields slStr, "~", slFields()
        slStr = slFields(ilFieldIndex)
        If (StrComp(slStr, "[New]", vbTextCompare) <> 0) And (StrComp(slStr, "[New-Cart]", vbTextCompare) <> 0) And (StrComp(slStr, "[New-ISCI]", vbTextCompare) <> 0) And (StrComp(slStr, "[Pool-Copy]", vbTextCompare) <> 0) And (Trim$(slStr) <> "") Then
            If llRow >= grdCopy.rows Then
                grdCopy.AddItem ""
                grdCopy.rowHeight(llRow) = fgFlexGridRowH
                grdCopy.Row = llRow
                For ilCol = 0 To grdCopy.cols - 1 Step 1
                    grdCopy.ColAlignment(ilCol) = flexAlignLeftCenter
                Next ilCol
            End If
            grdCopy.Row = llRow
            For ilCol = PRODUCTINDEX To PRODMATCHINDEX Step 1
                If ilCol <> REPEATINDEX Then
                    grdCopy.Col = ilCol
                    grdCopy.CellBackColor = LIGHTYELLOW
                End If
            Next ilCol
            grdCopy.TextMatrix(llRow, PRODMATCHINDEX) = ""
            For ilField = LBONE To UBound(lmListField) - 1 Step 1
                If (imBlackoutAdfCode <> POOLROTATION) Then
                    slStr = slFields(ilFieldIndex)
                    If tgSpf.sUseCartNo = "N" Then
                        ilPos = InStr(1, slStr, " ", vbBinaryCompare)
                        If ilPos > 0 Then
                            grdCopy.TextMatrix(llRow, ISCIINDEX) = Trim$(Mid(slStr, ilPos + 1))
                        Else
                            grdCopy.TextMatrix(llRow, ISCIINDEX) = Trim$(slStr)
                        End If
                        Exit For
                    Else
                        If rbcShow(0).Value Then
                            If ilField = 2 Then
                                grdCopy.TextMatrix(llRow, CARTINDEX) = Trim$(slFields(ilFieldIndex))
                            ElseIf ilField = 3 Then
                                grdCopy.TextMatrix(llRow, ISCIINDEX) = Trim$(slFields(ilFieldIndex))
                            End If
                        Else
                            If ilField = 2 Then
                                grdCopy.TextMatrix(llRow, ISCIINDEX) = Trim$(slFields(ilFieldIndex))
                            ElseIf ilField = 3 Then
                                grdCopy.TextMatrix(llRow, CARTINDEX) = Trim$(slFields(ilFieldIndex))
                            End If
                        End If
                    End If
                Else
                    If tgSpf.sUseCartNo = "N" Then
                        grdCopy.TextMatrix(llRow, ISCIINDEX) = "[Pool-ISCI]"
                    Else
                        If rbcShow(0).Value Then
                            If ilField = 2 Then
                                grdCopy.TextMatrix(llRow, CARTINDEX) = "[Pool-Cart]"
                            ElseIf ilField = 3 Then
                                grdCopy.TextMatrix(llRow, ISCIINDEX) = "[Pool-ISCI]"
                            End If
                        Else
                            If ilField = 2 Then
                                grdCopy.TextMatrix(llRow, ISCIINDEX) = "[Pool-ISCI]"
                            ElseIf ilField = 3 Then
                                grdCopy.TextMatrix(llRow, CARTINDEX) = "[Pool-Cart]"
                            End If
                        End If
                    End If
                End If
                ilFieldIndex = ilFieldIndex + 1
            Next ilField
            If (imBlackoutAdfCode <> POOLROTATION) Then
                If imInvStatus = 0 Then
                    If tgSpf.sUseCartNo <> "B" Then
                        slNameCode = tmCopyNameCode(ilLoop - 1).sKey    'lbcInvCode.List(ilButtonIndex - 1)
                    Else
                        slNameCode = tmCopyNameCode(ilLoop - 2).sKey    'lbcInvCode.List(ilButtonIndex - 1)
                    End If
                Else
                    slNameCode = tmCopyNameCode(ilLoop).sKey    'lbcInvCode.List(ilButtonIndex - 1)
                End If
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                grdCopy.TextMatrix(llRow, CIFCODEINDEX) = slCode
                ilRet = gParseItem(slNameCode, 3, "\", slCode)
                grdCopy.TextMatrix(llRow, PRODUCTINDEX) = slCode
                'If blackout, bypass product test
                'If lmRGEnableRow >= grdRot.FixedRows Then
                If tmChf.lCode > 0 Then
                    'If Trim$(grdRot.TextMatrix(lmRGEnableRow, ADVTINDEX)) = "" Then
                    If (imBlackoutAdfCode <= 0) And (imBlackoutAdfCode <> POOLROTATION) Then
                        If StrComp(UCase(Trim$(tmChf.sProduct)), UCase(Trim$(slCode)), 1) <> 0 Then
                            grdCopy.TextMatrix(llRow, PRODMATCHINDEX) = "!"
                        End If
                    End If
                End If
                ilRet = gParseItem(slNameCode, 4, "\", slCode)
                If Val(slCode) > 0 Then
                    slCode = Format(slCode, "m/d/yy")
                Else
                    slCode = ""
                End If
                grdCopy.TextMatrix(llRow, ROTATIONDATEINDEX) = slCode
                
                tmCifSrchKey.lCode = Val(grdCopy.TextMatrix(llRow, CIFCODEINDEX))
                ilRet = btrGetEqual(hmCif, tmCif, imCifRecLen, tmCifSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                If ilRet = BTRV_ERR_NONE Then
                    If tmCif.lcpfCode > 0 Then
                        tmCpfSrchKey.lCode = tmCif.lcpfCode
                        ilRet = btrGetEqual(hmCpf, tmCpf, imCpfRecLen, tmCpfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                        If ilRet = BTRV_ERR_NONE Then
                            grdCopy.TextMatrix(llRow, CREATIVETITLEINDEX) = Trim$(tmCpf.sCreative)
                        End If
                    End If
                    gUnpackDate tmCif.iDateEntrd(0), tmCif.iDateEntrd(1), slDate
                    grdCopy.TextMatrix(llRow, CREATEDDATEINDEX) = slDate
                    gUnpackDate tmCif.iRotStartDate(0), tmCif.iRotStartDate(1), slDate
                    If slDate <> "" Then
                        gUnpackDate tmCif.iRotEndDate(0), tmCif.iRotEndDate(1), slStr
                        grdCopy.TextMatrix(llRow, ROTATIONDATEINDEX) = slDate & "-" & slStr
                    End If
                End If
            Else
                grdCopy.TextMatrix(llRow, CIFCODEINDEX) = POOLROTATION
                grdCopy.TextMatrix(llRow, PRODUCTINDEX) = "[Pool-Product]"
            End If
            
            llRow = llRow + 1
        End If
    Next ilLoop
    'Force ascending
    For ilLoop = llRow To grdCopy.rows - 1 Step 1
        grdCopy.Row = ilLoop
        For ilCol = 0 To grdCopy.cols - 1 Step 1
            grdCopy.Col = ilCol
            grdCopy.CellBackColor = LIGHTYELLOW
        Next ilCol
    Next ilLoop
    imLastColSorted = -1
    imLastSort = -1
    'grdCopy.Row = 0
    'grdCopy.Col = CARTINDEX
    'If grdCopy.CellWidth <= 0 Then
        mCGSortCol ISCIINDEX
    'Else
    '    mCGSortCol CARTINDEX
    'End If
    grdCopy.Col = SORTINDEX
    grdCopy.Redraw = True
End Sub
Private Sub mCGSortCol(ilCol As Integer)
    Dim llRow As Long
    Dim slStr As String
    Dim slSort As String
    Dim ilPos As Integer
    Dim slRow As String

    For llRow = grdCopy.FixedRows To grdCopy.rows - 1 Step 1
        If ilCol = CARTINDEX Then
            slSort = grdCopy.TextMatrix(llRow, CARTINDEX)
            Do While Len(slSort) < 5
                slSort = slSort & " "
            Loop
        ElseIf ilCol = ISCIINDEX Then
            slSort = grdCopy.TextMatrix(llRow, ISCIINDEX)
            Do While Len(slSort) < 20
                slSort = slSort & " "
            Loop
        Else
            slSort = grdCopy.TextMatrix(llRow, ilCol)
        End If
        slStr = grdCopy.TextMatrix(llRow, SORTINDEX)
        ilPos = InStr(1, slStr, "|", vbTextCompare)
        If ilPos > 1 Then
            slStr = Left$(slStr, ilPos - 1)
        End If
        If (ilCol <> imLastColSorted) Or ((ilCol = imLastColSorted) And (imLastSort = flexSortStringNoCaseDescending)) Then
            slRow = Trim$(str$(llRow))
            Do While Len(slRow) < 4
                slRow = "0" & slRow
            Loop
            grdCopy.TextMatrix(llRow, SORTINDEX) = slSort & slStr & "|" & slRow
        Else
            slRow = Trim$(str$(llRow))
            Do While Len(slRow) < 4
                slRow = "0" & slRow
            Loop
            grdCopy.TextMatrix(llRow, SORTINDEX) = slSort & slStr & "|" & slRow
        End If
    Next llRow
    If ilCol = imLastColSorted Then
        imLastColSorted = SORTINDEX
    Else
        imLastColSorted = -1
        imLastSort = -1
    End If
    grdCopy.Row = 0
    grdCopy.Col = CARTINDEX
    If grdCopy.CellWidth <= 0 Then
        gGrid_SortByCol grdCopy, ISCIINDEX, SORTINDEX, imLastColSorted, imLastSort
    Else
        gGrid_SortByCol grdCopy, CARTINDEX, SORTINDEX, imLastColSorted, imLastSort
    End If
    imLastColSorted = ilCol
End Sub

'*******************************************************
'*                                                     *
'*      Procedure Name:mReadRec                        *
'*                                                     *
'*             Created:5/17/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Read a record                  *
'*                                                     *
'*******************************************************
Private Function mReadRecRaf(llRafCode As Long, blModeling As Boolean) As Integer
'
'   iRet = mReadRec(ilSelectIndex)
'   Where:
'       ilSelectIndex (I) - list box index
'       iRet (O)- True if record read,
'                 False if not read
'
    Dim slNameCode As String  'Code and Code strings from Traffic!lbcLockBox or Traffic!lbcAgencyDP
    Dim slCode As String    'Code number- so record can be found
    Dim ilRet As Integer    'Return status
    Dim tlSef As SEF

    If llRafCode <= 0 Then
        mReadRecRaf = False
        Exit Function
    End If
    tmRafSrchKey.lCode = llRafCode
    ilRet = btrGetEqual(hmRaf, tmRaf, imRafRecLen, tmRafSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    On Error GoTo mReadRecErr
    gBtrvErrorMsg ilRet, "mReadRecErr (btrGetEqual: Region)", Copy
    On Error GoTo 0
    If blModeling Then
        If grdRot.TextMatrix(lmRGEnableRow, REGIONNAMEINDEX) <> Trim$(tmRaf.sName) Then
            imRotHeaderChgOnly = False
        End If
        grdRot.TextMatrix(lmRGEnableRow, REGIONNAMEINDEX) = Trim$(tmRaf.sName)
        grdRot.TextMatrix(lmRGEnableRow, RAFCODEINDEX) = 0
        grdRot.TextMatrix(lmRGEnableRow, STATUSINDEX) = "M"
        ReDim tmSef(0 To 0) As SEF
        tmSefSrchKey1.lRafCode = tmRaf.lCode
        tmSefSrchKey1.iSeqNo = 0
        ilRet = btrGetGreaterOrEqual(hmSef, tlSef, imSefRecLen, tmSefSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
        Do While (ilRet = BTRV_ERR_NONE) And (tlSef.lRafCode = tmRaf.lCode)
            tmSef(UBound(tmSef)) = tlSef
            ReDim Preserve tmSef(0 To UBound(tmSef) + 1) As SEF
            ilRet = btrGetNext(hmSef, tlSef, imSefRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
        mMoveSEFRecToCtrl
    Else
        If grdRot.TextMatrix(lmRGEnableRow, REGIONNAMEINDEX) <> Trim$(tmRaf.sName) Then
            imRotHeaderChgOnly = False
        End If
        grdRot.TextMatrix(lmRGEnableRow, REGIONNAMEINDEX) = Trim$(tmRaf.sName)
        grdRot.TextMatrix(lmRGEnableRow, RAFCODEINDEX) = llRafCode
        grdRot.TextMatrix(lmRGEnableRow, STATUSINDEX) = "C"
    End If
    mReadRecRaf = True
    Exit Function
mReadRecErr:
    On Error GoTo 0
    mReadRecRaf = False
    Exit Function
End Function
Private Function mReadRecRafSef(llRafCode As Long) As Integer
'
'   iRet = mReadRec(ilSelectIndex)
'   Where:
'       ilSelectIndex (I) - list box index
'       iRet (O)- True if record read,
'                 False if not read
'
    Dim slNameCode As String  'Code and Code strings from Traffic!lbcLockBox or Traffic!lbcAgencyDP
    Dim slCode As String    'Code number- so record can be found
    Dim ilRet As Integer    'Return status
    Dim tlSef As SEF

    If llRafCode <= 0 Then
        mReadRecRafSef = False
        Exit Function
    End If
    tmRafSrchKey.lCode = llRafCode
    ilRet = btrGetEqual(hmRaf, tmRaf, imRafRecLen, tmRafSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    On Error GoTo mReadRecErr
    gBtrvErrorMsg ilRet, "mReadRecErr (btrGetEqual: Region)", Copy
    On Error GoTo 0
    ReDim tmSef(0 To 0) As SEF
    tmSefSrchKey1.lRafCode = tmRaf.lCode
    tmSefSrchKey1.iSeqNo = 0
    ilRet = btrGetGreaterOrEqual(hmSef, tlSef, imSefRecLen, tmSefSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
    Do While (ilRet = BTRV_ERR_NONE) And (tlSef.lRafCode = tmRaf.lCode)
        tmSef(UBound(tmSef)) = tlSef
        ReDim Preserve tmSef(0 To UBound(tmSef) + 1) As SEF
        ilRet = btrGetNext(hmSef, tlSef, imSefRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
    mReadRecRafSef = True
    Exit Function
mReadRecErr:
    On Error GoTo 0
    mReadRecRafSef = False
    Exit Function
End Function

Sub mMoveSEFRecToCtrl()

    Dim ilSef As Integer
    Dim ilLoop As Integer
    Dim slStr As String
    Dim llRow As Long
    Dim ilCol As Integer
    Dim slCategory As String
    Dim slInclExcl As String
    Dim ilPos As Integer
    Dim llRGEnableRow As Long
    Dim llRGEnableCol As Long
    ReDim blCategoryPop(0 To 5) As Boolean

    llRGEnableRow = lmRGEnableRow
    llRGEnableCol = lmRGEnableCol
    For ilLoop = 0 To 5 Step 1
        blCategoryPop(ilLoop) = False
        For llRow = 0 To lbcRGSelection(ilLoop).ListCount - 1 Step 1
            lbcRGSelection(ilLoop).Selected(llRow) = False
        Next llRow
    Next ilLoop
    mPopRGCategory "DMA Market"
    mPopRGCategory "MSA Market"
    mPopRGCategory "State Name"
    mPopRGCategory "Format"
    mPopRGCategory "Time Zone"
    mPopRGCategory "Station"
    For ilSef = 0 To UBound(tmSef) - 1 Step 1
        'DoEvents
        slCategory = UCase$(tmRaf.sCategory)
        slInclExcl = tmRaf.sInclExcl
        If Trim$(tmSef(ilSef).sCategory) <> "" Then
            slCategory = tmSef(ilSef).sCategory
            slInclExcl = tmSef(ilSef).sInclExcl
        End If
        If slInclExcl = "E" Then
            slInclExcl = "Exclude"
        Else
            slInclExcl = "Include"
        End If
        Select Case UCase$(slCategory)
            Case "M"
                For ilLoop = 0 To lbcRGSelection(0).ListCount - 1 Step 1
                    If tmSef(ilSef).iIntCode = Val(lbcRGSelection(0).ItemData(ilLoop)) Then
                        lbcRGSelection(0).Selected(ilLoop) = True
                        blCategoryPop(0) = True
                        Exit For
                    End If
                Next ilLoop
            Case "A"
                For ilLoop = 0 To lbcRGSelection(2).ListCount - 1 Step 1
                    If tmSef(ilSef).iIntCode = Val(lbcRGSelection(2).ItemData(ilLoop)) Then
                        lbcRGSelection(2).Selected(ilLoop) = True
                        blCategoryPop(2) = True
                        Exit For
                    End If
                Next ilLoop
            Case "N"
                For ilLoop = 0 To lbcRGSelection(3).ListCount - 1 Step 1
                    slStr = Trim$(lbcRGSelection(3).List(ilLoop))
                    ilPos = InStr(1, slStr, "(", vbTextCompare)
                    If ilPos > 0 Then
                        slStr = Trim$(Left$(slStr, ilPos - 1))
                    End If
                    If StrComp(Trim$(tmSef(ilSef).sName), slStr, vbTextCompare) = 0 Then
                        lbcRGSelection(3).Selected(ilLoop) = True
                        blCategoryPop(3) = True
                        Exit For
                    End If
                Next ilLoop
            Case "T"
                For ilLoop = 0 To lbcRGSelection(5).ListCount - 1 Step 1
                    If tmSef(ilSef).iIntCode = Val(lbcRGSelection(5).ItemData(ilLoop)) Then
                        lbcRGSelection(5).Selected(ilLoop) = True
                        blCategoryPop(5) = True
                        Exit For
                    End If
                Next ilLoop
            Case "F"
                For ilLoop = 0 To lbcRGSelection(1).ListCount - 1 Step 1
                    If tmSef(ilSef).iIntCode = Val(lbcRGSelection(1).ItemData(ilLoop)) Then
                        lbcRGSelection(1).Selected(ilLoop) = True
                        blCategoryPop(1) = True
                        Exit For
                    End If
                Next ilLoop
                grdRot.TextMatrix(llRGEnableRow, INCLEXCLINDEX) = slInclExcl
            Case "S"
                'mPopStations False
                For ilLoop = 0 To lbcRGSelection(4).ListCount - 1 Step 1
                    If tmSef(ilSef).iIntCode = Val(lbcRGSelection(4).ItemData(ilLoop)) Then
                        lbcRGSelection(4).Selected(ilLoop) = True
                        blCategoryPop(4) = True
                        Exit For
                    End If
                Next ilLoop
        End Select
    Next ilSef
    For ilLoop = 0 To 5 Step 1
        lmRGEnableRow = llRGEnableRow
        lmRGEnableCol = llRGEnableCol
        imRGSelection = ilLoop
        If blCategoryPop(ilLoop) = True Then
            If ilLoop = 1 Then
                lmRGEnableRow = llRGEnableRow
                lmRGEnableCol = FORMATINDEX
                mRGSetShow
            Else
                Select Case ilLoop
                    Case 0
                        slCategory = "DMA Market"
                    Case 2
                        slCategory = "MSA Market"
                    Case 3
                        slCategory = "State Name"
                    Case 4
                        slCategory = "Station"
                    Case 5
                        slCategory = "Time Zone"
                End Select
                grdRot.TextMatrix(lmRGEnableRow, CATEGORYINDEX) = slCategory
                lmRGEnableRow = llRGEnableRow
                lmRGEnableCol = SELECTIONINDEX
                mRGSetShow
            End If
        End If
    Next ilLoop
    For ilLoop = 1 To 4 Step 1
        grdRot.Col = ilLoop
        grdRot.CellBackColor = vbWhite
    Next ilLoop
    lmRGEnableRow = llRGEnableRow
    lmRGEnableCol = llRGEnableCol
    mSetCommands
End Sub

'*******************************************************
'*                                                     *
'*      Procedure Name:mGeneratePattern                *
'*                                                     *
'*             Created:6/28/93       By:D. LeVine      *
'*            Modified:              By:               *
'*                                                     *
'*            Comments: Generate copy pattern from     *
'*                      input                          *
'*            Note: Step Description                   *
'*                    1  Create empty cells (total # of*
'*                       instructions to be gen.)      *
'*                    2  Find instruction with smallest*
'*                       distribution count            *
'*                    3  Evenly distribute instruction *
'*                       into empty cells              *
'*                                                     *
'*******************************************************
Private Function mGeneratePattern(llRow As Long) As Integer
    Dim ilSmallest As Integer
    Dim ilSmallestIndex As Integer
    Dim ilTotal As Integer
    Dim ilLoop As Integer
    Dim ilNoUsed As Integer
    Dim ilDone As Integer
    Dim ilNoBeforeInc As Integer
    Dim ilField As Integer
    Dim ilInsert As Integer
    Dim ilPlaced As Integer
    Dim ilAdded As Integer
    Dim ilAddIndex As Integer
    Dim ilFromIndex As Integer
    Dim ilRes As Integer
    Dim slStr As String
    Dim ilRepeat As Integer
    Dim ilPos As Integer
    Dim slISCI As String
    Dim llCGRow As Long
    Dim slFields() As String
    Dim ilCif As Integer
    Dim ilFound As Integer
    Dim slNameCode As String
    Dim slName As String
    Dim slCode As String
    Dim ilRet As Integer
    ReDim llCifCode(0 To 0) As Long
    ReDim ilNumber(0 To 0) As Integer
    
    slStr = grdRot.TextMatrix(llRow, ADVTINDEX)
    imBlackoutAdfCode = 0
    If slStr <> "" Then
        For ilLoop = 0 To lbcRGAdvt.ListCount - 1 Step 1
            If slStr = lbcRGAdvt.List(ilLoop) Then
                imBlackoutAdfCode = lbcRGAdvt.ItemData(ilLoop)
                Exit For
            End If
        Next ilLoop
    End If
    lbcInst.Clear
    mInvPop
    ilSmallest = -1
    slStr = grdRot.TextMatrix(llRow, COPYINDEX)
    slFields = Split(slStr, "; ")
    If IsArray(slFields) Then
        For ilLoop = 0 To UBound(slFields) Step 1
            ilRepeat = 1
            ilPos = InStr(1, slFields(ilLoop), "(", vbTextCompare)
            If ilPos > 0 Then
                slISCI = Left$(slFields(ilLoop), ilPos - 1)
                slStr = Mid(slFields(ilLoop), ilPos + 1)
                ilRepeat = Val(Left$(slStr, Len(slStr) - 1))
            Else
                slISCI = slFields(ilLoop)
            End If
            If ilSmallest = -1 Then
                ilSmallest = ilRepeat
            ElseIf ilRepeat < ilSmallest Then
                ilSmallest = ilRepeat
            End If
            slISCI = Trim$(slISCI)
            ilNumber(UBound(ilNumber)) = ilRepeat
            ReDim Preserve ilNumber(0 To UBound(ilNumber) + 1) As Integer
            For llCGRow = grdCopy.FixedRows To grdCopy.rows - 1 Step 1
                If (Trim$(grdCopy.TextMatrix(llCGRow, CARTINDEX)) = slISCI) Or (Trim$(grdCopy.TextMatrix(llCGRow, ISCIINDEX)) = slISCI) Then
                    llCifCode(UBound(llCifCode)) = grdCopy.TextMatrix(llCGRow, CIFCODEINDEX)
                    ReDim Preserve llCifCode(0 To UBound(llCifCode) + 1) As Long
                    Exit For
                End If
            Next llCGRow
        Next ilLoop
        'Compute Altered
        For ilLoop = 0 To UBound(ilNumber) - 1 Step 1
            ilNumber(ilLoop) = Val(gDivStr(str$(ilNumber(ilLoop)), str$(ilSmallest)))
            If ilNumber(ilLoop) <= 0 Then
                ilNumber(ilLoop) = 1
            End If
        Next ilLoop
    End If
    
    
    
    ilTotal = 0
    For ilLoop = 0 To UBound(ilNumber) - 1 Step 1
        ilTotal = ilTotal + ilNumber(ilLoop)
    Next ilLoop
    
    
    
    If ilTotal <= 0 Then
        mGeneratePattern = False
        Exit Function
    End If
    mGeneratePattern = True
    ReDim lmGenerateCode(0 To ilTotal) As Long
    ReDim lmWorkArea(0 To ilTotal) As Long
    For ilLoop = 0 To UBound(lmGenerateCode) - 1 Step 1
        lmGenerateCode(ilLoop) = -1
        lmWorkArea(ilLoop) = -1
    Next ilLoop
    ilDone = False
    Do
        ilSmallest = -1
        For ilLoop = 0 To UBound(ilNumber) - 1 Step 1
            If llCifCode(ilLoop) >= 0 Then
                If ilSmallest = -1 Then
                    ilSmallest = ilNumber(ilLoop)
                    ilSmallestIndex = ilLoop
                Else
                    If ilNumber(ilLoop) < ilSmallest Then
                        ilSmallest = ilNumber(ilLoop)
                        ilSmallestIndex = ilLoop
                    End If
                End If
            End If
        Next ilLoop
        If ilSmallest = -1 Then
            ilDone = True
            Exit Do
        End If
        ilNoUsed = 0
        For ilLoop = 0 To UBound(lmGenerateCode) - 1 Step 1
            If lmGenerateCode(ilLoop) >= 0 Then
                ilNoUsed = ilNoUsed + 1
            End If
        Next ilLoop
        If ilNoUsed = 0 Then
            ilInsert = ilSmallest
            For ilLoop = 1 To ilSmallest Step 1
                lmGenerateCode(ilLoop - 1) = llCifCode(ilSmallestIndex)
            Next ilLoop
            llCifCode(ilSmallestIndex) = -1
        Else
            ilInsert = ilSmallest \ ilNoUsed
            ilNoBeforeInc = ilNoUsed - (ilSmallest Mod ilNoUsed)
            ilAddIndex = 1
            ilFromIndex = 1
            ilPlaced = 0
            ilAdded = 0
            Do
                If ilFromIndex <= ilNoUsed Then
                    lmWorkArea(ilAddIndex - 1) = lmGenerateCode(ilFromIndex - 1)
                    ilFromIndex = ilFromIndex + 1
                    ilAddIndex = ilAddIndex + 1
                End If
                If ilAdded <= ilSmallest Then
                    For ilLoop = 1 To ilInsert Step 1
                        lmWorkArea(ilAddIndex - 1) = llCifCode(ilSmallestIndex)
                        ilAddIndex = ilAddIndex + 1
                        ilAdded = ilAdded + 1
                        If ilAdded >= ilSmallest Then
                            llCifCode(ilSmallestIndex) = -1
                            Exit For
                        End If
                    Next ilLoop
                End If
                ilPlaced = ilPlaced + 1
                If ilPlaced = ilNoBeforeInc Then
                    ilInsert = ilInsert + 1
                End If
            Loop While (ilFromIndex <= ilNoUsed) And (ilAdded < ilSmallest)
            For ilLoop = 0 To UBound(lmGenerateCode) - 1 Step 1
                lmGenerateCode(ilLoop) = lmWorkArea(ilLoop)
            Next ilLoop
        End If
    Loop While Not ilDone
    For ilCif = 0 To UBound(lmGenerateCode) - 1 Step 1
        ilFound = False
        For ilLoop = 0 To UBound(tgActiveCode) - 1 Step 1 'lbcActiveCode.ListCount - 1 Step 1
            slNameCode = tgActiveCode(ilLoop).sKey  'lbcActiveCode.List(ilLoop)
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            If lmGenerateCode(ilCif) = Val(slCode) Then
                ilRet = gParseItem(slNameCode, 1, "\", slName)
                lbcInst.AddItem slName
                ilFound = True
                Exit For
            End If
        Next ilLoop
        If Not ilFound Then
            For ilLoop = 0 To UBound(tmPurgeCode) - 1 Step 1  'lbcPurgeCode.ListCount - 1 Step 1
                slNameCode = tmPurgeCode(ilLoop).sKey    'lbcPurgeCode.List(ilLoop)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                If lmGenerateCode(ilCif) = Val(slCode) Then
                    ilRet = gParseItem(slNameCode, 1, "\", slName)
                    lbcInst.AddItem slName
                    ilFound = True
                    Exit For
                End If
            Next ilLoop
        End If
        If Not ilFound Then
            For ilLoop = 0 To UBound(tmHistoryCode) - 1 Step 1  'lbcHistoryCode.ListCount - 1 Step 1
                slNameCode = tmHistoryCode(ilLoop).sKey    'lbcHistoryCode.List(ilLoop)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                If lmGenerateCode(ilCif) = Val(slCode) Then
                    ilRet = gParseItem(slNameCode, 1, "\", slName)
                    lbcInst.AddItem slName
                    ilFound = True
                    Exit For
                End If
            Next ilLoop
        End If
    Next ilCif
    lbcInst.AddItem " "
End Function

Private Function mAddRafSef() As Integer
    Dim ilRet As Integer
    Dim ilSef As Integer
    Dim slCode As String    'code number
    Dim slNameCode As String
    
    tmRaf.lCode = 0
    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    tmRaf.iAdfCode = Val(slCode)
    tmRaf.sState = "A"
    gPackDate Format(gNow(), "m/d/yy"), tmRaf.iDateEntrd(0), tmRaf.iDateEntrd(1)
    tmRaf.iUrfCode = tgUrf(0).iCode
    tmRaf.sAssigned = "Y"
    ilRet = btrInsert(hmRaf, tmRaf, imRafRecLen, INDEXKEY0)
    On Error GoTo mAddRecErr
    gBtrvErrorMsg ilRet, "mAddRafSef (btrInsert: RAF)", Copy
    On Error GoTo 0
    For ilSef = 0 To UBound(tmSef) - 1 Step 1
        tmSef(ilSef).lCode = 0
        tmSef(ilSef).lRafCode = tmRaf.lCode
        ilRet = btrInsert(hmSef, tmSef(ilSef), imSefRecLen, INDEXKEY0)
        On Error GoTo mAddRecErr
        gBtrvErrorMsg ilRet, "mAddRafSef (btrInsert: SEF)", Copy
        On Error GoTo 0
    Next ilSef
    mObtainRegions
    mAddRafSef = True
    Exit Function
mAddRecErr:
    On Error GoTo 0
    mAddRafSef = False
    Exit Function
End Function

Private Function mCreateRafSef(llRow As Long) As Integer
    Dim slStr As String
    Dim slFields() As String
    Dim ilUpper As Integer
    Dim ilLoop As Integer
    Dim ilPos As Integer
    
    tmRaf.sName = grdRot.TextMatrix(llRow, REGIONNAMEINDEX)
    gPackDate "", tmRaf.iDateDormant(0), tmRaf.iDateDormant(1)
    tmRaf.lRegionCode = 0
    tmRaf.sType = "C"
    tmRaf.sCategory = ""
    tmRaf.sInclExcl = ""
    tmRaf.sShowNoProposal = "N"
    tmRaf.sShowOnOrder = "N"
    tmRaf.sShowOnInvoice = "N"
    tmRaf.iAudPct = 10000
    tmRaf.sAbbr = ""
    tmRaf.sUnused = ""
    tmRaf.sCustom = "N"
    ReDim tmSef(0 To 0) As SEF
    ilUpper = LBound(tmSef)
    If grdRot.TextMatrix(llRow, CATEGORYINDEX) <> "" Then
        slStr = grdRot.TextMatrix(llRow, CATEGORYINDEX)
        If slStr = "DMA Market" Then
            tmSef(ilUpper).sCategory = "M"
        ElseIf slStr = "MSA Market" Then
            tmSef(ilUpper).sCategory = "A"
        ElseIf slStr = "State Name" Then
            tmSef(ilUpper).sCategory = "N"
        ElseIf slStr = "Station" Then
            tmSef(ilUpper).sCategory = "S"
        ElseIf slStr = "Time Zone" Then
            tmSef(ilUpper).sCategory = "T"
        End If
        mPopRGCategory slStr
        slStr = grdRot.TextMatrix(llRow, SELECTIONINDEX)
        slFields = Split(slStr, "; ")
        If IsArray(slFields) Then
            For ilLoop = 0 To UBound(slFields) Step 1
                gFindMatch slFields(ilLoop), 0, lbcRGSelection(imRGSelection)
                If gLastFound(lbcRGSelection(imRGSelection)) >= 0 Then
                    If tmSef(ilUpper).sCategory = "N" Then
                        slStr = lbcRGSelection(imRGSelection).List(gLastFound(lbcRGSelection(imRGSelection)))
                        ilPos = InStr(1, slStr, "(", vbTextCompare)
                        If ilPos >= 1 Then
                            tmSef(ilUpper).sName = Trim$(Left(slStr, ilPos - 1))
                        Else
                            tmSef(ilUpper).sName = Trim$(slStr)
                        End If
                        tmSef(ilUpper).iIntCode = 0
                    Else
                        tmSef(ilUpper).iIntCode = lbcRGSelection(imRGSelection).ItemData(gLastFound(lbcRGSelection(imRGSelection)))
                        tmSef(ilUpper).sName = ""
                    End If
                    tmSef(ilUpper).sInclExcl = "I"
                    tmSef(ilUpper).iSeqNo = ilUpper + 1
                    tmSef(ilUpper).lLongCode = 0
                    tmSef(ilUpper).sUnused = ""
                    ReDim Preserve tmSef(0 To ilUpper + 1) As SEF
                    ilUpper = ilUpper + 1
                    tmSef(ilUpper) = tmSef(ilUpper - 1)
                End If
            Next ilLoop
        End If
        
    End If
    If grdRot.TextMatrix(llRow, FORMATINDEX) <> "" Then
        tmSef(ilUpper).sCategory = "F"
        If grdRot.TextMatrix(llRow, INCLEXCLINDEX) = "Exclude" Then
            tmSef(ilUpper).sInclExcl = "E"
        Else
            tmSef(ilUpper).sInclExcl = "I"
        End If
        mPopRGCategory "Format"
        slStr = grdRot.TextMatrix(llRow, FORMATINDEX)
        slFields = Split(slStr, "; ")
        If IsArray(slFields) Then
            For ilLoop = 0 To UBound(slFields) Step 1
                gFindMatch slFields(ilLoop), 0, lbcRGSelection(imRGSelection)
                If gLastFound(lbcRGSelection(imRGSelection)) >= 0 Then
                    tmSef(ilUpper).iIntCode = lbcRGSelection(imRGSelection).ItemData(gLastFound(lbcRGSelection(imRGSelection)))
                    tmSef(ilUpper).iSeqNo = ilUpper + 1
                    tmSef(ilUpper).lLongCode = 0
                    tmSef(ilUpper).sUnused = ""
                    ReDim Preserve tmSef(0 To ilUpper + 1) As SEF
                    ilUpper = ilUpper + 1
                    tmSef(ilUpper) = tmSef(ilUpper - 1)
                End If
            Next ilLoop
        End If
    End If
    mCreateRafSef = True
End Function

Private Function mSaveGridRot(ilInCategory As Integer, ilInMaxCategory As Integer) As Integer
    Dim llRow As Long
    Dim ilRet As Integer
    Dim ilZone As Integer
    Dim ilBlackout As Integer
    Dim ilFound As Integer
    Dim ilIndex As Integer
    Dim ilInAllSaveRec As Integer
    Dim llLastRow As Long
    Dim slNameCode As String
    Dim slCode As String
    Dim ilVefCode As Integer
    Dim slStr As String
    Dim ilLoop As Integer
    Dim blVehicleOk As Boolean
    Dim ilAdd As Integer
    Dim ilCategory As Integer
    Dim ilVef As Integer
    Dim ilField As Integer
    Dim slRotVefName As String
    Dim slFields() As String
    Dim blRotGen As Boolean
    '12/23/14
    Dim slName As String

    ReDim llCategoryRowSort(0 To 0) As Long
    
    ReDim tlCrfVefCode(0 To UBound(tmCrfVefCode)) As CRFVEFCODE   'Array of vehicles associated with the rotation
    For ilLoop = 0 To UBound(tmCrfVefCode) Step 1
        tlCrfVefCode(ilLoop).iVefCode = tmCrfVefCode(ilLoop).iVefCode
        tlCrfVefCode(ilLoop).iNextFinal = tmCrfVefCode(ilLoop).iNextFinal
        tlCrfVefCode(ilLoop).iNextPrelim = tmCrfVefCode(ilLoop).iNextPrelim
    Next ilLoop
    
    'Retain the current selected rotation vehicles that will be applied for
    'each instruction without vehicle selected
    For ilLoop = 0 To lbcVehicle.ListCount - 1 Step 1
        If lbcVehicle.Selected(ilLoop) Then
            ilRet = gParseItem(Trim(lbcVehicle.List(ilLoop)), 1, "/", slRotVefName)
            Exit For
        End If
    Next ilLoop
    llCategoryRowSort(0) = -1
    ilInAllSaveRec = imInAllSaveRec
    'For ilCategory = 1 To 12 Step 1
        For llRow = grdRot.FixedRows To grdRot.rows - 1 Step 1
            If grdRot.TextMatrix(llRow, COPYINDEX) <> "" Then
                ilAdd = False
                If (grdRot.TextMatrix(llRow, REGIONNAMEINDEX) <> "") And (grdRot.TextMatrix(llRow, STATUSINDEX) <> "N") And (grdRot.TextMatrix(llRow, STATUSINDEX) <> "M") Then
                    If ilInCategory = 1 Then
                        If grdRot.TextMatrix(llRow, REGIONNAMEINDEX) = "Generic" Then
                            ilAdd = True
                        End If
                    Else
                        slStr = Trim$(grdRot.TextMatrix(llRow, REGIONNAMEINDEX))
                        If slStr <> "Generic" Then
                            For ilLoop = 2 To lbcRGRegion.ListCount - 1 Step 1
                                If StrComp(slStr, lbcRGRegion.List(ilLoop), 1) = 0 Then
                                    For ilIndex = 0 To UBound(tmRegionCategory) - 1 Step 1
                                        If tmRegionCategory(ilIndex).lRafCode = lbcRGRegion.ItemData(ilLoop) Then
                                            If tmRegionCategory(ilIndex).iMaxCategory = ilInCategory Then
                                                ilAdd = True
                                            End If
                                            Exit For
                                        End If
                                    Next ilIndex
                                    Exit For
                                End If
                            Next ilLoop
                        End If
                    End If
                    
                Else
                    Select Case ilInCategory
                        Case 1  'Generic
                            If grdRot.TextMatrix(llRow, REGIONNAMEINDEX) = "Generic" Then
                                ilAdd = True
                            End If
                        Case 2  'Time Zone w/o Format
                            If grdRot.TextMatrix(llRow, CATEGORYINDEX) = "Time Zone" Then
                                If Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) = "" Then
                                    ilAdd = True
                                End If
                            End If
                        Case 3  'State w/o Format
                            If grdRot.TextMatrix(llRow, CATEGORYINDEX) = "State Name" Then
                                If Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) = "" Then
                                    ilAdd = True
                                End If
                            End If
                        Case 4  'DMA Market w/o Format
                            If grdRot.TextMatrix(llRow, CATEGORYINDEX) = "DMA Market" Then
                                If Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) = "" Then
                                    ilAdd = True
                                End If
                            End If
                        Case 5  'MSA Market w/o Format
                            If grdRot.TextMatrix(llRow, CATEGORYINDEX) = "MSA Market" Then
                                If Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) = "" Then
                                    ilAdd = True
                                End If
                            End If
                        Case 6  'Station w/o Format
                            If grdRot.TextMatrix(llRow, CATEGORYINDEX) = "Station" Then
                                If Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) = "" Then
                                    ilAdd = True
                                End If
                            End If
                        Case 7  'Format Only
                            If grdRot.TextMatrix(llRow, CATEGORYINDEX) = "[None]" Or grdRot.TextMatrix(llRow, CATEGORYINDEX) = "" Then
                                If Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) <> "" Then
                                    ilAdd = True
                                End If
                            End If
                        Case 8  'Format with Time Zone
                            If grdRot.TextMatrix(llRow, CATEGORYINDEX) = "Time Zone" Then
                                If Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) <> "" Then
                                    ilAdd = True
                                End If
                            End If
                        Case 9  'Format with State
                            If grdRot.TextMatrix(llRow, CATEGORYINDEX) = "State Name" Then
                                If Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) <> "" Then
                                    ilAdd = True
                                End If
                            End If
                        Case 10  'Format with DMA Market
                            If grdRot.TextMatrix(llRow, CATEGORYINDEX) = "DMA Market" Then
                                If Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) <> "" Then
                                    ilAdd = True
                                End If
                            End If
                        Case 11  'Format with MSA Market
                            If grdRot.TextMatrix(llRow, CATEGORYINDEX) = "MSA Market" Then
                                If Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) <> "" Then
                                    ilAdd = True
                                End If
                            End If
                        Case 12  'Format with Station
                            If grdRot.TextMatrix(llRow, CATEGORYINDEX) = "Station" Then
                                If Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) <> "" Then
                                    ilAdd = True
                                End If
                            End If
                    End Select
                End If
                If ilAdd Then
                    llCategoryRowSort(UBound(llCategoryRowSort)) = llRow
                    ReDim Preserve llCategoryRowSort(0 To UBound(llCategoryRowSort) + 1) As Long
                End If
            End If
        Next llRow
    'Next ilCategory
    blRotGen = False
    imInAllSaveRec = True
    'For llRow = grdRot.FixedRows To grdRot.Rows - 1 Step 1
    If UBound(llCategoryRowSort) <= LBound(llCategoryRowSort) Then
        mSaveGridRot = True
        Exit Function
    End If
    llLastRow = llCategoryRowSort(UBound(llCategoryRowSort) - 1)
    For ilCategory = 0 To UBound(llCategoryRowSort) - 1 Step 1
        llRow = llCategoryRowSort(ilCategory)
        If (grdRot.TextMatrix(llRow, COPYINDEX) <> "") Then
            
            If grdRot.TextMatrix(llRow, RGVEHICLEINDEX) <> "" Then
                slStr = grdRot.TextMatrix(llRow, RGVEHICLEINDEX)
                slFields = Split(slStr, "; ")
                ReDim tmCrfVefCode(0 To 0) As CRFVEFCODE
                If IsArray(slFields) Then
                    For ilField = 0 To UBound(slFields) Step 1
                        For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1
                            slNameCode = tgCVehicle(ilLoop).sKey
                            ilRet = gParseItem(slNameCode, 1, "\", slName)
                            ilRet = gParseItem(slName, 3, "|", slName)
                            ilRet = gParseItem(slNameCode, 2, "\", slCode)
                            If (slFields(ilField) = slName) Or (Mid(slFields(ilField), 3) = slName) Then
                                '4/21/15: Filter out disallow split copy vehicles.  This filter only works if imSave(2) is defined which it is not.
                                If mTestIfRegionAllowed(True, Val(slCode)) Then
                                    tmCrfVefCode(UBound(tmCrfVefCode)).iVefCode = Val(slCode)
                                    tmCrfVefCode(UBound(tmCrfVefCode)).iNextFinal = 1
                                    tmCrfVefCode(UBound(tmCrfVefCode)).iNextPrelim = 1
                                    ReDim Preserve tmCrfVefCode(0 To UBound(tmCrfVefCode) + 1) As CRFVEFCODE
                                End If
                                Exit For
                            End If
                        Next ilLoop
                    Next ilField
                End If
            Else
                'slStr = slRotVefName
                ReDim tmCrfVefCode(0 To UBound(tlCrfVefCode)) As CRFVEFCODE   'Array of vehicles associated with the rotation
                For ilLoop = 0 To UBound(tlCrfVefCode) Step 1
                    tmCrfVefCode(ilLoop).iVefCode = tlCrfVefCode(ilLoop).iVefCode
                    tmCrfVefCode(ilLoop).iNextFinal = tlCrfVefCode(ilLoop).iNextFinal
                    tmCrfVefCode(ilLoop).iNextPrelim = tlCrfVefCode(ilLoop).iNextPrelim
                Next ilLoop
            End If
            'slFields = Split(slStr, "; ")
            'If IsArray(slFields) Then
            If UBound(tmCrfVefCode) > 0 Then
                'For ilField = 0 To UBound(slFields) Step 1
                '    blVehicleOk = False
                '    If slFields(ilField) = slRotVefName Then
                '        blVehicleOk = True
                '    End If
                '    If blVehicleOk Then
                        imRotIndex = 0
                        For ilIndex = imLBCtrls To UBound(tmCtrls) Step 1
                            tmCtrls(ilIndex).iChg = True
                        Next ilIndex
                        If (llRow = llLastRow) And (ilInCategory = ilInMaxCategory) Then
                            imInAllSaveRec = ilInAllSaveRec
                        End If
                        'Set Region field
                        imSave(1) = -1
                        'If llRow = grdRot.FixedRows Then
                        If grdRot.TextMatrix(llRow, REGIONNAMEINDEX) = "Generic" Then
                            If lbcZones.List(0) = "[Generic]" Then
                                imSave(1) = 0
                            ElseIf lbcZones.List(1) = "[Generic]" Then
                                imSave(1) = 1
                            End If
                        Else
                            If grdRot.TextMatrix(llRow, STATUSINDEX) = "N" Then 'New
                                'Create Region and add to list
                                ilRet = mCreateRafSef(llRow)
                                If ilRet Then
                                    ilRet = mAddRafSef()
                                    If ilRet Then
                                        'Add name to Zone
                                        mVehOptIndex
                                        grdRot.TextMatrix(llRow, STATUSINDEX) = ""
                                        grdRot.TextMatrix(llRow, RAFCODEINDEX) = tmRaf.lCode
                                        tmRegionCategory(UBound(tmRegionCategory)).lRafCode = tmRaf.lCode
                                        tmRegionCategory(UBound(tmRegionCategory)).iMaxCategory = ilInCategory
                                        ReDim Preserve tmRegionCategory(0 To UBound(tmRegionCategory) + 1) As REGIONCATEGORY
                                    End If
                                End If
                            ElseIf grdRot.TextMatrix(llRow, STATUSINDEX) = "M" Then 'Model
                                ''Create Region and add to list
                                'ilRet = mReadRecRafSef(grdRot.TextMatrix(llRow, RAFCODEINDEX))
                                ilRet = mCreateRafSef(llRow)
                                If ilRet Then
                                    ilRet = mAddRafSef()
                                    If ilRet Then
                                        'Add name to Zone
                                        mVehOptIndex
                                        grdRot.TextMatrix(llRow, STATUSINDEX) = ""
                                        grdRot.TextMatrix(llRow, RAFCODEINDEX) = tmRaf.lCode
                                        tmRegionCategory(UBound(tmRegionCategory)).lRafCode = tmRaf.lCode
                                        tmRegionCategory(UBound(tmRegionCategory)).iMaxCategory = ilInCategory
                                        ReDim Preserve tmRegionCategory(0 To UBound(tmRegionCategory) + 1) As REGIONCATEGORY
                                    End If
                                End If
                            End If
                            For ilZone = 0 To lbcZones.ListCount - 1 Step 1
                                If grdRot.TextMatrix(llRow, REGIONNAMEINDEX) = lbcZones.List(ilZone) Then
                                    imSave(1) = ilZone
                                    lbcZones.ListIndex = ilZone
                                    mSetRGCtrl
                                    grdRot.Visible = True
                                    Exit For
                                End If
                            Next ilZone
                        End If
                        'Set Blackout field
                        If grdRot.TextMatrix(llRow, ADVTINDEX) <> "" Then
                            For ilBlackout = 0 To cbcBlackout.ListCount - 1 Step 1
                                If cbcBlackout.List(ilBlackout) = grdRot.TextMatrix(llRow, ADVTINDEX) Then
                                    imBlackoutIndex = ilBlackout
                                    cbcBlackout.Visible = True
                                    Exit For
                                End If
                            Next ilBlackout
                        Else
                            imBlackoutIndex = -1
                        End If
                        'Set copy
                        ilRet = mGeneratePattern(llRow)
                        
                        If imSave(1) <> -1 Then
                            '4/21/15: Filter vehicles here as imSave(2) is now defined
                            'ilFound = mTestIfRegionAllowed(True)
                            'If ilFound Then
                            ReDim tlTempVefCode(0 To 0) As CRFVEFCODE
                            For ilLoop = 0 To UBound(tmCrfVefCode) - 1 Step 1
                                If mTestIfRegionAllowed(True, tmCrfVefCode(ilLoop).iVefCode) Then
                                    tlTempVefCode(UBound(tlTempVefCode)).iVefCode = tmCrfVefCode(ilLoop).iVefCode
                                    tlTempVefCode(UBound(tlTempVefCode)).iNextFinal = tmCrfVefCode(ilLoop).iNextFinal
                                    tlTempVefCode(UBound(tlTempVefCode)).iNextPrelim = tmCrfVefCode(ilLoop).iNextPrelim
                                    ReDim Preserve tlTempVefCode(0 To UBound(tlTempVefCode) + 1) As CRFVEFCODE
                                End If
                            Next ilLoop
                            ReDim tmCrfVefCode(0 To UBound(tlTempVefCode)) As CRFVEFCODE
                            For ilLoop = 0 To UBound(tlTempVefCode) Step 1
                                tmCrfVefCode(ilLoop).iVefCode = tlTempVefCode(ilLoop).iVefCode
                                tmCrfVefCode(ilLoop).iNextFinal = tlTempVefCode(ilLoop).iNextFinal
                                tmCrfVefCode(ilLoop).iNextPrelim = tlTempVefCode(ilLoop).iNextPrelim
                            Next ilLoop
                            If UBound(tmCrfVefCode) > 0 Then
                                blRotGen = True
                                smComment = Trim$(smRGComment(llRow))
                                ilRet = mSaveRec()
                                If ilRet = False Then
                                    gSetMousePointer grdRot, grdRot, vbDefault
                                    mSaveGridRot = False
                                    Exit Function
                                End If
                                gSetMousePointer grdRot, grdRot, vbHourglass
                                mAdjustCufAndCif "U", tmCrf, lmCifCode()
                                ReDim lmCifCode(0 To 0) As Long
                                imAskQuestions = False
                                imCheckInv = False
                            End If
                        End If
                '    End If
                'Next ilField
            End If
        End If
    Next ilCategory
    'If (Not blRotGen) And (ilInAllSaveRec = False) And (ilInCategory = ilInMaxCategory) Then
    '    ilRet = mGridSavedRemoved(True)
    '    '8/14/12: SSpeed-up setting of copy inventory rotation dates
    '    mAdjustCufAndCif "U", tmCrf, lmCifCode()
    '    mRotPop False
    '    For ilLoop = imLBCtrls To UBound(tmCtrls) Step 1
    '        tmCtrls(ilLoop).iChg = False
    '    Next ilLoop
    '    imRotHeaderChgOnly = True
    '    mSetCommands
    '    imInAllSaveRec = False
    '    If lbcRot.ListIndex = -1 Then
    '        lbcRot_Click
    '    Else
    '        lbcRot.ListIndex = -1
    '    End If
    'End If
    ReDim tmCrfVefCode(0 To UBound(tlCrfVefCode)) As CRFVEFCODE   'Array of vehicles associated with the rotation
    For ilLoop = 0 To UBound(tlCrfVefCode) Step 1
        tmCrfVefCode(ilLoop).iVefCode = tlCrfVefCode(ilLoop).iVefCode
        tmCrfVefCode(ilLoop).iNextFinal = tlCrfVefCode(ilLoop).iNextFinal
        tmCrfVefCode(ilLoop).iNextPrelim = tlCrfVefCode(ilLoop).iNextPrelim
    Next ilLoop
    mSaveGridRot = True
End Function

Private Sub mGridRestore()
    Dim ilRet As Integer
    Dim slCode As String    'code number
    Dim slNameCode As String
    Dim ilAdfCode As Integer
    Dim llRow As Long
    Dim ilLoop As Integer
    Dim slCategory As String
    Dim blGetRegionName As Boolean
    Dim llCopy As Long
    Dim llLastRow As Long
    Dim llLoop As Long
    Dim llStart As Long
    Dim slStr As String
    Dim ilRegionExit As Boolean
    ReDim llCifCode(0 To 0) As Long
    ReDim ilCount(0 To 0) As Integer
    
    'For llRow = grdRot.FixedRows To grdRot.Rows - 1 Step 1
   '
    'Next llRow
    mClearRG
    If imAdvtIndex < 0 Then
        Exit Sub
    End If
    bmInCmcGrid = True
    edcRGDropdown.MaxLength = 0
    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    ilAdfCode = Val(slCode)
    If lmGnfCode <= 0 Then
        tmGnfSrchKey2.iAdfCode = ilAdfCode
        tmGnfSrchKey2.sGridName = "Current Working"
        ilRet = btrGetEqual(hmGnf, tmGnf, imGnfRecLen, tmGnfSrchKey2, INDEXKEY2, BTRV_LOCK_NONE, SETFORREADONLY)
        If ilRet <> BTRV_ERR_NONE Then
            lmGnfCode = 0
            bmInCmcGrid = False
            Exit Sub
        End If
        lmGnfCode = tmGnf.lCode
    Else
        tmGnfSrchKey.lCode = lmGnfCode
        ilRet = btrGetEqual(hmGnf, tmGnf, imGnfRecLen, tmGnfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        If ilRet <> BTRV_ERR_NONE Then
            lmGnfCode = 0
            bmInCmcGrid = False
            Exit Sub
        End If
    End If
    smGridName = Trim$(tmGnf.sGridName)
    tmGpfSrchKey1.lGnfCode = lmGnfCode
    tmGpfSrchKey1.iRowNo = 1
    ilRet = btrGetGreaterOrEqual(hmGpf, tmGpf, imGpfRecLen, tmGpfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
    If ilRet <> BTRV_ERR_NONE Then
        bmInCmcGrid = False
        Exit Sub
    End If
    
    gSetMousePointer grdRot, grdRot, vbHourglass
    imBlackoutAdfCode = 0
    If lbcRGAdvt.ListCount <= 0 Then
        mAdvtBlackoutPop
    End If
    'llRow = grdRot.FixedRows
    'llLastRow = llRow
    Do While (ilRet = BTRV_ERR_NONE) And (tmGpf.lGnfCode = lmGnfCode)
        'llRow = tmGpf.iRowNo  ' TTP 10786 JJB 2023-07-30
        llRow = llRow + 1      ' TTP 10786 JJB 2023-07-30
        For ilLoop = 0 To lbcRGVehicle.ListCount - 1 Step 1
            lbcRGVehicle.Selected(ilLoop) = False
        Next ilLoop
        tmGcfSrchKey1.lGpfCode = tmGpf.lCode
        tmGcfSrchKey1.iSeqNo = 0
        ilRet = btrGetGreaterOrEqual(hmGcf, tmGcf, imGcfRecLen, tmGcfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
        Do While (ilRet = BTRV_ERR_NONE) And (tmGcf.lGpfCode = tmGpf.lCode)
            lmRGEnableCol = lmRGEnableCol
            tmGtfSrchKey1.lGpfCode = tmGpf.lCode
            ilRet = btrGetEqual(hmGtf, tmGtf, imGtfRecLen, tmGtfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)   'Get first record as starting point of extend operation
            If ilRet <> BTRV_ERR_NONE Then
                tmGtf.sRegionName = ""
                tmGtf.sType = ""
            End If
            If llRow >= grdRot.rows Then
                grdRot.AddItem ""
                grdRot.rowHeight(llRow) = fgFlexGridRowH
                grdRot.TextMatrix(llRow, ADVTINDEX) = ""
            End If
            grdRot.Row = llRow
            lmRGEnableRow = llRow
            grdRot.TextMatrix(llRow, GPFCODEINDEX) = tmGpf.lCode
            'If blGetRegionName Then
                If ilRet = BTRV_ERR_NONE Then
                    If Trim$(tmGtf.sRegionName) = "Generic" Then
                        lbcRGRegion.ListIndex = 0
                        edcRGDropdown.Text = "[Generic]"
                    ElseIf tmGtf.sType = "N" Then
                        lbcRGRegion.ListIndex = -1
                        edcRGDropdown.Text = Trim$(tmGtf.sRegionName)
                        'Check if restoring from pressing the Grid button.  When grid saved the new region name was not added yet.
                        For ilLoop = 0 To lbcRGRegion.ListCount - 1 Step 1
                            If Trim$(tmGtf.sRegionName) = Trim$(lbcRGRegion.List(ilLoop)) Then
                                lbcRGRegion.ListIndex = ilLoop
                                lgSplitModelCodeRaf = lbcRGRegion.ItemData(ilLoop)
                                If (tmGcf.sType = "M") Or (tmGcf.sType = "A") Or (tmGcf.sType = "N") Or (tmGcf.sType = "F") Or (tmGcf.sType = "T") Or (tmGcf.sType = "S") Or (tmGcf.sType = "I") Then
                                    tmGcf.sType = ""
                                End If
                                Exit For
                            End If
                        Next ilLoop
                    ElseIf tmGtf.sType = "M" Then
                        lbcRGRegion.ListIndex = 1
                        edcRGDropdown.Text = "[Model]"
                        lgSplitModelCodeRaf = tmGtf.lRafCode
                    ElseIf Trim$(tmGtf.sType) = "" Then
                        lbcRGRegion.ListIndex = -1
                        edcRGDropdown.Text = ""
                    Else
                        For ilLoop = 0 To lbcRGRegion.ListCount - 1 Step 1
                            If tmGtf.lRafCode = lbcRGRegion.ItemData(ilLoop) Then
                                lbcRGRegion.ListIndex = ilLoop
                                lgSplitModelCodeRaf = tmGtf.lRafCode
                                Exit For
                            End If
                        Next ilLoop
                    End If
                    lmRGEnableCol = REGIONNAMEINDEX
                    mRGSetShow
                End If
            'End If
            lmRGEnableRow = llRow
            Select Case tmGcf.sType
                Case "G"    'Generic
                Case "M"    'DMA
                    slCategory = "DMA Market"
                Case "A"    'MSA
                    slCategory = "MSA Market"
                Case "N"    'State Name
                    slCategory = "State Name"
                Case "F"    'Format
                    slCategory = "Format"
                Case "T"    'Time Zone
                    slCategory = "Time Zone"
                Case "S"    'Station
                    slCategory = "Station"
                Case "B"    'Blackout
                    For ilLoop = 0 To lbcRGAdvt.ListCount - 1 Step 1
                        If tmGcf.iIntCode = Val(lbcRGAdvt.ItemData(ilLoop)) Then
                            lbcRGAdvt.ListIndex = ilLoop
                            edcRGDropdown.Text = lbcRGAdvt.List(ilLoop)
                            grdRot.TextMatrix(lmRGEnableRow, ADVTINDEX) = edcRGDropdown.Text
                            Exit For
                        End If
                    Next ilLoop
                    lmRGEnableCol = ADVTINDEX
                    mRGSetShow
                Case "C"    'Copy
                    llCifCode(UBound(llCifCode)) = tmGcf.lLongCode
                    ilCount(UBound(ilCount)) = tmGcf.iCopyCount
                    ReDim Preserve llCifCode(0 To UBound(llCifCode) + 1) As Long
                    ReDim Preserve ilCount(0 To UBound(ilCount) + 1) As Integer
                Case "I"    'Include/Exclude
                    If tmGcf.sInclExcl = "E" Then
                        smRGInclExcl = "Exclude"
                    ElseIf tmGcf.sInclExcl = "E" Then
                        smRGInclExcl = "Include"
                    Else
                        smRGInclExcl = ""
                    End If
                    lmRGEnableCol = INCLEXCLINDEX
                    grdRot.TextMatrix(lmRGEnableRow, lmRGEnableCol) = smRGInclExcl
                Case "V"    'Vehicle
                    lmRGEnableCol = RGVEHICLEINDEX
                    For ilLoop = 0 To lbcRGVehicle.ListCount - 1 Step 1
                        If tmGcf.iIntCode = Val(lbcRGVehicle.ItemData(ilLoop)) Then
                            lbcRGVehicle.Selected(ilLoop) = True
                            Exit For
                        End If
                    Next ilLoop
                    mRGSetShow
            End Select
            lmRGEnableRow = llRow
            Select Case tmGcf.sType
                Case "M", "A", "N", "F", "T", "S"
                    lmRGEnableCol = CATEGORYINDEX
                    mPopRGCategory slCategory
                    If tmGcf.sType <> "F" Then
                        edcRGDropdown.Text = slCategory
                        For ilLoop = 0 To lbcRGCategory.ListCount - 1 Step 1
                            If slCategory = lbcRGCategory.List(ilLoop) Then
                                lbcRGCategory.ListIndex = ilLoop
                                Exit For
                            End If
                        Next ilLoop
                        mRGSetShow
                    End If
                    If tmGcf.sType <> "F" Then
                        lmRGEnableCol = SELECTIONINDEX
                    Else
                        lmRGEnableCol = FORMATINDEX
                    End If
                    lmRGEnableRow = llRow
                    For ilLoop = 0 To lbcRGSelection(imRGSelection).ListCount - 1 Step 1
                        If tmGcf.iIntCode = Val(lbcRGSelection(imRGSelection).ItemData(ilLoop)) Then
                            lbcRGSelection(imRGSelection).Selected(ilLoop) = True
                            Exit For
                        End If
                    Next ilLoop
                    mRGSetShow
            End Select
            
            lmRGEnableRow = llRow
            If tmGpf.iRowNo >= UBound(smRGComment) Then
                llStart = UBound(smRGComment)
                ReDim Preserve smRGComment(0 To tmGpf.iRowNo + 1)
                For llLoop = llStart To UBound(smRGComment) Step 1
                    smRGComment(llLoop) = ""
                Next llLoop
            End If
            If tmGpf.lCsfCode <> 0 Then
                tmCsfSrchKey.lCode = tmGpf.lCsfCode
                imCsfRecLen = Len(tmCsf) '5011
                ilRet = btrGetEqual(hmCsf, tmCsf, imCsfRecLen, tmCsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
                If ilRet = BTRV_ERR_NONE Then
                    edcRGComment.Text = Trim$(gStripChr0(tmCsf.sComment))
                    lmRGEnableCol = RGCOMMENTINDEX
                    mRGSetShow
                End If
            End If
            
            lmRGEnableRow = llRow
            ilRet = btrGetNext(hmGcf, tmGcf, imGcfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
        If bmRetainGridCopy Then
            lmRGEnableRow = llRow
            smRGSource = "U" 'User
            imBlackoutAdfCode = 0
            slStr = grdRot.TextMatrix(lmRGEnableRow, ADVTINDEX)
            If slStr <> "" Then
                gFindMatch slStr, 0, lbcRGAdvt
                If gLastFound(lbcRGAdvt) >= 0 Then
                    imBlackoutAdfCode = lbcRGAdvt.ItemData(gLastFound(lbcRGAdvt))
                End If
            End If
            'mInvPop
            If (imCurrentBlackoutAdfCode <> imBlackoutAdfCode) And (imBlackoutAdfCode <> 0) Then
                mInvPop
            ElseIf imBlackoutAdfCode = 0 Then
                If imCurrentAdvtIndex <> imAdvtIndex Then
                    mInvPop
                End If
            End If
            For llCopy = grdCopy.FixedRows To grdCopy.rows - 1 Step 1
                grdCopy.TextMatrix(llCopy, REPEATINDEX) = ""
            Next llCopy
            For ilLoop = 0 To UBound(llCifCode) - 1 Step 1
                For llCopy = grdCopy.FixedRows To grdCopy.rows - 1 Step 1
                    If llCifCode(ilLoop) = Val(grdCopy.TextMatrix(llCopy, CIFCODEINDEX)) Then
                        grdCopy.TextMatrix(llCopy, REPEATINDEX) = ilCount(ilLoop)
                        Exit For
                    End If
                Next llCopy
            Next ilLoop
            lmRGEnableRow = lmRGEnableRow
            lmRGEnableCol = COPYINDEX
            smRGSource = "P"
            mRGSetShow
            ReDim llCifCode(0 To 0) As Long
            ReDim ilCount(0 To 0) As Integer
            blGetRegionName = True
        End If
        ilRet = btrGetNext(hmGpf, tmGpf, imGpfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
    bmInCmcGrid = False
    mSetCommands
    gSetMousePointer grdRot, grdRot, vbDefault
End Sub

Private Sub mClearCG()
    Dim llRow As Long
    Dim ilCol As Integer
    
    grdCopy.rows = imCGRows
    For llRow = grdCopy.FixedRows To grdCopy.rows - 1 Step 1
        grdCopy.rowHeight(llRow) = fgFlexGridRowH
        grdCopy.Row = llRow
        For ilCol = 0 To grdCopy.cols - 1 Step 1
            If (ilCol = CIFCODEINDEX) Then
                grdCopy.TextMatrix(llRow, ilCol) = 0
            Else
                grdCopy.TextMatrix(llRow, ilCol) = ""
            End If
            grdCopy.Col = ilCol
            grdCopy.CellBackColor = WHITE
        Next ilCol
        grdCopy.CellBackColor = WHITE
    Next llRow
End Sub

Private Function mGridSaved(llRow As Long, blLoadInv As Boolean) As Integer
    Dim ilAdfCode As Integer
    Dim llGpfCode As Long
    Dim ilRet As Integer
    Dim ilLoop As Integer
    Dim ilEnteredOrderNo As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim ilSeqNo As Integer
    Dim llLoop As Long
    Dim ilPos As Integer
    Dim llCopyRow As Long
    Dim ilRepeat As Integer
    Dim slCopy As String
    Dim slStr As String
    Dim llRGEnableRow As Long
    Dim llRGEnableCol As Long
    Dim slFields() As String
    
    If Not imUpdateAllowed Then
        mGridSaved = True
        Exit Function
    End If
    If imAdvtIndex < 0 Then
        mGridSaved = True
        Exit Function
    End If
    If llRow < grdRot.FixedRows Then
        mGridSaved = True
        Exit Function
    End If
    llRGEnableRow = lmRGEnableRow
    llRGEnableCol = lmRGEnableCol
    edcRGDropdown.MaxLength = 0
    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    ilAdfCode = Val(slCode)
    
    If lmGnfCode <= 0 Then
        tmGnf.lCode = 0
        tmGnf.iAdfCode = ilAdfCode
        tmGnf.sGridName = smGridName
        gPackDate Format(gNow(), "m/d/yy"), tmGnf.iEnteredDate(0), tmGnf.iEnteredDate(1)
        gPackTime Format(gNow(), "h:mm:ssAM/PM"), tmGnf.iEnteredTime(0), tmGnf.iEnteredTime(1)
        tmGnf.iUrfCode = tgUrf(0).iCode
        tmGnf.sUnused = ""
        ilRet = btrInsert(hmGnf, tmGnf, imGnfRecLen, INDEXKEY0)
        If ilRet <> BTRV_ERR_NONE Then
            mGridSaved = False
            Exit Function
        End If
        lmGnfCode = tmGnf.lCode
    Else
        Do
            tmGnfSrchKey.lCode = lmGnfCode
            ilRet = btrGetEqual(hmGnf, tmGnf, imGnfRecLen, tmGnfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
            If ilRet <> BTRV_ERR_NONE Then
                Exit Do
            End If
            tmGnf.sGridName = smGridName
            ilRet = btrUpdate(hmGnf, tmGnf, imGnfRecLen)
        Loop While ilRet = BTRV_ERR_CONFLICT
    End If
    If Val(grdRot.TextMatrix(llRow, CSFCODEINDEX)) > 0 Then
        Do
            tmCsfSrchKey.lCode = Val(grdRot.TextMatrix(llRow, CSFCODEINDEX))
            imCsfRecLen = Len(tmCsf) '5011
            ilRet = btrGetEqual(hmCsf, tmCsf, imCsfRecLen, tmCsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
            If ilRet <> BTRV_ERR_NONE Then
                Exit Do
            End If
            If Trim$(smRGComment(llRow)) = "" Then
                ilRet = btrDelete(hmCsf)
            Else
                imCsfRecLen = Len(tmCsf) '5011
                tmCsf.sComment = Trim$(smRGComment(llRow)) & Chr$(0)
                ilRet = btrUpdate(hmCsf, tmCsf, imCsfRecLen)
            End If
        Loop While ilRet = BTRV_ERR_CONFLICT
        If Trim$(smRGComment(llRow)) = "" Then
            grdRot.TextMatrix(llRow, CSFCODEINDEX) = "0"
        End If
    Else
        If Trim$(smRGComment(llRow)) <> "" Then
            imCsfRecLen = Len(tmCsf)
            tmCsf.lCode = 0
            tmCsf.sComment = Trim$(smRGComment(llRow)) & Chr$(0)
            tmCsf.iAdfCode = ilAdfCode
            tmCsf.sType = "R"
            ilRet = btrInsert(hmCsf, tmCsf, imCsfRecLen, INDEXKEY0)
            If ilRet = BTRV_ERR_NONE Then
                grdRot.TextMatrix(llRow, CSFCODEINDEX) = tmCsf.lCode
            End If
        End If
    End If
    If Val(grdRot.TextMatrix(llRow, GPFCODEINDEX)) > 0 Then
        llGpfCode = Val(grdRot.TextMatrix(llRow, GPFCODEINDEX))
        'Delete then add
        tmGcfSrchKey1.lGpfCode = llGpfCode
        tmGcfSrchKey1.iSeqNo = 1
        ilRet = btrGetGreaterOrEqual(hmGcf, tmGcf, imGcfRecLen, tmGcfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
        Do While (ilRet = BTRV_ERR_NONE) And (tmGcf.lGpfCode = llGpfCode)
            ilRet = btrDelete(hmGcf)
            tmGcfSrchKey1.lGpfCode = llGpfCode
            tmGcfSrchKey1.iSeqNo = 1
            ilRet = btrGetGreaterOrEqual(hmGcf, tmGcf, imGcfRecLen, tmGcfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
        Loop
        'Delete then add
        tmGtfSrchKey1.lGpfCode = llGpfCode
        ilRet = btrGetEqual(hmGtf, tmGtf, imGtfRecLen, tmGtfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)
        Do While ilRet = BTRV_ERR_NONE
            ilRet = btrDelete(hmGtf)
            tmGtfSrchKey1.lGpfCode = llGpfCode
            ilRet = btrGetEqual(hmGtf, tmGtf, imGtfRecLen, tmGcfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
        Do
            tmGpfSrchKey.lCode = Val(grdRot.TextMatrix(llRow, GPFCODEINDEX))
            ilRet = btrGetEqual(hmGpf, tmGpf, imGpfRecLen, tmGpfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
            If ilRet <> BTRV_ERR_NONE Then
                Exit Do
            End If
            tmGpf.lCsfCode = Val(grdRot.TextMatrix(llRow, CSFCODEINDEX))
            ilRet = btrUpdate(hmGpf, tmGpf, imGpfRecLen)
        Loop While ilRet = BTRV_ERR_CONFLICT
    Else
        tmGpf.lCode = 0
        tmGpf.lGnfCode = lmGnfCode
        tmGpf.iRowNo = llRow
        tmGpf.lCsfCode = Val(grdRot.TextMatrix(llRow, CSFCODEINDEX))
        tmGpf.sUnused = ""
        ilRet = btrInsert(hmGpf, tmGpf, imGpfRecLen, INDEXKEY0)
        If ilRet <> BTRV_ERR_NONE Then
            mGridSaved = False
            Exit Function
        End If
        llGpfCode = tmGpf.lCode
        grdRot.TextMatrix(llRow, GPFCODEINDEX) = llGpfCode
    End If
    
    ilSeqNo = 0
    'Vehicle
    lmRGEnableRow = llRow
    lmRGEnableCol = RGVEHICLEINDEX
    mSetRGVehicles llRow
    lmRGEnableRow = llRGEnableRow
    lmRGEnableCol = llRGEnableCol
    tmGcf.lGpfCode = llGpfCode
    tmGcf.sType = "V"
    tmGcf.sInclExcl = ""
    For ilLoop = 0 To lbcRGVehicle.ListCount - 1 Step 1
        If lbcRGVehicle.Selected(ilLoop) Then
            tmGcf.lCode = 0
            ilSeqNo = ilSeqNo + 1
            tmGcf.iSeqNo = ilSeqNo
            tmGcf.iIntCode = lbcRGVehicle.ItemData(ilLoop)
            tmGcf.lLongCode = 0
            tmGcf.iCopyCount = 0
            tmGcf.sUnused = ""
            ilRet = btrInsert(hmGcf, tmGcf, imGcfRecLen, INDEXKEY0)
        End If
    Next ilLoop
    
    'Region
    tmGtf.lCode = 0
    tmGtf.lGpfCode = llGpfCode
    tmGtf.sType = grdRot.TextMatrix(llRow, STATUSINDEX)
    If tmGtf.sType = "M" Then   'Treat Model as New
        tmGtf.sType = "N"
    End If
    tmGtf.lRafCode = Val(grdRot.TextMatrix(llRow, RAFCODEINDEX))
    tmGtf.sRegionName = grdRot.TextMatrix(llRow, REGIONNAMEINDEX)
    tmGtf.sUnused = ""
    ilRet = btrInsert(hmGtf, tmGtf, imGtfRecLen, INDEXKEY0)
    If ilRet <> BTRV_ERR_NONE Then
        mGridSaved = False
        Exit Function
    End If
    'Category
    If grdRot.TextMatrix(llRow, CATEGORYINDEX) <> "" Then
        tmGcf.lGpfCode = llGpfCode
        mPopRGCategory grdRot.TextMatrix(llRow, CATEGORYINDEX)
        If imRGSelection >= 0 Then
            If grdRot.TextMatrix(llRow, CATEGORYINDEX) = "DMA Market" Then
                tmGcf.sType = "M"
            ElseIf grdRot.TextMatrix(llRow, CATEGORYINDEX) = "MSA Market" Then
                tmGcf.sType = "A"
            ElseIf grdRot.TextMatrix(llRow, CATEGORYINDEX) = "State Name" Then
                tmGcf.sType = "N"
            ElseIf grdRot.TextMatrix(llRow, CATEGORYINDEX) = "Time Zone" Then
                tmGcf.sType = "T"
            ElseIf grdRot.TextMatrix(llRow, CATEGORYINDEX) = "Station" Then
                tmGcf.sType = "S"
            End If
            'Selection
            slStr = Trim$(grdRot.TextMatrix(llRow, SELECTIONINDEX))
            If slStr = "Missing" Then
                slStr = ""
            End If
            lmRGEnableCol = SELECTIONINDEX
            mSetRGSelection slStr
            lmRGEnableCol = llRGEnableCol
            For ilLoop = 0 To lbcRGSelection(imRGSelection).ListCount - 1 Step 1
                If lbcRGSelection(imRGSelection).Selected(ilLoop) Then
                    tmGcf.lCode = 0
                    ilSeqNo = ilSeqNo + 1
                    tmGcf.iSeqNo = ilSeqNo
                    tmGcf.iIntCode = lbcRGSelection(imRGSelection).ItemData(ilLoop)
                    tmGcf.lLongCode = 0
                    tmGcf.sInclExcl = ""
                    tmGcf.iCopyCount = 0
                    tmGcf.sUnused = ""
                    ilRet = btrInsert(hmGcf, tmGcf, imGcfRecLen, INDEXKEY0)
                End If
            Next ilLoop
        End If
    End If
    'Include/Exclude
    tmGcf.lCode = 0
    tmGcf.lGpfCode = llGpfCode
    ilSeqNo = ilSeqNo + 1
    tmGcf.iSeqNo = ilSeqNo
    tmGcf.sType = "I"
    If grdRot.TextMatrix(llRow, INCLEXCLINDEX) = "Include" Then
        tmGcf.sInclExcl = "I"
    ElseIf grdRot.TextMatrix(llRow, INCLEXCLINDEX) = "Exclude" Then
        tmGcf.sInclExcl = "E"
    Else
        tmGcf.sInclExcl = "N"
    End If
    tmGcf.iIntCode = 0
    tmGcf.lLongCode = 0
    tmGcf.iCopyCount = 0
    tmGcf.sUnused = ""
    ilRet = btrInsert(hmGcf, tmGcf, imGcfRecLen, INDEXKEY0)
    'Format
    If (grdRot.TextMatrix(llRow, INCLEXCLINDEX) = "Include") Or (grdRot.TextMatrix(llRow, INCLEXCLINDEX) = "Exclude") Then
        mPopRGCategory "Format" 'grdRot.TextMatrix(llRow, FORMATINDEX)
        tmGcf.lGpfCode = llGpfCode
        tmGcf.sType = "F"
        tmGcf.sInclExcl = ""
        If imRGSelection >= 0 Then
            slStr = Trim$(grdRot.TextMatrix(llRow, FORMATINDEX))
            If slStr = "Missing" Then
                slStr = ""
            End If
            mSetRGSelection slStr
            'bypass [None]
            For ilLoop = 1 To lbcRGSelection(imRGSelection).ListCount - 1 Step 1
                If lbcRGSelection(imRGSelection).Selected(ilLoop) Then
                    tmGcf.lCode = 0
                    ilSeqNo = ilSeqNo + 1
                    tmGcf.iSeqNo = ilSeqNo
                    tmGcf.iIntCode = lbcRGSelection(imRGSelection).ItemData(ilLoop)
                    tmGcf.lLongCode = 0
                    tmGcf.iCopyCount = 0
                    tmGcf.sUnused = ""
                    ilRet = btrInsert(hmGcf, tmGcf, imGcfRecLen, INDEXKEY0)
                End If
            Next ilLoop
        End If
    End If
    'Blackout
    If grdRot.TextMatrix(llRow, ADVTINDEX) <> "" Then
        tmGcf.lCode = 0
        tmGcf.lGpfCode = llGpfCode
        tmGcf.sType = "B"
        tmGcf.sInclExcl = ""
        For ilLoop = 0 To lbcRGAdvt.ListCount - 1 Step 1
            If lbcRGAdvt.List(ilLoop) = grdRot.TextMatrix(llRow, ADVTINDEX) Then
                tmGcf.lCode = 0
                ilSeqNo = ilSeqNo + 1
                tmGcf.iSeqNo = ilSeqNo
                tmGcf.iIntCode = lbcRGAdvt.ItemData(ilLoop)
                tmGcf.lLongCode = 0
                tmGcf.iCopyCount = 0
                tmGcf.sUnused = ""
                ilRet = btrInsert(hmGcf, tmGcf, imGcfRecLen, INDEXKEY0)
                Exit For
            End If
        Next ilLoop
    End If
    'Copy
    tmGcf.lGpfCode = llGpfCode
    tmGcf.sType = "C"
    tmGcf.sInclExcl = ""
    If blLoadInv Then
        imBlackoutAdfCode = 0
        slStr = grdRot.TextMatrix(llRow, ADVTINDEX)
        If slStr <> "" Then
            gFindMatch slStr, 0, lbcRGAdvt
            If gLastFound(lbcRGAdvt) >= 0 Then
                imBlackoutAdfCode = lbcRGAdvt.ItemData(gLastFound(lbcRGAdvt))
            End If
        End If
        If (imCurrentBlackoutAdfCode <> imBlackoutAdfCode) And (imBlackoutAdfCode <> 0) Then
            mInvPop
        ElseIf imBlackoutAdfCode = 0 Then
            If imCurrentAdvtIndex <> imAdvtIndex Then
                mInvPop
            End If
        End If
        slStr = grdRot.TextMatrix(llRow, COPYINDEX)
        For llCopyRow = grdCopy.FixedRows To grdCopy.rows - 1 Step 1
            grdCopy.TextMatrix(llCopyRow, REPEATINDEX) = ""
        Next llCopyRow
        slFields = Split(slStr, "; ")
        If IsArray(slFields) Then
            For ilLoop = 0 To UBound(slFields) Step 1
                ilRepeat = 1
                ilPos = InStr(1, slFields(ilLoop), "(", vbTextCompare)
                If ilPos > 0 Then
                    slCopy = Left$(slFields(ilLoop), ilPos - 1)
                    slStr = Mid(slFields(ilLoop), ilPos + 1)
                    ilRepeat = Val(Left$(slStr, Len(slStr) - 1))
                Else
                    slCopy = slFields(ilLoop)
                End If
                For llCopyRow = grdCopy.FixedRows To grdCopy.rows - 1 Step 1
                    If (slCopy = grdCopy.TextMatrix(llCopyRow, CARTINDEX)) Or (slCopy = grdCopy.TextMatrix(llCopyRow, ISCIINDEX)) Then
                        grdCopy.TextMatrix(llCopyRow, REPEATINDEX) = ilRepeat
                        Exit For
                    End If
                Next llCopyRow
            Next ilLoop
        End If
    End If
    For ilLoop = grdCopy.FixedRows To grdCopy.rows - 1 Step 1
        If grdCopy.TextMatrix(ilLoop, REPEATINDEX) <> "" Then
            tmGcf.lCode = 0
            ilSeqNo = ilSeqNo + 1
            tmGcf.iSeqNo = ilSeqNo
            tmGcf.iIntCode = 0
            tmGcf.lLongCode = grdCopy.TextMatrix(ilLoop, CIFCODEINDEX)
            tmGcf.iCopyCount = grdCopy.TextMatrix(ilLoop, REPEATINDEX)
            tmGcf.sUnused = ""
            ilRet = btrInsert(hmGcf, tmGcf, imGcfRecLen, INDEXKEY0)
        End If
    Next ilLoop
    
    mGridSaved = True
End Function

Private Sub mRGVehPop()
    Dim ilLoop As Integer
    Dim slNameCode As String
    Dim slName As String
    Dim slCode As String
    Dim ilRet As Integer
    Dim ilIndex As Integer
    Dim ilFound As Integer
    Dim ilVef As Integer
    Dim ilVefCode As Integer
    Dim ilClf As Integer
    Dim ilHidden As Integer
    Dim ilTest As Integer
    Dim slPrefix As String
    
    lbcRGVehicle.Clear
    If Trim$(smSave(2)) = "[All]" Then
        For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1
            slNameCode = tgCVehicle(ilLoop).sKey
            'If (Left$(slNameCode, 1) <> "1") And (Left$(slNameCode, 1) <> "2") Then
            If (Left$(slNameCode, 1) <> "2") And (Left$(slNameCode, 1) <> "4") Then
                ilRet = gParseItem(slNameCode, 1, "\", slName)
                ilRet = gParseItem(slName, 3, "|", slName)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                slPrefix = ""
                If Left$(slNameCode, 1) = "2" Then
                    slPrefix = "H:"
                ElseIf Left$(slNameCode, 1) = "4" Then
                    slPrefix = "A:"
                ElseIf Left$(slNameCode, 1) = "3" Then
                    slPrefix = "MG:"
                ElseIf Left$(slNameCode, 1) = "1" Then
                Else
                End If
                lbcRGVehicle.AddItem slPrefix & Trim$(slName)
                lbcRGVehicle.ItemData(lbcRGVehicle.NewIndex) = slCode
            End If
        Next ilLoop
    ElseIf Trim$(smSave(2)) = smSeveral Then
        If lbcVehicle.Selected(0) And (imAllVehAdj = 1) Then  'All
            For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1
                slNameCode = tgCVehicle(ilLoop).sKey
                'If (Left$(slNameCode, 1) <> "1") And (Left$(slNameCode, 1) <> "2") Then
                If (Left$(slNameCode, 1) <> "2") And (Left$(slNameCode, 1) <> "4") Then
                    ilRet = gParseItem(slNameCode, 1, "\", slName)
                    ilRet = gParseItem(slName, 3, "|", slName)
                    ilRet = gParseItem(slNameCode, 2, "\", slCode)
                    slPrefix = ""
                    If Left$(slNameCode, 1) = "2" Then
                        slPrefix = "H:"
                    ElseIf Left$(slNameCode, 1) = "4" Then
                        slPrefix = "A:"
                    ElseIf Left$(slNameCode, 1) = "3" Then
                        slPrefix = "MG:"
                    ElseIf Left$(slNameCode, 1) = "1" Then
                    Else
                    End If
                    lbcRGVehicle.AddItem slPrefix & Trim$(slName)
                    lbcRGVehicle.ItemData(lbcRGVehicle.NewIndex) = slCode
                End If
            Next ilLoop
        End If
        For ilLoop = imAllVehAdj To lbcVehicle.ListCount - 1 Step 1
            If lbcVehicle.Selected(ilLoop) Then
                ilFound = False
                slNameCode = tgCVehicle(ilLoop - imAllVehAdj).sKey
                ilRet = gParseItem(slNameCode, 1, "\", slName)
                ilRet = gParseItem(slName, 3, "|", slName)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                For ilIndex = 0 To lbcRGVehicle.ListCount - 1 Step 1
                    If Val(slCode) = lbcRGVehicle.ItemData(ilIndex) Then
                        ilFound = True
                        Exit For
                    End If
                Next ilIndex
                If Not ilFound Then
                    slPrefix = ""
                    If Left$(slNameCode, 1) = "2" Then
                        slPrefix = "H:"
                    ElseIf Left$(slNameCode, 1) = "4" Then
                        slPrefix = "A:"
                    ElseIf Left$(slNameCode, 1) = "3" Then
                        slPrefix = "MG:"
                    ElseIf Left$(slNameCode, 1) = "1" Then
                    Else
                    End If
                    lbcRGVehicle.AddItem slPrefix & Trim$(slName)
                    lbcRGVehicle.ItemData(lbcRGVehicle.NewIndex) = slCode
                End If
            End If
        Next ilLoop
    Else
        For ilLoop = imAllVehAdj To lbcVehicle.ListCount - 1 Step 1
            If lbcVehicle.Selected(ilLoop) Then
                slNameCode = tgCVehicle(ilLoop - imAllVehAdj).sKey
                ilRet = gParseItem(slNameCode, 1, "\", slName)
                ilRet = gParseItem(slName, 3, "|", slName)
                ilRet = gParseItem(slNameCode, 2, "\", slCode)
                slPrefix = ""
                If Left$(slNameCode, 1) = "2" Then
                    slPrefix = "H:"
                ElseIf Left$(slNameCode, 1) = "4" Then
                    slPrefix = "A:"
                ElseIf Left$(slNameCode, 1) = "3" Then
                    slPrefix = "MG:"
                ElseIf Left$(slNameCode, 1) = "1" Then
                Else
                End If
                lbcRGVehicle.AddItem slPrefix & Trim$(slName)
                lbcRGVehicle.ItemData(lbcRGVehicle.NewIndex) = slCode
                Exit For
            End If
        Next ilLoop
    End If
    'Add hidden Lines
'    For ilLoop = 0 To lbcRGVehicle.ListCount - 1 Step 1
'        ilVefCode = lbcRGVehicle.ItemData(ilLoop)
'        ilVef = gBinarySearchVef(ilVefCode)
'        If ilVef <> -1 Then
'            If tgMVef(ilVef).sType = "P" Then
'                For ilClf = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
'                    If tgClfCopy(ilClf).ClfRec.iVefCode = ilVefCode Then
'                        For ilHidden = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
'                            If tgClfCopy(ilClf).ClfRec.iLine = tgClfCopy(ilHidden).ClfRec.iPkLineNo Then
'                                If tgClfCopy(ilClf).ClfRec.iLen = tgClfCopy(ilHidden).ClfRec.iLen Then
'                                    ilFound = False
'                                    For ilTest = 0 To lbcRGVehicle.ListCount - 1 Step 1
'                                        If lbcRGVehicle.ItemData(ilTest) = tgClfCopy(ilHidden).ClfRec.iVefCode Then
'                                            ilFound = True
'                                            Exit For
'                                        End If
'                                    Next ilTest
'                                    If Not ilFound Then
'                                        ilVef = gBinarySearchVef(tgClfCopy(ilHidden).ClfRec.iVefCode)
'                                        If ilVef <> -1 Then
'                                            lbcRGVehicle.AddItem Trim$(tgMVef(ilVef).sName)
'                                            lbcRGVehicle.ItemData(lbcRGVehicle.NewIndex) = tgMVef(ilVef).iCode
'                                        End If
'                                    End If
'                                End If
'                            End If
'                        Next ilHidden
'                    End If
'                Next ilClf
'            End If
'        End If
'    Next ilLoop
End Sub

Private Sub mSetRGVehicles(llRow As Long)
    Dim slStr As String
    Dim ilLoop As Integer
    Dim slFields() As String
    
    slStr = grdRot.TextMatrix(llRow, RGVEHICLEINDEX)
    If slStr = "Missing" Then
        slStr = ""
    End If
    For ilLoop = 0 To lbcRGVehicle.ListCount - 1 Step 1
        imEdcChgMode = True
        lbcRGVehicle.Selected(ilLoop) = False
    Next ilLoop
    imEdcChgMode = False
    If slStr <> "" Then
        slFields = Split(slStr, "; ")
        If IsArray(slFields) Then
            For ilLoop = 0 To UBound(slFields) Step 1
                gFindMatch slFields(ilLoop), 0, lbcRGVehicle
                If gLastFound(lbcRGVehicle) >= 0 Then
                    lbcRGVehicle.Selected(gLastFound(lbcRGVehicle)) = True
                End If
            Next ilLoop
        End If
    Else
        'If (llRow <> grdRot.FixedRows) Then
        '    slStr = grdRot.TextMatrix(llRow - 1, RGVEHICLEINDEX)
        'End If
        'If (llRow = grdRot.FixedRows) Or (slStr = "") Or (slStr = "Missing") Then
            For ilLoop = 0 To lbcRGVehicle.ListCount - 1 Step 1
                lbcRGVehicle.Selected(ilLoop) = True
            Next ilLoop
        'Else
        '    slFields = Split(slStr, "; ")
        '    If IsArray(slFields) Then
        '        For ilLoop = 0 To UBound(slFields) Step 1
        '            gFindMatch slFields(ilLoop), 0, lbcRGVehicle
        '            If gLastFound(lbcRGVehicle) >= 0 Then
        '                lbcRGVehicle.Selected(gLastFound(lbcRGVehicle)) = True
        '            End If
        '        Next ilLoop
        '    End If
        'End If
    End If
End Sub


Private Function mGridSavedRemoved(slGridName As String) As Integer
    Dim ilAdfCode As Integer
    Dim llGpfCode As Long
    Dim ilRet As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim llRow As Long
    
    If imAdvtIndex < 0 Then
        mGridSavedRemoved = True
        Exit Function
    End If
    slNameCode = tgCopyAdvertiser(imAdvtIndex).sKey    'Traffic!lbcAdvertiser.List(imAdvtIndex)
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    ilAdfCode = Val(slCode)
    tmGnfSrchKey2.iAdfCode = ilAdfCode
    tmGnfSrchKey2.sGridName = slGridName
    ilRet = btrGetEqual(hmGnf, tmGnf, imGnfRecLen, tmGnfSrchKey2, INDEXKEY2, BTRV_LOCK_NONE, SETFORREADONLY)
    If ilRet = BTRV_ERR_NONE Then
        tmGpfSrchKey1.lGnfCode = tmGnf.lCode
        tmGpfSrchKey1.iRowNo = 1
        ilRet = btrGetGreaterOrEqual(hmGpf, tmGpf, imGpfRecLen, tmGpfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
        Do While (ilRet = BTRV_ERR_NONE) And (tmGpf.lGnfCode = tmGnf.lCode)
            llGpfCode = tmGpf.lCode
            If tmGpf.lCsfCode > 0 Then
                tmCsfSrchKey.lCode = tmGpf.lCsfCode
                imCsfRecLen = Len(tmCsf) '5011
                ilRet = btrGetEqual(hmCsf, tmCsf, imCsfRecLen, tmCsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
                If ilRet = BTRV_ERR_NONE Then
                    ilRet = btrDelete(hmCsf)
                End If
            End If
            tmGcfSrchKey1.lGpfCode = llGpfCode
            tmGcfSrchKey1.iSeqNo = 0
            ilRet = btrGetGreaterOrEqual(hmGcf, tmGcf, imGcfRecLen, tmGcfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
            Do While (ilRet = BTRV_ERR_NONE) And (tmGcf.lGpfCode = llGpfCode)
                ilRet = btrDelete(hmGcf)
                tmGcfSrchKey1.lGpfCode = llGpfCode
                tmGcfSrchKey1.iSeqNo = 0
                ilRet = btrGetGreaterOrEqual(hmGcf, tmGcf, imGcfRecLen, tmGcfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
            Loop
            'Delete then add
            tmGtfSrchKey1.lGpfCode = llGpfCode
            ilRet = btrGetGreaterOrEqual(hmGtf, tmGtf, imGtfRecLen, tmGtfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
            Do While (ilRet = BTRV_ERR_NONE) And (tmGtf.lGpfCode = llGpfCode)
                ilRet = btrDelete(hmGtf)
                tmGtfSrchKey1.lGpfCode = llGpfCode
                ilRet = btrGetGreaterOrEqual(hmGtf, tmGtf, imGtfRecLen, tmGcfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
            Loop
            ilRet = btrDelete(hmGpf)
            tmGpfSrchKey1.lGnfCode = tmGnf.lCode
            tmGpfSrchKey1.iRowNo = 1
            ilRet = btrGetGreaterOrEqual(hmGpf, tmGpf, imGpfRecLen, tmGpfSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)
        Loop
        ilRet = btrDelete(hmGnf)
    End If
    
    mGridSavedRemoved = True
End Function

Private Sub mSetRGSelection(slStr As String)
    Dim ilLoop As Integer
    Dim slFields() As String
    If slStr <> "" Then
        slFields = Split(slStr, "; ")
        If IsArray(slFields) Then
            For ilLoop = 0 To UBound(slFields) Step 1
                gFindMatch slFields(ilLoop), 0, lbcRGSelection(imRGSelection)
                If gLastFound(lbcRGSelection(imRGSelection)) >= 0 Then
                    lbcRGSelection(imRGSelection).Selected(gLastFound(lbcRGSelection(imRGSelection))) = True
                End If
            Next ilLoop
        End If
    Else
        '5/22/13: Don't default to any items selected.
        'If lbcRGSelection(imRGSelection).ListCount > 0 Then
        '    lbcRGSelection(imRGSelection).Selected(0) = True
        'End If
    End If
End Sub

Private Function mTestRotGrid() As Integer
    Dim llRow As Long
    Dim ilLoop As Integer
    Dim ilContinue As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim ilVefCode As Integer
    Dim ilRet As Integer
    Dim slName As String
    Dim slVefNames As String
    Dim ilVef As Integer
    Dim ilVpf As Integer
    Dim ilCount As Integer
    Dim llTestRow As Long
    Dim slStr As String
    Dim blVehicleOk As Boolean
    Dim ilField As Integer
    Dim slRotVefName As String
    Dim slFields() As String
    
    ilContinue = True
    mTestRotGrid = True
    If Not grdRot.Visible Then
        Exit Function
    End If
    ilCount = 0
    For llRow = grdRot.FixedRows To grdRot.rows - 1 Step 1
        If grdRot.TextMatrix(llRow, COPYINDEX) <> "" Then
            If grdRot.TextMatrix(llRow, REGIONNAMEINDEX) <> "Generic" Then
                ilCount = ilCount + 1
                grdRot.Row = llRow
                If ((Trim$(grdRot.TextMatrix(llRow, REGIONNAMEINDEX))) = "") Or ((Trim$(grdRot.TextMatrix(llRow, REGIONNAMEINDEX))) = "Missing") Then
                    grdRot.Col = REGIONNAMEINDEX
                    grdRot.CellForeColor = vbRed
                    grdRot.TextMatrix(llRow, REGIONNAMEINDEX) = "Missing"
                    ilContinue = False
                Else
                    grdRot.Col = CATEGORYINDEX
                    If mRGColOk() Then
                        If (grdRot.TextMatrix(llRow, STATUSINDEX) = "N") Or (grdRot.TextMatrix(llRow, STATUSINDEX) = "M") Then
                            If ((Trim$(grdRot.TextMatrix(llRow, CATEGORYINDEX)) = "") And (Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) = "") And (Trim$(grdRot.TextMatrix(llRow, ADVTINDEX)) = "")) Or (Trim$(grdRot.TextMatrix(llRow, CATEGORYINDEX)) = "Missing") Then
                                grdRot.Col = CATEGORYINDEX
                                grdRot.CellForeColor = vbRed
                                grdRot.TextMatrix(llRow, CATEGORYINDEX) = "Missing"
                                ilContinue = False
                            End If
                            If (Trim$(grdRot.TextMatrix(llRow, CATEGORYINDEX)) = "") And (Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) = "") Then
                                grdRot.Col = CATEGORYINDEX
                                grdRot.CellForeColor = vbRed
                                grdRot.TextMatrix(llRow, CATEGORYINDEX) = "Missing"
                                ilContinue = False
                            End If
                        End If
                    End If
                End If
                If (grdRot.TextMatrix(llRow, STATUSINDEX) = "N") Or (grdRot.TextMatrix(llRow, STATUSINDEX) = "M") Then
                    If (Trim$(grdRot.TextMatrix(llRow, CATEGORYINDEX)) <> "") Then
                        If (Trim$(grdRot.TextMatrix(llRow, SELECTIONINDEX)) = "") Or (Trim$(grdRot.TextMatrix(llRow, SELECTIONINDEX)) = "Missing") Then
                            grdRot.Col = SELECTIONINDEX
                            grdRot.CellForeColor = vbRed
                            grdRot.TextMatrix(llRow, SELECTIONINDEX) = "Missing"
                            ilContinue = False
                        End If
                    End If
                    If (Trim$(grdRot.TextMatrix(llRow, FORMATINDEX)) <> "") Then
                        If (Trim$(grdRot.TextMatrix(llRow, INCLEXCLINDEX)) = "") Or (Trim$(grdRot.TextMatrix(llRow, INCLEXCLINDEX)) = "Missing") Then
                            grdRot.Col = INCLEXCLINDEX
                            grdRot.CellForeColor = vbRed
                            grdRot.TextMatrix(llRow, INCLEXCLINDEX) = "Missing"
                            ilContinue = False
                        End If
                    End If
                    'Check for duplicate names
                    For llTestRow = grdRot.FixedRows To grdRot.rows - 1 Step 1
                        If grdRot.TextMatrix(llTestRow, COPYINDEX) <> "" Then
                            If llTestRow <> llRow Then
                                If UCase(Trim$(grdRot.TextMatrix(llTestRow, REGIONNAMEINDEX))) = UCase(Trim$(grdRot.TextMatrix(llRow, REGIONNAMEINDEX))) Then
                                    grdRot.Col = REGIONNAMEINDEX
                                    grdRot.CellForeColor = vbRed
                                    ilContinue = False
                                End If
                            End If
                        End If
                    Next llTestRow
                    'Check that name not previously used
                    For ilLoop = LBound(tmRegionCode) To UBound(tmRegionCode) - 1 Step 1
                        slNameCode = tmRegionCode(ilLoop).sKey    'lbcVehicleCode.List(ilLoop)
                        ilRet = gParseItem(slNameCode, 1, "\", slName)
                        If UCase(Trim$(slName)) = UCase(Trim$(grdRot.TextMatrix(llRow, REGIONNAMEINDEX))) Then
                            grdRot.Col = REGIONNAMEINDEX
                            grdRot.CellForeColor = vbRed
                            ilContinue = False
                        End If
                    Next ilLoop
                End If
            End If
            '1/17/14: TTP: 6598 check that vehicle is allowed
            If (Trim$(grdRot.TextMatrix(llRow, RGVEHICLEINDEX)) <> "") Then
                slStr = grdRot.TextMatrix(llRow, RGVEHICLEINDEX)
                slFields = Split(slStr, "; ")
                If IsArray(slFields) Then
                    blVehicleOk = False
                    For ilField = 0 To UBound(slFields) Step 1
                        For ilLoop = 0 To lbcVehicle.ListCount - 1 Step 1
                            If lbcVehicle.Selected(ilLoop) Then
                                ilRet = gParseItem(Trim(lbcVehicle.List(ilLoop)), 1, "/", slRotVefName)
                                If slFields(ilField) = slRotVefName Then
                                    blVehicleOk = True
                                    Exit For
                                End If
                            End If
                        Next ilLoop
                        If Not blVehicleOk Then
                            grdRot.Row = llRow
                            grdRot.Col = RGVEHICLEINDEX
                            grdRot.CellForeColor = vbRed
                            ilContinue = False
                            Exit For
                        End If
                    Next ilField
                End If
            End If
        End If
    Next llRow
    If Not ilContinue Then
        mTestRotGrid = False
        Exit Function
    End If
    If ilCount < 1 Then
        Exit Function
    End If
    slVefNames = ""
    For ilLoop = imAllVehAdj To lbcVehicle.ListCount - 1 Step 1
        If lbcVehicle.Selected(ilLoop) Then
            slNameCode = tgCVehicle(ilLoop - imAllVehAdj).sKey
            ilRet = gParseItem(slNameCode, 1, "\", slName)
            ilRet = gParseItem(slName, 3, "|", slName)
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            ilVefCode = Val(slCode)
            ilVef = gBinarySearchVef(ilVefCode)
            If ilVef <> -1 Then
                If (tgMVef(ilVef).sType = "C") Or (tgMVef(ilVef).sType = "A") Or (tgMVef(ilVef).sType = "G") Or (tgMVef(ilVef).sType = "S") Then
                    ilVpf = gBinarySearchVpf(ilVefCode)
                    If ilVpf <> -1 Then
                        If tgVpf(ilVpf).sAllowSplitCopy <> "Y" Then
                            ilContinue = False
                            If slVefNames = "" Then
                                slVefNames = slName
                            Else
                                slVefNames = slVefNames & ", " & slName
                            End If
                        End If
                    End If
                End If
            End If
        End If
    Next ilLoop
    If Not ilContinue Then
        ilRet = MsgBox("The following Vehicles don't allowed Split Copy " & slVefNames & ", Continue with Save", vbInformation + vbOKCancel, "Warning")
        If ilRet = vbCancel Then
            mTestRotGrid = False
        End If
    End If
End Function

Private Sub mSetAlerts(ilInVefCode As Integer, llStartDate As Long, llInEndDate As Long, llCvfCode As Long, llChfCode As Long)
    Dim ilVpf As Integer
    Dim llLastLogDate As Long
    Dim llNowDate As Long
    Dim llEndDate As Long
    Dim slLogDate As String
    Dim ilRet As Integer
    Dim llDate As Long
    Dim ilVef As Integer
    Dim ilCvf As Integer
    Dim ilIndex As Integer
    Dim tlCvf As CVF
    ReDim ilVefCode(0 To 0) As Integer
    
    If ilInVefCode = 0 Then
        tmCvfSrchKey.lCode = llCvfCode
        ilRet = btrGetEqual(hmCvf, tlCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        Do While ilRet = BTRV_ERR_NONE
            For ilCvf = 0 To 99 Step 1
                If tlCvf.iVefCode(ilCvf) > 0 Then
                    ilVefCode(UBound(ilVefCode)) = tlCvf.iVefCode(ilCvf)
                    ReDim Preserve ilVefCode(0 To UBound(ilVefCode) + 1) As Integer
                End If
            Next ilCvf
            If tlCvf.lLkCvfCode <= 0 Then
                Exit Do
            End If
            tmCvfSrchKey.lCode = tlCvf.lLkCvfCode
            ilRet = btrGetEqual(hmCvf, tlCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
    Else
        ReDim ilVefCode(0 To 1) As Integer
        ilVefCode(0) = ilInVefCode
    End If
    'Expand package vehicles
    For ilVef = 0 To UBound(ilVefCode) - 1 Step 1
        ilIndex = gBinarySearchVef(ilVefCode(ilVef))
        If ilIndex <> -1 Then
            If tgMVef(ilIndex).sType = "P" Then
                mExpandPackage llChfCode, ilVefCode(), ilVef
            End If
        End If
    Next ilVef
    
    For ilVef = 0 To UBound(ilVefCode) - 1 Step 1
        ilVpf = gBinarySearchVpfPlus(ilVefCode(ilVef))
        If ilVpf > 0 Then
            If (tgVpf(ilVpf).iLLD(0) <> 0) Or (tgVpf(ilVpf).iLLD(1) <> 0) Then
                gUnpackDateLong tgVpf(ilVpf).iLLD(0), tgVpf(ilVpf).iLLD(1), llLastLogDate
            Else
                llLastLogDate = -1
            End If
            If llInEndDate = 0 Then
                llEndDate = llLastLogDate
            Else
                llEndDate = llInEndDate
            End If
            llNowDate = gDateValue(Format$(gNow(), "m/d/yy"))
            If (llEndDate <> -1) And (llStartDate <= llLastLogDate) And (llLastLogDate <> -1) Then
                For llDate = llStartDate To llEndDate Step 7
                    If (llDate > llNowDate) And (llDate <= llLastLogDate) Then
                        slLogDate = Format$(llDate, "m/d/yy")
                        'ilRet = gAlertAdd("L", "C", 0, tmSdf.iVefCode, slLogDate)
                        ilRet = gAlertAdd("L", "C", 0, ilVefCode(ilVef), slLogDate)
                    End If
                Next llDate
            End If
        End If
    Next ilVef
End Sub

Private Sub mComputeGridCopyTotal()
    Dim llTotal As Long
    Dim llRow As Long
    
    llTotal = 0
    For llRow = grdCopy.FixedRows To grdCopy.rows - 1 Step 1
        llTotal = llTotal + Val(grdCopy.TextMatrix(llRow, REPEATINDEX))
    Next llRow
    edcGridTotal.Text = "Total: " & sgCR & sgLF & llTotal
End Sub

Private Function mVehicleOk(slNameCode As String, ilLen As Integer) As Boolean
    Dim ilRet As Integer
    Dim ilVefCode As Integer
    Dim ilVef As Integer
    Dim ilVpf As Integer
    Dim ilSAGroupNo As Integer
    Dim ilTest As Integer
    Dim blFound As Boolean
    Dim slCode As String
    
    blFound = False
    ilRet = gParseItem(slNameCode, 2, "\", slCode)
    ilVefCode = Val(slCode)
    ilVef = gBinarySearchVef(ilVefCode)
    If ilVef <> -1 Then
        If (Left$(slNameCode, 1) <> "3") Then
            If tgMVef(ilVef).sType = "A" Then
                ilVpf = gBinarySearchVpf(ilVefCode)
                If ilVpf <> -1 Then
                    ilSAGroupNo = tgVpf(ilVpf).iSAGroupNo
                    For ilTest = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
                        If ((tgClfCopy(ilTest).ClfRec.iLen = ilLen) And (imTypeIndex = 0)) Or ((tgClfCopy(ilTest).ClfRec.iBBOpenLen = ilLen) And (imTypeIndex = 1)) Or ((tgClfCopy(ilTest).ClfRec.iBBCloseLen = ilLen) And (imTypeIndex = 2)) Then
                            'Test if in same Group
                            ilVef = gBinarySearchVef(tgClfCopy(ilTest).ClfRec.iVefCode)
                            If ilVef <> -1 Then
                                If tgMVef(ilVef).sType = "S" Then
                                    ilVpf = gBinarySearchVpf(tgClfCopy(ilTest).ClfRec.iVefCode)
                                    If ilVpf <> -1 Then
                                        If ilSAGroupNo = tgVpf(ilVpf).iSAGroupNo Then
                                            blFound = True
                                            Exit For
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    Next ilTest
                End If
            Else
                For ilTest = LBound(tgClfCopy) To UBound(tgClfCopy) - 1 Step 1
                    If (tgClfCopy(ilTest).ClfRec.iVefCode = ilVefCode) And (((tgClfCopy(ilTest).ClfRec.iLen = ilLen) And (imTypeIndex = 0)) Or ((tgClfCopy(ilTest).ClfRec.iBBOpenLen = ilLen) And (imTypeIndex = 1)) Or ((tgClfCopy(ilTest).ClfRec.iBBCloseLen = ilLen) And (imTypeIndex = 2))) Then
                        blFound = True
                        Exit For
                    End If
                Next ilTest
            End If
        Else
            blFound = True
        End If
    End If
    mVehicleOk = blFound
End Function

Private Sub mSelectRotVehicles()
    Dim ilVef As Integer
    Dim ilLoop As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim ilRet As Integer
    
    For ilVef = 0 To UBound(tmCrfVefCode) - 1 Step 1
        For ilLoop = 0 To UBound(tgCVehicle) - 1 Step 1
            slNameCode = tgCVehicle(ilLoop).sKey
            ilRet = gParseItem(slNameCode, 2, "\", slCode)
            If Val(slCode) = tmCrfVefCode(ilVef).iVefCode Then
                lbcVehicle.Selected(ilLoop + imAllVehAdj) = True
                Exit For
            End If
        Next ilLoop
    Next ilVef
End Sub

Private Function mVehiclesMatch(tlCrf As CRF)
    Dim ilVef1 As Integer
    Dim ilVef2 As Integer
    Dim blFound As Boolean
    Dim tlCvf As CVF
    Dim ilRet As Integer
    Dim ilCvf As Integer
    ReDim ilCrfVefCode(0 To 0) As Integer
    
    If tlCrf.lCode = tmCrf.lCode Then
        mVehiclesMatch = False
        Exit Function
    End If
    If (tlCrf.iVefCode > 0) And (tmCrf.iVefCode <> tlCrf.iVefCode) Then
        mVehiclesMatch = False
        Exit Function
    End If
    If (tmCrf.iVefCode > 0) And (tmCrf.iVefCode <> tlCrf.iVefCode) Then
        mVehiclesMatch = False
        Exit Function
    End If
    If (tlCrf.iVefCode > 0) And (tmCrf.iVefCode = tlCrf.iVefCode) Then
        mVehiclesMatch = True
        Exit Function
    End If
    tmCvfSrchKey.lCode = tlCrf.lCvfCode
    ilRet = btrGetEqual(hmCvf, tlCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    Do While ilRet = BTRV_ERR_NONE
        For ilCvf = 0 To 99 Step 1
            If tlCvf.iVefCode(ilCvf) > 0 Then
                ilCrfVefCode(UBound(ilCrfVefCode)) = tlCvf.iVefCode(ilCvf)
                ReDim Preserve ilCrfVefCode(0 To UBound(ilCrfVefCode) + 1) As Integer
            End If
        Next ilCvf
        If tlCvf.lLkCvfCode <= 0 Then
            Exit Do
        End If
        tmCvfSrchKey.lCode = tlCvf.lLkCvfCode
        ilRet = btrGetEqual(hmCvf, tlCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
    If UBound(tmCrfVefCode) <> UBound(ilCrfVefCode) Then
        mVehiclesMatch = False
        Exit Function
    End If
    For ilVef1 = 0 To UBound(tmCrfVefCode) - 1 Step 1
        blFound = False
        For ilVef2 = 0 To UBound(ilCrfVefCode) - 1 Step 1
            If tmCrfVefCode(ilVef1).iVefCode = ilCrfVefCode(ilVef2) Then
                blFound = True
                Exit For
            End If
        Next ilVef2
        If Not blFound Then
            mVehiclesMatch = False
            Exit Function
        End If
    Next ilVef1
    mVehiclesMatch = True
End Function

Private Function mSetRegionFlagForGrid(blGridVisible As Boolean) As Integer

    mSetRegionFlagForGrid = imSave(1)
    If blGridVisible Then

    End If
End Function

Private Function mCreateStationRotation(tlInCrf As CRF) As Integer
    Dim tlCrf As CRF
    Dim tlCvf As CVF
    Dim ilCvf As Integer
    Dim ilShtt As Integer
    Dim ilRet As Integer
    Dim ilVef As Integer
    Dim ilIndex As Integer
    Dim ilTest As Integer
    Dim ilCnf As Integer
    Dim ilCaf As Integer
    Dim slInclExcl As String
    Dim llCrfCode As Long
    ReDim tlCnf(0 To 0) As CNF
    ReDim tlCaf(0 To 0) As CAF
    
    mCreateStationRotation = True
    'If ((Asc(tgSpf.sUsingFeatures2) And SPLITCOPY) <> SPLITCOPY) Then
    '    Exit Function
    'End If
    If Not bgStationAreVehicles Then
        Exit Function
    End If
    'If (Left$(tlCrf.sZone, 1) <> "R") Or (tlCrf.lRafCode <= 0) Then
    '    Exit Function
    'End If
    If (tlInCrf.iVefCode > 0) Then
        ReDim ilVefCode(0 To 1) As Integer
        ilVefCode(0) = tlInCrf.iVefCode
    Else
        ReDim ilVefCode(0 To 0) As Integer
        tmCvfSrchKey.lCode = tlInCrf.lCvfCode
        ilRet = btrGetEqual(hmCvf, tlCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        Do While ilRet = BTRV_ERR_NONE
            For ilCvf = 0 To 99 Step 1
                If tlCvf.iVefCode(ilCvf) > 0 Then
                    If mOkToAddStationVehicle(tlCvf.iVefCode(ilCvf), ilVefCode()) Then
                        ilVefCode(UBound(ilVefCode)) = tlCvf.iVefCode(ilCvf)
                        ReDim Preserve ilVefCode(0 To UBound(ilVefCode) + 1) As Integer
                    End If
                End If
            Next ilCvf
            If tlCvf.lLkCvfCode <= 0 Then
                Exit Do
            End If
            tmCvfSrchKey.lCode = tlCvf.lLkCvfCode
            ilRet = btrGetEqual(hmCvf, tlCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
        Loop
    End If
    'Expand package vehicles
    For ilVef = 0 To UBound(ilVefCode) - 1 Step 1
        ilIndex = gBinarySearchVef(ilVefCode(ilVef))
        If ilIndex <> -1 Then
            If tgMVef(ilIndex).sType = "P" Then
                mExpandPackage tlInCrf.lChfCode, ilVefCode(), ilVef
            End If
        End If
    Next ilVef
    If (UBound(ilVefCode) > 1) Or ((UBound(ilVefCode) = 1) And (ilVefCode(0) <> tlInCrf.iVefCode)) Then
        For ilVef = 0 To UBound(ilVefCode) - 1 Step 1
            If ilVefCode(ilVef) > 0 Then
                For ilShtt = LBound(tgVehicleStations) To UBound(tgVehicleStations) - 1 Step 1
                    If tgVehicleStations(ilShtt).iShttVefCode = ilVefCode(ilVef) Then
                        'Region if Region definition is to be assigned to the station
                        If (mStationInSplitCopy(tlInCrf.lRafCode, ilShtt)) Or (tlInCrf.lRafCode <= 0) Then
                            'Create new rotations based on tlCrf
                            llCrfCode = tlInCrf.lCode
                            tlCrf = tlInCrf
                            If tlInCrf.lCsfCode > 0 Then
                                tmCsfSrchKey.lCode = tlInCrf.lCsfCode
                                imCsfRecLen = Len(tmCsf) '5011
                                ilRet = btrGetEqual(hmCsf, tmCsf, imCsfRecLen, tmCsfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORWRITE)
                                If ilRet = BTRV_ERR_NONE Then
                                    tmCsf.lCode = 0 'Autoincrement
                                    ilRet = btrInsert(hmCsf, tmCsf, imCsfRecLen, INDEXKEY0)
                                    tlCrf.lCsfCode = tmCsf.lCode
                                End If
                            End If
                            tlCrf.lCode = 0
                            tlCrf.iVefCode = ilVefCode(ilVef)
                            tlCrf.lCvfCode = 0
                            tlCrf.sZone = ""
                            tlCrf.lRafCode = 0
                            mGetLastRotNo
                            tlCrf.iRotNo = imLastUsedRotNo + 1
                            ilRet = btrInsert(hmCrf, tlCrf, imCrfRecLen, INDEXKEY0)
                            If ilRet = BTRV_ERR_NONE Then
                                tmCnfSrchKey.lCrfCode = llCrfCode
                                tmCnfSrchKey.iInstrNo = 0
                                ilRet = btrGetGreaterOrEqual(hmCnf, tlCnf(UBound(tlCnf)), imCnfRecLen, tmCnfSrchKey, INDEXKEY0, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
                                Do While (ilRet = BTRV_ERR_NONE) And (tlCnf(UBound(tlCnf)).lCrfCode = llCrfCode)
                                    ReDim Preserve tlCnf(0 To UBound(tlCnf) + 1) As CNF
                                    ilRet = btrGetNext(hmCnf, tlCnf(UBound(tlCnf)), imCnfRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
                                Loop
                                For ilCnf = 0 To UBound(tlCnf) - 1 Step 1
                                    tlCnf(ilCnf).lCrfCode = tlCrf.lCode
                                    tlCnf(ilCnf).lCode = 0
                                    ilRet = btrInsert(hmCnf, tlCnf(ilCnf), imCnfRecLen, INDEXKEY1)
                                Next ilCnf
                                
                                tmCafSrchKey1.lCrfCode = llCrfCode
                                ilRet = btrGetGreaterOrEqual(hmCaf, tlCaf(UBound(tlCaf)), imCafRecLen, tmCafSrchKey1, INDEXKEY1, BTRV_LOCK_NONE)   'Get first record as starting point of extend operation
                                Do While (ilRet = BTRV_ERR_NONE) And (tlCaf(UBound(tlCaf)).lCrfCode = llCrfCode)
                                    ReDim Preserve tlCaf(0 To UBound(tlCaf) + 1) As CAF
                                    ilRet = btrGetNext(hmCaf, tlCaf(UBound(tlCaf)), imCafRecLen, BTRV_LOCK_NONE, SETFORREADONLY)
                                Loop
                                For ilCaf = 0 To UBound(tlCaf) - 1 Step 1
                                    tlCaf(ilCaf).lCrfCode = tlCrf.lCode
                                    tlCaf(ilCaf).lCode = 0
                                    ilRet = btrInsert(hmCaf, tlCaf(ilCaf), imCafRecLen, INDEXKEY0)
                                Next ilCaf
                                ReDim llCifCode(0 To 0) As Long
                                mBuildCifArray tlCrf, llCifCode()
                                mAdjustCufAndCif "U", tlCrf, llCifCode()
                            End If
                        End If
                        Exit For
                    End If
                Next ilShtt
            End If
        Next ilVef
    End If
End Function


Private Function mStationInSplitCopy(llRafCode As Long, ilShtt As Integer) As Boolean
    Dim llUpperSplit As Long
    Dim ilShttCode As Integer
    Dim ilMktCode As Integer
    Dim ilMSAMktCode As Integer
    Dim slState As String
    Dim ilFmtCode As Integer
    Dim ilTztCode As Integer
    Dim blFound As Boolean
    Dim llRegionIndex As Long
    Dim slGroupInfo As String
    Dim ilRet As Integer
    Dim tlRegionDefinition() As REGIONDEFINITION
    Dim tlSplitCategoryInfo() As SPLITCATEGORYINFO
    
    ReDim tlRegionDefinition(0 To 1) As REGIONDEFINITION
    ReDim tlSplitCategoryInfo(0 To 500) As SPLITCATEGORYINFO
    ReDim tmRegionDefinition(0 To 0) As REGIONDEFINITION
    ReDim tmSplitCategoryInfo(0 To 0) As SPLITCATEGORYINFO

    If llRafCode <= 0 Then
        mStationInSplitCopy = False
        Exit Function
    End If
    tmRafSrchKey.lCode = llRafCode
    ilRet = btrGetEqual(hmRaf, tmRaf, imRafRecLen, tmRafSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    If ilRet <> BTRV_ERR_NONE Then
        mStationInSplitCopy = False
        Exit Function
    End If
    tlRegionDefinition(0).lRotNo = 0
    tlRegionDefinition(0).lRafCode = tmRaf.lCode
    tlRegionDefinition(0).sCategory = Trim$(tmRaf.sCategory)
    tlRegionDefinition(0).sInclExcl = tmRaf.sInclExcl
    tlRegionDefinition(0).sRegionName = tmRaf.sName
    tlRegionDefinition(0).lFormatFirst = -1
    tlRegionDefinition(0).lOtherFirst = -1
    tlRegionDefinition(0).lExcludeFirst = -1
    tlRegionDefinition(0).sPtType = ""
    tlRegionDefinition(0).lCopyCode = 0
    tlRegionDefinition(0).lCrfCode = 0
    tlRegionDefinition(0).lRsfCode = 0
    
    llUpperSplit = 0
    gBuildSplitCategoryInfo hmSef, llUpperSplit, tlRegionDefinition(0), tlSplitCategoryInfo(), Copy
    ReDim Preserve tlSplitCategoryInfo(0 To llUpperSplit) As SPLITCATEGORYINFO
    gSeparateRegions tlRegionDefinition(), tlSplitCategoryInfo(), tmRegionDefinition(), tmSplitCategoryInfo()

    ilShttCode = tgVehicleStations(ilShtt).iCode
    
    ilMktCode = tgVehicleStations(ilShtt).iMktCode
    ilMSAMktCode = tgVehicleStations(ilShtt).iMetCode
    slState = tgVehicleStations(ilShtt).sState
    ilFmtCode = tgVehicleStations(ilShtt).iFmtCode
    ilTztCode = tgVehicleStations(ilShtt).iTztCode
    mStationInSplitCopy = gRegionTestDefinition(ilShttCode, ilMktCode, ilMSAMktCode, slState, ilFmtCode, ilTztCode, tmRegionDefinition(), tmSplitCategoryInfo(), llRegionIndex, slGroupInfo, Copy)

End Function

Private Sub mExpandPackage(llChfCode As Long, ilVefCode() As Integer, ilVefIndex As Integer)
    Dim blFirstVehicle As Boolean
    Dim ilRet As Integer
    Dim ilClf As Integer
    Dim ilTest As Integer
    Dim ilPkVefCode As Integer
    Dim tlClf() As CLFLIST
    
    blFirstVehicle = True
    ilPkVefCode = ilVefCode(ilVefIndex)
    ilRet = gObtainChfClf(hmCHF, hmClf, llChfCode, 0, tmChf, tlClf)
    If ilRet = -1 Then
        ilVefCode(ilVefIndex) = 0
        For ilClf = 0 To UBound(tlClf) - 1 Step 1
            If tlClf(ilClf).ClfRec.iVefCode = ilPkVefCode Then
                For ilTest = 0 To UBound(tlClf) - 1 Step 1
                    If tlClf(ilTest).ClfRec.iPkLineNo = tlClf(ilClf).ClfRec.iLine Then
                        If mOkToAddStationVehicle(tlClf(ilTest).ClfRec.iVefCode, ilVefCode()) Then
                            If blFirstVehicle Then
                                ilVefCode(ilVefIndex) = tlClf(ilTest).ClfRec.iVefCode
                                blFirstVehicle = False
                            Else
                                ilVefCode(UBound(ilVefCode)) = tlClf(ilTest).ClfRec.iVefCode
                                ReDim Preserve ilVefCode(0 To UBound(ilVefCode) + 1) As Integer
                            End If
                        End If
                    End If
                Next ilTest
            End If
        Next ilClf
    Else
        ilVefCode(ilVefIndex) = 0
    End If

End Sub

Private Function mOkToAddStationVehicle(ilStationVefCode As Integer, ilVefCode() As Integer) As Boolean
    Dim ilVef As Integer
    
    mOkToAddStationVehicle = True
    For ilVef = 0 To UBound(ilVefCode) - 1 Step 1
        If ilStationVefCode = ilVefCode(ilVef) Then
            mOkToAddStationVehicle = False
            Exit Function
        End If
    Next ilVef
End Function

Private Sub mBuildUnassignVef(tlCrf As CRF, ilTestVefCode() As Integer)
    Dim ilRet As Integer
    Dim ilCvf As Integer
    
    If tlCrf.iVefCode > 0 Then
        ReDim ilTestVefCode(0 To 1) As Integer
        ilTestVefCode(0) = tlCrf.iVefCode
        Exit Sub
    End If
    ReDim ilTestVefCode(0 To 0) As Integer
    tmCvfSrchKey.lCode = tmCrf.lCvfCode
    ilRet = btrGetEqual(hmCvf, tmCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    Do While ilRet = BTRV_ERR_NONE
        For ilCvf = 0 To 99 Step 1
            If tmCvf.iVefCode(ilCvf) > 0 Then
                ilTestVefCode(UBound(ilTestVefCode)) = tmCvf.iVefCode(ilCvf)
                ReDim Preserve ilTestVefCode(0 To UBound(ilTestVefCode) + 1) As Integer
            End If
        Next ilCvf
        If tmCvf.lLkCvfCode <= 0 Then
            Exit Do
        End If
        tmCvfSrchKey.lCode = tmCvf.lLkCvfCode
        ilRet = btrGetEqual(hmCvf, tmCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
    
End Sub

Private Sub mShowToolTip()
    Dim ilButtonIndex As Integer
    Dim ilRet As Integer
    Dim ilCvf As Integer
    Dim ilVef As Integer
    Dim slStr As String
    
    'If (imButtonIndex <= 0) Or (imButtonIndex >= lbcRot.ListCount) Then
    '    imButtonIndex = 0
    '    edcToolTip.Visible = False
    '    Exit Sub
    'End If
    ilButtonIndex = imButtonIndex
    ilRet = mReadRec(ilButtonIndex, True, SETFORREADONLY)
    If tmCrf.lCvfCode <= 0 Then
    '    imButtonIndex = 0
        edcToolTip.Visible = False
        Exit Sub
    End If
    gSetMousePointer grdRot, grdRot, vbHourglass
    tmCvfSrchKey.lCode = tmCrf.lCvfCode
    ilRet = btrGetEqual(hmCvf, tmCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    Do While ilRet = BTRV_ERR_NONE
        For ilCvf = 0 To 99 Step 1
            If tmCvf.iVefCode(ilCvf) > 0 Then
                ilVef = gBinarySearchVef(tmCvf.iVefCode(ilCvf))
                If ilVef <> -1 Then
                    If slStr = "" Then
                        slStr = Trim$(tgMVef(ilVef).sName)
                    Else
                        slStr = slStr & "; " & Trim$(tgMVef(ilVef).sName)
                    End If
                End If
            End If
        Next ilCvf
        If tmCvf.lLkCvfCode <= 0 Then
            Exit Do
        End If
        tmCvfSrchKey.lCode = tmCvf.lLkCvfCode
        ilRet = btrGetEqual(hmCvf, tmCvf, imCvfRecLen, tmCvfSrchKey, INDEXKEY0, BTRV_LOCK_NONE, SETFORREADONLY)
    Loop
    lacToolTip.Caption = slStr
    edcToolTip.Text = slStr
    edcToolTip.Width = lacToolTip.Width
    edcToolTip.height = lacToolTip.height + 60
    'edcToolTip.Move tmCtrls(VEHICLEINDEX).fBoxX, lbcRot.Top + Y + 360
    edcToolTip.Move lbcRot.Left, lbcRot.Top + lbcRot.height + 60
    edcToolTip.ZOrder
    edcToolTip.Visible = True
    gSetMousePointer grdRot, grdRot, vbDefault
End Sub


Private Sub mSetUnassignedDate(llDate As Long, llEarliestDateUnassigned As Long, llLatestDateUnassigned As Long)
    If llEarliestDateUnassigned = -1 Then
        llEarliestDateUnassigned = llDate
        llLatestDateUnassigned = llDate
    Else
        If llDate < llEarliestDateUnassigned Then
            llEarliestDateUnassigned = llDate
        End If
        If llDate > llLatestDateUnassigned Then
            llLatestDateUnassigned = llDate
        End If
    End If
End Sub

Private Function mGetDefaultAudioType() As Integer
    Dim slNameCode As String
    Dim slCode As String
    Dim ilRet As Integer
    Dim llChfCode As Long
    Dim slSQLQuery As String
    Dim ilLoop As Integer
    
    mGetDefaultAudioType = 1
    For ilLoop = 0 To 5 Step 1
        bmAllowedAudioTypes(ilLoop) = False
    Next ilLoop
    If ((Asc(tgSpf.sUsingFeatures) And LIVECOPY) <> LIVECOPY) And ((Asc(tgSpf.sUsingFeatures3) And PROMOCOPY) <> PROMOCOPY) Then 'Using Live Copy
        bmAllowedAudioTypes(1) = True
        Exit Function
    End If
    'bmAllowedAudioTypes(1) = True
    gFindMatch smSave(1), 0, lbcCntr
    If gLastFound(lbcCntr) >= 0 Then
        slNameCode = tmCopyCntrCode(gLastFound(lbcCntr)).sKey    'lbcCntrCode.List(gLastFound(lbcCntr))
        ilRet = gParseItem(slNameCode, 2, "\", slCode)
        llChfCode = Val(slCode)
    Else
        For ilLoop = 0 To 5 Step 1
            bmAllowedAudioTypes(ilLoop) = True
        Next ilLoop
        Exit Function
    End If
    slSQLQuery = "Select Count(If(clfLiveCopy = 'R', 1, Null)) as RCCount, "
    slSQLQuery = slSQLQuery & "Count(If(clfLiveCopy = 'L', 1, Null)) as LCCount, "
    slSQLQuery = slSQLQuery & "Count(If(clfLiveCopy = 'M', 1, Null)) as LPCount, "
    slSQLQuery = slSQLQuery & "Count(If(clfLiveCopy = 'S', 1, Null)) as RPCount, "
    slSQLQuery = slSQLQuery & "Count(If(clfLiveCopy = 'P', 1, Null)) as PCCount, "
    slSQLQuery = slSQLQuery & "Count(If(clfLiveCopy = 'Q', 1, Null)) as PPCount "
    slSQLQuery = slSQLQuery & " From clf_Contract_Line where clfChfCode = " & llChfCode
    slSQLQuery = slSQLQuery & " And clfLen = " & lbcLen.Text
    Set rst_clf = gSQLSelectCall(slSQLQuery)
    If rst_clf.EOF Then
        For ilLoop = 0 To 5 Step 1
            bmAllowedAudioTypes(ilLoop) = True
        Next ilLoop
        Exit Function
    End If
    
    If (rst_clf!RCCount = 0) And (rst_clf!LCCount = 0) And (rst_clf!LPCount = 0) And (rst_clf!RPCount = 0) And (rst_clf!PCCount = 0) And (rst_clf!PPCount = 0) Then
        For ilLoop = 0 To 5 Step 1
            bmAllowedAudioTypes(ilLoop) = True
        Next ilLoop
        Exit Function
    Else
        If (rst_clf!RCCount > 0) Then
            bmAllowedAudioTypes(1) = True
        End If
        If (rst_clf!LCCount > 0) Then
            bmAllowedAudioTypes(0) = True
        End If
        If (rst_clf!LPCount > 0) Then
            bmAllowedAudioTypes(2) = True
        End If
        If (rst_clf!RPCount > 0) Then
            bmAllowedAudioTypes(3) = True
        End If
        If (rst_clf!PCCount > 0) Then
            bmAllowedAudioTypes(4) = True
        End If
        If (rst_clf!PPCount > 0) Then
            bmAllowedAudioTypes(5) = True
        End If
    End If
    If (rst_clf!RCCount > 0) And (rst_clf!LCCount = 0) And (rst_clf!LPCount = 0) And (rst_clf!RPCount = 0) And (rst_clf!PCCount = 0) And (rst_clf!PPCount = 0) Then
        mGetDefaultAudioType = 1
    End If
    If (rst_clf!RCCount = 0) And (rst_clf!LCCount > 0) And (rst_clf!LPCount = 0) And (rst_clf!RPCount = 0) And (rst_clf!PCCount = 0) And (rst_clf!PPCount = 0) Then
        mGetDefaultAudioType = 0
    End If
    If (rst_clf!RCCount = 0) And (rst_clf!LCCount = 0) And (rst_clf!LPCount > 0) And (rst_clf!RPCount = 0) And (rst_clf!PCCount = 0) And (rst_clf!PPCount = 0) Then
        mGetDefaultAudioType = 2
    End If
    If (rst_clf!RCCount = 0) And (rst_clf!LCCount = 0) And (rst_clf!LPCount = 0) And (rst_clf!RPCount > 0) And (rst_clf!PCCount = 0) And (rst_clf!PPCount = 0) Then
        mGetDefaultAudioType = 3
    End If
    If (rst_clf!RCCount = 0) And (rst_clf!LCCount = 0) And (rst_clf!LPCount = 0) And (rst_clf!RPCount = 0) And (rst_clf!PCCount > 0) And (rst_clf!PPCount = 0) Then
        mGetDefaultAudioType = 4
    End If
    If (rst_clf!RCCount = 0) And (rst_clf!LCCount = 0) And (rst_clf!LPCount = 0) And (rst_clf!RPCount = 0) And (rst_clf!PCCount = 0) And (rst_clf!PPCount > 0) Then
        mGetDefaultAudioType = 5
    End If
End Function



Private Sub mInvPopPool(ilInISCIProd As Integer)
    Dim ilISCIProd As Integer
    ReDim tgActiveCode(0 To 0) As SORTCODE   'VB list box clear (list box used to retain code number so record can be found)
    ReDim tmPurgeCode(0 To 0) As SORTCODE   'VB list box clear (list box used to retain code number so record can be found)
    ReDim tmHistoryCode(0 To 0) As SORTCODE   'VB list box clear (list box used to retain code number so record can be found)
    smPurgeCodeTag = ""
    lbcPurge.Clear
    smHistoryCodeTag = ""
    lbcHistory.Clear
    smActiveCodeTag = ""
    lbcActive.Clear
    lbcInv.Clear
    lbcInst.Clear
    ilISCIProd = ilInISCIProd And &H7
    If tgSpf.sUseCartNo <> "N" Then
        If (ilISCIProd = 1) Or (ilISCIProd = 2) Then
            lbcInv.AddItem "30~[Pool-Cart]~[Pool-ISCI]", 0
        ElseIf (ilISCIProd = 3) Then
            lbcInv.AddItem "30~[Pool-ISCI]~[Pool-Cart]", 0
        Else
            lbcInv.AddItem "30~[Pool-ISCI]", 0
        End If
    Else
        lbcInv.AddItem "30 [Pool-ISCI]", 0
    End If
    lbcInv.ItemData(lbcInv.NewIndex) = POOLROTATION
    lbcInst.AddItem lbcInv.List(0)
    lbcInst.ItemData(lbcInst.NewIndex) = POOLROTATION
    pbcLbcInv_Paint
    pbcLbcInst_Paint
    mSetCommands
End Sub


